Imports System.Data.SqlClient
'Imports OpenNETCF.Desktop.Communication
'Imports FirebirdSql.Data.Client
'Imports FirebirdSql.Data.FirebirdClient
Imports System
Imports System.IO
Imports System.Math
Imports System.Xml
Imports System.DateTime
Imports Microsoft.VisualBasic
Imports System.Windows.Forms
'Imports System.Windows.Forms.VisualStyles.VisualStyleElement
Imports System.Reflection.Emit
'Imports Microsoft.Office.Interop.Excel
'Imports Excel = Microsoft.Office.Interop.Excel
'Imports System.Data.Sql
'Imports System.Net.Mail
'Imports System.Net.Mime
'Imports System.Security.Cryptography
'Imports System.Security.Cryptography.X509Certificates

Public Class MenuPrincipal
    Private ErrorEMp06 As Integer
    Private empresa As String
    Private documento As String
    Private mensaje As String
    'cliente 10
    Dim LongitudBD As Integer = 10
    Private vlRFC As String = ""
    Private vlRFC_CTE As String = ""
    Private vlSyncCompleta As Integer = 0
    Private DesactivarOCPed As Boolean
    Private vconttimer As Integer = 1
    Private vfVerificarErrorVta As Boolean
    Private vlActualizarEstatusPedidos As Integer
    Private vlActualizarEstatusOC As Integer
    Private varchivo As String
    Private vlMinitos As Integer
    Private Conexion As String = My.Settings.ConexionLocal
    Private connSAE As New SqlConnection(My.Settings.ConexionSAE)
    'Private conn As New SqlConnection(My.Settings.ConexionLocal)
    'Private connFB1 As New FbConnection(My.Settings.ConexionFB)
    'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    Private oTabla As System.Data.DataTable
    Dim FlagComm As Boolean = True
    'Public WithEvents myRAPI As New RAPI
    'Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
    Private Minuto As Integer
    Private Minuto2 As Integer
    Private Minuto3 As Integer
    Private sqllocal As String
    Dim time As Date = Date.Today
    Dim vfechayhora As Date = Date.Now
    Private cmd As SqlCommand
    'Private cmdFB As FbCommand
    Private objTransPedidos As SqlTransaction
    Private objTransCompras As SqlTransaction
    Private objTrans As SqlTransaction
    Public objTransEmbarques As SqlTransaction
    Public objTransRecepcion As SqlTransaction
    'Private objTransFB As FbTransaction
    Private vcambio As Boolean
    Private RefVenta As String
    Private Sub _AAA_Load(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'Dim cryptoTransform As ICryptoTransform = tdesProvider.CreateDecryptor(Me.key, Me.iv)
        '' Provide a memory stream to decrypt information into 
        'Dim decryptedStream As MemoryStream = New MemoryStream()
        'Dim cryptStream As CryptoStream = New CryptoStream(decryptedStream, cryptoTransform, CryptoStreamMode.Write)
        'cryptStream.Write(inputInBytes, 0, inputInBytes.Length)
        'cryptStream.FlushFinalBlock()
        'decryptedStream.Position = 0

        '' Read the memory stream and convert it back into a string 
        'Dim result(decryptedStream.Length - 1) As Byte
        'decryptedStream.Read(result, 0, decryptedStream.Length)
        'cryptStream.Close()
        'Dim myutf As UTF8Encoding = New UTF8Encoding()
        'Return myutf.GetString(result)


    End Sub
    Private Sub Colores()
        'esta funcion colorea el grid de los mensajes en pantalla
        Dim x As Integer
        For x = 0 To DGV_OC.Rows.Count - 1
            Dim sel = DGV_OC.Rows(x).Cells("positivo").Value()
            If sel = "1" Then
                DGV_OC.Rows(x).DefaultCellStyle.BackColor = System.Drawing.Color.LightGreen
            End If
            If sel = "0" Then
                DGV_OC.Rows(x).DefaultCellStyle.BackColor = System.Drawing.Color.LightCyan
            End If
            If sel = "2" Then
                DGV_OC.Rows(x).DefaultCellStyle.BackColor = System.Drawing.Color.LightPink
            End If
            If sel = "7" Then
                'pedido xxxx, empresa xx, tiene productos duplicados
                DGV_OC.Rows(x).DefaultCellStyle.BackColor = System.Drawing.Color.LightPink
            End If
            If sel = "33" Then
                'pedido xxxx, empresa xx, tiene productos duplicados
                DGV_OC.Rows(x).DefaultCellStyle.BackColor = System.Drawing.Color.LightPink
            End If
        Next
    End Sub
    Private Sub LlenarProveedores()
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn As New SqlConnection(Str)
        If conn.State = Data.ConnectionState.Closed Then
            conn.Open()
        End If
        DGV_OC.Columns.Clear()
        'DGVPedidosVts.Rows.Clear()
        DGV_OC.AllowUserToAddRows = False
        DGV_OC.ReadOnly = True
        Dim StartDate As String = DateTimePickerFecha.Value.Date.ToString("yyyy/MM/dd") & " 00:00:00"
        Dim EndDate As String = DateTimePickerFecha.Value.Date.ToString("yyyy/MM/dd") & " 23:59:59"

        'Dim StartDate As String = DateTime.Today.ToString("yyyy/MM/dd") & " 00:00:00"
        'Dim EndDate As String = DateTime.Today.ToString("yyyy/MM/dd") & " 23:59:59"

        Dim sql As String
        If CheckBoxMostrar.Checked = True Then
            sql = "select id_log, empresa, documento, fechahora, mensaje, positivo" +
                 " from Logistik_log" +
                 " where fechahora>='" + StartDate + "' AND fechahora<='" + EndDate + "'" +
                 " and positivo = '2' or positivo = '7' or positivo = '33' order by id_log desc"
        ElseIf CheckBoxEnviado.Checked = True Then
            sql = "select id_log, empresa, documento, fechahora, mensaje, positivo" +
                 " from Logistik_log" +
                 " where fechahora>='" + StartDate + "' AND fechahora<='" + EndDate + "'" +
                 " and positivo = '1' order by id_log desc"
        Else
            sql = "select id_log, empresa, documento, fechahora, mensaje, positivo" +
                    " from Logistik_log" +
                    " where fechahora>='" + StartDate + "' AND fechahora<='" + EndDate + "'" +
                    " order by id_log desc"
        End If
        Dim ds As New DataSet
        '----------------------
        Dim dataadapter As New SqlDataAdapter(sql, conn)
        dataadapter.Fill(ds, "Logistik_log")
        DGV_OC.DataSource = ds
        DGV_OC.DataMember = "Logistik_log"
        DGV_OC.Columns("Empresa").Width = 170
        DGV_OC.Columns("documento").Width = 170
        DGV_OC.Columns("fechahora").Width = 170
        DGV_OC.Columns("mensaje").Width = 620
        DGV_OC.Columns("id_log").Visible = False
        DGV_OC.Columns("positivo").Visible = False
        Me.DGV_OC.Refresh()
        If conn.State = Data.ConnectionState.Open Then
            conn.Close()
        End If
        Colores()
    End Sub
    'Private Sub ConfiguraciónToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ConfiguraciónToolStripMenuItem.Click
    '    Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '    'Call Conecta()
    '    'If FlagComm = True Then
    '    '    FrmConfiguracion.ShowDialog()
    '    'End If
    '    '-------------------------
    '    FrmConfiguracion.ShowDialog()
    '    connFB = New FbConnection(My.Settings.ConexionFB)
    'End Sub
    'Public Sub Conecta()
    '    Dim jar As New RAPI
    '    'Dim aux As OpenNETCF.Desktop.Communication.OSVERSIONINFO
    '    'Dim aux2 As OpenNETCF.Desktop.Communication.SYSTEM_INFO
    '    'Dim aux3 As OpenNETCF.Desktop.Communication.MEMORYSTATUS
    '    Dim aux4 As Integer
    '    'icono de espera
    '    Cursor.Current = Cursors.WaitCursor
    '    Try
    '        'Label5.Text = "Status: Conectando..."
    '        Me.Refresh()
    '        Sleep(500)
    '        If myRAPI.DevicePresent = False Then
    '            'icono normal
    '            Cursor.Current = Cursors.Default
    '            MsgBox("No está conectada la PDA o Terminal", MsgBoxStyle.Critical, "")
    '            FlagComm = False
    '            Exit Sub
    '        Else
    '            'conectar a la pda
    '            myRAPI.Connect()
    '            MsgBox("Teminal: Conectada!")
    '            FlagComm = True
    '            Me.Refresh()
    '            Sleep(500)

    '            'aux4 = jar.GetDeviceFileSize("\windows\scanner9000.cpl")
    '            'FlagD = True

    '            'desconectar de la pda
    '            myRAPI.Disconnect()
    '            'Label5.Text = "Status: Desconectado"
    '            Me.Refresh()
    '            Sleep(500)
    '        End If
    '        Exit Sub
    '    Catch ex As RAPIException
    '        'icono normal
    '        If FlagD = False Then
    '            MsgBox("Favor de utilizar equipo autorizado REVO (www.revo.com.mx)")
    '        End If
    '        Cursor.Current = Cursors.Default
    '        'MsgBox(ex.Message)
    '    End Try
    '    'icono normal
    '    Cursor.Current = Cursors.Default

    'End Sub

    'Private Sub UsuariosToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles UsuariosToolStripMenuItem.Click
    '    FrmUsuarios.ShowDialog()
    'End Sub
    'Private Sub SalirToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SalirToolStripMenuItem.Click
    '    'My.Application.Exit()
    '    Me.Dispose()
    '    FrmLogin.Dispose()
    'End Sub
    'Private Sub AlmacenesToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AlmacenesToolStripMenuItem.Click
    '    FrmAlmacenes.ShowDialog()
    'End Sub
    'Private Sub ProductosToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ProductosToolStripMenuItem.Click
    '    FrmProductos.ShowDialog()
    'End Sub
    'Private Sub ProveedoresToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ProveedoresToolStripMenuItem.Click
    '    FrmProveedores.ShowDialog()
    'End Sub
    'Private Sub ImportarStockToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ImportarStockToolStripMenuItem.Click
    '    InventarioInicial.ShowDialog()
    '    'Try
    '    '    '' Create new Application.
    '    '    'Dim xlApp As Application = New Application
    '    '    '' Open Excel spreadsheet.
    '    '    'Dim w As Workbook = xlApp.Workbooks.Open("C:\Borrar\stock.xlsx")
    '    '    ''Dim ldExcelDS As System.Data.DataSet
    '    '    ''Dim xlApp As New Excel.Application
    '    '    ''xlApp.Workbooks.Open(Filename:=Server.MapPath("~/ExtractFiles/10-31-13.P"))
    '    '    ''xlApp.ActiveWorkbook.SaveAs(Filename:=Server.MapPath("~/ExtractFiles/10-31-13.xls"), FileFormat:=51)
    '    '    'If Not xlApp Is Nothing Then
    '    '    '    xlApp.ActiveWorkbook.Close()
    '    '    '    xlApp.Quit()
    '    '    '    xlApp = Nothing
    '    '    'End If

    '    '    Dim PrmPathExcelFile As String = "C:\Borrar\stock.xlsx"
    '    '    Dim plmExcelCon As System.Data.OleDb.OleDbConnection
    '    '    plmExcelCon = New System.Data.OleDb.OleDbConnection("Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + PrmPathExcelFile + ";Extended Properties=""Excel 12.0;HDR=YES;IMEX=1""")
    '    '    Dim cmdLoadExcel As System.Data.OleDb.OleDbDataAdapter
    '    '    cmdLoadExcel = New System.Data.OleDb.OleDbDataAdapter("select * FROM [stock$a2:k39]", plmExcelCon)

    '    '    Dim dt As System.Data.DataTable
    '    '    dt = New System.Data.DataTable
    '    '    cmdLoadExcel.Fill(dt)
    '    '    plmExcelCon.Close()

    '    '    '---------------------------------------------------
    '    '    'Dim plmExcelCon As System.Data.OleDb.OleDbConnection
    '    '    'Dim ldExcelDS As System.Data.DataSet
    '    '    'Dim cmdLoadExcel As System.Data.OleDb.OleDbDataAdapter
    '    '    'Dim PrmPathExcelFile As String
    '    '    'PrmPathExcelFile = txtImportFileLocation.Text.ToString
    '    '    'plmExcelCon = New System.Data.OleDb.OleDbConnection("Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + PrmPathExcelFile + ";Extended Properties=Excel 12.0;")
    '    '    'cmdLoadExcel = New System.Data.OleDb.OleDbDataAdapter("select * FROM [" + _ txtImportSheetName.Text + "$]", plmExcelCon)
    '    '    'ldExcelDS = New System.Data.DataSet
    '    '    'cmdLoadExcel.Fill(ldExcelDS)
    '    '    'dgvImportData.DataSource = ldExcelDS.Tables(0)
    '    '    'plmExcelCon.Close()
    '    '    '    cmdINSERT.Parameters("@[SQL COLUMN NAME]").Value = [Not sure how to set value FROM datagrid view]
    '    '    'cnLD.Open()
    '    '    'cmdINSERT.ExecuteNonQuery()
    '    '    'cnLD.Close()
    '    '    Dim vMaterial As String
    '    '    Dim vCentro As String
    '    '    Dim vAlmacen As String
    '    '    Dim vLote As String
    '    '    Dim vUM As String
    '    '    Dim vCantLibre As String
    '    '    Dim vTransladado As String
    '    '    Dim vControlCalidad As String
    '    '    Dim vStockNoLibre As String
    '    '    Dim vBloqueado As String
    '    '    Dim vDevoluciones As String
    '    '    Dim vMsg As Integer = 0
    '    '    For i = 0 To dt.Rows.Count - 1
    '    '        vMaterial = dt.Rows(i)(0).ToString()
    '    '        'MsgBox(vMaterial)
    '    '        vCentro = dt.Rows(i)(1).ToString()
    '    '        'MsgBox(vCentro)
    '    '        vAlmacen = dt.Rows(i)(2).ToString()
    '    '        'MsgBox(vAlmacen)
    '    '        vLote = dt.Rows(i)(3).ToString()
    '    '        'MsgBox(vLote)
    '    '        vUM = dt.Rows(i)(4).ToString()
    '    '        'MsgBox(vUM)
    '    '        vCantLibre = dt.Rows(i)(5).ToString()
    '    '        'MsgBox(vCantLibre)
    '    '        vTransladado = dt.Rows(i)(6).ToString()
    '    '        'MsgBox(vTransladado)
    '    '        vControlCalidad = dt.Rows(i)(7).ToString()
    '    '        'MsgBox(vControlCalidad)
    '    '        vStockNoLibre = dt.Rows(i)(8).ToString()
    '    '        'MsgBox(vStockNoLibre)
    '    '        vBloqueado = dt.Rows(i)(9).ToString()
    '    '        'MsgBox(vBloqueado)
    '    '        vDevoluciones = dt.Rows(i)(10).ToString()
    '    '        'MsgBox(vDevoluciones)
    '    '        If vAlmacen <> "" Then
    '    '            Dim vNextStock As String = NextStok()
    '    '            Dim vgcont As String = fnArticulo(vMaterial.ToString)
    '    '            Dim vAlm As String = fnAlmacen(vAlmacen.ToString)
    '    '            If vgcont <> "" And vAlm <> "" Then
    '    '                Dim SQL As String = "INSERT INTO Logistik_stock(" + _
    '    '                "id_stock, id_warehouse, id_product, id_product_attribute, reference" + _
    '    '                ",ean13, upc, physical_quantity, usable_quantity, price_te" + _
    '    '                ",lote, id_supplier, clave_Remplace) VALUES ('" + _
    '    '                vNextStock.ToString + "','" + vAlm.ToString + "','" + vgcont.ToString + "','0','" + vAlmacen.ToString + "','" + _
    '    '                "', '" + vMaterial.ToString + "', '" + vCantLibre.ToString + "', '" + vCantLibre.ToString + "', '0', '" + _
    '    '                vLote.ToString + "','" + vgId_usurio + "','')"
    '    '                EjecutarQuerySQL(SQL)
    '    '            Else
    '    '                vMsg = 1
    '    '            End If
    '    '        End If
    '    '    Next i
    '    '    If vMsg = 1 Then
    '    '        MsgBox("Algunos registros no fueron importados, porque no se encontro el almacén o el producto ")
    '    '    Else
    '    '        MsgBox("Datos importados correctamente")
    '    '    End If

    '    'Catch ex As Exception
    '    '    MsgBox(ex.Message.ToString)
    '    'End Try
    'End Sub
    Function fnAlmacen(ByVal pUPC As String) As String
        Dim sql As String = "SELECT id_warehouse FROM Logistik_warehouse WHERE ltrim(rtrim(reference)) = '" + Trim(pUPC) + "'"
        Dim dataadapter As New SqlDataAdapter(sql, Conexion)
        Dim dsCargarEncabezado As New DataSet()
        dataadapter.Fill(dsCargarEncabezado, "Logistik_warehouse")
        oTabla = dsCargarEncabezado.Tables("Logistik_warehouse")
        Dim vidprod As String = ""
        If oTabla.Rows.Count >= 1 Then
            Dim oFila As DataRow
            For Each oFila In oTabla.Rows
                vidprod = oFila.Item("id_warehouse").ToString
            Next
            Return vidprod
        Else
            Return ""
        End If
    End Function
    Function fnArticulo(ByVal pUPC As String) As String
        Dim sql As String = "SELECT id_product FROM Logistik_product WHERE ltrim(rtrim(upc)) = '" + Trim(pUPC) + "'"
        Dim dataadapter As New SqlDataAdapter(sql, Conexion)
        Dim dsCargarEncabezado As New DataSet()
        dataadapter.Fill(dsCargarEncabezado, "Logistik_product1")
        oTabla = dsCargarEncabezado.Tables("Logistik_product1")
        Dim vidprod As String = ""
        If oTabla.Rows.Count >= 1 Then
            Dim oFila As DataRow
            For Each oFila In oTabla.Rows
                vidprod = oFila.Item("id_product").ToString
            Next
            Return vidprod
        Else
            Return ""
        End If
    End Function
    Function NextStok() As String
        Dim vid_stock As String = ""
        Dim sql2 As String = "SELECT ISNULL(count(id_stock),1) as num FROM Logistik_stock"
        Dim dataadapter2 As New SqlDataAdapter(sql2, Conexion)
        Dim dsCargarEncabezado2 As New DataSet()
        dataadapter2.Fill(dsCargarEncabezado2, "Logistik_product")
        oTabla = dsCargarEncabezado2.Tables("Logistik_product")
        Dim oFila3 As DataRow
        If oTabla.Rows.Count >= 1 Then
            For Each oFila3 In oTabla.Rows
                vid_stock = oFila3.Item("num").ToString
                vid_stock = Val(vid_stock) + 1
            Next
        Else
            vid_stock = "1"
        End If
        Return vid_stock
    End Function

    Protected Overrides Sub OnFormClosing(ByVal e As FormClosingEventArgs)
        If e.CloseReason <> CloseReason.WindowsShutDown AndAlso e.CloseReason <> CloseReason.ApplicationExitCall Then
            e.Cancel = True
        End If

        MyBase.OnFormClosing(e)
    End Sub
    Function PrevInstance() As Boolean
        If UBound(Diagnostics.Process.GetProcessesByName(Diagnostics.Process.GetCurrentProcess.ProcessName)) Then
            Return True
        Else
            Return False
        End If
    End Function
    Private Sub FrmMenuPrincipal_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        If PrevInstance() = True Then
            MsgBox("El programa de Logistik ya se encuentra en ejecución")
            'Application.Exit()
        Else
            ''------------------------------------
            'Dim serial As Long
            'Dim Llave As String = "0"
            'Dim sm As New SecurityManager
            'Dim key As Long = 0
            'Dim key2 As Long = 0

            'serial = sm.GetSerial
            ''MsgBox(serial.ToString)
            'Dim regkey As RegistryKey = Registry.LocalMachine.OpenSubKey("SOFTWARE\Microsoft\MSTools")
            ''MsgBox(regkey.ToString)
            'If Not regkey Is Nothing Then
            '    Llave = My.Computer.Registry.GetValue("HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSTools", "Nuevo", Nothing)
            '    BPrimeravez = False
            'Else
            '    MsgBox("Se esta ejecutando el programa por primera vez. Favor de llamar en el sitio www.bildden.com para autorizar el programa")
            '    BPrimeravez = True
            'End If

            'If BPrimeravez Then
            '    Dim ActivaV As New Activa
            '    ActivaV.ShowDialog()
            'Else
            '    ' verificar si la llave de activacion esta correcta
            '    Dim kg As New KeyGenerator
            '    If sm.CheckKey2(Llave) Then
            '        'MsgBox("Activación Exitosa")
            '        BanderaActiva = True
            '    Else
            '        MsgBox("Llave de activación equivocada!. Favor de llamar a Soporte en www.bildden.com", MsgBoxStyle.Critical)
            '        Dim msgbox1 = MessageBox.Show("Desea cambiar la llave de Activación?", "Cambia llave Activación", MessageBoxButtons.YesNo, MessageBoxIcon.Exclamation, MessageBoxDefaultButton.Button2)
            '        If msgbox1 = Windows.Forms.DialogResult.Yes Then
            '            Dim ActivaV As New Activa
            '            ActivaV.ShowDialog()
            '            If BanderaActiva = False Then
            '                Application.Exit()
            '            End If
            '        Else
            '            BanderaActiva = False
            '            Application.Exit()
            '        End If
            '    End If
            '    'si el programa esta activo y con llave valida
            '    If BanderaActiva Then
            Try
                '----------------------------------

                If Trim(vgTipo_usurio) = "Administrador" Then
                    'ConfiguraciónToolStripMenuItem.Visible = True
                    CatalogosToolStripMenuItem.Visible = True
                Else
                    ConfiguraciónToolStripMenuItem.Visible = False
                    CatalogosToolStripMenuItem.Visible = False
                End If
                '------------------leer xML-----------------------------
                varchivo = System.AppDomain.CurrentDomain.BaseDirectory() & "Form_Config_XML.xml"
                Dim reader As XmlTextReader = New XmlTextReader(varchivo)
                Dim vvalor As String
                Dim vnombre As String
                Do While (reader.Read())
                    Select Case reader.NodeType
                        Case XmlNodeType.Element 'Mostrar comienzo del elemento.
                            'Case XmlNodeType.Text
                            vnombre = reader.Name
                            If vnombre = "enviarSAE" Then
                                vlMinitos = reader.ReadElementContentAsString
                            End If
                            If vnombre = "auttraspaso" Then
                                vvalor = reader.ReadElementContentAsBoolean
                                vgAutorizTraspaso = Convert.ToBoolean(vvalor)
                                If vgAutorizTraspaso = False Then
                                    AutorizaciónToolStripMenuItem.Visible = False
                                Else
                                    AutorizaciónToolStripMenuItem.Visible = True
                                End If
                            End If
                            If vnombre = "empresa" Then
                                vgEmpresa = reader.ReadElementContentAsString
                                vgNumEmpresa = Mid(vgEmpresa, LongitudBD)
                            End If
                            If vnombre = "versionsae" Then
                                vgVersion = reader.ReadElementContentAsString
                            End If
                            If vnombre = "basededatos" Then
                                vgTipoBD = reader.ReadElementContentAsString
                            End If
                            If vnombre = "diasactualizar" Then
                                vgDiasActulizarSAE = reader.ReadElementContentAsString
                            End If
                            If vnombre = "especificardoc" Then
                                vvalor = reader.ReadElementContentAsBoolean
                                vgEspecificarDoc = Convert.ToBoolean(vvalor)
                            End If
                            If vnombre = "codigoalterno" Then
                                vvalor = reader.ReadElementContentAsBoolean
                                vgCodigoAlterno = Convert.ToBoolean(vvalor)
                            End If

                    End Select
                Loop
                reader.Close()
            Catch ex As Exception
                MsgBox("Error en la licencia " + ex.Message.ToString)
                'Application.Exit()
            End Try
            '    Else
            'MsgBox("Programa no autorizado, favor de llamar a su proveedor")
            'Application.Exit()
            '    End If
            'End If
        End If
        Dim Label1 As Object
        Label1 = New System.Windows.Forms.Label
        Label1.text = "Control was Added."
        Label1.name = "Label1"
        Label1.width = 300
        Label1.height = 20
        Label1.top = 100
        Label1.left = 100
        Me.Controls.Add(Label1)
        Dim myButton As Object
        myButton = New System.Windows.Forms.Button
        myButton.text = "Hola"
        myButton.name = "myButton"
        myButton.width = 100
        myButton.height = 20
        myButton.top = 80
        myButton.left = 80
        Me.Controls.Add(myButton)
        Me.Controls.RemoveByKey("Label1")
        Me.Controls.RemoveByKey("myButton")
    End Sub

    'Private Sub OrdenesDeCompraToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles OrdenesDeCompraToolStripMenuItem.Click
    '    ReporteOC.ShowDialog()
    'End Sub

    'Private Sub PedidosDeVentaToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PedidosDeVentaToolStripMenuItem.Click
    '    ReportePedidosVta.ShowDialog()
    'End Sub

    Private Sub Timer1_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer1.Tick
        'Try
        '    TextHora.Text = vconttimer.ToString
        '    vconttimer = vconttimer + 1
        '    Dim cMin As Int32 = 60
        '    cMin = cMin * vlMinitos
        '    Minuto = Minuto + 1
        '    Minuto3 = Minuto3 + 1
        '    If Minuto3 = My.Settings.vgTime Then ' 1 = 120
        '        Minuto3 = 0
        '        cMin = 0
        '        vlSyncCompleta = 1
        '        DesactivarOCPed = False
        '        'Sincronizar(sender, e)
        '        Label5.Text = "completa"
        '    Else
        '        If Minuto2 = 60 Then '1 = 60
        '            Minuto = 0
        '            cMin = 0
        '            vlSyncCompleta = 0
        '            DesactivarOCPed = False
        '            'Sincronizar(sender, e)
        '            Label5.Text = "parcial"
        '        End If
        '    End If
        'Catch ex As Exception
        '    Timer1.Enabled = False
        '    'Timer2.Enabled = False
        '    'Timer3.Enabled = False
        '    Timer4.Enabled = False
        '    MsgBox("Se perdio la conexion con el servidor SAE, favor de verificar")
        '    Application.Exit()
        'End Try
        TextHora.Text = vconttimer.ToString
        vconttimer = vconttimer + 1
        Dim cMin As Int32 = 60
        cMin = cMin * vlMinitos
        Minuto = Minuto + 1
        Select Case Minuto
            Case cMin
                'RectangleShape1.FillColor = Color.Red
                Minuto = 0
                cMin = 0
                '-------- parar todo si se pierde la conexcion
                Try
                    'SAE CON FIREBIRD
                    'Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
                    'Dim conn As New SqlConnection(Str)
                    'conn.Open()
                    'conn.Close()
                    'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
                    'If connFB.State = ConnectionState.Closed Then
                    '    connFB.Open()
                    'End If
                    'SAE CON SQL
                    'Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
                    'Dim conn As New SqlConnection(Str)
                    'conn.Open()
                    'conn.Close()
                    'Dim connFB As New SqlConnection("Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + My.Settings.Ruta_SAE_FB + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";")
                    'If connFB.State = ConnectionState.Closed Then
                    '    connFB.Open()
                    'End If
                    vlSyncCompleta = 0
                    DesactivarOCPed = False
                    Sincronizar(sender, e)
                    'MsgBox("parcial")
                Catch ex As Exception
                    Timer1.Enabled = False
                    'Timer2.Enabled = False
                    'Timer3.Enabled = False
                    Timer4.Enabled = False
                    MsgBox("Se perdio la conexion con el servidor SAE, favor de verificar")
                    Application.Exit()
                End Try
            Case Else
        End Select
    End Sub

#Region "EnvioSeries"
    Private Sub LlevarSeiesFaltantes()
        If vgBD = "S" Then
            Label5.Text = "Sincronizando Traspasos del SQL a SAE"
            'Call SerieSAE_SQL()
            Label5.Text = "Sincronización finalizada"
        Else
            Label5.Text = "Sincronizando Traspasos del FireBird a SAE"
            Me.Refresh()
            'Call SeriesSAEFB()
            Label5.Text = "Sincronización finalizada"
            Me.Refresh()
            Timer3.Enabled = True
        End If
    End Sub
    'Private Sub SeriesSAEFB()
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=PASS;"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        Dim nNUM_SER As String
    '        Dim nCOSTO As String
    '        Dim nDOCTO_ENT As String
    '        Dim nFECHA_ENT As String
    '        Dim nREG_SERIE As String
    '        Dim NUM_ALM As String
    '        Dim CVE_ART As String
    '        Dim NUM_SER As String
    '        Dim readerNumSerie As SqlDataReader
    '        Dim SqlSelection As String = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE," + _
    '        " ns.ALMACEN, ns.CVE_ART, ns.NUM_SER, ns.CVE_DOC_SQL" + _
    '        " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" + _
    '        " where h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" + _
    '        " and ns.STATUS ='M'"
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        cmd = New SqlCommand(SqlSelection, conn)
    '        readerNumSerie = cmd.ExecuteReader()
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        Dim NumSer_Cve_Doc As String
    '        '---------------------------------------
    '        objTransFB = connFB.BeginTransaction()
    '        '--------------------------------------
    '        While readerNumSerie.Read()
    '            nNUM_SER = readerNumSerie.Item(0).ToString
    '            nCOSTO = readerNumSerie.Item(1).ToString
    '            nDOCTO_ENT = readerNumSerie.Item(2).ToString
    '            nFECHA_ENT = readerNumSerie.Item(3).ToString
    '            nREG_SERIE = readerNumSerie.Item(4).ToString
    '            NUM_ALM = readerNumSerie.Item(5).ToString
    '            CVE_ART = readerNumSerie.Item(6).ToString
    '            NUM_SER = readerNumSerie.Item(7).ToString
    '            NumSer_Cve_Doc = readerNumSerie.Item(8).ToString
    '            If nFECHA_ENT <> "" Then
    '                nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
    '            End If

    '            sqllocal = "UPDATE NUMSER0" + vgNumEmpresa.ToString + " SET STATUS = 'V', COSTO = '" + nCOSTO + "', " + _
    '            "DOCTO_ENT = '" + NumSer_Cve_Doc + "', FECHA_ENT = '" + nFECHA_ENT + "'" + _
    '            " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()

    '            sqllocal = "UPDATE HNUMSER0" + vgNumEmpresa.ToString + " SET STATUS = 'V'," + _
    '            "TIP_MOV = '51', CVE_DOC ='" + NumSer_Cve_Doc + "', REG_SERIE = '" + nREG_SERIE + "'" + _
    '           " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
    '           "' AND ALMACEN = '" + Trim(NUM_ALM) + "' AND REG_SERIE = '" + nREG_SERIE + "'"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()

    '            '--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '            sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'V'" + _
    '            " where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '            " and CVE_DOC_SQL ='" + Trim(NumSer_Cve_Doc.ToString) + "' and STATUS ='M'" + _
    '            " AND NUM_SER ='" + nNUM_SER + "'"
    '            cmd = New SqlCommand(sqllocal, conn)
    '            cmd.ExecuteNonQuery()

    '        End While
    '        '------------------------
    '        objTransFB.Commit()
    '        '------------------------
    '        If conn.State = ConnectionState.Open Then
    '            conn.Close()
    '        End If
    '        readerNumSerie.Close()
    '    Catch es As SqlException
    '        objTransFB.Rollback()
    '        Throw es
    '    Catch ex As Exception
    '        '***** rollback the transaction ************************************************'
    '        objTransFB.Rollback()
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Sub
#End Region
#Region "EnvioTraspasos"
    Private Sub LlevarTraspasos(ByVal pMiBD As String)
        If vgTipoBD = "S" Then
            Label5.Text = "Sincronizando Traspasos del SQL a SAE"
            Me.Refresh()
            Call TraspasosSAE(pMiBD)
        End If
    End Sub

    Private Sub TraspasosSAE(ByVal pMiBD As String)
        Label5.Text = "Sincronizacion de Traspasos del SQL al SAE"
        Me.Refresh()
        Dim OrdenVenta As String = ""
        Dim vAlm_orig As String
        Dim vAlm_des As String
        Dim vArt As String
        Dim vEnviadoSAE As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn2 As New SqlConnection(Str2)
            sqllocal = "select id_order, Almacen_origen, Almacen_destino, Documento, EnviadaSAE, Tipo_Traspaso  from Logistik_Traspasos" +
            " where EnviadaSAE IN('O','I') and current_state = '5' order by id_order"
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_Traspasos")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_Traspasos")
            Dim vDocumento As String = "0"
            Dim TipoProd As String = ""
            Dim verifExist As Boolean = False
            For Each oRowPC In oTablePC.Rows
                OrdenVenta = oRowPC.Item("id_order").ToString
                ' especificar documento
                vDocumento = Trim(oRowPC.Item("Documento").ToString)
                vEnviadoSAE = Trim(oRowPC.Item("EnviadaSAE").ToString)
                'agregar ceros
                vDocumento = espacios(vDocumento, 20)
                If vEnviadoSAE = "O" Then
                    vAlm_orig = "911"
                    vAlm_des = oRowPC.Item("Almacen_origen").ToString
                ElseIf vEnviadoSAE = "I" Then
                    vAlm_orig = "911"
                    vAlm_des = oRowPC.Item("Almacen_destino").ToString
                End If
                TipoProd = oRowPC.Item("Tipo_Traspaso").ToString
                '--------------consecutivo traspaso SAE
                Dim vConsecSAE As String = oRowPC.Item("id_order").ToString
                'sqllocal = "select num_doc from Logistik_Consecutivo_SAE"
                'Dim daPC1 As New SqlDataAdapter(sqllocal, conn)
                'Dim dsPC1 As New DataSet
                'daPC1.Fill(dsPC1, "Logistik_Consecutivo_SAE")
                'Dim oTablePC1 As New DataTable
                'oTablePC1 = dsPC1.Tables("Logistik_Consecutivo_SAE")
                'If oTablePC1.Rows.Count >= 1 Then
                '    For Each oRowPC7 In oTablePC1.Rows
                '        vConsecSAE = oRowPC7.Item("num_doc").ToString
                '        vConsecSAE = Val(vConsecSAE) + 1
                '        sqllocal = "update Logistik_Consecutivo_SAE SET num_doc = '" + vConsecSAE + "'"
                '        EjecutarQuerySQL(sqllocal)
                '        Exit For
                '    Next
                'Else
                '    sqllocal = "insert into Logistik_Consecutivo_SAE(num_doc) values ('1')"
                '    EjecutarQuerySQL_EMPRESA(sqllocal)
                '    vConsecSAE = 1
                'End If

                '--------------------------------------
                If vConsecSAE > 0 Then
                    vConsecSAE = espacios(vConsecSAE, 20)

                    sqllocal = "select product_upc, product_quantity, quantity_input, quantity_output from Logistik_Traspasos_detail where id_order = '" + Trim(OrdenVenta.ToString) + "'"
                    Dim da As New SqlDataAdapter(sqllocal, conn)
                    Dim ds As New DataSet
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    da.Fill(ds, "Logistik_Traspasos_detail")
                    Dim oTable As New DataTable
                    oTable = ds.Tables("Logistik_Traspasos_detail")
                    Dim vCant As Double
                    Dim vCantPed As Double

                    '-------------------------------------------
                    If conn2.State = ConnectionState.Closed Then
                        conn2.Open()
                    End If
                    '---------------------------------------
                    objTrans = conn2.BeginTransaction()
                    '--------------------------------------
                    Dim vMovimiento As Integer = 0
                    Dim vEntrada As String = "B"
                    For Each oRow In oTable.Rows
                        vArt = oRow.Item("product_upc").ToString

                        If vEnviadoSAE = "O" Then
                            vCant = oRow.Item("quantity_output").ToString
                            vCantPed = oRow.Item("product_quantity").ToString
                            vCant = vCantPed - vCant
                        ElseIf vEnviadoSAE = "I" Then
                            vCant = oRow.Item("quantity_input").ToString
                            Dim vCantSalida As Double = oRow.Item("quantity_output").ToString
                            If vCantSalida > vCant Then
                                vEntrada = "M"
                            End If
                        Else
                            vCant = 0
                        End If
                        If vCant > 0 Then
                            '---------------------crear el o los movimientos de salida por traspaso
                            Dim vNum_Mov As String
                            Dim vcont7 As String = ""
                            Dim reader7 As SqlDataReader
                            sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            reader7 = cmd.ExecuteReader()
                            While reader7.Read()
                                'MsgBox(reader7.Item(0))
                                vcont7 = reader7.Item(0).ToString
                                vcont7 = Val(vcont7) + 1
                            End While
                            If vcont7 = "" Then vcont7 = "1"
                            vNum_Mov = vcont7
                            reader7.Close()
                            '-------------traer y costo existencia - la cantidad de salida
                            Dim vCosto As String = "0"
                            Dim vExistencia As Double = 0
                            sqllocal = "Select ISNULL(max(m.NUM_MOV),1) AS num," +
                            " (SELECT M1.COSTO FROM MINVE" + vgNumEmpresa.ToString + " M1 WHERE M1.CVE_ART = '" + vArt.ToString + "' AND M1.ALMACEN = '" + vAlm_orig.ToString + "' AND M1.NUM_MOV = MAX(M.NUM_MOV)) AS COSTO, " +
                            " (SELECT EXISTENCIA FROM MINVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt.ToString + "' AND ALMACEN = '" + vAlm_orig.ToString + "' AND NUM_MOV = MAX(M.NUM_MOV)) AS EXIST " +
                            " from MINVE" + vgNumEmpresa.ToString + " m where m.CVE_ART = '" + vArt.ToString + "' and m.ALMACEN = '" + vAlm_orig.ToString + "'"
                            Dim reader As SqlDataReader
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            reader = cmd.ExecuteReader()
                            While reader.Read()
                                vCosto = reader.Item(1).ToString
                                If reader.Item(2).ToString = "" Then
                                    vExistencia = 0
                                Else
                                    vExistencia = reader.Item(2).ToString
                                End If
                            End While
                            If vCosto = "" Then vCosto = "0"
                            vExistencia = vExistencia - vCant
                            reader.Close()
                            '-------------traer tipo de producto y unida de medida
                            Dim vUM As String = ""
                            Dim vTip_Art As String = ""
                            Dim reader3 As SqlDataReader
                            sqllocal = "Select UNI_MED, TIPO_ELE, COSTO_PROM from INVE" + vgNumEmpresa.ToString + " where CVE_ART = '" + vArt + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            reader3 = cmd.ExecuteReader()
                            While reader3.Read()
                                vUM = reader3.Item(0).ToString
                                vTip_Art = reader3.Item(1).ToString
                                vCosto = reader3.Item(2).ToString
                            End While
                            reader3.Close()
                            'insertar movimiento de disminucion
                            sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, COSTO_PROM_GRAL, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                            "'" + vArt + "','" + vAlm_orig + "','" + vNum_Mov + "','58','" + time.ToString("yyyy/MM/dd") + "'," +
                            "'M','" + vConsecSAE + "','0','0','" + vCant.ToString + "','0','0','" + vCosto + "','0','0'," +
                            "'0','" + vUM + "','0','" + vExistencia.ToString + "','" + vTip_Art + "'," +
                            "'1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
                            "S','" + vCosto + "','" + vCosto + "','" + vCosto + "','S','0')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                            If vEnviadoSAE = "O" Then
                                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + '" + vCant.ToString + "'" +
                                           " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_orig + "'"
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                'vAlm_orig = "911"
                                'vAlm_des = oRowPC.Item("Almacen_origen").ToString
                            ElseIf vEnviadoSAE = "I" Then
                                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - '" + vCant.ToString + "'" +
                                           " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_orig + "'"
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                'vAlm_orig = "911"
                                'vAlm_des = oRowPC.Item("Almacen_destino").ToString
                            End If

                            '---------------------crear el o los movimientos de entrada por traspaso
                            sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            reader7 = cmd.ExecuteReader()
                            While reader7.Read()
                                'MsgBox(reader7.Item(0))
                                vcont7 = reader7.Item(0).ToString
                                vcont7 = Val(vcont7) + 1
                            End While
                            If vcont7 = "" Then vcont7 = "1"
                            vNum_Mov = vcont7
                            reader7.Close()
                            '-------------traer y costo existencia + la cantidad de entrada
                            sqllocal = "Select ISNULL(max(m.NUM_MOV),1) AS num," +
                            " (SELECT M1.COSTO FROM MINVE" + vgNumEmpresa.ToString + " M1 WHERE M1.CVE_ART = '" + vArt.ToString + "' AND M1.ALMACEN = '" + vAlm_des.ToString + "' AND M1.NUM_MOV = MAX(M.NUM_MOV)) AS COSTO, " +
                            " (SELECT EXISTENCIA FROM MINVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt.ToString + "' AND ALMACEN = '" + vAlm_des.ToString + "' AND NUM_MOV = MAX(M.NUM_MOV)) AS EXIST " +
                            " from MINVE" + vgNumEmpresa.ToString + " m where m.CVE_ART = '" + vArt.ToString + "' and m.ALMACEN = '" + vAlm_des.ToString + "'"
                            Dim reader5 As SqlDataReader
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            reader5 = cmd.ExecuteReader()
                            While reader5.Read()
                                vCosto = reader5.Item(1).ToString
                                If reader5.Item(2).ToString = "" Then
                                    vExistencia = 0
                                Else
                                    vExistencia = reader5.Item(2).ToString
                                End If
                            End While
                            If vCosto = "" Then vCosto = "0"
                            vExistencia = vExistencia + vCant
                            reader5.Close()
                            'insertar movimiento de aumento
                            sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                            "'" + vArt + "','" + vAlm_des + "','" + vNum_Mov + "','7','" + time.ToString("yyyy/MM/dd") + "'," +
                            "'M','" + vConsecSAE + "','0','0','" + vCant.ToString + "','0','0','" + vCosto + "','0','0'," +
                            "'0','" + vUM + "','0','" + vExistencia.ToString + "','" + vTip_Art + "'," +
                            "'1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','1','" +
                            "S','0','" + vCosto + "','S','0')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                            If vEnviadoSAE = "O" Then
                                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - '" + vCant.ToString + "'" +
                                           " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_des + "'"
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                'vAlm_orig = "911"
                                'vAlm_des = oRowPC.Item("Almacen_origen").ToString
                            ElseIf vEnviadoSAE = "I" Then
                                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + '" + vCant.ToString + "'" +
                                           " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_des + "'"
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                'vAlm_orig = "911"
                                'vAlm_des = oRowPC.Item("Almacen_destino").ToString
                            End If
                            vMovimiento = 1
                        End If
                    Next
                    '------------------------
                    objTrans.Commit()
                    empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                    documento = OrdenVenta.ToString
                    If vEnviadoSAE = "O" Then
                        mensaje = "Registro de Salida:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                    ElseIf vEnviadoSAE = "I" Then
                        mensaje = "Registro de Entrada:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                    End If

                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    '------------------------
                    If conn2.State = ConnectionState.Open Then
                        conn2.Close()
                    End If
                    '------------------------------------------
                    'cambiar el status de envio
                    If vMovimiento = 1 Then
                        If vEnviadoSAE = "O" Then
                            Dim sql As String = "update Logistik_Traspasos SET EnviadaSAE = 'N', current_state = '4', Doc_Salida ='" + vConsecSAE + "'" +
                            " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                            EjecutarQuerySQL_EMPRESA(sql)
                            'sql = "update Logistik_Consecutivo_SAE SET num_doc = num_doc + 1"
                            'EjecutarQuerySQL(sql)
                            '--------------------CREAR MOVIEMNTOS DE LA ORDEN DE COMPRA
                            sql = "Select product_upc, product_name, quantity_output " +
                            " from Logistik_Traspasos_detail " +
                            " where id_order = '" + Trim(OrdenVenta.ToString) + "'"
                            Dim dsCargarEncabezado As New DataSet()
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            Dim dataadapter As New SqlDataAdapter(sql, conn)
                            dataadapter.Fill(dsCargarEncabezado, "Logistik_Traspasos")
                            Dim oTabla As DataTable
                            oTabla = dsCargarEncabezado.Tables("Logistik_Traspasos")
                            Dim oFila As DataRow
                            Dim vArt7 As String = ""
                            Dim vDesc7 As String = ""
                            Dim vCant7 As String = ""
                            'dim vFecha as String =
                            If oTabla.Rows.Count >= 1 Then
                                For Each oFila In oTabla.Rows
                                    vArt7 = oFila.Item("product_upc").ToString
                                    vDesc7 = oFila.Item("product_name").ToString
                                    vCant7 = Convert.ToDouble(oFila.Item("quantity_output").ToString)
                                    If Len(vCant) >= 1 Then
                                        sql = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                        "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino) VALUES (" +
                                        "'" + Trim(OrdenVenta.ToString) + "','Salida x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                        vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                        vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_des.ToString + "','" + vAlm_orig.ToString + "')"
                                        EjecutarQuerySQL_EMPRESA(sql)
                                    End If
                                Next
                            End If
                            '---------------------------------------------------------

                        ElseIf vEnviadoSAE = "I" Then
                            Dim sql As String
                            If vEntrada = "B" Then
                                sql = "update Logistik_Traspasos SET EnviadaSAE = 'S', current_state = '7', Doc_Entrada ='" + vConsecSAE + "'" +
                                      " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                                EjecutarQuerySQL_EMPRESA(sql)
                            Else
                                sql = "update Logistik_Traspasos SET EnviadaSAE = 'S', current_state = '8', Doc_Entrada ='" + vConsecSAE + "'" +
                                      " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                                EjecutarQuerySQL_EMPRESA(sql)
                            End If

                            'sql = "update Logistik_Consecutivo_SAE SET num_doc = num_doc + 1"
                            'EjecutarQuerySQL_EMPRESA(sql)
                            '--------------------CREAR MOVIEMNTOS DE LA ORDEN DE COMPRA
                            sql = "Select product_upc, product_name, quantity_input " +
                          " from Logistik_Traspasos_detail " +
                          " where id_order = '" + Trim(OrdenVenta.ToString) + "'"
                            Dim dsCargarEncabezado As New DataSet()
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            Dim dataadapter As New SqlDataAdapter(sql, conn)
                            dataadapter.Fill(dsCargarEncabezado, "Logistik_Traspasos")
                            Dim oTabla As DataTable
                            oTabla = dsCargarEncabezado.Tables("Logistik_Traspasos")
                            Dim oFila As DataRow
                            Dim vArt7 As String = ""
                            Dim vDesc7 As String = ""
                            Dim vCant7 As String = ""
                            'dim vFecha as String =
                            If oTabla.Rows.Count >= 1 Then
                                For Each oFila In oTabla.Rows
                                    vArt7 = oFila.Item("product_upc").ToString
                                    vDesc7 = oFila.Item("product_name").ToString
                                    vCant7 = Convert.ToDouble(oFila.Item("quantity_input").ToString)
                                    If Len(vCant) >= 1 Then
                                        sql = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                        "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino ) VALUES (" +
                                        "'" + Trim(OrdenVenta.ToString) + "','Entrada x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                        vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                        vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_orig.ToString + "','" + vAlm_des.ToString + "')"
                                        EjecutarQuerySQL_EMPRESA(sql)
                                    End If
                                Next
                            End If
                            '---------------------------------------------------------

                        End If
                    Else
                        If vEnviadoSAE = "O" Then
                            Dim sql As String = "update Logistik_Traspasos SET EnviadaSAE = 'N', current_state = '4'" +
                            " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                            EjecutarQuerySQL_EMPRESA(sql)
                            '--------------------CREAR MOVIEMNTOS DE LA ORDEN DE COMPRA
                            sql = "Select product_upc, product_name, quantity_output " +
                           " from Logistik_Traspasos_detail " +
                           " where id_order = '" + Trim(OrdenVenta.ToString) + "'"
                            Dim dsCargarEncabezado As New DataSet()
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            Dim dataadapter As New SqlDataAdapter(sql, conn)
                            dataadapter.Fill(dsCargarEncabezado, "Logistik_Traspasos")
                            Dim oTabla As DataTable
                            oTabla = dsCargarEncabezado.Tables("Logistik_Traspasos")
                            Dim oFila As DataRow
                            Dim vArt7 As String = ""
                            Dim vDesc7 As String = ""
                            Dim vCant7 As String = ""
                            'dim vFecha as String =
                            If oTabla.Rows.Count >= 1 Then
                                For Each oFila In oTabla.Rows
                                    vArt7 = oFila.Item("product_upc").ToString
                                    vDesc7 = oFila.Item("product_name").ToString
                                    vCant7 = Convert.ToDouble(oFila.Item("quantity_output").ToString)
                                    If Len(vCant) >= 1 Then
                                        sql = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                        "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino) VALUES (" +
                                        "'" + Trim(OrdenVenta.ToString) + "','Salida x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                        vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                        vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_des.ToString + "','" + vAlm_orig.ToString + "')"
                                        EjecutarQuerySQL_EMPRESA(sql)
                                    End If
                                Next
                            End If
                            '---------------------------------------------------------

                        ElseIf vEnviadoSAE = "I" Then
                            If vEntrada = "B" Then
                                Dim sql As String = "update Logistik_Traspasos SET EnviadaSAE = 'S', current_state = '7'" +
                                " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                                EjecutarQuerySQL_EMPRESA(sql)
                            Else
                                Dim sql As String = "update Logistik_Traspasos SET EnviadaSAE = 'S', current_state = '8'" +
                                " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                                EjecutarQuerySQL_EMPRESA(sql)
                            End If
                            '--------------------CREAR MOVIEMNTOS DE LA ORDEN DE COMPRA
                            Dim SQL1 As String = "Select product_upc, product_name, quantity_input " +
                         " from Logistik_Traspasos_detail " +
                         " where id_order = '" + Trim(OrdenVenta.ToString) + "'"
                            Dim dsCargarEncabezado As New DataSet()
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            Dim dataadapter As New SqlDataAdapter(SQL1, conn)
                            dataadapter.Fill(dsCargarEncabezado, "Logistik_Traspasos")
                            Dim oTabla As DataTable
                            oTabla = dsCargarEncabezado.Tables("Logistik_Traspasos")
                            Dim oFila As DataRow
                            Dim vArt7 As String = ""
                            Dim vDesc7 As String = ""
                            Dim vCant7 As String = ""
                            'dim vFecha as String =
                            If oTabla.Rows.Count >= 1 Then
                                For Each oFila In oTabla.Rows
                                    vArt7 = oFila.Item("product_upc").ToString
                                    vDesc7 = oFila.Item("product_name").ToString
                                    vCant7 = Convert.ToDouble(oFila.Item("quantity_input").ToString)
                                    If Len(vCant) >= 1 Then
                                        SQL1 = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                        "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino ) VALUES (" +
                                        "'" + Trim(OrdenVenta.ToString) + "','Entrada x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                        vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                        vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_orig.ToString + "','" + vAlm_des.ToString + "')"
                                        EjecutarQuerySQL_EMPRESA(SQL1)
                                    End If
                                Next
                            End If
                            '---------------------------------------------------------

                        End If
                    End If
                    '//////////////////////////////cambiar existencia de LogistikUbicaciones
                    ''                    Reubicar
                    ''1   Sacar Producto de Tarima  = 1
                    ''Tipo de Traspaso = 4
                    ''2   Producto a nueva ubicación = 2
                    ''Tipo de Traspaso = 5
                    ''3   Tarima a nueva ubicación  = 3
                    ''Tipo de Traspaso = 6
                    ''4   Meter producto en tarima   = 4
                    ''Tipo de Traspaso = 7
                    'Dim verifExist As Boolean = False
                    ''// Sacar Productos de Tarima
                    'If (TipoProd = 1) Then
                    '    verifExist = FnExisteArticuloInv(vArt, AlmacenFiltro, "")
                    '    TarimaUsada = ""
                    'End If
                    ''// Tarima a nueva Ubicacion
                    'If (TipoProd = 3) Then
                    '    verifExist = FnExisteArticuloInv(vArt, AlmacenFiltro, UbicaTemp)
                    '    TarimaUsada = UbicaTemp
                    'End If
                    ''// Productos a nueva Ubicacion
                    'If (TipoProd = 2) Then
                    '    '//' Obtiene el ID de la ubicacion destino
                    '    '//'Verifica_Ubica(UbicaTemp, "1")
                    '    verifExist = FnExisteArticuloInv(vArt, AlmacenFiltro, "")
                    '    TarimaUsada = ""
                    'End If
                    'If verifExist = False Then
                    '    If TipoProd = 1 Then sqllocal = "insert into vLogistik_Ubicaciones(" & "ubicacion, tarima, caja, id_product, codigo_producto, cantidad, estado, procesado_sae, embarque, oc, factura) values ('" +
                    '        AlmacenFiltro.ToString() & "','" & "" & "','','" + idProd & "','" + CodigoTemp & "','" + CantTemp & "','2','N','" + Class1.vEmbarque & "','" + Class1.vOC & "','" + Class1.vFactura & "')"
                    '    If TipoProd = 3 Then sqllocal = "insert into vLogistik_Ubicaciones(" & "ubicacion, tarima, caja, id_product, codigo_producto, cantidad, estado, procesado_sae, embarque, oc, factura) values ('" +
                    '        UbicaOri & "','" + UbicaTemp & "','','" + idProd & "','" + CodigoTemp & "','" + CantTemp & "','3','N','" + Class1.vEmbarque & "','" + Class1.vOC & "','" + Class1.vFactura & "')"
                    '    If TipoProd = 2 Then sqllocal = "insert into vLogistik_Ubicaciones(" & "ubicacion, tarima, caja, id_product, codigo_producto, cantidad, estado, procesado_sae, embarque, oc, factura) values ('" +
                    '        AlmacenFiltro.ToString() & "','" & "" & "','','" + idProd & "','" + CodigoTemp & "','" + CantTemp & "','2','N','" + Class1.vEmbarque & "','" + Class1.vOC & "','" + Class1.vFactura & "')"
                    'Else
                    '    If UbicaOri <> "" Then
                    '        dCant = Convert.ToInt32(CantTemp) + Module1.Inv_cant
                    '        If TipoProd = 1 Then sqllocal = "update vLogistik_Ubicaciones set cantidad = " & dCant.ToString() & " where codigo_producto='" + CodigoTemp & "'" & " and ubicacion='" +
                    '            AlmacenFiltro.ToString() & "' and tarima = '" & "" & "' and embarque='" + Class1.vEmbarque & "' and oc='" + Class1.vOC & "' and factura='" + Class1.vFactura & "'"
                    '        If TipoProd = 3 Then sqllocal = "update vLogistik_Ubicaciones set cantidad = " & dCant.ToString() & " where codigo_producto='" + CodigoTemp & "'" & " and ubicacion='" +
                    '            AlmacenFiltro.ToString() & "' and tarima = '" + UbicaTemp & "' and embarque='" + Class1.vEmbarque & "' and oc='" + Class1.vOC & "' and factura='" + Class1.vFactura & "'"
                    '        If TipoProd = 2 Then sqllocal = "update vLogistik_Ubicaciones set cantidad = " & dCant.ToString() & " where codigo_producto='" + CodigoTemp & "'" & " and ubicacion='" +
                    '            AlmacenFiltro.ToString() & "' and tarima = '' and embarque='" + Class1.vEmbarque & "' and oc='" + Class1.vOC & "' and factura='" + Class1.vFactura & "'"
                    '    Else
                    '        'Toast.MakeText(Me, "ERROR CRITICO de SISTEMA !!!! Por favor Llame a su supervisor y no haga mas con la terminal...", ToastLength.Short).Show()
                    '    End If
                    'End If
                    'EjecutarQuerySQLWifi(sqllocal)
                    ''OJO: si es traspaso de Tarima a nueva ubicación, hay que cambiar la tarima con estas instrucciones:
                    'If editTextUbicaDest.Text = "PASILLO" OrElse editTextUbicaDest.Text = "PASILLO-GDL" Then
                    '    sqllocal = "update vLogistik_Ubicaciones set ubicacion = '" & IDWharehoseDest & "', estado='22'" & " where tarima='" & codigo & "'"
                    'Else
                    '    sqllocal = "update vLogistik_Ubicaciones set ubicacion = '" & IDWharehoseDest & "', estado='3'" & " where tarima='" & codigo & "'"
                    'End If
                    'EjecutarQuerySQLWifi(sqllocal)
                    ''OJO: En meter producto en Tarima, este es el query final
                    'Dim verifExist As Boolean = False
                    'Dim UbOrig As Integer = Convert.ToInt32(UbicaOri)
                    'verifExist = FnExisteArticuloInv(CodigoTemp, UbOrig, UbicaTemp)
                    'If verifExist = False Then
                    '    sqllocal = "insert into vLogistik_Ubicaciones(" & "ubicacion, tarima, caja, id_product, codigo_producto, cantidad, estado, procesado_sae, embarque, oc, factura) values ('" & UbicaOri & "','" + UbicaTemp & "','','" + idProd & "','" + CodigoTemp & "','" + CantTemp.ToString() & "','3','N','" + Class1.vEmbarque & "','" + Class1.vOC & "','" + Class1.vFactura & "')"
                    'Else
                    '    If UbicaOri <> "" Then
                    '        dCant = (CantTemp) + Class1.Inv_cant
                    '        sqllocal = "update vLogistik_Ubicaciones set cantidad = " & dCant.ToString() & " where codigo_producto='" + CodigoTemp & "'" & " and ubicacion='" + UbicaOri & "' and tarima = '" + UbicaTemp & "' and embarque='" + Class1.vEmbarque & "' and oc='" + Class1.vOC & "' and factura='" + Class1.vFactura & "'"
                    '    Else
                    '        'Toast.MakeText(Me, "ERROR CRITICO de SISTEMA !!!! Por favor Llame a su supervisor y no haga mas con la terminal...", ToastLength.Short).Show()
                    '    End If
                    'End If
                    'EjecutarQuerySQLWifi(sqllocal)

                    ''Ubicar
                    ''1   Producto a Tarima
                    ''Tipo de Traspaso = 1
                    ''2   Producto a ubicación
                    ''Tipo de Traspaso = 2
                    ''3   Tarima a Ubicación
                    ''Tipo de Traspaso = 3

                    verifExist = False
                    'If TipoProd = 1 Or TipoProd = 3 Then
                    '    verifExist = FnExisteArticuloInv(vArt, UbicaOri, UbicaTemp)
                    '    TarimaUsada = UbicaTemp
                    'Else
                    '    Verifica_Ubica(UbicaTemp, "1")
                    '    verifExist = FnExisteArticuloInv(vArt, IDWharehouse, "")
                    '    TarimaUsada = ""
                    'End If

                    'If verifExist = False Then
                    '    If TipoProd = 3 Then sqllocal = "insert into vLogistik_Ubicaciones(" & "ubicacion, tarima, caja, id_product, codigo_producto,
                    '    cantidad, estado, procesado_sae, embarque, oc, factura, id_usuario) values ('" & UbicaOri & "','" + UbicaTemp & "','','" +
                    '    idProd & "','" + CodigoTemp & "','" + CantTemp.ToString() & "','3','N','" + Class1.vEmbarque & "','" + Class1.vOC & "','" +
                    '    Class1.vFactura & "','" + Class1.vgID_employee.ToString() & "')"
                    '    If TipoProd = 2 Then sqllocal = "insert into vLogistik_Ubicaciones(" & "ubicacion, tarima, caja, id_product, codigo_producto,
                    '    cantidad, estado, procesado_sae, embarque, oc, factura, id_usuario) values ('" & IDWharehouse & "','" & "" & "','','" +
                    '    idProd & "','" + CodigoTemp & "','" + CantTemp.ToString() & "','3','N','" + Class1.vEmbarque & "','" + Class1.vOC & "','" +
                    '    Class1.vFactura & "','" + Class1.vgID_employee.ToString() & "')"
                    '    EjecutarQuerySQLWifi(sql1)
                    'Else

                    '    If TipoProd = 3 Then
                    '        If UbicaOri <> "" Then
                    '            dCant = Convert.ToDecimal(CantTemp) + Class1.Inv_cant
                    '            sqllocal = "update vLogistik_Ubicaciones set cantidad = " & dCant.ToString() & " where codigo_producto='" + CodigoTemp +
                    '                "'" & " and ubicacion='" + UbicaOri & "' and tarima = '" + UbicaTemp & "' and embarque ='" + Class1.vEmbarque +
                    '                "' and oc='" + Class1.vOC & "' and factura='" + Class1.vFactura & "'"
                    '        End If

                    '    ElseIf (TipoProd = 2) Then
                    '        'Toast.MakeText(Me, "ERROR CRITICO de SISTEMA !!!! Por favor Llame a su supervisor y no haga mas con la terminal...", ToastLength.Short).Show()
                    '    Else

                    '        If IDWharehouse <> "" Then
                    '            dCant = Convert.ToDecimal(CantTemp) + Class1.Inv_cant
                    '            sqllocal = "update vLogistik_Ubicaciones set cantidad = " & dCant.ToString() & " where codigo_producto='" + CodigoTemp +
                    '                "'" & " and ubicacion='" + IDWharehouse & "' and tarima = '' and embarque ='" + Class1.vEmbarque & "' and oc='" +
                    '                Class1.vOC & "' and factura='" + Class1.vFactura & "'"
                    '        Else
                    '            'Toast.MakeText(Me, "ERROR CRITICO de SISTEMA !!!! Por favor Llame a su supervisor y no haga mas con la terminal...", ToastLength.Short).Show()
                    '        End If
                    '    End If
                    '    EjecutarQuerySQLWifi(sqllocal)
                    'End If
                    ''Surtidos
                    ''Tipo de Traspaso = 0
                    If (TipoProd = 0) Then
                        '// perfil 8 verifica
                        '// perfil 1 o 9 surte
                        sqllocal = "update Logistik_order_detail set quantity_received = quantity_received + '" + vCant.ToString() & "'" & " where id_order = '" +
                                OrdenVenta.ToString() & "'" & " and product_upc = '" + vArt.ToString().Trim() & "' and num_empresa='" + vgNumEmpresa + "'"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    End If
                End If
            Next
        Catch es As SqlException
            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
            documento = OrdenVenta.ToString
            If vEnviadoSAE = "O" Then
                mensaje = "Registro de Salida:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            ElseIf vEnviadoSAE = "I" Then
                mensaje = "Registro de Entrada:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            End If
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTrans.Rollback()
            If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                Me.Dispose()
                'MenuPrincipal.Dispose()
            End If
            Throw es
        Catch ex As Exception
            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
            documento = OrdenVenta.ToString
            If vEnviadoSAE = "O" Then
                mensaje = "Registro de Salida:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            ElseIf vEnviadoSAE = "I" Then
                mensaje = "Registro de Entrada:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            End If
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTrans.Rollback()
            Throw ex
        End Try
    End Sub
    'Public Function FnExisteArticuloInv(ByVal codigo As String, ByVal ubica As Integer, ByVal Tarima As String) As Boolean
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" +
    '            My.Settings.vgBDOtroLado_User + "; Password=PASS;"
    '        Using con As SqlConnection = New SqlConnection(Str)
    '            con.Open()
    '            sqllocal = "Select cantidad from vLogistik_Ubicaciones" & " where codigo_producto = '" + codigo + "' and ubicacion='" +
    '                ubica.ToString() + "' and tarima='" + Tarima + "' and embarque='" + vEmbarque + "' and oc='" + vOC +
    '                "' and factura='" + vFactura + "'"
    '            Dim command As SqlCommand = New SqlCommand(sqllocal, con)
    '            Dim reader As SqlDataReader = command.ExecuteReader()
    '            Module1.Inv_cant = 0
    '            While reader.Read()
    '                Module1.Inv_cant = CDec(reader("cantidad"))
    '                Return True
    '            End While

    '            Return False
    '        End Using

    '    Catch ex As Exception
    '        'Toast.MakeText(Me, ex.Message, ToastLength.Short).Show()
    '        Return False
    '    End Try
    'End Function

#End Region

#Region "EnvioPedidosdeVentaSAE"
    Private Sub LlevarPedidoVentaSAE(ByVal pMiBD As String, ByVal pNUMEMP As String, ByVal Refer As String)
        'If vgTipoBD = "S" Then
        Label5.Text = "Sincronizando Remisiones del SQL a SAE"
        Call RemisionesSAE(pMiBD, pNUMEMP, Refer, "1020", "")
        'Else
        'Label5.Text = "Sincronizando Remisiones del Fire Bird a SAE"
        ''Call LlevarRemisionesSAEFB()
        'Call LlevarRemisionesSAE_FB()
        'End If
    End Sub
    'Private Sub LlevarRemisionesSAE_FB()
    '    'Remisiones
    '    Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=PASS;MultipleActiveResultSets=true;"
    '    Dim conn As New SqlConnection(Str)
    '    Dim NUM_ALM As String = ""
    '    Dim pcve_doc_origen As String = ""
    '    Try
    '        vfVerificarErrorVta = False
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "select id_order, current_state, AlamcenSAE, doc_sig_sae from Logistik_orders where EnviadaSAE = 'N' and current_state in (5,6) AND Tipo_Rem_Fact = 'R'"
    '        Dim daPC As New SqlDataAdapter(sqllocal, conn)
    '        Dim dsPC As New DataSet
    '        daPC.Fill(dsPC, "Logistik_orders")
    '        Dim oTablePC As New DataTable
    '        oTablePC = dsPC.Tables("Logistik_orders")
    '        Dim OrdenVenta As String
    '        Dim vEstatus As String
    '        Dim vDocRemision As String
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        For Each oRowPC In oTablePC.Rows
    '            OrdenVenta = Trim(oRowPC.Item("id_order").ToString)
    '            vEstatus = oRowPC.Item("current_state").ToString
    '            vDocRemision = oRowPC.Item("doc_sig_sae").ToString
    '            '----------------buscar configuracion
    '            Dim reader As FbDataReader
    '            Dim vlConf_Cve_Doc As Integer = Nothing
    '            Dim SqlSelection As String = "Select MASCARA from PARAM_FOLIOSF" + vgNumEmpresa.ToString + _
    '            " where NUM_EMP = '1' AND TIPODOCTO = 'P'"
    '            cmdFB = New FbCommand(SqlSelection, connFB)
    '            reader = cmdFB.ExecuteReader()
    '            While reader.Read()
    '                'MsgBox(reader.Item(0))
    '                vlConf_Cve_Doc = Trim(reader.Item(0).ToString)
    '                Exit While
    '            End While
    '            reader.Close()
    '            If vlConf_Cve_Doc <> 0 And vlConf_Cve_Doc <> 1 And vlConf_Cve_Doc <> 2 Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            If vlConf_Cve_Doc = 0 Then OrdenVenta = espacios(OrdenVenta, 20)
    '            If vlConf_Cve_Doc = 1 Then
    '                'agregar ceros
    '                OrdenVenta = ceros(OrdenVenta, 10)
    '                'agregar espacios
    '                OrdenVenta = espacios(OrdenVenta, 20)
    '            End If
    '            If vlConf_Cve_Doc = 2 Then OrdenVenta = Trim(OrdenVenta)
    '            '----------------------------------------------------------------------------
    '            sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" + _
    '            ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" + _
    '            ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" + _
    '            ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" + _
    '            ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" + _
    '            ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" + _
    '            ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" + _
    '            ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" + _
    '            ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" + _
    '            ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" + _
    '            ",DOC_ANT,TIP_DOC_SIG,DOC_SIG FROM FACTP" + vgNumEmpresa.ToString + _
    '            " WHERE CVE_DOC = '" & OrdenVenta & "'"
    '            '" WHERE ENLAZADO='O' and TIP_DOC_E = 'O'"
    '            Dim da As New FbDataAdapter(sqllocal, connFB)
    '            Dim ds As New DataSet
    '            da.Fill(ds, "FACTP" & vgNumEmpresa.ToString)
    '            Dim oTable As New DataTable
    '            oTable = ds.Tables("FACTP" & vgNumEmpresa.ToString)
    '            '----------------buscar configuracion
    '            Dim reader123 As FbDataReader
    '            vlConf_Cve_Doc = Nothing
    '            SqlSelection = "Select MASCARA from PARAM_FOLIOSF" + vgNumEmpresa.ToString + _
    '            " where NUM_EMP = '1' AND TIPODOCTO = 'R'"
    '            cmdFB = New FbCommand(SqlSelection, connFB)
    '            reader123 = cmdFB.ExecuteReader()
    '            While reader123.Read()
    '                'MsgBox(reader.Item(0))
    '                vlConf_Cve_Doc = Trim(reader123.Item(0).ToString)
    '                Exit While
    '            End While
    '            reader123.Close()
    '            If vlConf_Cve_Doc <> 0 And vlConf_Cve_Doc <> 1 And vlConf_Cve_Doc <> 2 Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            If vlConf_Cve_Doc = 0 Then OrdenVenta = espacios(OrdenVenta, 20)
    '            If vlConf_Cve_Doc = 1 Then
    '                'agregar ceros
    '                OrdenVenta = ceros(OrdenVenta, 10)
    '                'agregar espacios
    '                OrdenVenta = espacios(OrdenVenta, 20)
    '            End If
    '            If vlConf_Cve_Doc = 2 Then OrdenVenta = Trim(OrdenVenta)
    '            '----------------------------------------------------------------------------
    '            Dim TIP_DOC As String
    '            Dim CVE_DOC As String
    '            Dim CVE_CLPV As String
    '            Dim STATUS As String
    '            Dim DAT_MOSTR As String
    '            Dim CVE_VEND As String
    '            Dim CVE_PEDI As String
    '            Dim FECHA_DOC As String
    '            Dim FECHA_ENT As String
    '            Dim FECHA_VEN As String
    '            Dim FECHA_CANCELA As String
    '            Dim CAN_TOT As String
    '            Dim IMP_TOT1 As String
    '            Dim IMP_TOT2 As String
    '            Dim IMP_TOT3 As String
    '            Dim IMP_TOT4 As String
    '            Dim DES_TOT As String
    '            Dim DES_FIN As String
    '            Dim COM_TOT As String
    '            Dim CONDICION As String
    '            Dim CVE_OBS As String
    '            Dim NUM_ALMA As String = oRowPC.Item("AlamcenSAE").ToString
    '            Dim ACT_CXC As String
    '            Dim ACT_COI As String
    '            Dim ENLAZADO As String
    '            Dim TIP_DOC_E As String
    '            Dim NUM_MONED As String
    '            Dim TIPCAMB As String
    '            Dim NUM_PAGOS As String
    '            Dim FECHAELAB As String
    '            Dim PRIMERPAGO As String
    '            Dim RFC As String
    '            Dim CTLPOL As String
    '            Dim ESCFD As String
    '            Dim AUTORIZA As String
    '            Dim SERIE As String
    '            Dim FOLIO As String
    '            Dim AUTOANIO As String
    '            Dim DAT_ENVIO As String
    '            Dim CONTADO As String
    '            Dim CVE_BITA As String
    '            Dim BLOQ As String
    '            Dim FORMAENVIO As String
    '            Dim DES_FIN_PORC As String
    '            Dim DES_TOT_PORC As String
    '            Dim IMPORTE As String
    '            Dim COM_TOT_PORC As String
    '            Dim METODODEPAGO As String
    '            Dim NUMCTAPAGO As String
    '            Dim TIP_DOC_ANT As String
    '            Dim DOC_ANT As String
    '            Dim TIP_DOC_SIG As String
    '            Dim DOC_SIG As String
    '            Dim vCveDoc As String = ""
    '            If oTable.Rows.Count >= 1 Then
    '                '---------------------------------------
    '                objTransFB = connFB.BeginTransaction
    '                '--------------------------------------
    '                For Each oRow In oTable.Rows
    '                    TIP_DOC = "R"
    '                    'SigCveDoc = TraerCveDocSigRecep()
    '                    'CVE_DOC = SigCveDoc
    '                    CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
    '                    STATUS = oRow.Item("STATUS").ToString
    '                    DAT_MOSTR = oRow.Item("DAT_MOSTR").ToString
    '                    CVE_VEND = oRow.Item("CVE_VEND").ToString
    '                    CVE_PEDI = oRow.Item("CVE_PEDI").ToString
    '                    FECHA_DOC = oRow.Item("FECHA_DOC").ToString
    '                    If FECHA_DOC <> "" Then
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd hh:mm:ss")
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy-MM-dd hh:mm:ss.mmm")
    '                        FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd")
    '                    End If

    '                    FECHA_ENT = time
    '                    FECHA_ENT = Convert.ToDateTime(time).ToString("yyyy/MM/dd")
    '                    'FECHA_ENT = oRow.Item("FECHA_ENT").ToString
    '                    'If FECHA_ENT <> "" Then
    '                    '    'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                    '    'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("yyyy/MM/dd hh:mm:ss")
    '                    '    FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("yyyy/MM/dd")
    '                    'End If
    '                    FECHA_VEN = time
    '                    FECHA_VEN = Convert.ToDateTime(time).ToString("yyyy/MM/dd")
    '                    'FECHA_VEN = oRow.Item("FECHA_VEN").ToString
    '                    'If FECHA_VEN <> "" Then
    '                    '    'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                    '    'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("yyyy/MM/dd hh:mm:ss")
    '                    '    FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("yyyy/MM/dd")
    '                    'End If
    '                    FECHA_CANCELA = oRow.Item("FECHA_CANCELA").ToString
    '                    If FECHA_CANCELA <> "" Then
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
    '                        FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd")
    '                    Else
    '                        FECHA_CANCELA = time.ToString("yyyy/MM/dd")
    '                    End If
    '                    CAN_TOT = oRow.Item("CAN_TOT").ToString
    '                    IMP_TOT1 = oRow.Item("IMP_TOT1").ToString
    '                    IMP_TOT2 = oRow.Item("IMP_TOT2").ToString
    '                    IMP_TOT3 = oRow.Item("IMP_TOT3").ToString
    '                    IMP_TOT4 = oRow.Item("IMP_TOT4").ToString
    '                    DES_TOT = oRow.Item("DES_TOT").ToString
    '                    DES_FIN = oRow.Item("DES_FIN").ToString
    '                    COM_TOT = oRow.Item("COM_TOT").ToString
    '                    CONDICION = oRow.Item("CONDICION").ToString
    '                    CVE_OBS = oRow.Item("CVE_OBS").ToString
    '                    'NUM_ALMA = oRow.Item("NUM_ALMA").ToString
    '                    ACT_CXC = oRow.Item("ACT_CXC").ToString
    '                    ACT_COI = oRow.Item("ACT_COI").ToString

    '                    ENLAZADO = "O"
    '                    'If Trim(vEstatus) = "6" Then
    '                    '    ENLAZADO = "P"
    '                    'ElseIf Trim(vEstatus) = "5" Then
    '                    '    ENLAZADO = "T"
    '                    'End If

    '                    TIP_DOC_E = "r"
    '                    NUM_MONED = oRow.Item("NUM_MONED").ToString
    '                    TIPCAMB = oRow.Item("TIPCAMB").ToString
    '                    NUM_PAGOS = oRow.Item("NUM_PAGOS").ToString

    '                    FECHAELAB = vfechayhora
    '                    'FECHAELAB = oRow.Item("FECHAELAB").ToString
    '                    If FECHAELAB <> "" Then
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
    '                        FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss")
    '                    End If
    '                    PRIMERPAGO = oRow.Item("PRIMERPAGO").ToString
    '                    RFC = oRow.Item("RFC").ToString
    '                    CTLPOL = oRow.Item("CTLPOL").ToString()
    '                    ESCFD = oRow.Item("ESCFD").ToString
    '                    AUTORIZA = oRow.Item("AUTORIZA").ToString
    '                    SERIE = oRow.Item("SERIE").ToString
    '                    FOLIO = oRow.Item("FOLIO").ToString
    '                    AUTOANIO = oRow.Item("AUTOANIO").ToString
    '                    DAT_ENVIO = oRow.Item("DAT_ENVIO").ToString
    '                    CONTADO = oRow.Item("CONTADO").ToString
    '                    CVE_BITA = oRow.Item("CVE_BITA").ToString
    '                    BLOQ = oRow.Item("BLOQ").ToString
    '                    FORMAENVIO = oRow.Item("FORMAENVIO").ToString
    '                    DES_FIN_PORC = oRow.Item("DES_FIN_PORC").ToString
    '                    DES_TOT_PORC = oRow.Item("DES_TOT_PORC").ToString
    '                    IMPORTE = oRow.Item("IMPORTE").ToString
    '                    COM_TOT_PORC = oRow.Item("COM_TOT_PORC").ToString
    '                    METODODEPAGO = oRow.Item("METODODEPAGO").ToString
    '                    NUMCTAPAGO = oRow.Item("NUMCTAPAGO").ToString
    '                    TIP_DOC_ANT = "P"
    '                    DOC_ANT = CVE_DOC
    '                    TIP_DOC_SIG = Nothing
    '                    DOC_SIG = Nothing
    '                    '----------------buscar clave del documento
    '                    If vgEspecificarDoc = True Then
    '                        vCveDoc = UCase(vDocRemision)
    '                    Else
    '                        '----------------buscar configuracion
    '                        Dim readerDoc As FbDataReader
    '                        Dim SqlSelection7 As String = "Select ULT_DOC from FOLIOSF" + vgNumEmpresa.ToString + _
    '                        " where TIP_DOC = 'R'"
    '                        cmdFB = New FbCommand(SqlSelection7, connFB, objTransFB)
    '                        readerDoc = cmdFB.ExecuteReader()
    '                        While readerDoc.Read()
    '                            'MsgBox(reader.Item(0))
    '                            vCveDoc = Trim(readerDoc.Item(0).ToString)
    '                            'no se si se aumenta el consecutivo
    '                            vCveDoc = Val(vCveDoc) + 1
    '                            Exit While
    '                        End While
    '                        readerDoc.Close()
    '                    End If
    '                    If vCveDoc <> "" Then
    '                        If vlConf_Cve_Doc = 0 Then
    '                            vCveDoc = Trim(vCveDoc)
    '                            '**********************************
    '                            DOC_ANT = Trim(DOC_ANT)
    '                        End If
    '                        If vlConf_Cve_Doc = 1 Then
    '                            vCveDoc = ceros(vCveDoc, 10)
    '                            vCveDoc = espacios(vCveDoc, 20)
    '                            '**********************************
    '                            DOC_ANT = ceros(DOC_ANT, 10)
    '                            DOC_ANT = espacios(DOC_ANT, 20)
    '                        End If
    '                        If vlConf_Cve_Doc = 2 Then
    '                            vCveDoc = espacios(vCveDoc, 20)
    '                            '*********************************
    '                            DOC_ANT = espacios(DOC_ANT, 20)
    '                        End If
    '                        If DAT_MOSTR = "" Then DAT_MOSTR = "0"
    '                        If CAN_TOT = "" Then CAN_TOT = "0"
    '                        If IMP_TOT1 = "" Then IMP_TOT1 = "0"
    '                        If IMP_TOT2 = "" Then IMP_TOT2 = "0"
    '                        If IMP_TOT3 = "" Then IMP_TOT3 = "0"
    '                        If IMP_TOT4 = "" Then IMP_TOT4 = "0"
    '                        If DES_TOT = "" Then DES_TOT = "0"
    '                        If DES_FIN = "" Then DES_FIN = "0"
    '                        If COM_TOT = "" Then COM_TOT = "0"
    '                        If CVE_OBS = "" Then CVE_OBS = "0"
    '                        If NUM_ALMA = "" Then NUM_ALMA = "1"
    '                        If NUM_MONED = "" Then NUM_MONED = "1"
    '                        If TIPCAMB = "" Then TIPCAMB = "0"
    '                        If NUM_PAGOS = "" Then NUM_PAGOS = Nothing
    '                        If PRIMERPAGO = "" Then PRIMERPAGO = "0"
    '                        If CTLPOL = "" Then CTLPOL = "0"
    '                        If AUTORIZA = "" Then AUTORIZA = "0"
    '                        If FOLIO = "" Then FOLIO = "0"
    '                        If CVE_BITA = "" Then CVE_BITA = "0"
    '                        If DES_FIN_PORC = "" Then DES_FIN_PORC = "0"
    '                        If DES_TOT_PORC = "" Then DES_TOT_PORC = "0"
    '                        If IMPORTE = "" Then IMPORTE = "0"
    '                        If COM_TOT_PORC = "" Then COM_TOT_PORC = "0"
    '                        If vgVersion = "5" Then
    '                            sqllocal = "insert into FACTR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" + _
    '                            ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" + _
    '                            ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" + _
    '                            ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" + _
    '                            ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" + _
    '                            ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" + _
    '                            ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" + _
    '                            ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" + _
    '                            ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" + _
    '                            ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" + _
    '                            ",DOC_ANT,TIP_DOC_SIG,DOC_SIG) values (" + _
    '                            "'R','" + Trim(vCveDoc.ToString) + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" + _
    '                            CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" + _
    '                            FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + _
    '                            IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" + _
    '                            CVE_OBS + "','" + Trim(NUM_ALMA.ToString) + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" + _
    '                            "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" + _
    '                            PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" + _
    '                            SERIE + "','0','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" + _
    '                            CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" + _
    '                            IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" + _
    '                            DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "')"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                        If vgVersion = "6" Then
    '                            sqllocal = "insert into FACTR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" + _
    '                            ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" + _
    '                            ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" + _
    '                            ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" + _
    '                            ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" + _
    '                            ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" + _
    '                            ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" + _
    '                            ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" + _
    '                            ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" + _
    '                            ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" + _
    '                            ",DOC_ANT,TIP_DOC_SIG,DOC_SIG,VERSION_SINC) values (" + _
    '                            "'R','" + vCveDoc.ToString + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" + _
    '                            CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" + _
    '                            FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + _
    '                            IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" + _
    '                            CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" + _
    '                            "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" + _
    '                            PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" + _
    '                            SERIE + "','0','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" + _
    '                            CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" + _
    '                            IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" + _
    '                            DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "','" + FECHAELAB + "')"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                        If vgVersion = "7" Then
    '                            sqllocal = "insert into FACTR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" + _
    '                            ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" + _
    '                            ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" + _
    '                            ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" + _
    '                            ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" + _
    '                            ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" + _
    '                            ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" + _
    '                            ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" + _
    '                            ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" + _
    '                            ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" + _
    '                            ",DOC_ANT,TIP_DOC_SIG,DOC_SIG,VERSION_SINC) values (" + _
    '                            "'R','" + vCveDoc.ToString + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" + _
    '                            CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" + _
    '                            FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + _
    '                            IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" + _
    '                            CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" + _
    '                            "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" + _
    '                            PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" + _
    '                            SERIE + "','0','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" + _
    '                            CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" + _
    '                            IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" + _
    '                            DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "','" + FECHAELAB + "')"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                        sqllocal = "insert into FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC) values ('" + vCveDoc.ToString + "')"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        'sae lo inserta automaticamente
    '                        'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'cmdFB.ExecuteNonQuery()
    '                        '---------------------
    '                        'Dim vCve_Obs As String = TraerClaveSiguiente()
    '                        'Dim vCve_Obs As String
    '                        'Dim vcont7 As String = ""
    '                        'Dim reader7 As FbDataReader
    '                        'sqllocal = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCF" + vgNumEmpresa.ToString
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'reader7 = cmdFB.ExecuteReader()
    '                        'While reader7.Read()
    '                        '    'MsgBox(reader7.Item(0))
    '                        '    vcont7 = reader7.Item(0).ToString
    '                        '    vcont7 = Val(vcont7) + 1
    '                        'End While
    '                        'If vcont7 = "" Then vcont7 = "1"
    '                        'vCve_Obs = vcont7
    '                        'reader7.Close()
    '                        '-----------------------------------
    '                        Dim vObser As String = "Buenas Remisión HH"
    '                        'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'cmdFB.ExecuteNonQuery()
    '                        'Call UpdateOC(CVE_DOC, vCveDoc)
    '                        If Trim(vEstatus) = "6" Then
    '                            sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='P', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
    '                            " WHERE CVE_DOC ='" + CVE_DOC + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        Else
    '                            sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
    '                          " WHERE CVE_DOC ='" + CVE_DOC + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                        '------------------------
    '                        Dim vvArticulo As String
    '                        Dim dateactual As String = time
    '                        dateactual = Convert.ToDateTime(dateactual).ToString("yyyy/MM/dd")
    '                        sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
    '                        ",FECH_ULT_DOC = '" + dateactual + "' WHERE TIP_DOC = 'R'"
    '                        '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        '------------------------
    '                        'objTransFB.Commit()
    '                        '------------------------
    '                        vfVerificarErrorVta = True
    '                        Dim vfSubtot As Double
    '                        'vfSubtot = RemisionesDatalleSAEFB(vCveDoc, vObser, CVE_DOC, CVE_VEND, NUM_ALMA, CVE_CLPV, COM_TOT_PORC)
    '                        Dim pcvedoc As String = vCveDoc
    '                        Dim pObser As String = vObser
    '                        pcve_doc_origen = CVE_DOC
    '                        Dim VEND As String = CVE_VEND
    '                        Dim pAlmacen As String = NUM_ALMA
    '                        Dim pCve_Cliente As String = CVE_CLPV
    '                        Dim pComicion As String = COM_TOT_PORC
    '                        '--ByVal pcvedoc As String, ByVal pObser As String, ByVal pcve_doc_origen As String, ByVal VEND As String, ByVal pAlmacen As String, ByVal pCve_Cliente As String, ByVal pComicion As String
    '                        '---------------------------------------------
    '                        '------------------DETALLE DE REMISIONES
    '                        '----------------------------------------------
    '                        'Dim CVE_DOC As String
    '                        Dim NUM_PAR As String
    '                        Dim CVE_ART As String
    '                        Dim vlsubtotal As Double
    '                        Dim CANT As Double
    '                        Dim CANTp As Double
    '                        Dim PXS As String
    '                        Dim PREC As String
    '                        Dim COST As String
    '                        Dim IMPU1 As String
    '                        Dim IMPU2 As String
    '                        Dim IMPU3 As String
    '                        Dim IMPU4 As String
    '                        Dim IMP1APLA As String
    '                        Dim IMP2APLA As String
    '                        Dim IMP3APLA As String
    '                        Dim IMP4APLA As String
    '                        Dim TOTIMP1 As String
    '                        Dim TOTIMP2 As String
    '                        Dim TOTIMP3 As String
    '                        Dim TOTIMP4 As String
    '                        Dim DESC1 As String
    '                        Dim DESC2 As String
    '                        Dim DESC3 As String
    '                        Dim COMI As String
    '                        Dim APAR As String
    '                        Dim ACT_INV As String
    '                        NUM_ALM = pAlmacen
    '                        Dim POLIT_APLI As String
    '                        Dim TIP_CAM As String
    '                        Dim UNI_VENTA As String
    '                        Dim TIPO_PROD As String
    '                        'Dim CVE_OBS As String
    '                        Dim REG_SERIE As String
    '                        Dim E_LTPD As String
    '                        Dim TIPO_ELEM As String
    '                        Dim NUM_MOV As String
    '                        Dim TOT_PARTIDA As String
    '                        Dim IMPRIMIR As String
    '                        '----------------------------------------------
    '                        '-----------------------------------------------
    '                        'Dim readerLotesDet As SqlDataReader
    '                        SqlSelection = "select OD.product_upc, od.quantity_received, LP.CVE_ART, LP.LOTE, LP.CANT_SALIDA, LP.CVE_ALM, LP.PEDIMENTO, LP.FCHCADUC" + _
    '                        ",LP.FCHADUANA,LP.FCHULTMOV,LP.NOM_ADUAN,LP.CANTIDAD,LP.SALDO" + _
    '                        ",LP.CANT_ENTRADA,LP.CANT_SALIDA,LP.REG_LTPD,LP.CVE_OBS,LP.CIUDAD" + _
    '                        ",LP.FRONTERA,LP.FEC_PROD_LT,LP.GLN,LP.STATUS,LP.CVE_DOC" + _
    '                        ",LP.PARCIAL from Logistik_Lote_Pedimento LP RIGHT  JOIN Logistik_order_detail OD " + _
    '                        " ON LP.CVE_ART = OD.product_upc AND LP.CVE_DOC_SALIDA = OD.id_order" + _
    '                        " where OD.id_order='" + Trim(pcve_doc_origen.ToString) + "'"
    '                        Dim daLOTESDET As New SqlDataAdapter(SqlSelection, conn)
    '                        Dim dsLOTESDET As New DataSet
    '                        daLOTESDET.Fill(dsLOTESDET, "Lote_Pedimento")
    '                        Dim oTableLOTESDET As New DataTable
    '                        oTableLOTESDET = dsLOTESDET.Tables("Lote_Pedimento")
    '                        If conn.State = ConnectionState.Closed Then
    '                            conn.Open()
    '                        End If
    '                        'cmd = New SqlCommand(SqlSelection, conn)
    '                        'readerLotesDet = cmd.ExecuteReader()
    '                        '--------------------------------------------------
    '                        Dim vlLoteBandera As Boolean = False
    '                        Dim vlCVE_ART As String
    '                        Dim vlCVE_ART2 As String = ""
    '                        Dim vlLOTES As String
    '                        Dim vlCANT_ENTRADA As String
    '                        Dim vlCVE_ALM As String
    '                        '----------------------------------------
    '                        '---EXTRAER DATOS DEL SQL
    '                        Dim pLOTE As String
    '                        Dim pPEDIMENTO As String
    '                        Dim pFCHCADUC As String
    '                        Dim pFCHADUANA As String
    '                        Dim pFCHULTMOV As String
    '                        Dim pNOM_ADUAN As String
    '                        Dim pCANTIDAD As Double
    '                        Dim pCVE_OBS As String
    '                        Dim pCIUDAD As String
    '                        Dim pFRONTERA As String
    '                        Dim pFEC_PROD_LT As String
    '                        Dim pGLN As String
    '                        Dim pSTATUS As String
    '                        Dim pPARCIAL As String
    '                        '---------------------------------------
    '                        'While readerLotesDet.Read()
    '                        NUM_PAR = "0"
    '                        '----------------------------------------
    '                        'si HAY lotes
    '                        '----------------------------------------
    '                        Dim vlUpdateLotesExist As Integer = 1
    '                        For Each oRow777LOTE In oTableLOTESDET.Rows
    '                            'MsgBox(reader2.Item(0))
    '                            'vlCVE_ART = readerLotesDet.Item(0).ToString
    '                            'vlLOTES = readerLotesDet.Item(1).ToString
    '                            'vlCANT_ENTRADA = readerLotesDet.Item(2).ToString
    '                            'vlCVE_ALM = readerLotesDet.Item(3).ToString

    '                            vlLOTES = oRow777LOTE.Item("LOTE").ToString()
    '                            pLOTE = oRow777LOTE.Item("LOTE").ToString()
    '                            vlCVE_ART = oRow777LOTE.Item("CVE_ART").ToString()
    '                            vlCANT_ENTRADA = oRow777LOTE.Item("CANT_SALIDA").ToString()
    '                            If vlCVE_ART = "" Then
    '                                vlCVE_ART = oRow777LOTE.Item("product_upc").ToString()
    '                                vlCANT_ENTRADA = oRow777LOTE.Item("quantity_received").ToString()
    '                            End If
    '                            vlCVE_ALM = oRow777LOTE.Item("CVE_ALM").ToString()
    '                            pLOTE = oRow777LOTE.Item("LOTE").ToString()
    '                            pPEDIMENTO = oRow777LOTE.Item("PEDIMENTO").ToString()
    '                            pFCHCADUC = oRow777LOTE.Item("FCHCADUC").ToString()
    '                            pFCHADUANA = oRow777LOTE.Item("FCHADUANA").ToString()
    '                            pFCHULTMOV = oRow777LOTE.Item("FCHULTMOV").ToString()
    '                            pNOM_ADUAN = oRow777LOTE.Item("NOM_ADUAN").ToString()
    '                            If Len(oRow777LOTE.Item("CANTIDAD").ToString()) >= 1 Then
    '                                pCANTIDAD = oRow777LOTE.Item("CANTIDAD").ToString()
    '                            Else
    '                                pCANTIDAD = vlCANT_ENTRADA
    '                            End If

    '                            pCVE_OBS = oRow777LOTE.Item("CVE_OBS").ToString()
    '                            pCIUDAD = oRow777LOTE.Item("CIUDAD").ToString()
    '                            pFRONTERA = oRow777LOTE.Item("FRONTERA").ToString()
    '                            pFEC_PROD_LT = oRow777LOTE.Item("FEC_PROD_LT").ToString()
    '                            pGLN = oRow777LOTE.Item("GLN").ToString()
    '                            pSTATUS = oRow777LOTE.Item("STATUS").ToString()
    '                            pPARCIAL = oRow777LOTE.Item("PARCIAL").ToString()
    '                            NUM_PAR = Val(NUM_PAR) + 1
    '                            'If conn.State = ConnectionState.Open Then
    '                            '    conn.Close()
    '                            'End If
    '                            vlLoteBandera = True
    '                            Dim readerPAR_FACTP As FbDataReader
    '                            SqlSelection = "SELECT CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                            ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                            ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                            ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" + _
    '                            " FROM PAR_FACTP" + vgNumEmpresa.ToString + " where CVE_DOC = '" + pcve_doc_origen + "'" + _
    '                            " and CVE_ART = '" + Trim(vlCVE_ART.ToString) + "'"
    '                            cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                            readerPAR_FACTP = cmdFB.ExecuteReader()
    '                            '--------------------------------------
    '                            '---------------------------------------
    '                            'objTransFB = connFB.BeginTransaction()
    '                            '--------------------------------------
    '                            '-------------------------------------------
    '                            ' esta variable controla el consecutivo de las series
    '                            Dim mREG_SERIE As String
    '                            ' esta variable controla una sola entrada al ciclo de las series
    '                            Dim vlMaxNum As Boolean = True
    '                            While readerPAR_FACTP.Read()
    '                                'MsgBox(readerPAR_FACTP.Item(0))
    '                                CVE_DOC = readerPAR_FACTP.Item(0).ToString
    '                                'NUM_PAR = readerPAR_FACTP.Item(1).ToString
    '                                CVE_ART = readerPAR_FACTP.Item(2).ToString
    '                                CANTp = readerPAR_FACTP.Item(3).ToString
    '                                PXS = readerPAR_FACTP.Item(4).ToString
    '                                PREC = readerPAR_FACTP.Item(5).ToString
    '                                COST = readerPAR_FACTP.Item(6).ToString
    '                                IMPU1 = readerPAR_FACTP.Item(7).ToString
    '                                IMPU2 = readerPAR_FACTP.Item(8).ToString
    '                                IMPU3 = readerPAR_FACTP.Item(9).ToString

    '                                IMPU4 = readerPAR_FACTP.Item(10).ToString
    '                                IMP1APLA = readerPAR_FACTP.Item(11).ToString
    '                                IMP2APLA = readerPAR_FACTP.Item(12).ToString
    '                                IMP3APLA = readerPAR_FACTP.Item(13).ToString
    '                                IMP4APLA = readerPAR_FACTP.Item(14).ToString
    '                                TOTIMP1 = readerPAR_FACTP.Item(15).ToString
    '                                TOTIMP2 = readerPAR_FACTP.Item(16).ToString
    '                                TOTIMP3 = readerPAR_FACTP.Item(17).ToString
    '                                TOTIMP4 = readerPAR_FACTP.Item(18).ToString
    '                                DESC1 = readerPAR_FACTP.Item(19).ToString

    '                                DESC2 = readerPAR_FACTP.Item(20).ToString
    '                                DESC3 = readerPAR_FACTP.Item(21).ToString
    '                                COMI = readerPAR_FACTP.Item(22).ToString
    '                                APAR = readerPAR_FACTP.Item(23).ToString
    '                                ACT_INV = readerPAR_FACTP.Item(24).ToString
    '                                'NUM_ALM = reader2.Item(25).ToString
    '                                POLIT_APLI = readerPAR_FACTP.Item(26).ToString
    '                                TIP_CAM = readerPAR_FACTP.Item(27).ToString
    '                                UNI_VENTA = readerPAR_FACTP.Item(28).ToString
    '                                TIPO_PROD = readerPAR_FACTP.Item(29).ToString

    '                                CVE_OBS = readerPAR_FACTP.Item(30).ToString
    '                                REG_SERIE = readerPAR_FACTP.Item(31).ToString
    '                                E_LTPD = readerPAR_FACTP.Item(32).ToString
    '                                TIPO_ELEM = readerPAR_FACTP.Item(33).ToString
    '                                NUM_MOV = readerPAR_FACTP.Item(34).ToString
    '                                TOT_PARTIDA = readerPAR_FACTP.Item(35).ToString
    '                                IMPRIMIR = readerPAR_FACTP.Item(36).ToString

    '                                Dim Sql As String
    '                                '-------------------Traer la clave siguiente
    '                                ''CVE_OBS = TraerClaveSiguiente()
    '                                'Dim vcont As String = ""
    '                                ''Dim vnum As Integer
    '                                'Dim reader As FbDataReader
    '                                'Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCF" + vgNumEmpresa.ToString
    '                                'cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                'reader = cmdFB.ExecuteReader()
    '                                'While reader.Read()
    '                                '    'MsgBox(reader.Item(0))
    '                                '    vcont = reader.Item(0).ToString
    '                                '    vcont = Val(vcont) + 1
    '                                'End While
    '                                'If vcont = "" Then vcont = "1"
    '                                'CVE_OBS = vcont
    '                                'reader.Close()

    '                                'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                '---------------------crear el o los movimientos
    '                                'Dim vNum_Mov As String = ConsecutivoMovimiento()
    '                                Dim vNum_Mov As String
    '                                Dim vcont7 As String = ""
    '                                Dim readerMINVE As FbDataReader
    '                                Sql = "Select coalesce(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerMINVE = cmdFB.ExecuteReader()
    '                                While readerMINVE.Read()
    '                                    'MsgBox(reader7.Item(0))
    '                                    vcont7 = readerMINVE.Item(0).ToString
    '                                    vcont7 = Val(vcont7) + 1
    '                                End While
    '                                If vcont7 = "" Then vcont7 = "1"
    '                                vNum_Mov = vcont7
    '                                readerMINVE.Close()
    '                                '----------traer la cantidad
    '                                'Dim vlPedimento_OC As String = "0"
    '                                'Dim vlLote_OC As String = "0"
    '                                Dim readerOD As SqlDataReader
    '                                SqlSelection = "select OD.quantity_received from Logistik_order_detail OD" + _
    '                                " where OD.id_order = '" + Trim(pcve_doc_origen) + "' and OD.product_upc = '" + CVE_ART + "'"
    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                cmd = New SqlCommand(SqlSelection, conn)
    '                                readerOD = cmd.ExecuteReader()
    '                                While readerOD.Read()
    '                                    CANT = vlCANT_ENTRADA
    '                                    'vlPedimento_OC = readerOD.Item(1).ToString
    '                                    'vlLote_OC = readerOD.Item(2).ToString
    '                                End While
    '                                TOT_PARTIDA = CANT * COST
    '                                TOTIMP4 = (CANT * COST) * (IMPU4 / 100)

    '                                If conn.State = ConnectionState.Open Then
    '                                    conn.Close()
    '                                End If
    '                                readerOD.Close()
    '                                '-------------------------------------------
    '                                '----------tiene pedimento y numero de serie
    '                                Dim vlPedimento As String = "N"
    '                                Dim vlLote As String = "N"
    '                                Dim vlNumSer As String = "N"
    '                                Dim readerPedi As SqlDataReader
    '                                SqlSelection = "select p.Pedimento, p.NumSerie, p.Lote from Logistik_product p" + _
    '                                " where p.upc = '" + CVE_ART + "'"
    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                cmd = New SqlCommand(SqlSelection, conn)
    '                                readerPedi = cmd.ExecuteReader()
    '                                While readerPedi.Read()
    '                                    vlPedimento = readerPedi.Item(0)
    '                                    vlNumSer = readerPedi.Item(1)
    '                                    vlLote = readerPedi.Item(2)
    '                                End While
    '                                If conn.State = ConnectionState.Open Then
    '                                    conn.Close()
    '                                End If
    '                                readerPedi.Close()
    '                                If vlNumSer = "S" Then
    '                                    '--------------------------------------------------------------
    '                                    'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
    '                                    '---------------------------------------------------------------
    '                                    '--------------------------H NUMEROS DE SERIE
    '                                    If vlMaxNum = True Then
    '                                        Dim readerNumSerie3 As FbDataReader
    '                                        SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
    '                                        '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                                        readerNumSerie3 = cmdFB.ExecuteReader()
    '                                        While readerNumSerie3.Read()
    '                                            mREG_SERIE = readerNumSerie3.Item(0).ToString
    '                                            mREG_SERIE = Val(mREG_SERIE) + 1
    '                                        End While
    '                                        'If connFB.State = ConnectionState.Open Then
    '                                        '    connFB.Close()
    '                                        'End If
    '                                        readerNumSerie3.Close()
    '                                        vlMaxNum = False
    '                                    End If

    '                                    '---------------------------------------------------
    '                                    Dim nNUM_SER As String
    '                                    Dim nCOSTO As String
    '                                    Dim nDOCTO_ENT As String
    '                                    Dim nFECHA_ENT As String
    '                                    Dim nREG_SERIE As String
    '                                    Dim readerLogistikNumSerie As SqlDataReader
    '                                    'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
    '                                    '" FROM Logistik_numeros_series" + _
    '                                    '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                                    '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
    '                                    SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" + _
    '                                    " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" + _
    '                                    " where h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" + _
    '                                    " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART + "'" + _
    '                                    " and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='M'"
    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    cmd = New SqlCommand(SqlSelection, conn)
    '                                    readerLogistikNumSerie = cmd.ExecuteReader()
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    Dim vlNo_Par As Integer = 0
    '                                    Dim ns As New ArrayList()
    '                                    While readerLogistikNumSerie.Read()
    '                                        Dim NumSer_Cve_Doc As String = Trim(pcve_doc_origen.ToString)
    '                                        'NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
    '                                        nNUM_SER = readerLogistikNumSerie.Item(0).ToString
    '                                        nCOSTO = readerLogistikNumSerie.Item(1).ToString
    '                                        nDOCTO_ENT = readerLogistikNumSerie.Item(2).ToString
    '                                        nFECHA_ENT = readerLogistikNumSerie.Item(3).ToString
    '                                        nREG_SERIE = readerLogistikNumSerie.Item(4).ToString
    '                                        If nFECHA_ENT <> "" Then
    '                                            nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If

    '                                        sqllocal = "UPDATE NUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', COSTO = '" + nCOSTO + "', " + _
    '                                        "DOCTO_ENT = '" + NumSer_Cve_Doc + "', FECHA_ENT = '" + nFECHA_ENT + "'" + _
    '                                        " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()

    '                                        sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V'," + _
    '                                        "TIP_MOV = '51', CVE_DOC ='" + NumSer_Cve_Doc + "', REG_SERIE = '" + mREG_SERIE + "'" + _
    '                                       " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
    '                                       "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" ' AND REG_SERIE = '" + nREG_SERIE + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        ns.Add(nNUM_SER)
    '                                        vlNo_Par = vlNo_Par + 1
    '                                        If CANT = vlNo_Par Then
    '                                            Exit While
    '                                        End If

    '                                    End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If
    '                                    readerLogistikNumSerie.Close()
    '                                    ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                                    If ns.Count >= 1 Then
    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        For j = 0 To Val(CANT - 1)
    '                                            Dim vlNumSerieActual As String
    '                                            vlNumSerieActual = ns.Item(j)
    '                                            If vlNumSerieActual = "" Then Exit For
    '                                            sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'V'" + _
    '                                            " where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                                            " and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'" + _
    '                                            " AND NUM_SER ='" + vlNumSerieActual + "'"
    '                                            cmd = New SqlCommand(sqllocal, conn)
    '                                            cmd.ExecuteNonQuery()
    '                                            If j = Val(CANT) Then
    '                                                vlNo_Par = 0
    '                                                Exit For
    '                                            End If
    '                                        Next j
    '                                        If conn.State = ConnectionState.Open Then
    '                                            conn.Close()
    '                                        End If
    '                                    End If

    '                                    '--------------------------H NUMEROS DE SERIE
    '                                    'Dim nREG_SERIE As String
    '                                    'Dim readerNumSerie3 As SqlDataReader
    '                                    'SqlSelection = "SELECT NUM_SER, REG_SERIE" + _
    '                                    '" FROM Logistik_Hnumeros_series" + _
    '                                    '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                                    'conn.Open()
    '                                    'cmd = New SqlCommand(SqlSelection, conn)
    '                                    'readerNumSerie3 = cmd.ExecuteReader()
    '                                    'While readerNumSerie3.Read()
    '                                    '    nNUM_SER = readerNumSerie3.Item(0).ToString
    '                                    '    nREG_SERIE = readerNumSerie3.Item(1).ToString
    '                                    '    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', TIP_MOV = '51', CVE_DOC ='" + pcve_doc_origen.ToString + "'" + _
    '                                    '    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
    '                                    '    "' AND ALMACEN = '" + NUM_ALM + "' AND REG_SERIE = '" + nREG_SERIE + "'"
    '                                    '    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    '    cmdFB.ExecuteNonQuery()
    '                                    'End While
    '                                    'conn.Close()
    '                                    'readerNumSerie3.Close()
    '                                    '--------------------------------------------------------------
    '                                    'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
    '                                    '--------------------------------------------------------------
    '                                End If

    '                                Dim pREG_LTPD As String
    '                                If vlPedimento = "S" Or vlLote = "S" Then
    '                                    '---- extraer el consecutivo REG_LTPD de SAE
    '                                    Dim vConsecutivoReg_LTPD As Boolean
    '                                    Dim readerMAx As FbDataReader
    '                                    sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    If vConsecutivoReg_LTPD = False Then
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerMAx = cmdFB.ExecuteReader()
    '                                        While readerMAx.Read()
    '                                            pREG_LTPD = readerMAx.Item(0).ToString
    '                                            pREG_LTPD = Val(pREG_LTPD) + 1
    '                                        End While
    '                                        If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                                        readerMAx.Close()
    '                                        vConsecutivoReg_LTPD = True
    '                                    Else
    '                                        pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    End If
    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                End If

    '                                If vlPedimento = "S" And vlLote = "S" Then
    '                                    Dim vvll_ltpd = pPARCIAL
    '                                    Dim vvREG_LTPD_Exist As String
    '                                    Dim vvLotesBandera As String = False
    '                                    Dim readerLotesPedimento As FbDataReader
    '                                    Sql = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                                    "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                                    "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                    "STATUS, REG_LTPD, CVE_ART, CVE_ALM  FROM LTPD" + vgNumEmpresa.ToString + _
    '                                    " where CVE_ALM = '" + Trim(NUM_ALM) + "'" + _
    '                                    " and CVE_ART = '" + CVE_ART + "'" + _
    '                                    " and LOTE = '" + Trim(vlLOTES.ToString) + "'" + _
    '                                    " and CANTIDAD > '0'" + _
    '                                    " and PEDIMENTO = '" + pPEDIMENTO + "'"
    '                                    cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                    readerLotesPedimento = cmdFB.ExecuteReader()
    '                                    Dim vvCantFaltante As Double = CANT
    '                                    Dim ped As New ArrayList()
    '                                    While readerLotesPedimento.Read()
    '                                        pLOTE = readerLotesPedimento.Item(0).ToString
    '                                        pPEDIMENTO = readerLotesPedimento.Item(1).ToString
    '                                        pFCHCADUC = readerLotesPedimento.Item(2).ToString
    '                                        pFCHADUANA = readerLotesPedimento.Item(3).ToString
    '                                        pFCHULTMOV = readerLotesPedimento.Item(4).ToString
    '                                        pNOM_ADUAN = readerLotesPedimento.Item(5).ToString
    '                                        pCANTIDAD = Convert.ToDouble(readerLotesPedimento.Item(6).ToString)
    '                                        pCVE_OBS = readerLotesPedimento.Item(7).ToString
    '                                        pCIUDAD = readerLotesPedimento.Item(8).ToString
    '                                        pFRONTERA = readerLotesPedimento.Item(9).ToString
    '                                        pFEC_PROD_LT = readerLotesPedimento.Item(10).ToString
    '                                        pGLN = readerLotesPedimento.Item(11).ToString
    '                                        pSTATUS = readerLotesPedimento.Item(12).ToString
    '                                        pREG_LTPD = readerLotesPedimento.Item(13).ToString
    '                                        vvREG_LTPD_Exist = readerLotesPedimento.Item(13).ToString
    '                                        vvLotesBandera = True
    '                                    End While
    '                                    readerLotesPedimento.Close()
    '                                    If pFCHCADUC <> "" Then
    '                                        pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFCHADUANA <> "" Then
    '                                        pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFCHULTMOV <> "" Then
    '                                        pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFEC_PROD_LT <> "" Then
    '                                        pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If vvLotesBandera = True Then
    '                                        '------------------UPDATE PEDIMENTOS EN SAE
    '                                        sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + CANT.ToString + _
    '                                            " where PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                                            " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'" + _
    '                                            " AND LOTE = '" + Trim(vlLOTES.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '---- extraer MAXIMO el E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS NUM from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            'MsgBox(reader7.Item(0))
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                ElseIf vlLote = "S" Then
    '                                    '---------------------------------------------------------------
    '                                    'BEGIN INSERTAR LOTE 1 pedimento por partida
    '                                    '---------------------------------------------------------------
    '                                    Dim vvll_ltpd = pPARCIAL
    '                                    '+++++++++++++++++++++++++++++++++++++++++++++++++++
    '                                    '*******************verificar que no exista el lote
    '                                    '+++++++++++++++++++++++++++++++++++++++++++++++++++
    '                                    Dim vvREG_LTPD_Exist As String = ""
    '                                    Dim vvLotesBandera As String = False
    '                                    Dim readerLotes7 As FbDataReader
    '                                    sqllocal = "Select REG_LTPD, CVE_ART, LOTE, CVE_ALM from LTPD" + vgNumEmpresa.ToString + _
    '                                    " where CVE_ART = '" + Trim(CVE_ART.ToString) + "'" + _
    '                                    " and LOTE = '" + Trim(vlLOTES.ToString) + "'" + _
    '                                    " and CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    readerLotes7 = cmdFB.ExecuteReader()
    '                                    While readerLotes7.Read()
    '                                        vvREG_LTPD_Exist = readerLotes7.Item(0).ToString
    '                                        vvLotesBandera = True
    '                                    End While
    '                                    readerLotes7.Close()
    '                                    If pFCHCADUC <> "" Then
    '                                        pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFCHADUANA <> "" Then
    '                                        pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFCHULTMOV <> "" Then
    '                                        pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFEC_PROD_LT <> "" Then
    '                                        pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If vvLotesBandera = True Then
    '                                        'si existe, hacer update en la tabla de acumuladora
    '                                        sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET CANTIDAD = CANTIDAD - " + CANT.ToString + _
    '                                        " WHERE REG_LTPD = '" + Trim(vvREG_LTPD_Exist.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        ' hacer insert en la tabla de desglosados
    '                                        '---- extraer el consecutivo E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        '---------regltpd reiniciar a 1 e incrementar a 1 por partida
    '                                        If vlUpdateLotesExist = 1 Then
    '                                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                            E_LTPD + "','" + vvREG_LTPD_Exist.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                            cmdFB.ExecuteNonQuery()
    '                                            vlUpdateLotesExist = vlUpdateLotesExist + 1
    '                                        Else
    '                                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                            E_LTPD + "','" + vvREG_LTPD_Exist.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                            cmdFB.ExecuteNonQuery()
    '                                            vlUpdateLotesExist = vlUpdateLotesExist + 1
    '                                        End If
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If

    '                                ElseIf vlPedimento = "S" Then
    '                                    '---------------------------------------------------------------
    '                                    'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
    '                                    '---------------------------------------------------------------
    '                                    '---- extraer el consecutivo REG_LTPD de SAE
    '                                    'Dim pREG_LTPD As String
    '                                    'Dim readerMAx As FbDataReader
    '                                    'sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                                    'If connFB.State = ConnectionState.Closed Then
    '                                    '    connFB.Open()
    '                                    'End If
    '                                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    'readerMAx = cmdFB.ExecuteReader()
    '                                    'While readerMAx.Read()
    '                                    '    'MsgBox(reader7.Item(0))
    '                                    '    pREG_LTPD = readerMAx.Item(0).ToString
    '                                    '    pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    'End While
    '                                    'If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                                    'readerMAx.Close()
    '                                    '---EXTRAER DATOS DEL SQL
    '                                    'Dim pLOTE As String
    '                                    'Dim pPEDIMENTO As String
    '                                    'Dim pFCHCADUC As String
    '                                    'Dim pFCHADUANA As String
    '                                    'Dim pFCHULTMOV As String
    '                                    'Dim pNOM_ADUAN As String
    '                                    'Dim pCANTIDAD As Double
    '                                    'Dim pCVE_OBS As String
    '                                    'Dim pCIUDAD As String
    '                                    'Dim pFRONTERA As String
    '                                    'Dim pFEC_PROD_LT As String
    '                                    'Dim pGLN As String
    '                                    'Dim pSTATUS As String
    '                                    'Dim readerPedimento As SqlDataReader
    '                                    'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                                    '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                                    '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                    '"STATUS, REG_LTPD  FROM Logistik_Lote_Pedimento" + _
    '                                    '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                    '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'"
    '                                    'If conn.State = ConnectionState.Closed Then
    '                                    '    conn.Open()
    '                                    'End If
    '                                    'cmd = New SqlCommand(SqlSelection, conn)
    '                                    'readerPedimento = cmd.ExecuteReader()
    '                                    'VENTASREMISION()
    '                                    '-----------------------------------------
    '                                    'Dim readerPedimento As SqlDataReader
    '                                    ''Dim readerLTPD As FbDataReader
    '                                    'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                                    '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                                    '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                    '"STATUS, REG_LTPD, PARCIAL  FROM Logistik_Lote_Pedimento" + _
    '                                    '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                    '"' and CVE_DOC_SALIDA ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='V'" + _
    '                                    '" and PEDIMENTO = '" + Trim(pPEDIMENTO) + "'"
    '                                    'If conn.State = ConnectionState.Closed Then
    '                                    '    conn.Open()
    '                                    'End If
    '                                    'cmd = New SqlCommand(SqlSelection, conn)
    '                                    'readerPedimento = cmd.ExecuteReader()
    '                                    '--------------------------------------------
    '                                    Dim readerPedimento As FbDataReader
    '                                    Sql = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                                    "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                                    "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                    "STATUS, REG_LTPD  FROM LTPD" + vgNumEmpresa.ToString + _
    '                                    " where CVE_ALM = '" + Trim(NUM_ALM) + "'" + _
    '                                    " and CVE_ART = '" + CVE_ART + "'" + _
    '                                    " and CANTIDAD > '0'" + _
    '                                    " and PEDIMENTO = '" + pPEDIMENTO + "'"
    '                                    cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                    readerPedimento = cmdFB.ExecuteReader()
    '                                    '--------------------------------------------------
    '                                    Dim vvCantFaltante As Double = CANT
    '                                    Dim ped As New ArrayList()
    '                                    While readerPedimento.Read()
    '                                        pLOTE = readerPedimento.Item(0).ToString
    '                                        'pPEDIMENTO = readerPedimento.Item(1).ToString
    '                                        pFCHCADUC = readerPedimento.Item(2).ToString
    '                                        pFCHADUANA = readerPedimento.Item(3).ToString
    '                                        pFCHULTMOV = readerPedimento.Item(4).ToString
    '                                        pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                                        pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
    '                                        pCVE_OBS = readerPedimento.Item(7).ToString
    '                                        pCIUDAD = readerPedimento.Item(8).ToString
    '                                        pFRONTERA = readerPedimento.Item(9).ToString
    '                                        pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                                        pGLN = readerPedimento.Item(11).ToString
    '                                        pSTATUS = readerPedimento.Item(12).ToString
    '                                        pREG_LTPD = readerPedimento.Item(13).ToString

    '                                        If pFCHCADUC <> "" Then
    '                                            pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFCHADUANA <> "" Then
    '                                            pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFCHULTMOV <> "" Then
    '                                            pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFEC_PROD_LT <> "" Then
    '                                            pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If

    '                                        '------------------INSERTAR PEDIMENTOS EN SAE
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()

    '                                        'sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = '" + pCANTIDAD.ToString + "'" + _
    '                                        '" where PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                                        '" AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        'cmdFB.ExecuteNonQuery()

    '                                        If pCANTIDAD >= vvCantFaltante Then
    '                                            sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + vvCantFaltante.ToString + _
    '                                            " where PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                                            " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                            cmdFB.ExecuteNonQuery()
    '                                        Else
    '                                            sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + pCANTIDAD.ToString + _
    '                                            " where PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                                            " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                            cmdFB.ExecuteNonQuery()
    '                                            '9 >= 10
    '                                            '10 - 9 = 1
    '                                            vvCantFaltante = CANT - pCANTIDAD
    '                                        End If

    '                                        'sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                                        '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                                        '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                        '"STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + NUM_ALM + "','" + pFCHCADUC + "','" + _
    '                                        ' pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD + "','" + pREG_LTPD + "','" + _
    '                                        ' pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        'cmdFB.ExecuteNonQuery()

    '                                        '---- extraer MAXIMO el E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            'MsgBox(reader7.Item(0))
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        ped.Add(pPEDIMENTO)
    '                                        If pCANTIDAD >= vvCantFaltante Then
    '                                            Exit While
    '                                        End If
    '                                        ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                                        'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
    '                                        '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                        '"' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
    '                                        '" AND REG_LTPD = '" + pREG_LTPD.ToString + "'"
    '                                        'cmd = New SqlCommand(SqlSelection, conn)
    '                                        'cmd.ExecuteNonQuery()

    '                                    End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If
    '                                    readerPedimento.Close()
    '                                    If ped.Count >= 1 Then
    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        For j = 0 To ped.Count
    '                                            'For j = 0 To Val(CANT - 1)
    '                                            If j = ped.Count Then
    '                                                'If j = Val(CANT) Then
    '                                                Exit For
    '                                            End If
    '                                            Dim vlPedActual As String
    '                                            vlPedActual = ped.Item(j)
    '                                            If vlPedActual = "" Then Exit For
    '                                            sqllocal = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A', CANTIDAD = CANTIDAD -" + CANT.ToString + _
    '                                            " where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                            "' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='V'" + _
    '                                            " AND REG_LTPD = '" + pREG_LTPD.ToString + "' and Pedimento = '" + vlPedActual + "'"
    '                                            cmd = New SqlCommand(sqllocal, conn)
    '                                            cmd.ExecuteNonQuery()

    '                                        Next j
    '                                        If conn.State = ConnectionState.Open Then
    '                                            conn.Close()
    '                                        End If
    '                                    End If
    '                                    '---------------------------------------------------------------
    '                                    'END INSERTAR PEDIMENTOS
    '                                    '---------------------------------------------------------------
    '                                End If

    '                                If vlNumSer = "S" Then
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" + _
    '                                        "'" + pcvedoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" + _
    '                                        DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" + _
    '                                        NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" + _
    '                                        TOT_PARTIDA + "','" + POLIT_APLI + "')"
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        Dim VERSION_SINC As String = vfechayhora
    '                                        VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
    '                                        sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" + _
    '                                        ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" + _
    '                                        PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" + _
    '                                        IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" + _
    '                                        TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" + _
    '                                        DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" + _
    '                                        Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" + _
    '                                        CVE_OBS.ToString + "','" + mREG_SERIE + "','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" + _
    '                                        TOT_PARTIDA.ToString + "','" + POLIT_APLI.ToString + "','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1')"
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        Dim VERSION_SINC As String = vfechayhora
    '                                        VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
    '                                        sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" + _
    '                                        ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" + _
    '                                        PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" + _
    '                                        IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" + _
    '                                        TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" + _
    '                                        DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" + _
    '                                        Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" + _
    '                                        CVE_OBS.ToString + "','" + mREG_SERIE + "','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" + _
    '                                        TOT_PARTIDA.ToString + "','" + POLIT_APLI.ToString + "','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1')"
    '                                    End If
    '                                Else
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" + _
    '                                        "'" + pcvedoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" + _
    '                                        DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" + _
    '                                        NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','0','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" + _
    '                                        TOT_PARTIDA + "','" + POLIT_APLI + "')"
    '                                    End If
    '                                    Dim VERSION_SINC As String = vfechayhora
    '                                    VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" + _
    '                                        ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" + _
    '                                        PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" + _
    '                                        IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" + _
    '                                        TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" + _
    '                                        DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" + _
    '                                        Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" + _
    '                                        CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" + _
    '                                        TOT_PARTIDA.ToString + "','" + POLIT_APLI.ToString + "','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1')"
    '                                        'VENTAS()
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" + _
    '                                        ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" + _
    '                                        PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" + _
    '                                        IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" + _
    '                                        TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" + _
    '                                        DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" + _
    '                                        Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" + _
    '                                        CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" + _
    '                                        TOT_PARTIDA.ToString + "','" + POLIT_APLI.ToString + "','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1')"
    '                                        'VENTAS()
    '                                    End If
    '                                End If
    '                                If connFB.State = ConnectionState.Closed Then
    '                                    connFB.Open()
    '                                End If
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()

    '                                'INSERTAR EL INDICE
    '                                sqllocal = "insert into  PAR_FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR + "')"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'actualizar detalle PAR_FACTP01
    '                                sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString + _
    '                                " where CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'actualizar ACUMULADOR de remisiones y facturas
    '                                '-----------camision del vendedor
    '                                If pComicion = "" Then pComicion = "0"
    '                                If Val(pComicion) >= 1 Then
    '                                    Dim VLcomi As String = (pComicion / 100) * TOT_PARTIDA
    '                                    sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '                                    " RIMP = RIMP + " + TOTIMP4 + ", RCOMI = RCOMI + " + VLcomi + _
    '                                    " where CVE_AFACT = '11'"
    '                                Else
    '                                    sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '                                    " RIMP = RIMP + " + TOTIMP4 + "" + _
    '                                    " where CVE_AFACT = '11'"
    '                                End If
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()

    '                                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()

    '                                'insertar documentos siguientes
    '                                sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '                                "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '                                "'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" + _
    '                                NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '                                "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '                                "'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" + _
    '                                NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()

    '                                'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
    '                                ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                'actualizar las existencias
    '                                'Call ActualizarExistencias(CVE_ART, CANT)
    '                                sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                " PEND_SURT = PEND_SURT - " + CANT.ToString + ", COSTO_PROM = '" + COST + "'," + _
    '                                " ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
    '                                " WHERE CVE_ART ='" + CVE_ART + "'"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                '-----------------------------------------------
    '                                'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
    '                                Dim vExistencia As String = ""
    '                                Dim readerINVE As FbDataReader
    '                                Sql = "Select coalesce(max(EXIST),0) AS num from INVE" + vgNumEmpresa.ToString + " where CVE_ART = '" + CVE_ART + "'"
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerINVE = cmdFB.ExecuteReader()
    '                                While readerINVE.Read()
    '                                    'MsgBox(readerINVE.Item(0))
    '                                    vExistencia = readerINVE.Item(0).ToString
    '                                    'vExistencia = Val(vExistencia) - Val(CANT)
    '                                End While
    '                                If vExistencia = "" Then vExistencia = "1"
    '                                readerINVE.Close()
    '                                '---------EXTRAER CLAVE DEL FOLIO
    '                                Dim CVE_FOLIO As String = "0"
    '                                Dim readerFOLIO As FbDataReader
    '                                Sql = "Select ULT_CVE AS num from TBLCONTROL" + vgNumEmpresa.ToString + " where ID_TABLA = 32"
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerFOLIO = cmdFB.ExecuteReader()
    '                                While readerFOLIO.Read()
    '                                    'MsgBox(reader3.Item(0))
    '                                    CVE_FOLIO = readerFOLIO.Item(0).ToString
    '                                    'vExistencia = Val(vExistencia) + 1
    '                                End While
    '                                If CVE_FOLIO = "" Then CVE_FOLIO = "1"
    '                                readerFOLIO.Close()
    '                                '-----------------------------------------------
    '                                If vlNumSer = "S" Then
    '                                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                    "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" + _
    '                                    "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                                    "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                    "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" + _
    '                                    "S','0','" + COST + "','N','0')"
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                Else
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" + _
    '                                        "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" + _
    '                                        "S','0','" + COST + "','N','0')"
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'R','" + pcve_doc_origen.ToString + "','" + pCve_Cliente + "','" + VEND + "','" + CANT.ToString + "','" + _
    '                                        "0','" + PREC.ToString + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO + "','-1','" + _
    '                                        "S','" + COST + "','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'R','" + pcve_doc_origen.ToString + "','" + pCve_Cliente + "','" + VEND + "','" + CANT.ToString + "','" + _
    '                                        "0','" + PREC.ToString + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO + "','-1','" + _
    '                                        "S','" + COST + "','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                    sqllocal = "UPDATE MINVE" + vgNumEmpresa.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " + _
    '                                    " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" + _
    '                                    " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                    Dim VERSION_SINC As String
    '                                    VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
    '                                    sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" + _
    '                                    " WHERE CVE_ART = '" + CVE_ART + "'" + _
    '                                    " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                End If
    '                                'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                mREG_SERIE = Val(mREG_SERIE) + 1
    '                                vlsubtotal = vlsubtotal + (PREC * CANT)
    '                            End While
    '                            readerPAR_FACTP.Close()
    '                        Next
    '                        '------------------------
    '                        vfSubtot = vlsubtotal
    '                        objTransFB.Commit()
    '                        '------------------------
    '                        '----------------------------------------------
    '                        If vfSubtot >= 1 Then
    '                            Dim vfIVA As Double = vfSubtot * 0.16
    '                            Dim vfNeto As Double = vfSubtot + vfIVA
    '                            sqllocal = "update FACTR" + vgNumEmpresa.ToString + " set CAN_TOT = '" + vfSubtot.ToString + "', IMP_TOT4 = '" + vfIVA.ToString + "'," + _
    '                            " IMPORTE = '" + vfNeto.ToString + "', FECHA_CANCELA=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                    End If
    '                Next
    '                'OrdenVenta = Val(OrdenVenta)
    '                '1 NUEVO EN SAE, PC Y TERMINAL
    '                '2
    '                '3
    '                '4 PARCIAL ESTA EN CAPTURA
    '                '5 FINALIZADO EN LA TERMINAL
    '                '6 FINALIZADO PARCIALMENTE EN LA TERMINAL
    '                '7 FINALIZADOS Y ENVIADOS A SAE
    '                '8 FINALIZADO PARCIALMENTE Y ENVIADO A SAE
    '                '911  MODIFICADO EN SAE
    '                '666  CANCELADO EN SAE
    '                '-------------------PENDIENTE
    '                If vlConf_Cve_Doc = 0 Then OrdenVenta = espacios(OrdenVenta, 20)
    '                If vlConf_Cve_Doc = 1 Then
    '                    ''QUITAR espacios
    '                    'OrdenVenta = Trim(OrdenVenta)
    '                    ''QUITAR DE LA IZQUIERDA ceros
    '                    'OrdenVenta = Quitarceros(OrdenVenta)
    '                    'agregar ceros
    '                    OrdenVenta = ceros(OrdenVenta, 10)
    '                    'agregar espacios
    '                    OrdenVenta = espacios(OrdenVenta, 20)
    '                End If
    '                If vlConf_Cve_Doc = 2 Then OrdenVenta = Trim(OrdenVenta)

    '                If vfVerificarErrorVta = True Then
    '                    If Trim(vEstatus) = "6" Then
    '                        Dim sql As String = "update Logistik_orders SET EnviadaSAE = 'N', current_state = '8'" + _
    '                        " WHERE id_order = '" + Trim(OrdenVenta) + "'"
    '                        EjecutarQuerySQL_EMPRESA(sql)
    '                        '-------------------------
    '                        Dim vart As String
    '                        Dim readerPC As SqlDataReader
    '                        sql = "select product_upc from Logistik_order_detail" + _
    '                        " where id_order = '" + Trim(OrdenVenta) + "'"
    '                        conn.Open()
    '                        cmd = New SqlCommand(sql, conn)
    '                        readerPC = cmd.ExecuteReader()
    '                        While readerPC.Read()
    '                            vart = readerPC.Item(0).ToString
    '                            sql = "update Logistik_order_detail set product_quantity = product_quantity - quantity_received," + _
    '                                  " quantity_received = 0 " + _
    '                                  " where id_order = '" + Trim(OrdenVenta) + "' and product_upc = '" + vart + "'"
    '                            EjecutarQuerySQL_EMPRESA(sql)
    '                        End While
    '                        conn.Close()
    '                        readerPC.Close()
    '                        '--------------------------
    '                    Else
    '                        Dim sql As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state = '7'" + _
    '                        " WHERE id_order = '" + Trim(OrdenVenta) + "'"
    '                        EjecutarQuerySQL_EMPRESA(sql)
    '                    End If
    '                End If
    '            End If
    '        Next

    '        'MsgBox("Almacenado correctamente")
    '    Catch es As SqlException
    '        objTransFB.Rollback()
    '        Throw es
    '    Catch ex As Exception
    '        '***** rollback the transaction ************************************************'
    '        sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'M'" + _
    '        " where ALMACEN = '" + Trim(NUM_ALM) + "'" + _
    '        " and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "'"
    '        cmd = New SqlCommand(sqllocal, conn)
    '        cmd.ExecuteNonQuery()
    '        objTransFB.Rollback()
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Sub
    'Private Sub LlevarRemisionesSAEFB()
    '    'Remisiones
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=PASS;"
    '        Dim conn As New SqlConnection(Str)
    '        vfVerificarErrorVta = False
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "select id_order, current_state, AlamcenSAE, doc_sig_sae from Logistik_orders where EnviadaSAE = 'N' and current_state in (5,6) AND Tipo_Rem_Fact = 'R'"
    '        Dim daPC As New SqlDataAdapter(sqllocal, conn)
    '        Dim dsPC As New DataSet
    '        daPC.Fill(dsPC, "Logistik_orders")
    '        Dim oTablePC As New DataTable
    '        oTablePC = dsPC.Tables("Logistik_orders")
    '        Dim OrdenVenta As String
    '        Dim vEstatus As String
    '        Dim vDocRemision As String
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        For Each oRowPC In oTablePC.Rows
    '            OrdenVenta = oRowPC.Item("id_order").ToString
    '            vEstatus = oRowPC.Item("current_state").ToString
    '            vDocRemision = oRowPC.Item("doc_sig_sae").ToString
    '            '----------------buscar configuracion
    '            Dim reader As FbDataReader
    '            Dim vlConf_Cve_Doc As Integer = Nothing
    '            Dim SqlSelection As String = "Select MASCARA from PARAM_FOLIOSF" + vgNumEmpresa.ToString + _
    '            " where NUM_EMP = '1' AND TIPODOCTO = 'P'"
    '            cmdFB = New FbCommand(SqlSelection, connFB)
    '            reader = cmdFB.ExecuteReader()
    '            While reader.Read()
    '                'MsgBox(reader.Item(0))
    '                vlConf_Cve_Doc = Trim(reader.Item(0).ToString)
    '                Exit While
    '            End While
    '            reader.Close()
    '            If vlConf_Cve_Doc <> 0 And vlConf_Cve_Doc <> 1 And vlConf_Cve_Doc <> 2 Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            If vlConf_Cve_Doc = 0 Then OrdenVenta = espacios(OrdenVenta, 20)
    '            If vlConf_Cve_Doc = 1 Then
    '                'agregar ceros
    '                OrdenVenta = ceros(OrdenVenta, 10)
    '                'agregar espacios
    '                OrdenVenta = espacios(OrdenVenta, 20)
    '            End If
    '            If vlConf_Cve_Doc = 2 Then OrdenVenta = Trim(OrdenVenta)
    '            '----------------------------------------------------------------------------
    '            sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" + _
    '            ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" + _
    '            ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" + _
    '            ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" + _
    '            ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" + _
    '            ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" + _
    '            ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" + _
    '            ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" + _
    '            ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" + _
    '            ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" + _
    '            ",DOC_ANT,TIP_DOC_SIG,DOC_SIG FROM FACTP" + vgNumEmpresa.ToString + _
    '            " WHERE CVE_DOC = '" & OrdenVenta & "'"
    '            '" WHERE ENLAZADO='O' and TIP_DOC_E = 'O'"
    '            Dim da As New FbDataAdapter(sqllocal, connFB)
    '            Dim ds As New DataSet
    '            da.Fill(ds, "FACTP" & vgNumEmpresa.ToString)
    '            Dim oTable As New DataTable
    '            oTable = ds.Tables("FACTP" & vgNumEmpresa.ToString)
    '            '----------------buscar configuracion
    '            Dim reader123 As FbDataReader
    '            vlConf_Cve_Doc = Nothing
    '            SqlSelection = "Select MASCARA from PARAM_FOLIOSF" + vgNumEmpresa.ToString + _
    '            " where NUM_EMP = '1' AND TIPODOCTO = 'R'"
    '            cmdFB = New FbCommand(SqlSelection, connFB)
    '            reader123 = cmdFB.ExecuteReader()
    '            While reader123.Read()
    '                'MsgBox(reader.Item(0))
    '                vlConf_Cve_Doc = Trim(reader123.Item(0).ToString)
    '                Exit While
    '            End While
    '            reader123.Close()
    '            If vlConf_Cve_Doc <> 0 And vlConf_Cve_Doc <> 1 And vlConf_Cve_Doc <> 2 Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            If vlConf_Cve_Doc = 0 Then OrdenVenta = espacios(OrdenVenta, 20)
    '            If vlConf_Cve_Doc = 1 Then
    '                'agregar ceros
    '                OrdenVenta = ceros(OrdenVenta, 10)
    '                'agregar espacios
    '                OrdenVenta = espacios(OrdenVenta, 20)
    '            End If
    '            If vlConf_Cve_Doc = 2 Then OrdenVenta = Trim(OrdenVenta)
    '            '----------------------------------------------------------------------------
    '            Dim TIP_DOC As String
    '            Dim CVE_DOC As String
    '            Dim CVE_CLPV As String
    '            Dim STATUS As String
    '            Dim DAT_MOSTR As String
    '            Dim CVE_VEND As String
    '            Dim CVE_PEDI As String
    '            Dim FECHA_DOC As String
    '            Dim FECHA_ENT As String
    '            Dim FECHA_VEN As String
    '            Dim FECHA_CANCELA As String
    '            Dim CAN_TOT As String
    '            Dim IMP_TOT1 As String
    '            Dim IMP_TOT2 As String
    '            Dim IMP_TOT3 As String
    '            Dim IMP_TOT4 As String
    '            Dim DES_TOT As String
    '            Dim DES_FIN As String
    '            Dim COM_TOT As String
    '            Dim CONDICION As String
    '            Dim CVE_OBS As String
    '            Dim NUM_ALMA As String = oRowPC.Item("AlamcenSAE").ToString
    '            Dim ACT_CXC As String
    '            Dim ACT_COI As String
    '            Dim ENLAZADO As String
    '            Dim TIP_DOC_E As String
    '            Dim NUM_MONED As String
    '            Dim TIPCAMB As String
    '            Dim NUM_PAGOS As String
    '            Dim FECHAELAB As String
    '            Dim PRIMERPAGO As String
    '            Dim RFC As String
    '            Dim CTLPOL As String
    '            Dim ESCFD As String
    '            Dim AUTORIZA As String
    '            Dim SERIE As String
    '            Dim FOLIO As String
    '            Dim AUTOANIO As String
    '            Dim DAT_ENVIO As String
    '            Dim CONTADO As String
    '            Dim CVE_BITA As String
    '            Dim BLOQ As String
    '            Dim FORMAENVIO As String
    '            Dim DES_FIN_PORC As String
    '            Dim DES_TOT_PORC As String
    '            Dim IMPORTE As String
    '            Dim COM_TOT_PORC As String
    '            Dim METODODEPAGO As String
    '            Dim NUMCTAPAGO As String
    '            Dim TIP_DOC_ANT As String
    '            Dim DOC_ANT As String
    '            Dim TIP_DOC_SIG As String
    '            Dim DOC_SIG As String
    '            Dim vCveDoc As String = ""
    '            If oTable.Rows.Count >= 1 Then
    '                '---------------------------------------
    '                objTransFB = connFB.BeginTransaction()
    '                '--------------------------------------
    '                For Each oRow In oTable.Rows
    '                    TIP_DOC = "R"
    '                    'SigCveDoc = TraerCveDocSigRecep()
    '                    'CVE_DOC = SigCveDoc
    '                    CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
    '                    STATUS = oRow.Item("STATUS").ToString
    '                    DAT_MOSTR = oRow.Item("DAT_MOSTR").ToString
    '                    CVE_VEND = oRow.Item("CVE_VEND").ToString
    '                    CVE_PEDI = oRow.Item("CVE_PEDI").ToString
    '                    FECHA_DOC = oRow.Item("FECHA_DOC").ToString
    '                    If FECHA_DOC <> "" Then
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd hh:mm:ss")
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy-MM-dd hh:mm:ss.mmm")
    '                        FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd")
    '                    End If

    '                    FECHA_ENT = time
    '                    FECHA_ENT = Convert.ToDateTime(time).ToString("yyyy/MM/dd")
    '                    'FECHA_ENT = oRow.Item("FECHA_ENT").ToString
    '                    'If FECHA_ENT <> "" Then
    '                    '    'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                    '    'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("yyyy/MM/dd hh:mm:ss")
    '                    '    FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("yyyy/MM/dd")
    '                    'End If
    '                    FECHA_VEN = time
    '                    FECHA_VEN = Convert.ToDateTime(time).ToString("yyyy/MM/dd")
    '                    'FECHA_VEN = oRow.Item("FECHA_VEN").ToString
    '                    'If FECHA_VEN <> "" Then
    '                    '    'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                    '    'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("yyyy/MM/dd hh:mm:ss")
    '                    '    FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("yyyy/MM/dd")
    '                    'End If
    '                    FECHA_CANCELA = oRow.Item("FECHA_CANCELA").ToString
    '                    If FECHA_CANCELA <> "" Then
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
    '                        FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd")
    '                    Else
    '                        FECHA_CANCELA = time.ToString("yyyy/MM/dd")
    '                    End If
    '                    CAN_TOT = oRow.Item("CAN_TOT").ToString
    '                    IMP_TOT1 = oRow.Item("IMP_TOT1").ToString
    '                    IMP_TOT2 = oRow.Item("IMP_TOT2").ToString
    '                    IMP_TOT3 = oRow.Item("IMP_TOT3").ToString
    '                    IMP_TOT4 = oRow.Item("IMP_TOT4").ToString
    '                    DES_TOT = oRow.Item("DES_TOT").ToString
    '                    DES_FIN = oRow.Item("DES_FIN").ToString
    '                    COM_TOT = oRow.Item("COM_TOT").ToString
    '                    CONDICION = oRow.Item("CONDICION").ToString
    '                    CVE_OBS = oRow.Item("CVE_OBS").ToString
    '                    'NUM_ALMA = oRow.Item("NUM_ALMA").ToString
    '                    ACT_CXC = oRow.Item("ACT_CXC").ToString
    '                    ACT_COI = oRow.Item("ACT_COI").ToString

    '                    ENLAZADO = "O"
    '                    'If Trim(vEstatus) = "6" Then
    '                    '    ENLAZADO = "P"
    '                    'ElseIf Trim(vEstatus) = "5" Then
    '                    '    ENLAZADO = "T"
    '                    'End If

    '                    TIP_DOC_E = "r"
    '                    NUM_MONED = oRow.Item("NUM_MONED").ToString
    '                    TIPCAMB = oRow.Item("TIPCAMB").ToString
    '                    NUM_PAGOS = oRow.Item("NUM_PAGOS").ToString

    '                    FECHAELAB = vfechayhora
    '                    'FECHAELAB = oRow.Item("FECHAELAB").ToString
    '                    If FECHAELAB <> "" Then
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
    '                        FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss")
    '                    End If
    '                    PRIMERPAGO = oRow.Item("PRIMERPAGO").ToString
    '                    RFC = oRow.Item("RFC").ToString
    '                    CTLPOL = oRow.Item("CTLPOL").ToString()
    '                    ESCFD = oRow.Item("ESCFD").ToString
    '                    AUTORIZA = oRow.Item("AUTORIZA").ToString
    '                    SERIE = oRow.Item("SERIE").ToString
    '                    FOLIO = oRow.Item("FOLIO").ToString
    '                    AUTOANIO = oRow.Item("AUTOANIO").ToString
    '                    DAT_ENVIO = oRow.Item("DAT_ENVIO").ToString
    '                    CONTADO = oRow.Item("CONTADO").ToString
    '                    CVE_BITA = oRow.Item("CVE_BITA").ToString
    '                    BLOQ = oRow.Item("BLOQ").ToString
    '                    FORMAENVIO = oRow.Item("FORMAENVIO").ToString
    '                    DES_FIN_PORC = oRow.Item("DES_FIN_PORC").ToString
    '                    DES_TOT_PORC = oRow.Item("DES_TOT_PORC").ToString
    '                    IMPORTE = oRow.Item("IMPORTE").ToString
    '                    COM_TOT_PORC = oRow.Item("COM_TOT_PORC").ToString
    '                    METODODEPAGO = oRow.Item("METODODEPAGO").ToString
    '                    NUMCTAPAGO = oRow.Item("NUMCTAPAGO").ToString
    '                    TIP_DOC_ANT = "P"
    '                    DOC_ANT = CVE_DOC
    '                    TIP_DOC_SIG = Nothing
    '                    DOC_SIG = Nothing
    '                    '----------------buscar clave del documento
    '                    If vgEspecificarDoc = True Then
    '                        vCveDoc = UCase(vDocRemision)
    '                    Else
    '                        '----------------buscar configuracion
    '                        Dim readerDoc As FbDataReader
    '                        Dim SqlSelection7 As String = "Select ULT_DOC from FOLIOSF" + vgNumEmpresa.ToString + _
    '                        " where TIP_DOC = 'R'"
    '                        cmdFB = New FbCommand(SqlSelection7, connFB, objTransFB)
    '                        readerDoc = cmdFB.ExecuteReader()
    '                        While readerDoc.Read()
    '                            'MsgBox(reader.Item(0))
    '                            vCveDoc = Trim(readerDoc.Item(0).ToString)
    '                            'no se si se aumenta el consecutivo
    '                            vCveDoc = Val(vCveDoc) + 1
    '                            Exit While
    '                        End While
    '                        readerDoc.Close()
    '                    End If
    '                    If vCveDoc <> "" Then
    '                        If vlConf_Cve_Doc = 0 Then
    '                            vCveDoc = espacios(vCveDoc, 20)
    '                            '**********************************
    '                            DOC_ANT = espacios(DOC_ANT, 20)
    '                        End If
    '                        If vlConf_Cve_Doc = 1 Then
    '                            vCveDoc = ceros(vCveDoc, 10)
    '                            vCveDoc = espacios(vCveDoc, 20)
    '                            '**********************************
    '                            DOC_ANT = ceros(DOC_ANT, 10)
    '                            DOC_ANT = espacios(DOC_ANT, 20)
    '                        End If
    '                        If vlConf_Cve_Doc = 2 Then
    '                            vCveDoc = Trim(vCveDoc)
    '                            '*********************************
    '                            DOC_ANT = Trim(DOC_ANT)
    '                        End If
    '                        If DAT_MOSTR = "" Then DAT_MOSTR = "0"
    '                        If CAN_TOT = "" Then CAN_TOT = "0"
    '                        If IMP_TOT1 = "" Then IMP_TOT1 = "0"
    '                        If IMP_TOT2 = "" Then IMP_TOT2 = "0"
    '                        If IMP_TOT3 = "" Then IMP_TOT3 = "0"
    '                        If IMP_TOT4 = "" Then IMP_TOT4 = "0"
    '                        If DES_TOT = "" Then DES_TOT = "0"
    '                        If DES_FIN = "" Then DES_FIN = "0"
    '                        If COM_TOT = "" Then COM_TOT = "0"
    '                        If CVE_OBS = "" Then CVE_OBS = "0"
    '                        If NUM_ALMA = "" Then NUM_ALMA = "11"
    '                        If NUM_MONED = "" Then NUM_MONED = "1"
    '                        If TIPCAMB = "" Then TIPCAMB = "0"
    '                        If NUM_PAGOS = "" Then NUM_PAGOS = Nothing
    '                        If PRIMERPAGO = "" Then PRIMERPAGO = "0"
    '                        If CTLPOL = "" Then CTLPOL = "0"
    '                        If AUTORIZA = "" Then AUTORIZA = "0"
    '                        If FOLIO = "" Then FOLIO = "0"
    '                        If CVE_BITA = "" Then CVE_BITA = "0"
    '                        If DES_FIN_PORC = "" Then DES_FIN_PORC = "0"
    '                        If DES_TOT_PORC = "" Then DES_TOT_PORC = "0"
    '                        If IMPORTE = "" Then IMPORTE = "0"
    '                        If COM_TOT_PORC = "" Then COM_TOT_PORC = "0"
    '                        If vgVersion = "5" Then
    '                            sqllocal = "insert into FACTR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" + _
    '                            ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" + _
    '                            ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" + _
    '                            ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" + _
    '                            ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" + _
    '                            ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" + _
    '                            ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" + _
    '                            ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" + _
    '                            ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" + _
    '                            ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" + _
    '                            ",DOC_ANT,TIP_DOC_SIG,DOC_SIG) values (" + _
    '                            "'R','" + Trim(vCveDoc.ToString) + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" + _
    '                            CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" + _
    '                            FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + _
    '                            IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" + _
    '                            CVE_OBS + "','" + Trim(NUM_ALMA.ToString) + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" + _
    '                            "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" + _
    '                            PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" + _
    '                            SERIE + "','0','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" + _
    '                            CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" + _
    '                            IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" + _
    '                            DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "')"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                        If vgVersion = "6" Then
    '                            sqllocal = "insert into FACTR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" + _
    '                            ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" + _
    '                            ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" + _
    '                            ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" + _
    '                            ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" + _
    '                            ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" + _
    '                            ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" + _
    '                            ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" + _
    '                            ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" + _
    '                            ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" + _
    '                            ",DOC_ANT,TIP_DOC_SIG,DOC_SIG,VERSION_SINC) values (" + _
    '                            "'R','" + vCveDoc.ToString + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" + _
    '                            CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" + _
    '                            FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + _
    '                            IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" + _
    '                            CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" + _
    '                            "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" + _
    '                            PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" + _
    '                            SERIE + "','0','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" + _
    '                            CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" + _
    '                            IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" + _
    '                            DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "','" + FECHAELAB + "')"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If

    '                        sqllocal = "insert into FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC) values ('" + vCveDoc.ToString + "')"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        'sae lo inserta automaticamente
    '                        'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'cmdFB.ExecuteNonQuery()
    '                        '---------------------
    '                        'Dim vCve_Obs As String = TraerClaveSiguiente()
    '                        'Dim vCve_Obs As String
    '                        'Dim vcont7 As String = ""
    '                        'Dim reader7 As FbDataReader
    '                        'sqllocal = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCF" + vgNumEmpresa.ToString
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'reader7 = cmdFB.ExecuteReader()
    '                        'While reader7.Read()
    '                        '    'MsgBox(reader7.Item(0))
    '                        '    vcont7 = reader7.Item(0).ToString
    '                        '    vcont7 = Val(vcont7) + 1
    '                        'End While
    '                        'If vcont7 = "" Then vcont7 = "1"
    '                        'vCve_Obs = vcont7
    '                        'reader7.Close()
    '                        '-----------------------------------
    '                        Dim vObser As String = "Buenas Remisión HH"
    '                        'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'cmdFB.ExecuteNonQuery()
    '                        'Call UpdateOC(CVE_DOC, vCveDoc)
    '                        If Trim(vEstatus) = "6" Then
    '                            sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='P', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
    '                            " WHERE CVE_DOC ='" + CVE_DOC + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        Else
    '                            sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
    '                          " WHERE CVE_DOC ='" + CVE_DOC + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                        '------------------------
    '                        Dim dateactual As String = time
    '                        dateactual = Convert.ToDateTime(dateactual).ToString("yyyy/MM/dd")
    '                        sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
    '                        ",FECH_ULT_DOC = '" + dateactual + "' WHERE TIP_DOC = 'R'"
    '                        '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        '------------------------
    '                        objTransFB.Commit()
    '                        '------------------------
    '                        vfVerificarErrorVta = True
    '                        Dim vfSubtot As Double
    '                        vfSubtot = RemisionesDatalleSAEFB(vCveDoc, vObser, CVE_DOC, CVE_VEND, NUM_ALMA, CVE_CLPV, COM_TOT_PORC)
    '                        If vfSubtot >= 1 Then
    '                            Dim vfIVA As Double = vfSubtot * 0.16
    '                            Dim vfNeto As Double = vfSubtot + vfIVA
    '                            sqllocal = "update FACTR" + vgNumEmpresa.ToString + " set CAN_TOT = '" + vfSubtot.ToString + "', IMP_TOT4 = '" + vfIVA.ToString + "'," + _
    '                            " IMPORTE = '" + vfNeto.ToString + "', FECHA_CANCELA=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                    End If
    '                Next
    '                'OrdenVenta = Val(OrdenVenta)
    '                '1 NUEVO EN SAE, PC Y TERMINAL
    '                '2
    '                '3
    '                '4 PARCIAL ESTA EN CAPTURA
    '                '5 FINALIZADO EN LA TERMINAL
    '                '6 FINALIZADO PARCIALMENTE EN LA TERMINAL
    '                '7 FINALIZADOS Y ENVIADOS A SAE
    '                '8 FINALIZADO PARCIALMENTE Y ENVIADO A SAE
    '                '911  MODIFICADO EN SAE
    '                '666  CANCELADO EN SAE
    '                '-------------------PENDIENTE
    '                If vlConf_Cve_Doc = 0 Then OrdenVenta = Trim(OrdenVenta)
    '                If vlConf_Cve_Doc = 1 Then
    '                    'QUITAR espacios
    '                    OrdenVenta = Trim(OrdenVenta)
    '                    'QUITAR DE LA IZQUIERDA ceros
    '                    OrdenVenta = Quitarceros(OrdenVenta)

    '                End If
    '                If vlConf_Cve_Doc = 2 Then OrdenVenta = Trim(OrdenVenta)
    '                If vfVerificarErrorVta = True Then
    '                    If Trim(vEstatus) = "6" Then
    '                        Dim sql As String = "update Logistik_orders SET EnviadaSAE = 'N', current_state = '8'" + _
    '                        " WHERE id_order = '" + Trim(OrdenVenta) + "'"
    '                        EjecutarQuerySQL_EMPRESA(sql)
    '                        '-------------------------
    '                        Dim vart As String
    '                        Dim readerPC As SqlDataReader
    '                        sql = "select product_upc from Logistik_order_detail" + _
    '                        " where id_order = '" + Trim(OrdenVenta) + "'"
    '                        conn.Open()
    '                        cmd = New SqlCommand(sql, conn)
    '                        readerPC = cmd.ExecuteReader()
    '                        While readerPC.Read()
    '                            vart = readerPC.Item(0).ToString
    '                            sql = "update Logistik_order_detail set product_quantity = product_quantity - quantity_received," + _
    '                                  " quantity_received = 0 " + _
    '                                  " where id_order = '" + Trim(OrdenVenta) + "' and product_upc = '" + vart + "'"
    '                            EjecutarQuerySQL_EMPRESA(sql)
    '                        End While
    '                        conn.Close()
    '                        readerPC.Close()
    '                        '--------------------------
    '                    Else
    '                        Dim sql As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state = '7'" + _
    '                        " WHERE id_order = '" + Trim(OrdenVenta) + "'"
    '                        EjecutarQuerySQL_EMPRESA(sql)
    '                    End If
    '                End If
    '            End If
    '        Next

    '        'MsgBox("Almacenado correctamente")
    '    Catch es As SqlException
    '        objTransFB.Rollback()
    '        Throw es
    '    Catch ex As Exception
    '        '***** rollback the transaction ************************************************'
    '        objTransFB.Rollback()
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Sub
    'Function RemisionesDatalleSAEFB(ByVal pcvedoc As String, ByVal pObser As String, ByVal pcve_doc_origen As String, ByVal VEND As String, ByVal pAlmacen As String, ByVal pCve_Cliente As String, ByVal pComicion As String) As Double
    '    'envia datos al sae
    '    Dim SqlSelection As String
    '    Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=PASS;"
    '    Dim conn As New SqlConnection(Str)
    '    Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '    Try
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        Dim CVE_DOC As String
    '        Dim NUM_PAR As String
    '        Dim CVE_ART As String
    '        Dim vlsubtotal As Double
    '        Dim CANT As Double
    '        Dim CANTp As Double
    '        Dim PXS As String
    '        Dim PREC As String
    '        Dim COST As String
    '        Dim IMPU1 As String
    '        Dim IMPU2 As String
    '        Dim IMPU3 As String
    '        Dim IMPU4 As String
    '        Dim IMP1APLA As String
    '        Dim IMP2APLA As String
    '        Dim IMP3APLA As String
    '        Dim IMP4APLA As String
    '        Dim TOTIMP1 As String
    '        Dim TOTIMP2 As String
    '        Dim TOTIMP3 As String
    '        Dim TOTIMP4 As String
    '        Dim DESC1 As String
    '        Dim DESC2 As String
    '        Dim DESC3 As String
    '        Dim COMI As String
    '        Dim APAR As String
    '        Dim ACT_INV As String
    '        Dim NUM_ALM As String = pAlmacen
    '        Dim POLIT_APLI As String
    '        Dim TIP_CAM As String
    '        Dim UNI_VENTA As String
    '        Dim TIPO_PROD As String
    '        Dim CVE_OBS As String
    '        Dim REG_SERIE As String
    '        Dim E_LTPD As String
    '        Dim TIPO_ELEM As String
    '        Dim NUM_MOV As String
    '        Dim TOT_PARTIDA As String
    '        Dim IMPRIMIR As String
    '        Dim reader2 As FbDataReader
    '        SqlSelection = "SELECT CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" + _
    '         " FROM PAR_FACTP" + vgNumEmpresa.ToString + " where CVE_DOC = '" + pcve_doc_origen + "'"
    '        cmdFB = New FbCommand(SqlSelection, connFB)
    '        reader2 = cmdFB.ExecuteReader()
    '        '--------------------------------------
    '        '---------------------------------------
    '        objTransFB = connFB.BeginTransaction()
    '        '--------------------------------------
    '        '-------------------------------------------
    '        ' esta variable controla el consecutivo de las series
    '        Dim mREG_SERIE As String
    '        ' esta variable controla una sola entrada al ciclo de las series
    '        Dim vlMaxNum As Boolean = True
    '        While reader2.Read()
    '            'MsgBox(reader2.Item(0))
    '            CVE_DOC = reader2.Item(0).ToString
    '            NUM_PAR = reader2.Item(1).ToString
    '            CVE_ART = reader2.Item(2).ToString
    '            CANTp = reader2.Item(3).ToString
    '            PXS = reader2.Item(4).ToString
    '            PREC = reader2.Item(5).ToString
    '            COST = reader2.Item(6).ToString
    '            IMPU1 = reader2.Item(7).ToString
    '            IMPU2 = reader2.Item(8).ToString
    '            IMPU3 = reader2.Item(9).ToString

    '            IMPU4 = reader2.Item(10).ToString
    '            IMP1APLA = reader2.Item(11).ToString
    '            IMP2APLA = reader2.Item(12).ToString
    '            IMP3APLA = reader2.Item(13).ToString
    '            IMP4APLA = reader2.Item(14).ToString
    '            TOTIMP1 = reader2.Item(15).ToString
    '            TOTIMP2 = reader2.Item(16).ToString
    '            TOTIMP3 = reader2.Item(17).ToString
    '            TOTIMP4 = reader2.Item(18).ToString
    '            DESC1 = reader2.Item(19).ToString

    '            DESC2 = reader2.Item(20).ToString
    '            DESC3 = reader2.Item(21).ToString
    '            COMI = reader2.Item(22).ToString
    '            APAR = reader2.Item(23).ToString
    '            ACT_INV = reader2.Item(24).ToString
    '            'NUM_ALM = reader2.Item(25).ToString
    '            POLIT_APLI = reader2.Item(26).ToString
    '            TIP_CAM = reader2.Item(27).ToString
    '            UNI_VENTA = reader2.Item(28).ToString
    '            TIPO_PROD = reader2.Item(29).ToString

    '            CVE_OBS = reader2.Item(30).ToString
    '            REG_SERIE = reader2.Item(31).ToString
    '            E_LTPD = reader2.Item(32).ToString
    '            TIPO_ELEM = reader2.Item(33).ToString
    '            NUM_MOV = reader2.Item(34).ToString
    '            TOT_PARTIDA = reader2.Item(35).ToString
    '            IMPRIMIR = reader2.Item(36).ToString
    '            Dim Sql As String
    '            '-------------------Traer la clave siguiente
    '            ''CVE_OBS = TraerClaveSiguiente()
    '            'Dim vcont As String = ""
    '            ''Dim vnum As Integer
    '            'Dim reader As FbDataReader
    '            'Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCF" + vgNumEmpresa.ToString
    '            'cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            'reader = cmdFB.ExecuteReader()
    '            'While reader.Read()
    '            '    'MsgBox(reader.Item(0))
    '            '    vcont = reader.Item(0).ToString
    '            '    vcont = Val(vcont) + 1
    '            'End While
    '            'If vcont = "" Then vcont = "1"
    '            'CVE_OBS = vcont
    '            'reader.Close()

    '            'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            '---------------------crear el o los movimientos
    '            'Dim vNum_Mov As String = ConsecutivoMovimiento()
    '            Dim vNum_Mov As String
    '            Dim vcont7 As String = ""
    '            Dim reader7 As FbDataReader
    '            Sql = "Select coalesce(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            reader7 = cmdFB.ExecuteReader()
    '            While reader7.Read()
    '                'MsgBox(reader7.Item(0))
    '                vcont7 = reader7.Item(0).ToString
    '                vcont7 = Val(vcont7) + 1
    '            End While
    '            If vcont7 = "" Then vcont7 = "1"
    '            vNum_Mov = vcont7
    '            reader7.Close()
    '            '----------traer la cantidad
    '            Dim readerPC As SqlDataReader
    '            SqlSelection = "select quantity_received from Logistik_order_detail" + _
    '            " where id_order = '" + Trim(pcve_doc_origen) + "' and product_upc = '" + CVE_ART + "'"
    '            If conn.State = ConnectionState.Closed Then
    '                conn.Open()
    '            End If
    '            cmd = New SqlCommand(SqlSelection, conn)
    '            readerPC = cmd.ExecuteReader()
    '            While readerPC.Read()
    '                CANT = Convert.ToDouble(readerPC.Item(0).ToString)
    '            End While
    '            If conn.State = ConnectionState.Open Then
    '                conn.Close()
    '            End If
    '            readerPC.Close()
    '            '-------------------------------------------
    '            '----------tiene pedimento y numero de serie
    '            Dim vlPedimento As String = "N"
    '            Dim vlNumSer As String = "S"
    '            Dim readerPedi As SqlDataReader
    '            SqlSelection = "select Pedimento, NumSerie from Logistik_product" + _
    '            " where upc = '" + CVE_ART + "'"
    '            conn.Open()
    '            cmd = New SqlCommand(SqlSelection, conn)
    '            readerPedi = cmd.ExecuteReader()
    '            While readerPedi.Read()
    '                vlPedimento = readerPedi.Item(0)
    '                vlNumSer = readerPedi.Item(1)
    '            End While
    '            conn.Close()
    '            readerPedi.Close()
    '            If vlNumSer = "S" Then
    '                '--------------------------------------------------------------
    '                'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
    '                '---------------------------------------------------------------
    '                '--------------------------H NUMEROS DE SERIE
    '                If vlMaxNum = True Then
    '                    Dim readerNumSerie3 As FbDataReader
    '                    SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
    '                    '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                    If connFB.State = ConnectionState.Closed Then
    '                        connFB.Open()
    '                    End If
    '                    cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                    readerNumSerie3 = cmdFB.ExecuteReader()
    '                    While readerNumSerie3.Read()
    '                        mREG_SERIE = readerNumSerie3.Item(0).ToString
    '                        mREG_SERIE = Val(mREG_SERIE) + 1
    '                    End While
    '                    'If connFB.State = ConnectionState.Open Then
    '                    '    connFB.Close()
    '                    'End If
    '                    readerNumSerie3.Close()
    '                    vlMaxNum = False
    '                End If
    '                '---------------------------------------------------
    '                Dim nNUM_SER As String
    '                Dim nCOSTO As String
    '                Dim nDOCTO_ENT As String
    '                Dim nFECHA_ENT As String
    '                Dim nREG_SERIE As String
    '                Dim readerNumSerie As SqlDataReader
    '                'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
    '                '" FROM Logistik_numeros_series" + _
    '                '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
    '                SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" + _
    '                " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" + _
    '                " where h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" + _
    '                " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART + _
    '                "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='M'"
    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                cmd = New SqlCommand(SqlSelection, conn)
    '                readerNumSerie = cmd.ExecuteReader()
    '                If connFB.State = ConnectionState.Closed Then
    '                    connFB.Open()
    '                End If
    '                While readerNumSerie.Read()
    '                    Dim NumSer_Cve_Doc As String = Trim(pcve_doc_origen.ToString)
    '                    'NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
    '                    nNUM_SER = readerNumSerie.Item(0).ToString
    '                    nCOSTO = readerNumSerie.Item(1).ToString
    '                    nDOCTO_ENT = readerNumSerie.Item(2).ToString
    '                    nFECHA_ENT = readerNumSerie.Item(3).ToString
    '                    nREG_SERIE = readerNumSerie.Item(4).ToString
    '                    If nFECHA_ENT <> "" Then
    '                        nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If

    '                    sqllocal = "UPDATE NUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', COSTO = '" + nCOSTO + "', " + _
    '                    "DOCTO_ENT = '" + NumSer_Cve_Doc + "', FECHA_ENT = '" + nFECHA_ENT + "'" + _
    '                    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()

    '                    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V'," + _
    '                    "TIP_MOV = '51', CVE_DOC ='" + NumSer_Cve_Doc + "', REG_SERIE = '" + mREG_SERIE + "'" + _
    '                   " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
    '                   "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" ' AND REG_SERIE = '" + nREG_SERIE + "'"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()

    '                    ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                    'sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'V'" + _
    '                    '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                    '" and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'" + _
    '                    '" AND NUM_SER ='" + nNUM_SER + "'"
    '                    'cmd = New SqlCommand(sqllocal, conn)
    '                    'cmd.ExecuteNonQuery()

    '                End While
    '                If conn.State = ConnectionState.Open Then
    '                    conn.Close()
    '                End If
    '                readerNumSerie.Close()
    '                '--------------------------H NUMEROS DE SERIE
    '                'Dim nREG_SERIE As String
    '                'Dim readerNumSerie3 As SqlDataReader
    '                'SqlSelection = "SELECT NUM_SER, REG_SERIE" + _
    '                '" FROM Logistik_Hnumeros_series" + _
    '                '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                'conn.Open()
    '                'cmd = New SqlCommand(SqlSelection, conn)
    '                'readerNumSerie3 = cmd.ExecuteReader()
    '                'While readerNumSerie3.Read()
    '                '    nNUM_SER = readerNumSerie3.Item(0).ToString
    '                '    nREG_SERIE = readerNumSerie3.Item(1).ToString
    '                '    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', TIP_MOV = '51', CVE_DOC ='" + pcve_doc_origen.ToString + "'" + _
    '                '    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
    '                '    "' AND ALMACEN = '" + NUM_ALM + "' AND REG_SERIE = '" + nREG_SERIE + "'"
    '                '    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                '    cmdFB.ExecuteNonQuery()
    '                'End While
    '                'conn.Close()
    '                'readerNumSerie3.Close()
    '                '--------------------------------------------------------------
    '                'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
    '                '--------------------------------------------------------------
    '            End If
    '            If vlPedimento = "S" Then


    '                '---------------------------------------------------------------
    '                'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
    '                '---------------------------------------------------------------
    '                '---- extraer el consecutivo REG_LTPD de SAE
    '                Dim pREG_LTPD As String
    '                'Dim readerMAx As FbDataReader
    '                'sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                'If connFB.State = ConnectionState.Closed Then
    '                '    connFB.Open()
    '                'End If
    '                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                'readerMAx = cmdFB.ExecuteReader()
    '                'While readerMAx.Read()
    '                '    'MsgBox(reader7.Item(0))
    '                '    pREG_LTPD = readerMAx.Item(0).ToString
    '                '    pREG_LTPD = Val(pREG_LTPD) + 1
    '                'End While
    '                'If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                'readerMAx.Close()
    '                '---EXTRAER DATOS DEL SQL
    '                Dim pLOTE As String
    '                Dim pPEDIMENTO As String
    '                Dim pFCHCADUC As String
    '                Dim pFCHADUANA As String
    '                Dim pFCHULTMOV As String
    '                Dim pNOM_ADUAN As String
    '                Dim pCANTIDAD As Double
    '                Dim pCVE_OBS As String
    '                Dim pCIUDAD As String
    '                Dim pFRONTERA As String
    '                Dim pFEC_PROD_LT As String
    '                Dim pGLN As String
    '                Dim pSTATUS As String
    '                'Dim readerPedimento As SqlDataReader
    '                'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                '"STATUS, REG_LTPD  FROM Logistik_Lote_Pedimento" + _
    '                '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'"
    '                'If conn.State = ConnectionState.Closed Then
    '                '    conn.Open()
    '                'End If
    '                'cmd = New SqlCommand(SqlSelection, conn)
    '                'readerPedimento = cmd.ExecuteReader()
    '                Dim readerPedimento As FbDataReader
    '                Sql = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                "STATUS, REG_LTPD  FROM LTPD" + vgNumEmpresa.ToString + _
    '                " where CVE_ALM = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                " and CANTIDAD > '0'"
    '                'If conn.State = ConnectionState.Closed Then
    '                '    conn.Open()
    '                'End If
    '                'cmd = New SqlCommand(SqlSelection, conn)
    '                'readerPedimento = cmd.ExecuteReader()
    '                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                readerPedimento = cmdFB.ExecuteReader()
    '                Dim vvCantFaltante As Double = CANT
    '                While readerPedimento.Read()
    '                    pLOTE = readerPedimento.Item(0).ToString
    '                    pPEDIMENTO = readerPedimento.Item(1).ToString
    '                    pFCHCADUC = readerPedimento.Item(2).ToString
    '                    pFCHADUANA = readerPedimento.Item(3).ToString
    '                    pFCHULTMOV = readerPedimento.Item(4).ToString
    '                    pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                    pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
    '                    pCVE_OBS = readerPedimento.Item(7).ToString
    '                    pCIUDAD = readerPedimento.Item(8).ToString
    '                    pFRONTERA = readerPedimento.Item(9).ToString
    '                    pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                    pGLN = readerPedimento.Item(11).ToString
    '                    pSTATUS = readerPedimento.Item(12).ToString
    '                    pREG_LTPD = readerPedimento.Item(13).ToString

    '                    If pFCHCADUC <> "" Then
    '                        pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFCHADUANA <> "" Then
    '                        pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFCHULTMOV <> "" Then
    '                        pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFEC_PROD_LT <> "" Then
    '                        pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If

    '                    '------------------INSERTAR PEDIMENTOS EN SAE
    '                    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()

    '                    'sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = '" + pCANTIDAD.ToString + "'" + _
    '                    '" where PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                    '" AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()

    '                    If pCANTIDAD >= vvCantFaltante Then
    '                        sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + vvCantFaltante.ToString + _
    '                        " where PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                    Else
    '                        sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + pCANTIDAD.ToString + _
    '                        " where PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        '9 >= 10
    '                        '10 - 9 = 1
    '                        vvCantFaltante = CANT - pCANTIDAD
    '                    End If

    '                    'sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                    '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                    '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                    '"STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + NUM_ALM + "','" + pFCHCADUC + "','" + _
    '                    ' pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD + "','" + pREG_LTPD + "','" + _
    '                    ' pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()

    '                    '---- extraer MAXIMO el E_LTPD de SAE
    '                    Dim readerLTPD As FbDataReader
    '                    sqllocal = "Select MAX(E_LTPD) AS NUM from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                    If connFB.State = ConnectionState.Closed Then
    '                        connFB.Open()
    '                    End If
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    readerLTPD = cmdFB.ExecuteReader()
    '                    While readerLTPD.Read()
    '                        'MsgBox(reader7.Item(0))
    '                        E_LTPD = readerLTPD.Item(0).ToString
    '                        E_LTPD = Val(E_LTPD) + 1
    '                    End While
    '                    If E_LTPD = "" Then E_LTPD = "1"
    '                    readerLTPD.Close()
    '                    sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                    E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    If pCANTIDAD >= vvCantFaltante Then
    '                        Exit While
    '                    End If
    '                    ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                    'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
    '                    '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                    '"' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
    '                    '" AND REG_LTPD = '" + pREG_LTPD.ToString + "'"
    '                    'cmd = New SqlCommand(SqlSelection, conn)
    '                    'cmd.ExecuteNonQuery()

    '                End While
    '                If conn.State = ConnectionState.Open Then
    '                    conn.Close()
    '                End If
    '                readerPedimento.Close()
    '                '---------------------------------------------------------------
    '                'END INSERTAR PEDIMENTOS
    '                '---------------------------------------------------------------
    '            End If
    '            If vlNumSer = "S" Then
    '                sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" + _
    '                "'" + pcvedoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" + _
    '                PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" + _
    '                DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" + _
    '                NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" + _
    '                CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" + _
    '                TOT_PARTIDA + "','" + POLIT_APLI + "')"
    '            Else
    '                If vgVersion = "5" Then
    '                    sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                    ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                    ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                    ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" + _
    '                    "'" + pcvedoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" + _
    '                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                    IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" + _
    '                    DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" + _
    '                    NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" + _
    '                    CVE_OBS + "','0','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" + _
    '                    TOT_PARTIDA + "','" + POLIT_APLI + "')"
    '                End If
    '                Dim VERSION_SINC As String = vfechayhora
    '                VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
    '                If vgVersion = "6" Then
    '                    sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                    ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                    ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                    ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" + _
    '                    ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                    "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" + _
    '                    PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" + _
    '                    IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" + _
    '                    TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" + _
    '                    DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" + _
    '                    Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" + _
    '                    CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" + _
    '                    TOT_PARTIDA.ToString + "','" + POLIT_APLI.ToString + "','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1')"
    '                End If

    '            End If
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()

    '            'INSERTAR EL INDICE
    '            sqllocal = "insert into  PAR_FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'actualizar detalle PAR_FACTP01
    '            sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString + _
    '            " where CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'actualizar ACUMULADOR de remisiones y facturas
    '            '-----------camision del vendedor
    '            If pComicion = "" Then pComicion = "0"
    '            If Val(pComicion) >= 1 Then
    '                Dim VLcomi As String = (pComicion / 100) * TOT_PARTIDA
    '                sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '                " RIMP = RIMP + " + TOTIMP4 + ", RCOMI = RCOMI + " + VLcomi + _
    '                " where CVE_AFACT = '11'"
    '            Else
    '                sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '                " RIMP = RIMP + " + TOTIMP4 + "" + _
    '                " where CVE_AFACT = '11'"
    '            End If
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()

    '            sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()

    '            'insertar documentos siguientes
    '            sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '            "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '            "'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" + _
    '            NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '            "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '            "'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" + _
    '            NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()

    '            'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
    '            ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            'actualizar las existencias
    '            'Call ActualizarExistencias(CVE_ART, CANT)
    '            sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
    '            " PEND_SURT = PEND_SURT - " + CANT.ToString + ", COSTO_PROM = '" + COST + "'," + _
    '            " ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
    '            " WHERE CVE_ART ='" + CVE_ART + "'"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            '-----------------------------------------------
    '            'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
    '            Dim vExistencia As String = ""
    '            Dim reader3 As FbDataReader
    '            Sql = "Select coalesce(max(EXIST),0) AS num from INVE" + vgNumEmpresa.ToString + " where CVE_ART = '" + CVE_ART + "'"
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            reader3 = cmdFB.ExecuteReader()
    '            While reader3.Read()
    '                'MsgBox(reader3.Item(0))
    '                vExistencia = reader3.Item(0).ToString
    '                'vExistencia = Val(vExistencia) - Val(CANT)
    '            End While
    '            If vExistencia = "" Then vExistencia = "1"
    '            reader3.Close()
    '            '---------EXTRAER CLAVE DEL FOLIO
    '            Dim CVE_FOLIO As String = "0"
    '            Dim readerFOLIO As FbDataReader
    '            Sql = "Select ULT_CVE AS num from TBLCONTROL" + vgNumEmpresa.ToString + " where ID_TABLA = 32"
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            readerFOLIO = cmdFB.ExecuteReader()
    '            While readerFOLIO.Read()
    '                'MsgBox(reader3.Item(0))
    '                CVE_FOLIO = readerFOLIO.Item(0).ToString
    '                'vExistencia = Val(vExistencia) + 1
    '            End While
    '            If CVE_FOLIO = "" Then CVE_FOLIO = "1"
    '            readerFOLIO.Close()
    '            '-----------------------------------------------
    '            If vlNumSer = "S" Then
    '                sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" + _
    '                "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" + _
    '                "S','0','" + COST + "','N','0')"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '            Else
    '                If vgVersion = "5" Then
    '                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" + _
    '                    "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                    "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                    "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" + _
    '                    "S','0','" + COST + "','N','0')"
    '                End If
    '                If vgVersion = "6" Then
    '                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                    "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    "'R','" + pcve_doc_origen.ToString + "','" + pCve_Cliente + "','" + VEND + "','" + CANT.ToString + "','" + _
    '                    "0','" + PREC.ToString + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                    "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                    "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO + "','-1','" + _
    '                    "S','" + COST + "','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                End If
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '                sqllocal = "UPDATE MINVE" + vgNumEmpresa.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " + _
    '                " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" + _
    '                " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '                Dim VERSION_SINC As String
    '                VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
    '                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" + _
    '                " WHERE CVE_ART = '" + CVE_ART + "'" + _
    '                " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '            End If
    '            'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            mREG_SERIE = Val(mREG_SERIE) + 1
    '            vlsubtotal = vlsubtotal + (PREC * CANT)
    '        End While
    '        reader2.Close()
    '        '------------------------
    '        objTransFB.Commit()
    '        '------------------------
    '        Return vlsubtotal
    '    Catch es As SqlException
    '        vfVerificarErrorVta = False
    '        objTransFB.Rollback()
    '        Throw es
    '        Return 0
    '    Catch ex As Exception
    '        vfVerificarErrorVta = False
    '        objTransFB.Rollback()
    '        MsgBox(ex.Message.ToString)
    '        Return 0
    '    End Try
    'End Function
    Private Sub RemisionesSAE_Error(ByVal pMiBD As String, ByVal pNUMEMP As String)
        Dim CVE_DOC As String
        'Remisiones
        Try
            ' SACAR LA EMPRESA DEL SAE
            'msg1.Text = "Remisiones con Error"
            'Me.Refresh()
            Dim MI_BD_x As String = ""
            Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + My.Settings.vgCrearBD_Name + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conError As New SqlConnection(Str1)
            Dim sqllocal As String = "SELECT NOMBRE_BD from EmpresaSAE WHERE BASEDATOS ='" + pMiBD + "'"
            Dim daError As New SqlDataAdapter(sqllocal, conError)
            Dim dsError As New DataSet
            daError.Fill(dsError, "EmpresaSAEError")
            Dim oTableError As New DataTable
            oTableError = dsError.Tables("EmpresaSAEError")

            For Each oRowError In oTableError.Rows
                MI_BD_x = oRowError.Item("NOMBRE_BD").ToString
            Next
            If MI_BD_x = "" Then MI_BD_x = "LogistikMasterValvulerias06"
            'Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            'Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + MI_BD_x + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD_x + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=SAE80_EMP01;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"

            'LOGISTIK
            Dim conn As New SqlConnection(Str)
            'SAE
            Dim conn2 As New SqlConnection(Str2)
            Dim vFechaHoy As Date = Today.Date.Now
            sqllocal = "select id_order from Logistik_orders where trim(EnviadaSAE) = 'S'" +
            " and (current_state=61 or current_state=62) and trim(Tipo_Rem_Fact) = 'R'"


            '/////" & Format(vFechaHoy, "MM/dd/yyyy") & "'"
            'msg1.Text = "Errorrrr1" + Str
            'Me.Refresh()
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_orders")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_orders")
            Dim OrdenVenta As String
            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            For Each oRowPC In oTablePC.Rows
                OrdenVenta = oRowPC.Item("id_order").ToString
                'agregar ceros
                'OrdenVenta = ceros(OrdenVenta, 10)
                'agregar espacios
                'OrdenVenta = espacios(OrdenVenta, 20)
                '777777777777777777777777777777777777777777777777777777777777777777777777777777777777
                'OrdenVenta = Val(OrdenVenta)
                OrdenVenta = espacios(OrdenVenta, 20)
                ''sqllocal = "update Logistik_orders SET EnviadaSAE = 'S', current_state='91'" + _
                ''" WHERE id_order = '" + OrdenVenta + "'"
                '''msg1.Text = "U Logistik_orders error2"
                ''EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                'msg1.Text = "paso"
                '7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
                sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                ",DOC_ANT,TIP_DOC_SIG,DOC_SIG FROM FACTP01" +
                " WHERE CVE_DOC = '" & OrdenVenta & "'"


                '/////////" WHERE ENLAZADO='O' and TIP_DOC_E = 'O'"
                Dim da As New SqlDataAdapter(sqllocal, conn2)
                Dim ds As New DataSet
                If conn2.State = ConnectionState.Closed Then
                    conn2.Open()
                End If
                da.Fill(ds, "FACTP01")
                Dim oTable As New DataTable
                oTable = ds.Tables("FACTP01")
                Dim TIP_DOC As String
                Dim CVE_CLPV As String
                Dim STATUS As String
                Dim DAT_MOSTR As String
                Dim CVE_VEND As String
                Dim CVE_PEDI As String
                Dim FECHA_DOC As String
                Dim FECHA_ENT As String
                Dim FECHA_VEN As String
                Dim FECHA_CANCELA As String
                Dim CAN_TOT As String
                Dim IMP_TOT1 As String
                Dim IMP_TOT2 As String
                Dim IMP_TOT3 As String
                Dim IMP_TOT4 As String
                Dim DES_TOT As String
                Dim DES_FIN As String
                Dim COM_TOT As String
                Dim CONDICION As String
                Dim CVE_OBS As String
                Dim NUM_ALMA As String
                Dim ACT_CXC As String
                Dim ACT_COI As String
                Dim ENLAZADO As String
                Dim TIP_DOC_E As String
                Dim NUM_MONED As String
                Dim TIPCAMB As String
                Dim NUM_PAGOS As String
                Dim FECHAELAB As String
                Dim PRIMERPAGO As String
                Dim RFC As String
                Dim CTLPOL As String
                Dim ESCFD As String
                Dim AUTORIZA As String
                Dim SERIE As String
                Dim FOLIO As String
                Dim AUTOANIO As String
                Dim DAT_ENVIO As String
                Dim CONTADO As String
                Dim CVE_BITA As String
                Dim BLOQ As String
                Dim FORMAENVIO As String
                Dim DES_FIN_PORC As String
                Dim DES_TOT_PORC As String
                Dim IMPORTE As String
                Dim COM_TOT_PORC As String
                Dim METODODEPAGO As String
                Dim NUMCTAPAGO As String
                Dim TIP_DOC_ANT As String
                Dim DOC_ANT As String
                Dim TIP_DOC_SIG As String
                Dim DOC_SIG As String
                Dim vCveDoc As String = ""
                '---------------------------------------
                objTrans = conn2.BeginTransaction()
                '--------------------------------------
                For Each oRow In oTable.Rows
                    TIP_DOC = "R"
                    'SigCveDoc = TraerCveDocSigRecep()
                    'CVE_DOC = SigCveDoc
                    CVE_DOC = oRow.Item("CVE_DOC").ToString
                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
                    'STATUS = oRow.Item("STATUS").ToString
                    STATUS = "E"
                    DAT_MOSTR = oRow.Item("DAT_MOSTR").ToString
                    CVE_VEND = oRow.Item("CVE_VEND").ToString
                    CVE_PEDI = oRow.Item("CVE_PEDI").ToString
                    FECHA_DOC = oRow.Item("FECHA_DOC").ToString
                    If FECHA_DOC <> "" Then
                        FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                    End If
                    FECHA_ENT = oRow.Item("FECHA_ENT").ToString
                    If FECHA_ENT <> "" Then
                        FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                    End If
                    FECHA_VEN = oRow.Item("FECHA_VEN").ToString
                    If FECHA_VEN <> "" Then
                        FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                    End If
                    FECHA_CANCELA = oRow.Item("FECHA_CANCELA").ToString
                    If FECHA_CANCELA <> "" Then
                        FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                    End If
                    CAN_TOT = oRow.Item("CAN_TOT").ToString
                    IMP_TOT1 = oRow.Item("IMP_TOT1").ToString
                    IMP_TOT2 = oRow.Item("IMP_TOT2").ToString
                    IMP_TOT3 = oRow.Item("IMP_TOT3").ToString
                    IMP_TOT4 = oRow.Item("IMP_TOT4").ToString
                    DES_TOT = oRow.Item("DES_TOT").ToString
                    DES_FIN = oRow.Item("DES_FIN").ToString
                    COM_TOT = oRow.Item("COM_TOT").ToString
                    CONDICION = oRow.Item("CONDICION").ToString
                    CVE_OBS = oRow.Item("CVE_OBS").ToString
                    NUM_ALMA = "1"
                    ACT_CXC = oRow.Item("ACT_CXC").ToString
                    ACT_COI = oRow.Item("ACT_COI").ToString
                    ENLAZADO = oRow.Item("ENLAZADO").ToString
                    TIP_DOC_E = "r"
                    NUM_MONED = oRow.Item("NUM_MONED").ToString
                    TIPCAMB = oRow.Item("TIPCAMB").ToString
                    NUM_PAGOS = oRow.Item("NUM_PAGOS").ToString
                    FECHAELAB = oRow.Item("FECHAELAB").ToString
                    If FECHAELAB <> "" Then
                        FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                    End If
                    PRIMERPAGO = oRow.Item("PRIMERPAGO").ToString
                    RFC = oRow.Item("RFC").ToString
                    CTLPOL = oRow.Item("CTLPOL").ToString()
                    ESCFD = oRow.Item("ESCFD").ToString
                    AUTORIZA = oRow.Item("AUTORIZA").ToString
                    SERIE = oRow.Item("SERIE").ToString
                    FOLIO = oRow.Item("FOLIO").ToString
                    AUTOANIO = oRow.Item("AUTOANIO").ToString
                    DAT_ENVIO = oRow.Item("DAT_ENVIO").ToString
                    CONTADO = oRow.Item("CONTADO").ToString
                    CVE_BITA = oRow.Item("CVE_BITA").ToString
                    BLOQ = oRow.Item("BLOQ").ToString
                    FORMAENVIO = oRow.Item("FORMAENVIO").ToString
                    DES_FIN_PORC = oRow.Item("DES_FIN_PORC").ToString
                    DES_TOT_PORC = oRow.Item("DES_TOT_PORC").ToString
                    IMPORTE = oRow.Item("IMPORTE").ToString
                    COM_TOT_PORC = oRow.Item("COM_TOT_PORC").ToString
                    METODODEPAGO = oRow.Item("METODODEPAGO").ToString
                    NUMCTAPAGO = oRow.Item("NUMCTAPAGO").ToString
                    TIP_DOC_ANT = "P"
                    DOC_ANT = CVE_DOC
                    TIP_DOC_SIG = Nothing
                    DOC_SIG = Nothing
                    'vCveDoc = BuscarClaveDoc()
                    '----------------buscar clave del documento
                    Dim vcont As String = ""
                    Dim vnum As Integer
                    Dim reader As SqlDataReader
                    'Dim SqlSelection As String = "Select ISNULL(max(CLAVE_DOC),1) AS num from FACTR_CLIB" + pNUMEMP.ToString
                    Dim SqlSelection As String = "Select ULT_DOC from FOLIOSF" + pNUMEMP.ToString +
                    " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + pNUMEMP.ToString + " WHERE TIP_DOC='R')"

                    cmd = New SqlCommand(SqlSelection, conn2, objTrans)
                    reader = cmd.ExecuteReader()
                    While reader.Read()
                        'MsgBox(reader.Item(0))
                        vcont = reader.Item(0).ToString
                        'Convertir a numero y 'aumentar mas uno
                        vcont = Val(vcont) + 1
                        'agregar ceros
                        'vcont = ceros(vnum, 10)
                        'agregar espacios
                        vcont = espacios(vcont, 20)
                        'regresar valor
                        'Me.TextBox1.Text = vcont
                        vCveDoc = vcont
                    End While
                    reader.Close()
                    'cmd.Dispose()
                    If vCveDoc <> "" Then
                        'DOC_ANT = ceros(DOC_ANT, 10)
                        DOC_ANT = espacios(DOC_ANT, 20)
                        sqllocal = "insert into FACTR" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                        ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                        ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                        ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                        ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                        ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                        ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                        ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                        ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                        ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                        ",DOC_ANT,TIP_DOC_SIG,DOC_SIG) values (" +
                        "'R','" + vCveDoc + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" +
                        CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" +
                        FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" +
                        IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" +
                        CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" +
                        "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                        PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" +
                        SERIE + "','" + vCveDoc + "','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" +
                        CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" +
                        IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" +
                        DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()

                        sqllocal = "insert into FACTR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()

                        sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        ''---------------------
                        ''Dim vCve_Obs As String = TraerClaveSiguiente()
                        Dim vCve_Obs As String
                        'Dim vcont7 As String = ""
                        'Dim reader7 As SqlDataReader
                        'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCF" + pNUMEMP.ToString
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'reader7 = cmd.ExecuteReader()
                        'While reader7.Read()
                        '    'MsgBox(reader7.Item(0))
                        '    vcont7 = reader7.Item(0).ToString
                        '    vcont7 = Val(vcont7) + 1
                        'End While
                        'If vcont7 = "" Then vcont7 = "1"
                        'vCve_Obs = vcont7
                        'reader7.Close()
                        ''-----------------------------------
                        Dim vObser As String = ""
                        'sqllocal = "INSERT INTO OBS_DOCF" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'cmd.ExecuteNonQuery()
                        'Call UpdateOC(CVE_DOC, vCveDoc)
                        sqllocal = "update FACTP" + pNUMEMP.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" +
                        " WHERE CVE_DOC ='" + CVE_DOC + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '------------------------------------------------------------------------------------------------------------------------------------------
                        'Call RemisionesDatalleSAE(vCveDoc, vObser, CVE_DOC, CVE_VEND)
                        Dim pcvedoc As String = vCveDoc
                        Dim pObser As String = vObser
                        Dim pcve_doc_origen As String = CVE_DOC
                        Dim VEND As String = CVE_VEND

                        Dim NUM_PAR As String
                        Dim CVE_ART As String
                        Dim CANT As String
                        Dim PXS As String
                        Dim PREC As String
                        Dim COST As String
                        Dim IMPU1 As String
                        Dim IMPU2 As String
                        Dim IMPU3 As String
                        Dim IMPU4 As String
                        Dim IMP1APLA As String
                        Dim IMP2APLA As String
                        Dim IMP3APLA As String
                        Dim IMP4APLA As String
                        Dim TOTIMP1 As String
                        Dim TOTIMP2 As String
                        Dim TOTIMP3 As String
                        Dim TOTIMP4 As String
                        Dim DESC1 As String
                        Dim DESC2 As String
                        Dim DESC3 As String
                        Dim COMI As String
                        Dim APAR As String
                        Dim ACT_INV As String
                        Dim NUM_ALM As String
                        Dim POLIT_APLI As String
                        Dim TIP_CAM As String
                        Dim UNI_VENTA As String
                        Dim TIPO_PROD As String

                        Dim REG_SERIE As String
                        Dim E_LTPD As String
                        Dim TIPO_ELEM As String
                        Dim NUM_MOV As String
                        Dim TOT_PARTIDA As String
                        Dim IMPRIMIR As String
                        Dim reader2 As SqlDataReader
                        SqlSelection = "SELECT CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" +
                         " FROM PAR_FACTP" + pNUMEMP.ToString + " where CVE_DOC = '" + pcve_doc_origen + "'"
                        cmd = New SqlCommand(SqlSelection, conn2, objTrans)
                        reader2 = cmd.ExecuteReader()
                        While reader2.Read()
                            'MsgBox(reader2.Item(0))
                            CVE_DOC = reader2.Item(0).ToString
                            NUM_PAR = reader2.Item(1).ToString
                            CVE_ART = reader2.Item(2).ToString
                            CANT = "0" 'reader2.Item(3).ToString
                            PXS = reader2.Item(4).ToString
                            PREC = reader2.Item(5).ToString
                            COST = reader2.Item(6).ToString
                            IMPU1 = reader2.Item(7).ToString
                            IMPU2 = reader2.Item(8).ToString
                            IMPU3 = reader2.Item(9).ToString

                            IMPU4 = reader2.Item(10).ToString
                            IMP1APLA = reader2.Item(11).ToString
                            IMP2APLA = reader2.Item(12).ToString
                            IMP3APLA = reader2.Item(13).ToString
                            IMP4APLA = reader2.Item(14).ToString
                            TOTIMP1 = reader2.Item(15).ToString
                            TOTIMP2 = reader2.Item(16).ToString
                            TOTIMP3 = reader2.Item(17).ToString
                            TOTIMP4 = reader2.Item(18).ToString
                            DESC1 = reader2.Item(19).ToString

                            DESC2 = reader2.Item(20).ToString
                            DESC3 = reader2.Item(21).ToString
                            COMI = reader2.Item(22).ToString
                            APAR = reader2.Item(23).ToString
                            ACT_INV = reader2.Item(24).ToString
                            NUM_ALM = "1"
                            POLIT_APLI = reader2.Item(26).ToString
                            TIP_CAM = reader2.Item(27).ToString
                            UNI_VENTA = reader2.Item(28).ToString
                            TIPO_PROD = reader2.Item(29).ToString

                            CVE_OBS = reader2.Item(30).ToString
                            REG_SERIE = reader2.Item(31).ToString
                            E_LTPD = reader2.Item(32).ToString
                            TIPO_ELEM = reader2.Item(33).ToString
                            NUM_MOV = reader2.Item(34).ToString
                            TOT_PARTIDA = reader2.Item(35).ToString
                            IMPRIMIR = reader2.Item(36).ToString
                            ''-------------------Traer la clave siguiente
                            ''CVE_OBS = TraerClaveSiguiente()
                            'Dim vconta As String = ""
                            ''Dim vnum As Integer
                            'Dim reader_obser As SqlDataReader
                            'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCF" + pNUMEMP.ToString
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'reader_obser = cmd.ExecuteReader()
                            'While reader_obser.Read()
                            '    'MsgBox(reader.Item(0))
                            '    vconta = reader_obser.Item(0).ToString
                            '    vconta = Val(vconta) + 1
                            'End While
                            'If vconta = "" Then vconta = "1"
                            'CVE_OBS = vconta
                            'reader_obser.Close()
                            ''-------------------------------------------
                            'sqllocal = "INSERT INTO OBS_DOCF" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            '---------------------crear el o los movimientos
                            'Dim vNum_Mov As String = ConsecutivoMovimiento()
                            Dim vNum_Mov As String
                            Dim vconta7 As String = ""
                            Dim readerMov As SqlDataReader
                            sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num from MINVE" + pNUMEMP.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerMov = cmd.ExecuteReader()
                            While readerMov.Read()
                                'MsgBox(reader7.Item(0))
                                vconta7 = readerMov.Item(0).ToString
                                vconta7 = Val(vconta7) + 1
                            End While
                            If vconta7 = "" Then vconta7 = "1"
                            vNum_Mov = vconta7
                            readerMov.Close()
                            '----------traer la cantidad
                            CANT = "0"
                            Dim readerPC As SqlDataReader
                            SqlSelection = "select quantity_received from Logistik_order_detail" +
                            " where id_order = '" + pcve_doc_origen + "' and product_upc = '" + CVE_ART + "'"
                            '+ _
                            '" and id_order_detail = '" + NUM_PAR + "'"
                            conn.Open()
                            cmd = New SqlCommand(SqlSelection, conn)
                            readerPC = cmd.ExecuteReader()
                            While readerPC.Read()
                                CANT = readerPC.Item(0).ToString
                            End While
                            conn.Close()
                            readerPC.Close()
                            '-------------------------------------------
                            sqllocal = "insert into  PAR_FACTR" + pNUMEMP.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                            ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                            ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                            ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                            "'" + pcvedoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT + "','" + PXS + "','" +
                            PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                            IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                            TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                            DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                            NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                            CVE_OBS + "','" + REG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                            TOT_PARTIDA + "','" + POLIT_APLI + "')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'INSERTAR EL INDICE
                            sqllocal = "insert into  PAR_FACTR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR + "')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'actualizar detalle PAR_FACTP01
                            sqllocal = "update PAR_FACTP" + pNUMEMP.ToString + " set PXS = PXS - " + CANT.ToString +
                            " where CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'actualizar ACUMULADOR de remisiones y facturas
                            sqllocal = "update AFACT" + pNUMEMP.ToString + " set RVTA_COM = RVTA_COM + '" + TOT_PARTIDA + "'," +
                            " PIMP = PIMP + '" + TOTIMP4 + "'" +
                            " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"

                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                            sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                            'insertar documentos siguientes
                            sqllocal = "INSERT INTO DOCTOSIGF" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                            "PARTIDA, PART_E, CANT_E) VALUES (" +
                            "'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" +
                            NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "INSERT INTO DOCTOSIGF" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                            "PARTIDA, PART_E, CANT_E) VALUES (" +
                            "'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" +
                            NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()


                            'actualizar las existencias
                            'Call ActualizarExistencias(CVE_ART, CANT)

                            'time = Today.Now
                            'sqllocal = "update INVE" + pNUMEMP.ToString + " SET FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
                            '" COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
                            '"VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
                            '" WHERE CVE_ART ='" + CVE_ART + "'"
                            '' sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
                            ''" COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
                            ''"VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
                            ''" WHERE CVE_ART ='" + CVE_ART + "'"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()

                            'sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST - '" + CANT + "', FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
                            '" PEND_SURT = PEND_SURT - '" + CANT + "', COSTO_PROM = '" + COST + "'," + _
                            '" ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + '" + CANT + "', VTAS_ANL_M = VTAS_ANL_M + '" + TOT_PARTIDA + "'" + _
                            '" WHERE CVE_ART ='" + CVE_ART + "'"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '-----------------------------------------------
                            'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                            Dim vExistencia As String = "0"
                            Dim reader3 As SqlDataReader
                            sqllocal = "Select ISNULL(max(EXIST),0) AS num from INVE" + pNUMEMP.ToString + " where CVE_ART = '" + CVE_ART + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            reader3 = cmd.ExecuteReader()
                            While reader3.Read()
                                'MsgBox(reader3.Item(0))
                                vExistencia = reader3.Item(0).ToString
                                vExistencia = Val(vExistencia) - Val(CANT)
                            End While
                            If vExistencia = "" Then vExistencia = "1"
                            reader3.Close()
                            ''--------existe almacen
                            Dim vExistAlm As String = "0"
                            Dim rederExistAlm As SqlDataReader
                            sqllocal = "SELECT EXIST FROM MULT" + vgNumEmpresa.ToString +
                            " WHERE CVE_ART = '" + CVE_ART + "' AND trim(CVE_ALM)='1'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            rederExistAlm = cmd.ExecuteReader()
                            While rederExistAlm.Read
                                vExistAlm = rederExistAlm.Item(0).ToString
                                vExistAlm = Val(vExistAlm) - CANT
                            End While
                            If vExistAlm = "" Then vExistAlm = "1"
                            rederExistAlm.Close()
                            '-----------------------------------------------
                            'ErrorREMISION2()
                            sqllocal = "INSERT INTO MINVE" + pNUMEMP.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXIST_G, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                            "'" + CVE_ART + "','1','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                            "'R','" + Trim(vCveDoc.ToString) + "','         1','" + VEND + "','" + CANT + "','" +
                            "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                            "'" + REG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + vExistAlm + "','" + TIPO_PROD + "','" +
                            "1','" + time.ToString("yyyy/MM/dd") + "','','" + Trim(vCveDoc.ToString) + "','-1','" +
                            "S','0','" + COST + "','N','0')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'sqllocal = "INSERT INTO OMINVE" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            Dim VERSION_SINC As String
                            VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")

                            sqllocal = "UPDATE MULT" + pNUMEMP.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" +
                            " WHERE CVE_ART = '" + CVE_ART + "'" +
                            " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                            time = Today.Now
                            sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                           " COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                           "VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" +
                           " WHERE CVE_ART ='" + CVE_ART + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                            sqllocal = "UPDATE MINVE" + pNUMEMP.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " +
                            " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" +
                            " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                        End While
                        reader2.Close()
                        sqllocal = "UPDATE FOLIOSF" + pNUMEMP.ToString + " SET ULT_DOC = ULT_DOC + 1 " +
                            " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + pNUMEMP.ToString + " WHERE TIP_DOC='R')"

                        '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE FACTR" + pNUMEMP.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
                    " WHERE CVE_DOC = '" + vCveDoc + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '------------------------
                        objTrans.Commit()
                        '------------------------
                        empresa = MI_BD_x.ToString
                        documento = pcvedoc.ToString
                        mensaje = "Registro de Remision Correcta:" + pcvedoc.ToString + " del Pedido:" + OrdenVenta.ToString
                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        TextBox1.Text = "REmp33:" + OrdenVenta + ":" + Str1
                        Me.Refresh()
                    End If
                Next
                OrdenVenta = Val(OrdenVenta)
                OrdenVenta = espacios(OrdenVenta, 20)
                Dim sql As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state='9'" +
                " WHERE id_order = '" + OrdenVenta + "'"
                EjecutarQuerySQL(sql)
            Next
            'MsgBox("Almacenado correctamente")
        Catch es As SqlException

            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "InCorrecta Remision:" + CVE_DOC.ToString + " Favor de realizar manualmente la remision en SAE"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            sqllocal = "update Logistik_orders SET EnviadaSAE = 'S', current_state='61'" +
            " WHERE id_order = '" + CVE_DOC.ToString + "'"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            objTrans.Rollback()
            Throw es
        Catch ex As Exception

            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "InCorrecta Remision:" + CVE_DOC.ToString + " Favor de realizar manualmente la remision en SAE"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            sqllocal = "update Logistik_orders SET EnviadaSAE = 'S', current_state='61'" +
            " WHERE id_order = '" + CVE_DOC.ToString + "'"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            '***** rollback the transaction ************************************************'
            'MsgBox(ex.Message.ToString)
            objTrans.Rollback()
        End Try
    End Sub
    Function fnEmp0104(ByVal pMiBD As String, ByVal pNUMEMP As String, ByVal pRefer As String, ByVal OrdenVenta As String) As Integer
        Dim CVE_DOC As String
        Dim CVE_PEDI As String
        Try
            Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + My.Settings.vgCrearBD_Name + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim connection7 As New SqlConnection(Str1)
            Dim sqllocal As String = "SELECT NOMBRE_BD from EmpresaSAE " +
            " WHERE BASEDATOS = '" + pMiBD + "'"
            If connection7.State = ConnectionState.Closed Then
                connection7.Open()
            End If
            Dim daPC1 As New SqlDataAdapter(sqllocal, connection7)
            Dim dsPC1 As New DataSet
            daPC1.Fill(dsPC1, "EmpresaSAE")
            Dim oTablePC1 As New DataTable
            oTablePC1 = dsPC1.Tables("EmpresaSAE")
            Dim MI_BD_x As String = ""
            connection7.Close()
            For Each oRowPC7 In oTablePC1.Rows
                MI_BD_x = oRowPC7.Item("NOMBRE_BD").ToString
            Next
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + MI_BD_x + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";MultipleActiveResultSets=True;"
            Dim conn As New SqlConnection(Str)
            'SAE
            Dim conn2 As New SqlConnection(Str2)
            sqllocal = "select id_order from Logistik_orders" +
            " WHERE TRIM(id_order) = '" + OrdenVenta.Trim + "'"
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_orders1")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_orders1")
            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            For Each oRowPC In oTablePC.Rows
                OrdenVenta = oRowPC.Item("id_order").ToString
                'agregar ceros
                'OrdenVenta = ceros(OrdenVenta, 10)
                'agregar espacios
                OrdenVenta = espacios(OrdenVenta, 20)

                sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                ",DOC_ANT,TIP_DOC_SIG,DOC_SIG FROM FACTP" + pNUMEMP.ToString +
                " WHERE CVE_DOC = '" & OrdenVenta & "'"
                '" WHERE ENLAZADO='O' and TIP_DOC_E = 'O'"
                'TextError.Text = "rEMISION 2 EMP01 O EMP04 - PASO3"
                Dim da As New SqlDataAdapter(sqllocal, conn2)
                Dim ds As New DataSet
                da.Fill(ds, "FACTP" & pNUMEMP.ToString)
                Dim oTable As New DataTable
                oTable = ds.Tables("FACTP" & pNUMEMP.ToString)
                Dim TIP_DOC As String
                Dim CVE_CLPV As String
                Dim STATUS As String
                Dim DAT_MOSTR As String
                Dim CVE_VEND As String
                'CVE_PEDI = pRefer
                Dim FECHA_DOC As String
                Dim FECHA_ENT As String
                Dim FECHA_VEN As String
                Dim FECHA_CANCELA As String
                Dim CAN_TOT As String
                Dim IMP_TOT1 As String
                Dim IMP_TOT2 As String
                Dim IMP_TOT3 As String
                Dim IMP_TOT4 As String
                Dim DES_TOT As String
                Dim DES_FIN As String
                Dim COM_TOT As String
                Dim CONDICION As String
                Dim CVE_OBS As String
                Dim NUM_ALMA As String
                Dim ACT_CXC As String
                Dim ACT_COI As String
                Dim ENLAZADO As String
                Dim TIP_DOC_E As String
                Dim NUM_MONED As String
                Dim TIPCAMB As String
                Dim NUM_PAGOS As String
                Dim FECHAELAB As String
                Dim PRIMERPAGO As String
                Dim RFC As String
                Dim CTLPOL As String
                Dim ESCFD As String
                Dim AUTORIZA As String
                Dim SERIE As String
                Dim FOLIO As String
                Dim AUTOANIO As String
                Dim DAT_ENVIO As String
                Dim CONTADO As String
                Dim CVE_BITA As String
                Dim BLOQ As String
                Dim FORMAENVIO As String
                Dim DES_FIN_PORC As String
                Dim DES_TOT_PORC As String
                Dim IMPORTE As String
                Dim COM_TOT_PORC As String
                Dim METODODEPAGO As String
                Dim NUMCTAPAGO As String
                Dim TIP_DOC_ANT As String
                Dim DOC_ANT As String
                Dim TIP_DOC_SIG As String
                Dim DOC_SIG As String
                Dim vCveDoc As String = ""
                For Each oRow In oTable.Rows
                    'SigCveDoc = TraerCveDocSigRecep()
                    'CVE_DOC = SigCveDoc
                    CVE_DOC = oRow.Item("CVE_DOC").ToString
                    CAN_TOT = oRow.Item("CAN_TOT").ToString
                    NUM_ALMA = "1"
                    'ppppppppppppppppppppppppppppppppppp verificar si existe en el almacen ppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppp
                    Dim readerOrders As SqlDataReader
                    sqllocal = "SELECT od.id_order,od.product_upc,od.id_warehouse, od.quantity_received" +
                    " FROM Logistik_order_detail as od WHERE TRIM(od.id_order) ='" + OrdenVenta.Trim + "'" +
                    " and od.quantity_received>0"
                    LabelTABLA.Text = "very Exist2"
                    cmd = New SqlCommand(sqllocal, conn)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    Me.Refresh()
                    readerOrders = cmd.ExecuteReader()
                    'CORRECTO()
                    Dim prod As String
                    Dim alm As String
                    Dim cant1 As String
                    Dim cantExist1 As String
                    Dim OK As Integer = 0
                    'Dim OK2 As Integer = 0
                    While readerOrders.Read()
                        prod = readerOrders.Item(1).ToString
                        alm = readerOrders.Item(2).ToString
                        cant1 = readerOrders.Item(3).ToString
                        Dim readerExist As SqlDataReader
                        sqllocal = "Select EXIST FROM MULT" + pNUMEMP.ToString +
                                    " WHERE CVE_ART = '" + prod + "' AND CVE_ALM='1'"
                        LabelTABLA.Text = "S MULT2"
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        Me.Refresh()
                        readerExist = cmd.ExecuteReader()
                        While readerExist.Read()
                            cantExist1 = readerExist.Item(0).ToString
                            If cantExist1 = Nothing Then
                                OK = 0
                                empresa = pNUMEMP.ToString
                                documento = OrdenVenta.ToString
                                mensaje = "Sincronizar Pedido: InCorrecta Pedido:" + OrdenVenta.ToString + " Producto no existe:" + prod.ToString + " en Almacen: 1"
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                Me.Refresh()
                                Exit While
                            Else
                                'cant sae >= cant logistik
                                If Val(cantExist1) >= Val(cant1) Then
                                    OK = 1
                                Else
                                    OK = 0
                                    empresa = pNUMEMP.ToString
                                    documento = OrdenVenta.ToString
                                    mensaje = "Sincronizar Pedido: InCorrecta Pedido:" + OrdenVenta.ToString + " Producto no hay Existencia suficiente:" + prod.ToString + " en Almacen: 1"
                                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
                                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                    Me.Refresh()
                                End If
                            End If

                        End While
                        readerExist.Close()
                    End While
                    readerOrders.Close()
                    'pppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppp
                    If OK = 1 Then
                        Return 1
                    Else
                        empresa = vgEmpresa.ToString
                        documento = OrdenVenta.ToString
                        mensaje = "Verificar Pedido: InCorrecto Pedido:" + OrdenVenta.ToString + " Producto no Existe:" + prod.ToString + " en Almacen: 1"
                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        Return 0
                    End If
                Next
            Next
        Catch es As SqlException
            Return 0
        Catch ex As Exception
            Return 0
        End Try
    End Function
    Private Sub RemisionesSAE(ByVal pMiBD As String, ByVal pNUMEMP As String, ByVal pRefer As String, ByVal OrdenVenta As String, camplib34 As String)
        LabelProcedimiento.Text = "Realizar Pedidos SAE1 o SAE4"
        Me.Refresh()
        Dim CVE_DOC As String = OrdenVenta
        Dim CVE_PEDI As String
        Dim OK As Integer = 0
        Try
            Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" +
                My.Settings.vgCrearBD_Name + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User +
                "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim connection7 As New SqlConnection(Str1)
            LabelTABLA.Text = "Conexion EmpresaSAE1"
            TextBox1.Text = "REmp1:" + OrdenVenta + ":" + Str1
            Me.Refresh()
            Dim sqllocal As String = "SELECT NOMBRE_BD from EmpresaSAE " +
            " WHERE BASEDATOS = '" + pMiBD + "'"
            If connection7.State = ConnectionState.Closed Then
                connection7.Open()
            End If
            LabelTABLA.Text = "Conexion EmpresaSAE2"
            TextBox1.Text = "REmp2:" + OrdenVenta + ":" + Str1
            Me.Refresh()
            Dim daPC1 As New SqlDataAdapter(sqllocal, connection7)
            Dim dsPC1 As New DataSet
            daPC1.Fill(dsPC1, "EmpresaSAE")
            Dim oTablePC1 As New DataTable
            oTablePC1 = dsPC1.Tables("EmpresaSAE")
            Dim MI_BD_x As String = ""
            connection7.Close()
            For Each oRowPC7 In oTablePC1.Rows
                MI_BD_x = oRowPC7.Item("NOMBRE_BD").ToString
            Next
            'TextError.Text = "rEMISION 2 EMP01 O EMP04 - PASO1"
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + MI_BD_x + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";MultipleActiveResultSets=True;"
            Dim Str3 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            'logistik
            Dim conn As New SqlConnection(Str)
            Dim connL6 As New SqlConnection(Str3)
            'SAE
            Dim conn2 As New SqlConnection(Str2)
            'sqllocal = "select id_order from Logistik_orders" + _
            '" where EnviadaSAE='S' and current_state='6' AND Tipo_Rem_Fact='R'"
            sqllocal = "select id_order,current_state from Logistik_orders" +
            " WHERE TRIM(id_order) = '" + OrdenVenta.Trim + "' and num_empresa='" + pNUMEMP + "'"
            LabelTABLA.Text = "Q1s_Logistik_orders"
            TextBox1.Text = "REmp3:" + OrdenVenta + ":" + Str1
            Me.Refresh()
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            'TextError.Text = "rEMISION 2 EMP01 O EMP04 - PASO2:" & Str
            daPC.Fill(dsPC, "Logistik_orders1")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_orders1")
            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            Dim vEstatus As String
            'Dim sql11 As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state = '62'" + _
            '        " WHERE id_order = '" + OrdenVenta + "' and num_empresa='" + pNUMEMP + "'"
            'EjecutarQuerySQL_EMPRESA_X(sql11, "LogistikMasterValvulerias06")
            For Each oRowPC In oTablePC.Rows
                OrdenVenta = oRowPC.Item("id_order").ToString
                'agregar ceros
                'OrdenVenta = ceros(OrdenVenta, 10)
                'agregar espacios
                OrdenVenta = espacios(OrdenVenta, 20)
                vEstatus = oRowPC.Item("current_state").ToString
                '15 DIAS   
                Dim vFechaHoy As Date = Date.Now
                Dim vFechaDiasAntes As Date = Date.Now
                vFechaDiasAntes = vFechaDiasAntes.AddDays(-15) 'Resta días
                sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                ",DOC_ANT,TIP_DOC_SIG,DOC_SIG FROM FACTP" + pNUMEMP.ToString +
                " WHERE CVE_DOC = '" & OrdenVenta & "'" '+
                '" AND FECHA_DOC BETWEEN '" & Format(vFechaDiasAntes, "MM/dd/yyyy") & "' AND '" & Format(vFechaHoy, "MM/dd/yyyy") & "'"
                '" WHERE ENLAZADO='O' and TIP_DOC_E = 'O'"
                'TextError.Text = "rEMISION 2 EMP01 O EMP04 - PASO3"
                LabelTABLA.Text = "Q2s_FACTP"
                TextBox1.Text = "REmp4:" + OrdenVenta + ":" + Str1
                Me.Refresh()
                Dim da As New SqlDataAdapter(sqllocal, conn2)
                Dim ds As New DataSet
                da.Fill(ds, "FACTP" & pNUMEMP.ToString)
                Dim oTable As New DataTable
                oTable = ds.Tables("FACTP" & pNUMEMP.ToString)
                Dim TIP_DOC As String
                Dim CVE_CLPV As String
                Dim STATUS As String
                Dim DAT_MOSTR As String
                Dim CVE_VEND As String
                'CVE_PEDI = pRefer
                Dim FECHA_DOC As String
                Dim FECHA_ENT As String
                Dim FECHA_VEN As String
                Dim FECHA_CANCELA As String
                Dim CAN_TOT As String
                Dim IMP_TOT1 As String
                Dim IMP_TOT2 As String
                Dim IMP_TOT3 As String
                Dim IMP_TOT4 As String
                Dim DES_TOT As String
                Dim DES_FIN As String
                Dim COM_TOT As String
                Dim CONDICION As String
                Dim CVE_OBS As String
                Dim NUM_ALMA As String
                Dim ACT_CXC As String
                Dim ACT_COI As String
                Dim ENLAZADO As String
                Dim TIP_DOC_E As String
                Dim NUM_MONED As String
                Dim TIPCAMB As String
                Dim NUM_PAGOS As String
                Dim FECHAELAB As String
                Dim PRIMERPAGO As String
                Dim RFC As String
                Dim CTLPOL As String
                Dim ESCFD As String
                Dim AUTORIZA As String
                Dim SERIE As String
                Dim FOLIO As String
                Dim AUTOANIO As String
                Dim DAT_ENVIO As String
                Dim CONTADO As String
                Dim CVE_BITA As String
                Dim BLOQ As String
                Dim FORMAENVIO As String
                Dim DES_FIN_PORC As String
                Dim DES_TOT_PORC As String
                Dim IMPORTE As Decimal
                Dim COM_TOT_PORC As String
                Dim METODODEPAGO As String
                Dim NUMCTAPAGO As String
                Dim TIP_DOC_ANT As String
                Dim DOC_ANT As String
                Dim TIP_DOC_SIG As String
                Dim DOC_SIG As String
                Dim vCveDoc As String = ""
                Dim vlFlagDesc As Integer = 0
                Dim vlFlagDescVerify As Integer = 0
                Dim vlFlagDesc2 As Integer = 0
                Dim vlFlagDescVerify2 As Integer = 0
                Dim vlFlagDesc3 As Integer = 0
                Dim vlFlagDescVerify3 As Integer = 0

                '---------------------------------------
                objTrans = conn2.BeginTransaction()
                '--------------------------------------
                For Each oRow In oTable.Rows
                    TIP_DOC = "R"
                    'SigCveDoc = TraerCveDocSigRecep()
                    'CVE_DOC = SigCveDoc
                    CVE_DOC = oRow.Item("CVE_DOC").ToString
                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
                    'STATUS = oRow.Item("STATUS").ToString
                    STATUS = "O"
                    DAT_MOSTR = oRow.Item("DAT_MOSTR").ToString
                    CVE_VEND = oRow.Item("CVE_VEND").ToString
                    CVE_PEDI = oRow.Item("CVE_PEDI").ToString
                    'CVE_PEDI = ""
                    FECHA_DOC = Date.Now
                    If FECHA_DOC <> "" Then
                        FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd")
                    End If
                    FECHA_ENT = Date.Now
                    If FECHA_ENT <> "" Then
                        FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("yyyy/MM/dd")
                    End If
                    FECHA_VEN = Date.Now
                    If FECHA_VEN <> "" Then
                        FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("yyyy/MM/dd")
                    End If
                    FECHA_CANCELA = Date.Now
                    If FECHA_CANCELA <> "" Then
                        FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd")
                    End If
                    CAN_TOT = oRow.Item("CAN_TOT").ToString
                    IMP_TOT1 = oRow.Item("IMP_TOT1").ToString
                    IMP_TOT2 = oRow.Item("IMP_TOT2").ToString
                    IMP_TOT3 = oRow.Item("IMP_TOT3").ToString
                    IMP_TOT4 = oRow.Item("IMP_TOT4").ToString
                    If Len(IMP_TOT4) >= 1 Then
                        Dim Resul As Decimal = Convert.ToDecimal(IMP_TOT4)
                        'IMP_TOT4 = FormatNumber(Resul, 2)
                        IMP_TOT4 = Resul.ToString("##########.##")
                    End If
                    DES_TOT = oRow.Item("DES_TOT").ToString
                    DES_FIN = oRow.Item("DES_FIN").ToString
                    COM_TOT = oRow.Item("COM_TOT").ToString
                    CONDICION = oRow.Item("CONDICION").ToString
                    CVE_OBS = oRow.Item("CVE_OBS").ToString
                    '/// se cambio de 1 a 104
                    If UCase(camplib34) = "GDL" Then
                        NUM_ALMA = "104"
                    Else
                        NUM_ALMA = "1"
                    End If

                    'ppppppppppppppppppppppppppppppppppp verificar si existe en el almacen ppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppp
                    Dim readerOrders As SqlDataReader
                    sqllocal = "SELECT od.id_order,od.product_upc,od.id_warehouse, od.quantity_received, od.product_quantity" +
                    " FROM Logistik_order_detail as od WHERE TRIM(od.id_order) ='" + OrdenVenta.Trim + "' and num_empresa='" + pNUMEMP + "'" +
                    " and od.quantity_received>0"
                    LabelTABLA.Text = "Q3s_Logistik_order_detail"
                    TextBox1.Text = "REmp5:" + OrdenVenta + ":" + Str1
                    Me.Refresh()
                    cmd = New SqlCommand(sqllocal, conn)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    Me.Refresh()
                    readerOrders = cmd.ExecuteReader()
                    Dim prod As String
                    Dim alm As String
                    Dim cant1 As String
                    Dim CantPedida As String
                    Dim cantExist1 As String
                    Dim PXS As String
                    OK = 0
                    Dim OK2 As Integer = 0
                    While readerOrders.Read()
                        prod = readerOrders.Item(1).ToString
                        alm = readerOrders.Item(2).ToString
                        cant1 = readerOrders.Item(3).ToString
                        CantPedida = readerOrders.Item(4).ToString
                        Dim CantFaltante As Integer = Val(CantPedida) - cant1
                        PXS = readerOrders.Item(3).ToString
                        Dim readerExist As SqlDataReader
                        '//se cambio de 1 a 104
                        If UCase(camplib34) = "GDL" Then
                            sqllocal = "Select EXIST FROM MULT" + pNUMEMP.ToString +
                                          " WHERE CVE_ART = '" + prod + "' AND CVE_ALM='104'"
                        Else
                            sqllocal = "Select EXIST FROM MULT" + pNUMEMP.ToString +
                                         " WHERE CVE_ART = '" + prod + "' AND CVE_ALM='1'"
                        End If
                        LabelTABLA.Text = "Q4s_MULT"
                        TextBox1.Text = "REmp6:" + OrdenVenta + ":" + Str1
                        Me.Refresh()
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        Me.Refresh()
                        readerExist = cmd.ExecuteReader()
                        While readerExist.Read()
                            cantExist1 = readerExist.Item(0).ToString
                            If cantExist1 = Nothing Then
                                OK = 0
                                empresa = pNUMEMP.ToString
                                documento = OrdenVenta.ToString
                                If UCase(camplib34) = "GDL" Then
                                    mensaje = "Sincronizar Pedido: Realizar manualmente:" + OrdenVenta.ToString + " Producto no existe:" + prod.ToString + " en Almacen: 104"
                                Else
                                    mensaje = "Sincronizar Pedido: Realizar manualmente:" + OrdenVenta.ToString + " Producto no existe:" + prod.ToString + " en Almacen: 1"
                                End If
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','62')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                LabelTABLA.Text = "Q5i_Logistik_log"
                                TextBox1.Text = "REmp7:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                Exit While
                            Else
                                ''cant sae >= cant logistik
                                If Val(cantExist1) >= Val(cant1) Then
                                    OK = 1
                                Else
                                    OK = 0
                                    empresa = pNUMEMP.ToString
                                    documento = OrdenVenta.ToString
                                    If UCase(camplib34) = "GDL" Then
                                        mensaje = "Sincronizar Pedido: Realizar manualmente:" + OrdenVenta.ToString + " Producto no hay Existencia suficiente:" + prod.ToString + " en Almacen: 104"
                                    Else
                                        mensaje = "Sincronizar Pedido: Realizar manualmente:" + OrdenVenta.ToString + " Producto no hay Existencia suficiente:" + prod.ToString + " en Almacen: 1"
                                    End If
                                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','62')"
                                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                    LabelTABLA.Text = "Q6i_Logistik_log"
                                    TextBox1.Text = "REmp8:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    Exit While
                                End If
                            End If
                        End While
                        readerExist.Close()
                        If OK = 0 Then
                            Exit While
                        End If
                    End While
                    readerOrders.Close()
                    If OK = 1 Then
                        ACT_CXC = oRow.Item("ACT_CXC").ToString
                        ACT_COI = oRow.Item("ACT_COI").ToString
                        ENLAZADO = oRow.Item("ENLAZADO").ToString
                        TIP_DOC_E = "r"
                        NUM_MONED = oRow.Item("NUM_MONED").ToString
                        TIPCAMB = oRow.Item("TIPCAMB").ToString
                        NUM_PAGOS = oRow.Item("NUM_PAGOS").ToString
                        FECHAELAB = DateTime.Now
                        If FECHAELAB <> "" Then
                            FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                        End If
                        PRIMERPAGO = oRow.Item("PRIMERPAGO").ToString
                        RFC = oRow.Item("RFC").ToString
                        CTLPOL = oRow.Item("CTLPOL").ToString()
                        ESCFD = oRow.Item("ESCFD").ToString
                        AUTORIZA = oRow.Item("AUTORIZA").ToString
                        SERIE = oRow.Item("SERIE").ToString
                        FOLIO = oRow.Item("FOLIO").ToString
                        AUTOANIO = oRow.Item("AUTOANIO").ToString
                        DAT_ENVIO = oRow.Item("DAT_ENVIO").ToString
                        CONTADO = oRow.Item("CONTADO").ToString
                        CVE_BITA = oRow.Item("CVE_BITA").ToString
                        BLOQ = oRow.Item("BLOQ").ToString
                        FORMAENVIO = oRow.Item("FORMAENVIO").ToString
                        DES_FIN_PORC = oRow.Item("DES_FIN_PORC").ToString
                        DES_TOT_PORC = oRow.Item("DES_TOT_PORC").ToString
                        IMPORTE = Convert.ToDecimal(oRow.Item("IMPORTE"))

                        COM_TOT_PORC = oRow.Item("COM_TOT_PORC").ToString
                        METODODEPAGO = oRow.Item("METODODEPAGO").ToString
                        NUMCTAPAGO = oRow.Item("NUMCTAPAGO").ToString
                        TIP_DOC_ANT = "P"
                        DOC_ANT = CVE_DOC
                        TIP_DOC_SIG = Nothing
                        DOC_SIG = Nothing
                        'vCveDoc = BuscarClaveDoc()
                        '----------------buscar clave del documento
                        Dim vcont As String = ""
                        Dim vnum As Integer
                        Dim reader As SqlDataReader
                        'Dim SqlSelection As String = "Select ISNULL(max(CLAVE_DOC),1) AS num from FACTR_CLIB" + pNUMEMP.ToString
                        Dim SqlSelection As String = "Select ULT_DOC from FOLIOSF" + pNUMEMP.ToString +
                        " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + pNUMEMP.ToString + " WHERE TIP_DOC='R')"
                        'TextError.Text = "rEMISION 2 EMP01 O EMP04 - PASO4"
                        LabelTABLA.Text = "Q7s_FOLIOSF"
                        TextBox1.Text = "REmp9:" + OrdenVenta + ":" + Str1
                        Me.Refresh()
                        cmd = New SqlCommand(SqlSelection, conn2, objTrans)
                        reader = cmd.ExecuteReader()
                        While reader.Read()
                            'MsgBox(reader.Item(0))
                            vcont = reader.Item(0).ToString
                            'Convertir a numero y 'aumentar mas uno
                            vcont = Val(vcont) + 1
                            'agregar ceros
                            'vcont = ceros(vnum, 10)
                            'agregar espacios
                            vcont = espacios(vcont, 20)
                            'regresar valor
                            'Me.TextBox1.Text = vcont
                            vCveDoc = vcont
                        End While
                        reader.Close()
                        'cmd.Dispose()
                        If vCveDoc <> "" Then
                            'recoger el dato = campo Camplib tabla factp_clib01
                            ''------------------------------------------------
                            'Dim readerFACTP_CLIB As SqlDataReader
                            'Dim CAMPLIB19 As String = ""
                            'sqllocal = "Select CAMPLIB19 FROM FACTP_CLIB" + pNUMEMP.ToString +
                            '" WHERE CLAVE_DOC ='" + CVE_DOC + "'"
                            'LabelTABLA.Text = "Q8s_FACTP_CLIB"
                            'TextBox1.Text = "FACTP_CLIB" + pNUMEMP.ToString
                            'Me.Refresh()
                            'If conn2.State = ConnectionState.Closed Then
                            '    conn2.Open()
                            'End If
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'readerFACTP_CLIB = cmd.ExecuteReader()
                            'While readerFACTP_CLIB.Read()
                            '    CAMPLIB19 = readerFACTP_CLIB.Item(0).ToString
                            'End While
                            'readerFACTP_CLIB.Close()
                            ''-----------------------------------------------
                            'TRAER CLAVE BITA
                            ''------------------------------------------------
                            Dim readerBita As SqlDataReader
                            Dim vBita As String
                            sqllocal = "Select ISNULL(max(CVE_BITA),1) AS num FROM BITA" + pNUMEMP.ToString
                            LabelTABLA.Text = "Q9s_BITA"
                            TextBox1.Text = "P14_EMPRESA" + pNUMEMP.ToString
                            Me.Refresh()
                            If conn2.State = ConnectionState.Closed Then
                                conn2.Open()
                            End If
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerBita = cmd.ExecuteReader()
                            While readerBita.Read()
                                vBita = readerBita.Item(0).ToString
                                CVE_BITA = Val(vBita) + 1
                            End While
                            readerBita.Close()
                            'sacar el importe

                            'Dim readerimporte As SqlDataReader
                            'sqllocal = "SELECT SUM(TOT_PARTIDA) * 1.16 FROM PAR_FACTP" + pNUMEMP.ToString + _
                            '"WHERE CVE_DOC = '" + OrdenVenta + "'"
                            'TextBox1.Text = "P14:EMPRESA" + pNUMEMP.ToString + ":" + OrdenVenta
                            'Me.Refresh()
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'readerimporte = cmd.ExecuteReader()
                            'While readerimporte.Read()
                            '    IMPORTE = Convert.ToDecimal(readerimporte.Item(0))
                            'End While
                            'readerimporte.Close()

                            Dim vUUID = Guid.NewGuid.ToString()
                            vUUID = UCase(vUUID)
                            'DOC_ANT = ceros(DOC_ANT, 10)
                            DOC_ANT = espacios(DOC_ANT, 20)
                            sqllocal = "insert into FACTR" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                            ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                            ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                            ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                            ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                            ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                            ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                            ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                            ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                            ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                            ",DOC_ANT,TIP_DOC_SIG,DOC_SIG,UUID) values (" +
                            "'R','" + vCveDoc + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" +
                            CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" +
                            FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" +
                            IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" +
                            CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" +
                            "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                            PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" +
                            SERIE + "','" + vCveDoc + "','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" +
                            CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" +
                            IMPORTE.ToString() + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" +
                            DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "','" + vUUID + "')"
                            'TextError.Text = "rEMISION 2 EMP01 O EMP04 - PASO5"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            LabelTABLA.Text = "Q10i_FACTR"
                            TextBox1.Text = "REmp10:" + OrdenVenta + ":" + Str1
                            Me.Refresh()

                            '///////////////////////////////////////CAMPOS LIBRES ENCABEZADO//////////////////////////
                            If pNUMEMP.ToString = "01" Or pNUMEMP.ToString = "1" Then
                                Dim CampLibA1, CampLibA2, CampLibA3, CampLibA4, CampLibA5, CampLibA6, CampLibA7 As String
                                Dim CampLibA8, CampLibA9, CampLibA10, CampLibA11, CampLibA12 As String
                                Dim CampLibA13, CampLibA14, CampLibA15, CampLibA16, CampLibA17 As String
                                Dim CampLibA18, CampLibA19, CampLibA20, CampLibA21, CampLibA22 As String
                                Dim CampLibA23, CampLibA24, CampLibA25, CampLibA26, CampLibA27 As String
                                Dim CampLibA28, CampLibA29, CampLibA30, CampLibA31, CampLibA32 As String
                                Dim CampLibA33, CampLibA34, CampLibA35, CampLibA36, CampLibA37 As String
                                Dim CampLibA38, CampLibA39, CampLibA40, CampLibA41, CampLibA42 As String
                                Dim CampLibA43, CampLibA44, CampLibA45 As String
                                sqllocal = "SELECT NUM_EMP, MascaraOrdenCompra, MascaraRecepcion, MascaraPedido, MascaraRemision" +
                                ",MultiAlmacen, InvNumDecimales, ActivarQuerys, CAMPLIB1, CAMPLIB2" +
                                ",CAMPLIB3, CAMPLIB4, CAMPLIB5, CAMPLIB6, CAMPLIB7" +
                                ",CAMPLIB8, CAMPLIB9, CAMPLIB10, CAMPLIB11, CAMPLIB12" +
                                ",CAMPLIB13, CAMPLIB14, CAMPLIB15, CAMPLIB16, CAMPLIB17" +
                                ",CAMPLIB18, CAMPLIB19, CAMPLIB20, CAMPLIB21, CAMPLIB22" +
                                ",CAMPLIB23, CAMPLIB24, CAMPLIB25, CAMPLIB26, CAMPLIB27" +
                                ",CAMPLIB28, CAMPLIB29, CAMPLIB30, CAMPLIB31, CAMPLIB32" +
                                ",CAMPLIB33, CAMPLIB34, CAMPLIB35, CAMPLIB36, CAMPLIB37" +
                                ",CAMPLIB38, CAMPLIB39, CAMPLIB40, CAMPLIB41, CAMPLIB42" +
                                ",CAMPLIB43, CAMPLIB44, CAMPLIB45" +
                                " From Logistik_Config_SAE"
                                Dim readerActivos As SqlDataReader
                                If connL6.State = ConnectionState.Closed Then
                                    connL6.Open()
                                End If
                                LabelTABLA.Text = "Q10s_Logistik_Config_SAE1"
                                TextBox1.Text = "REmp10:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, connL6)
                                readerActivos = cmd.ExecuteReader()
                                LabelTABLA.Text = "Q10s_Logistik_Config_SAE2"
                                TextBox1.Text = "REmp10:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                CampLibA1 = "" : CampLibA2 = "" : CampLibA3 = "" : CampLibA4 = ""
                                CampLibA5 = "" : CampLibA6 = "" : CampLibA7 = "" : CampLibA8 = ""
                                CampLibA9 = "" : CampLibA10 = "" : CampLibA11 = "" : CampLibA12 = ""
                                CampLibA13 = "" : CampLibA14 = "" : CampLibA15 = "" : CampLibA16 = ""
                                CampLibA17 = "" : CampLibA18 = "" : CampLibA19 = "" : CampLibA20 = ""
                                CampLibA21 = "" : CampLibA22 = "" : CampLibA23 = "" : CampLibA24 = ""
                                CampLibA25 = "" : CampLibA26 = "" : CampLibA27 = "" : CampLibA28 = ""
                                CampLibA29 = "" : CampLibA30 = "" : CampLibA31 = "" : CampLibA32 = ""
                                CampLibA33 = "" : CampLibA34 = "" : CampLibA35 = "" : CampLibA36 = ""
                                CampLibA37 = "" : CampLibA38 = "" : CampLibA39 = "" : CampLibA40 = ""
                                CampLibA41 = "" : CampLibA42 = "" : CampLibA43 = "" : CampLibA44 = ""
                                CampLibA45 = ""
                                While readerActivos.Read()
                                    CampLibA1 = readerActivos.Item("CAMPLIB1").ToString
                                    CampLibA2 = readerActivos.Item("CAMPLIB2").ToString
                                    CampLibA3 = readerActivos.Item("CAMPLIB3").ToString
                                    CampLibA4 = readerActivos.Item("CAMPLIB4").ToString
                                    CampLibA5 = readerActivos.Item("CAMPLIB5").ToString
                                    CampLibA6 = readerActivos.Item("CAMPLIB6").ToString
                                    CampLibA7 = readerActivos.Item("CAMPLIB7").ToString
                                    CampLibA8 = readerActivos.Item("CAMPLIB8").ToString
                                    CampLibA9 = readerActivos.Item("CAMPLIB9").ToString
                                    CampLibA10 = readerActivos.Item("CAMPLIB10").ToString
                                    CampLibA11 = readerActivos.Item("CAMPLIB11").ToString
                                    CampLibA12 = readerActivos.Item("CAMPLIB12").ToString
                                    CampLibA13 = readerActivos.Item("CAMPLIB13").ToString
                                    CampLibA14 = readerActivos.Item("CAMPLIB14").ToString
                                    CampLibA15 = readerActivos.Item("CAMPLIB15").ToString
                                    CampLibA16 = readerActivos.Item("CAMPLIB16").ToString
                                    CampLibA17 = readerActivos.Item("CAMPLIB17").ToString
                                    CampLibA18 = readerActivos.Item("CAMPLIB18").ToString
                                    CampLibA19 = readerActivos.Item("CAMPLIB19").ToString
                                    CampLibA20 = readerActivos.Item("CAMPLIB20").ToString
                                    CampLibA21 = readerActivos.Item("CAMPLIB21").ToString
                                    CampLibA22 = readerActivos.Item("CAMPLIB22").ToString
                                    CampLibA23 = readerActivos.Item("CAMPLIB23").ToString
                                    CampLibA24 = readerActivos.Item("CAMPLIB24").ToString
                                    CampLibA25 = readerActivos.Item("CAMPLIB25").ToString
                                    CampLibA26 = readerActivos.Item("CAMPLIB26").ToString
                                    CampLibA27 = readerActivos.Item("CAMPLIB27").ToString
                                    CampLibA28 = readerActivos.Item("CAMPLIB28").ToString
                                    CampLibA29 = readerActivos.Item("CAMPLIB29").ToString
                                    CampLibA30 = readerActivos.Item("CAMPLIB30").ToString
                                    CampLibA31 = readerActivos.Item("CAMPLIB31").ToString
                                    CampLibA32 = readerActivos.Item("CAMPLIB32").ToString
                                    CampLibA33 = readerActivos.Item("CAMPLIB33").ToString
                                    CampLibA34 = readerActivos.Item("CAMPLIB34").ToString
                                    CampLibA35 = readerActivos.Item("CAMPLIB35").ToString
                                    CampLibA36 = readerActivos.Item("CAMPLIB36").ToString
                                    CampLibA37 = readerActivos.Item("CAMPLIB37").ToString
                                    CampLibA38 = readerActivos.Item("CAMPLIB38").ToString
                                    CampLibA39 = readerActivos.Item("CAMPLIB39").ToString
                                    CampLibA40 = readerActivos.Item("CAMPLIB40").ToString
                                    CampLibA41 = readerActivos.Item("CAMPLIB41").ToString
                                    CampLibA42 = readerActivos.Item("CAMPLIB42").ToString
                                    CampLibA43 = readerActivos.Item("CAMPLIB43").ToString
                                    CampLibA44 = readerActivos.Item("CAMPLIB44").ToString
                                    CampLibA45 = readerActivos.Item("CAMPLIB45").ToString
                                End While
                                readerActivos.Close()
                                Dim CampoLib1 As String = ""
                                Dim CampoLib2 As String = ""
                                Dim CampoLib3 As String = ""
                                Dim CampoLib4 As String = ""
                                Dim CampoLib5 As String = ""
                                Dim CampoLib6 As String = ""
                                Dim CampoLib7 As String = ""
                                Dim CampoLib8 As String = ""
                                Dim CampoLib9 As String = ""
                                Dim CampoLib10 As String = ""
                                Dim CampoLib11 As String = ""
                                Dim CampoLib12 As String = ""
                                Dim CampoLib13 As String = ""
                                Dim CampoLib14 As String = ""
                                Dim CampoLib15 As String = ""
                                Dim CampoLib16 As String = ""
                                Dim CampoLib17 As String = ""
                                Dim CampoLib18 As String = ""
                                Dim CampoLib19 As String = ""
                                Dim CampoLib20 As String = ""
                                Dim CampoLib21 As String = ""
                                Dim CampoLib22 As String = ""
                                Dim CampoLib23 As String = ""
                                Dim CampoLib24 As String = ""
                                Dim CampoLib25 As String = ""
                                Dim CampoLib26 As String = ""
                                Dim CampoLib27 As String = ""
                                Dim CampoLib28 As String = ""
                                Dim CampoLib29 As String = ""
                                Dim CampoLib30 As String = ""
                                Dim CampoLib31 As String = ""
                                Dim CampoLib32 As String = ""
                                Dim CampoLib33 As String = ""
                                Dim CampoLib34 As String = ""
                                Dim CampoLib35 As String = ""
                                Dim CampoLib36 As String = ""
                                Dim CampoLib37 As String = ""
                                Dim CampoLib38 As String = ""
                                Dim CampoLib39 As String = ""
                                Dim CampoLib40 As String = ""
                                Dim CampoLib41 As String = ""
                                Dim CampoLib42 As String = ""
                                Dim CampoLib43 As String = ""
                                Dim CampoLib44 As String = ""
                                Dim CampoLib45 As String = ""
                                Dim CampoLib46 As String = ""
                                Dim CampoLib47 As String = ""
                                Dim CampoLib48 As String = ""
                                Dim CampoLib49 As String = ""
                                Dim CampoLib50 As String = ""
                                Dim readerFACTR_CLIB As SqlDataReader
                                sqllocal = "Select CAMPLIB1, CAMPLIB2, CAMPLIB3, CAMPLIB4" +
                                ",CAMPLIB5,CAMPLIB6,CAMPLIB7,CAMPLIB8,CAMPLIB9" +
                                ",CAMPLIB10,CAMPLIB11,CAMPLIB12,CAMPLIB13,CAMPLIB14" +
                                ",CAMPLIB15,CAMPLIB16,CAMPLIB17,CAMPLIB18,CAMPLIB19" +
                                ",CAMPLIB20,CAMPLIB21,CAMPLIB22,CAMPLIB23,CAMPLIB24" +
                                ",CAMPLIB25,CAMPLIB26,CAMPLIB27,CAMPLIB28,CAMPLIB29" +
                                ",CAMPLIB30,CAMPLIB31,CAMPLIB32,CAMPLIB33,CAMPLIB34" +
                                ",CAMPLIB35,CAMPLIB36,CAMPLIB37,CAMPLIB38,CAMPLIB39" +
                                ",CAMPLIB40,CAMPLIB41,CAMPLIB42,CAMPLIB43,CAMPLIB44" +
                                ",CAMPLIB45, CAMPLIB46, CAMPLIB47, CAMPLIB48, CAMPLIB49, CAMPLIB50" +
                                " FROM FACTP_CLIB" + pNUMEMP.ToString +
                                " WHERE CLAVE_DOC ='" + CVE_DOC + "'"
                                LabelTABLA.Text = "S FACTR_CLIB"
                                LabelTABLA.Text = "Q11s_FACTR_CLIB"
                                TextBox1.Text = "P15_EMPRESA" + pNUMEMP.ToString
                                Me.Refresh()
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                readerFACTR_CLIB = cmd.ExecuteReader()
                                While readerFACTR_CLIB.Read()
                                    'varchar
                                    If CampLibA1 = "1" Then
                                        CampoLib1 = readerFACTR_CLIB.Item("CAMPLIB1").ToString
                                    Else
                                        CampoLib1 = ""
                                    End If
                                    If CampLibA2 = "1" Then
                                        CampoLib2 = readerFACTR_CLIB.Item("CAMPLIB2").ToString
                                    Else
                                        CampoLib2 = ""
                                    End If
                                    If CampLibA3 = "1" Then
                                        CampoLib3 = readerFACTR_CLIB.Item("CAMPLIB3").ToString
                                    Else
                                        CampoLib3 = ""
                                    End If
                                    'fecha_factura
                                    If CampLibA4 = "1" Then
                                        CampoLib4 = readerFACTR_CLIB.Item("CAMPLIB4").ToString
                                        If Len(CampoLib4) > 6 Then
                                            CampoLib4 = "'" + Convert.ToDateTime(CampoLib4).ToString("yyyy/MM/dd HH:mm:ss") + "'"
                                        Else
                                            'CampoLib4 = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                            CampoLib4 = "NULL"
                                        End If
                                    Else
                                        CampoLib4 = "NULL"
                                    End If
                                    'fecha
                                    If CampLibA5 = "1" Then
                                        CampoLib5 = readerFACTR_CLIB.Item(4).ToString
                                        If Len(CampoLib5) > 6 Then
                                            CampoLib5 = "'" + Convert.ToDateTime(CampoLib5).ToString("yyyy/MM/dd HH:mm:ss") + "'"
                                        Else
                                            'CampoLib5 = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                            CampoLib5 = "NULL"
                                        End If
                                    Else
                                        CampoLib5 = "NULL"
                                    End If
                                    'varchar
                                    If CampLibA6 = "1" Then
                                        CampoLib6 = readerFACTR_CLIB.Item(5).ToString
                                    Else
                                        CampoLib6 = ""
                                    End If
                                    'int
                                    If CampLibA7 = "1" Then
                                        CampoLib7 = readerFACTR_CLIB.Item(6).ToString()
                                    Else
                                        CampoLib7 = ""
                                    End If
                                    'surte_fecha
                                    If CampLibA8 = "1" Then
                                        CampoLib8 = readerFACTR_CLIB.Item(7).ToString
                                        If Len(CampoLib8) > 6 Then
                                            CampoLib8 = "'" + Convert.ToDateTime(CampoLib8).ToString("yyyy/MM/dd HH:mm:ss") + "'"
                                        Else
                                            'CampoLib8 = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                            CampoLib8 = "NULL"
                                        End If
                                    Else
                                        CampoLib8 = "NULL"
                                    End If
                                    'varchar
                                    If CampLibA9 = "1" Then
                                        CampoLib9 = readerFACTR_CLIB.Item(8).ToString
                                    Else
                                        CampoLib9 = ""
                                    End If
                                    'int
                                    If CampLibA10 = "1" Then
                                        CampoLib10 = readerFACTR_CLIB.Item(9).ToString
                                    Else
                                        CampoLib10 = ""
                                    End If
                                    'int
                                    If CampLibA11 = "1" Then
                                        CampoLib11 = readerFACTR_CLIB.Item(10).ToString
                                    Else
                                        CampoLib11 = ""
                                    End If
                                    'recive_fecha
                                    If CampLibA12 = "1" Then
                                        CampoLib12 = readerFACTR_CLIB.Item(11).ToString
                                        If Len(CampoLib12) > 6 Then
                                            CampoLib12 = "'" + Convert.ToDateTime(CampoLib12).ToString("yyyy/MM/dd HH:mm:ss") + "'"
                                        Else
                                            'CampoLib12 = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                            CampoLib12 = "NULL"
                                        End If
                                    Else
                                        CampoLib12 = "NULL"
                                    End If
                                    'varchar
                                    If CampLibA13 = "1" Then
                                        CampoLib13 = readerFACTR_CLIB.Item(12).ToString
                                    Else
                                        CampoLib13 = ""
                                    End If
                                    'int
                                    If CampLibA14 = "1" Then
                                        CampoLib14 = readerFACTR_CLIB.Item(13).ToString
                                    Else
                                        CampoLib14 = ""
                                    End If
                                    'varchar
                                    If CampLibA15 = "1" Then
                                        CampoLib15 = readerFACTR_CLIB.Item(14).ToString
                                    Else
                                        CampoLib15 = ""
                                    End If
                                    'varchar
                                    If CampLibA16 = "1" Then
                                        CampoLib16 = readerFACTR_CLIB.Item(15).ToString
                                    Else
                                        CampoLib16 = ""
                                    End If
                                    'emp_date
                                    If CampLibA17 = "1" Then
                                        CampoLib17 = readerFACTR_CLIB.Item(16).ToString
                                        If Len(CampoLib17) > 6 Then
                                            CampoLib17 = "'" + Convert.ToDateTime(CampoLib17).ToString("yyyy/MM/dd HH:mm:ss") + "'"
                                        Else
                                            'CampoLib17 = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                            CampoLib17 = "NULL"
                                        End If
                                    Else
                                        CampoLib17 = "NULL"
                                    End If
                                    'varchar
                                    If CampLibA18 = "1" Then
                                        CampoLib18 = readerFACTR_CLIB.Item(17).ToString
                                    Else
                                        CampoLib18 = ""
                                    End If
                                    'int
                                    If CampLibA19 = "1" Then
                                        CampoLib19 = readerFACTR_CLIB.Item(18).ToString
                                    Else
                                        CampoLib19 = ""
                                    End If
                                    'date
                                    If CampLibA20 = "1" Then
                                        CampoLib20 = readerFACTR_CLIB.Item(19).ToString
                                        If Len(CampoLib20) > 6 Then
                                            CampoLib20 = "'" + Convert.ToDateTime(CampoLib20).ToString("yyyy/MM/dd HH:mm:ss") + "'"
                                        Else
                                            'CampoLib20 = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                            CampoLib20 = "NULL"
                                        End If
                                    Else
                                        CampoLib20 = "NULL"
                                    End If
                                    'varchar
                                    If CampLibA21 = "1" Then
                                        CampoLib21 = readerFACTR_CLIB.Item(20).ToString
                                    Else
                                        CampoLib21 = ""
                                    End If
                                    'varchar
                                    If CampLibA22 = "1" Then
                                        CampoLib22 = readerFACTR_CLIB.Item(21).ToString
                                    Else
                                        CampoLib22 = ""
                                    End If
                                    'varchar
                                    If CampLibA23 = "1" Then
                                        CampoLib23 = readerFACTR_CLIB.Item(22).ToString
                                    Else
                                        CampoLib23 = ""
                                    End If
                                    'varchar
                                    If CampLibA24 = "1" Then
                                        CampoLib24 = readerFACTR_CLIB.Item(23).ToString
                                    Else
                                        CampoLib24 = ""
                                    End If
                                    'varchar
                                    If CampLibA25 = "1" Then
                                        CampoLib25 = readerFACTR_CLIB.Item(24).ToString
                                    Else
                                        CampoLib25 = ""
                                    End If
                                    'varchar
                                    If CampLibA26 = "1" Then
                                        CampoLib26 = readerFACTR_CLIB.Item(25).ToString
                                    Else
                                        CampoLib26 = ""
                                    End If
                                    'date
                                    If CampLibA27 = "1" Then
                                        CampoLib27 = readerFACTR_CLIB.Item(26).ToString
                                        If Len(CampoLib27) > 6 Then
                                            CampoLib27 = "'" + Convert.ToDateTime(CampoLib27).ToString("yyyy/MM/dd HH:mm:ss") + "'"
                                        Else
                                            'CampoLib27 = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                            CampoLib27 = "NULL"
                                        End If
                                    Else
                                        CampoLib27 = "NULL"
                                    End If
                                    'float
                                    If CampLibA28 = "1" Then
                                        CampoLib28 = readerFACTR_CLIB.Item(27).ToString
                                    Else
                                        CampoLib28 = ""
                                    End If
                                    'varchar
                                    If CampLibA29 = "1" Then
                                        CampoLib29 = readerFACTR_CLIB.Item(28).ToString
                                    Else
                                        CampoLib29 = ""
                                    End If
                                    'varchar
                                    If CampLibA30 = "1" Then
                                        CampoLib30 = readerFACTR_CLIB.Item(29).ToString
                                    Else
                                        CampoLib30 = ""
                                    End If
                                    'varchar
                                    If CampLibA31 = "1" Then
                                        CampoLib31 = readerFACTR_CLIB.Item(30).ToString
                                    Else
                                        CampoLib31 = ""
                                    End If
                                    'int
                                    If CampLibA32 = "1" Then
                                        CampoLib32 = readerFACTR_CLIB.Item(31).ToString
                                    Else
                                        CampoLib32 = ""
                                    End If
                                    'int
                                    If CampLibA33 = "1" Then
                                        CampoLib33 = readerFACTR_CLIB.Item(32).ToString
                                    Else
                                        CampoLib33 = ""
                                    End If
                                    'varchar
                                    If CampLibA34 = "1" Then
                                        CampoLib34 = readerFACTR_CLIB.Item(33).ToString
                                    Else
                                        CampoLib34 = ""
                                    End If
                                    'varchar
                                    If CampLibA35 = "1" Then
                                        CampoLib35 = readerFACTR_CLIB.Item(34).ToString
                                    Else
                                        CampoLib35 = ""
                                    End If
                                    'float
                                    If CampLibA36 = "1" Then
                                        CampoLib36 = readerFACTR_CLIB.Item(35).ToString
                                    Else
                                        CampoLib36 = ""
                                    End If
                                    If CampLibA37 = "1" Then
                                        CampoLib37 = readerFACTR_CLIB.Item(36).ToString
                                    Else
                                        CampoLib37 = ""
                                    End If
                                    If CampLibA38 = "1" Then
                                        CampoLib38 = readerFACTR_CLIB.Item(37).ToString
                                    Else
                                        CampoLib38 = ""
                                    End If
                                    If CampLibA39 = "1" Then
                                        CampoLib39 = readerFACTR_CLIB.Item(38).ToString
                                    Else
                                        CampoLib39 = ""
                                    End If
                                    If CampLibA40 = "1" Then
                                        CampoLib40 = readerFACTR_CLIB.Item(39).ToString
                                    Else
                                        CampoLib40 = ""
                                    End If
                                    If CampLibA41 = "1" Then
                                        CampoLib41 = readerFACTR_CLIB.Item(40).ToString
                                    Else
                                        CampoLib41 = ""
                                    End If
                                    If CampLibA42 = "1" Then
                                        CampoLib42 = readerFACTR_CLIB.Item(41).ToString
                                    Else
                                        CampoLib42 = ""
                                    End If
                                    If CampLibA43 = "1" Then
                                        CampoLib43 = readerFACTR_CLIB.Item(42).ToString
                                    Else
                                        CampoLib43 = ""
                                    End If
                                    If CampLibA44 = "1" Then
                                        CampoLib44 = readerFACTR_CLIB.Item(43).ToString
                                    Else
                                        CampoLib44 = ""
                                    End If
                                    If CampLibA45 = "1" Then
                                        CampoLib45 = readerFACTR_CLIB.Item(44).ToString
                                    Else
                                        CampoLib45 = ""
                                    End If
                                    CampoLib46 = readerFACTR_CLIB.Item(45).ToString
                                    CampoLib47 = readerFACTR_CLIB.Item(46).ToString
                                    CampoLib48 = readerFACTR_CLIB.Item(47).ToString
                                    CampoLib49 = readerFACTR_CLIB.Item(48).ToString
                                    CampoLib50 = readerFACTR_CLIB.Item(49).ToString
                                End While
                                readerFACTR_CLIB.Close()
                                sqllocal = "Insert into FACTR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC, CAMPLIB1, CAMPLIB2" +
                                ",CAMPLIB3, CAMPLIB4, CAMPLIB5, CAMPLIB6, CAMPLIB7" +
                                ",CAMPLIB8, CAMPLIB9, CAMPLIB10, CAMPLIB11, CAMPLIB12" +
                                ",CAMPLIB13, CAMPLIB14, CAMPLIB15, CAMPLIB16, CAMPLIB17" +
                                ",CAMPLIB18, CAMPLIB19, CAMPLIB20, CAMPLIB21, CAMPLIB22" +
                                ",CAMPLIB23, CAMPLIB24, CAMPLIB25, CAMPLIB26, CAMPLIB27" +
                                ",CAMPLIB28, CAMPLIB29, CAMPLIB30, CAMPLIB31, CAMPLIB32" +
                                ",CAMPLIB33, CAMPLIB34, CAMPLIB35, CAMPLIB36, CAMPLIB37" +
                                ",CAMPLIB38, CAMPLIB39, CAMPLIB40, CAMPLIB41, CAMPLIB42" +
                                ",CAMPLIB43, CAMPLIB44, CAMPLIB45, CAMPLIB46, CAMPLIB47, CAMPLIB48, CAMPLIB49, CAMPLIB50) values ('" + vCveDoc + "','" + CampoLib1 + "','" + CampoLib2 +
                                "','" + CampoLib3 + "'," + CampoLib4 + "," + CampoLib5 + ",'" + CampoLib6 + "','" + CampoLib7 +
                                "'," + CampoLib8 + ",'" + CampoLib9 + "','" + CampoLib10 + "','" + CampoLib11 + "'," + CampoLib12 +
                                ",'" + CampoLib13 + "','" + CampoLib14 + "','" + CampoLib15 + "','" + CampoLib16 + "'," + CampoLib17 +
                                ",'" + CampoLib18 + "','" + CampoLib19 + "'," + CampoLib20 + ",'" + CampoLib21 + "','" + CampoLib22 +
                                "','" + CampoLib23 + "','" + CampoLib24 + "','" + CampoLib25 + "','" + CampoLib26 + "'," + CampoLib27 +
                                ",'" + CampoLib28 + "','" + CampoLib29 + "','" + CampoLib30 + "','" + CampoLib31 + "','" + CampoLib32 +
                                "','" + CampoLib33 + "','" + CampoLib34 + "','" + CampoLib35 + "','" + CampoLib36 + "','" + CampoLib37 +
                                "','" + CampoLib38 + "','" + CampoLib39 + "','" + CampoLib40 + "','" + CampoLib41 + "','" + CampoLib42 +
                                "','" + CampoLib43 + "','" + CampoLib44 + "','" + CampoLib45 + "','" + CampoLib46 + "','" + CampoLib47 + "','" + CampoLib48 + "','" + CampoLib49 + "','" + CampoLib50 + "')"
                                LabelTABLA.Text = "Q12i_FACTR_CLIB_sae1o4"
                                TextBox1.Text = "REmp11:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                            End If
                            sqllocal = "UPDATE TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                            'TextError.Text = "rEMISION 2 EMP01 O EMP04 - PASO7"
                            LabelTABLA.Text = "Q13u_TBLCONTROL"
                            TextBox1.Text = "REmp12:" + OrdenVenta + ":" + Str1
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            ''---------------------
                            ''Dim vCve_Obs As String = TraerClaveSiguiente()
                            Dim vCve_Obs As String
                            'Dim vcont7 As String = ""
                            'Dim reader7 As SqlDataReader
                            'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCF" + pNUMEMP.ToString
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'reader7 = cmd.ExecuteReader()
                            'While reader7.Read()
                            '    'MsgBox(reader7.Item(0))
                            '    vcont7 = reader7.Item(0).ToString
                            '    vcont7 = Val(vcont7) + 1
                            'End While
                            'If vcont7 = "" Then vcont7 = "1"
                            'vCve_Obs = vcont7
                            'reader7.Close()
                            ''-----------------------------------
                            Dim vObser As String = ""
                            'sqllocal = "INSERT INTO OBS_DOCF" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            'Call UpdateOC(CVE_DOC, vCveDoc)
                            Dim bVificarCant As Boolean = fVificarCant(pMiBD, CVE_DOC, pNUMEMP)
                            If bVificarCant = False Then
                                sqllocal = "update FACTP" + pNUMEMP.ToString + " SET ENLAZADO='P', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" +
                                " WHERE CVE_DOC ='" + CVE_DOC + "'"
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                            Else
                                sqllocal = "update FACTP" + pNUMEMP.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" +
                              " WHERE CVE_DOC ='" + CVE_DOC + "'"
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                            End If
                            'sqllocal = "update FACTP" + pNUMEMP.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
                            '" WHERE CVE_DOC ='" + CVE_DOC + "'"
                            LabelTABLA.Text = "Q14u_FACTP"
                            TextBox1.Text = "REmp13:" + OrdenVenta + ":" + Str1
                            Me.Refresh()
                            'TextError.Text = "rEMISION 2 EMP01 O EMP04 - PASO8"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            ''INSERT TABLA BITA
                            'sqllocal = "INSERT INTO BITA" + pNUMEMP.ToString + _
                            '"(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" + _
                            '" VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + IMPORTE.ToString + "', 'F', 'administrador')"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            TextBox1.Text = "P17"
                            Me.Refresh()
                            sqllocal = "UPDATE TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 62"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            LabelTABLA.Text = "Q15u_TBLCONTROL"
                            '------------------------------------------------------------------------------------------------------------------------------------------
                            'Call RemisionesDatalleSAE(vCveDoc, vObser, CVE_DOC, CVE_VEND)
                            Dim pcvedoc As String = vCveDoc
                            Dim pObser As String = vObser
                            Dim pcve_doc_origen As String = CVE_DOC
                            Dim VEND As String = CVE_VEND
                            Dim NUM_PAR As String
                            Dim CVE_ART As String
                            Dim CANT As String
                            Dim PREC As String
                            Dim COST As String
                            Dim IMPU1 As String
                            Dim IMPU2 As String
                            Dim IMPU3 As String
                            Dim IMPU4 As String
                            Dim IMP1APLA As String
                            Dim IMP2APLA As String
                            Dim IMP3APLA As String
                            Dim IMP4APLA As String
                            Dim TOTIMP1 As String
                            Dim TOTIMP2 As String
                            Dim TOTIMP3 As String
                            Dim TOTIMP4 As String
                            Dim DESC1 As String
                            Dim DESC2 As String
                            Dim DESC3 As String
                            Dim COMI As String = "0"
                            Dim APAR As String
                            Dim ACT_INV As String
                            Dim NUM_ALM As String
                            Dim POLIT_APLI As String
                            Dim TIP_CAM As String
                            Dim UNI_VENTA As String
                            Dim TIPO_PROD As String
                            Dim REG_SERIE As String
                            Dim E_LTPD As String
                            Dim TIPO_ELEM As String
                            Dim NUM_MOV As String
                            Dim TOT_PARTIDA As String
                            Dim IMPRIMIR As String
                            Dim DCampoLib1 As String = ""
                            Dim DCampoLib2 As String = ""
                            Dim DCampoLib3 As String = ""
                            Dim DCampoLib4 As String = ""
                            Dim DCampoLib5 As String = ""
                            Dim DCampoLib6 As String = ""
                            Dim DCampoLib7 As String = ""
                            Dim DCampoLib8 As String = ""
                            Dim DCampoLib9 As String = ""
                            Dim DCampoLib10 As String = ""
                            Dim DCampoLib11 As String = ""
                            Dim DCampoLib12 As String = ""
                            Dim DCampoLib13 As String = ""
                            Dim DCampoLib14 As String = ""
                            Dim DCampoLib15 As String = ""
                            Dim DCampoLib16 As String = ""
                            Dim DCampoLib17 As String = ""
                            Dim DCampoLib18 As String = ""
                            Dim reader2 As SqlDataReader
                            SqlSelection = "SELECT CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                            ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                            ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                            ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" +
                             " FROM PAR_FACTP" + pNUMEMP.ToString + " where CVE_DOC = '" + pcve_doc_origen + "'"
                            cmd = New SqlCommand(SqlSelection, conn2, objTrans)
                            reader2 = cmd.ExecuteReader()
                            LabelTABLA.Text = "Q16s_PAR_FACTP"
                            TextBox1.Text = "REmp14:" + OrdenVenta + ":" + Str1
                            Me.Refresh()
                            Dim RCOMI As Decimal = 0
                            Dim vlsubtotal As Double = 0
                            Dim vlsubtotPart As Double = 0
                            Dim vlsubtotalConDesc As Double = 0
                            Dim comision As Double = 0
                            Dim descuento As Double = 0
                            vlFlagDesc = 0
                            Dim descuentoPart As Double = 0
                            Dim descuentoPartMoney As Double = 0
                            Dim descPartMoneyTot As Double = 0
                            Dim descuentoPart2 As Double = 0
                            Dim descuentoPartMoney2 As Double = 0
                            Dim descPartMoneyTot2 As Double = 0
                            Dim descuentoPart3 As Double = 0
                            Dim descuentoPartMoney3 As Double = 0
                            Dim descPartMoneyTot3 As Double = 0
                            While reader2.Read()
                                'MsgBox(reader2.Item(0))
                                CVE_DOC = reader2.Item(0).ToString
                                NUM_PAR = reader2.Item(1).ToString
                                CVE_ART = reader2.Item(2).ToString
                                CANT = "0" 'reader2.Item(3).ToString
                                'PXS = reader2.Item(4).ToString
                                PREC = reader2.Item(5).ToString
                                'Dim readrPrecio As SqlDataReader
                                'sqllocal = "Select PRECIO from PRECIO_X_PROD" + pNUMEMP.ToString + " WHERE CVE_ART='" + CVE_ART + "' AND CVE_PRECIO=1"
                                'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                'readrPrecio = cmd.ExecuteReader()
                                'TextBox1.Text = "REmp15:" + OrdenVenta + ":" + Str1
                                'Me.Refresh()
                                'While readrPrecio.Read()
                                '    PREC = readrPrecio.Item(0).ToString
                                'End While
                                'readrPrecio.Close()
                                COST = reader2.Item(6).ToString
                                IMPU1 = reader2.Item(7).ToString
                                IMPU2 = reader2.Item(8).ToString
                                IMPU3 = reader2.Item(9).ToString

                                IMPU4 = reader2.Item(10).ToString
                                IMP1APLA = reader2.Item(11).ToString
                                IMP2APLA = reader2.Item(12).ToString
                                IMP3APLA = reader2.Item(13).ToString
                                IMP4APLA = reader2.Item(14).ToString
                                TOTIMP1 = reader2.Item(15).ToString
                                TOTIMP2 = reader2.Item(16).ToString
                                TOTIMP3 = reader2.Item(17).ToString
                                TOTIMP4 = reader2.Item(18).ToString

                                DESC1 = reader2.Item(19).ToString
                                DESC2 = reader2.Item(20).ToString
                                DESC3 = reader2.Item(21).ToString
                                COMI = reader2.Item(22).ToString

                                APAR = reader2.Item(23).ToString
                                ACT_INV = reader2.Item(24).ToString
                                '//se cambio de 1 a 104
                                If UCase(camplib34) = "GDL" Then
                                    NUM_ALM = "104"
                                Else
                                    NUM_ALM = "1"
                                End If
                                POLIT_APLI = reader2.Item(26).ToString
                                TIP_CAM = reader2.Item(27).ToString
                                UNI_VENTA = reader2.Item(28).ToString
                                TIPO_PROD = "P"
                                'sacar el tipo de producto del la tabla INVE campo TIPO_ELEM
                                Dim readerTypeProduct As SqlDataReader
                                sqllocal = "SELECT TIPO_ELE FROM INVE" + pNUMEMP.ToString + " WHERE CVE_ART ='" + CVE_ART + "'"
                                LabelTABLA.Text = "Q17s_INVE"
                                TextBox1.Text = "REmpTipoProd:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                readerTypeProduct = cmd.ExecuteReader()
                                While readerTypeProduct.Read()
                                    TIPO_PROD = readerTypeProduct.Item(0).ToString
                                End While
                                readerTypeProduct.Close()
                                CVE_OBS = reader2.Item(30).ToString
                                REG_SERIE = reader2.Item(31).ToString
                                E_LTPD = reader2.Item(32).ToString
                                TIPO_ELEM = reader2.Item(33).ToString
                                NUM_MOV = reader2.Item(34).ToString
                                TOT_PARTIDA = reader2.Item(35).ToString
                                IMPRIMIR = reader2.Item(36).ToString
                                ''-------------------Traer la clave siguiente
                                ''CVE_OBS = TraerClaveSiguiente()
                                'Dim vconta As String = ""
                                ''Dim vnum As Integer
                                'Dim reader_obser As SqlDataReader
                                'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCF" + pNUMEMP.ToString
                                'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                'reader_obser = cmd.ExecuteReader()
                                'While reader_obser.Read()
                                '    'MsgBox(reader.Item(0))
                                '    vconta = reader_obser.Item(0).ToString
                                '    vconta = Val(vconta) + 1
                                'End While
                                'If vconta = "" Then vconta = "1"
                                'CVE_OBS = vconta
                                'reader_obser.Close()
                                ''-------------------------------------------
                                'sqllocal = "INSERT INTO OBS_DOCF" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                                'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                'cmd.ExecuteNonQuery()
                                '---------------------crear el o los movimientos
                                'Dim vNum_Mov As String = ConsecutivoMovimiento()
                                Dim vNum_Mov As String
                                Dim vconta7 As String = ""
                                Dim readerMov As SqlDataReader
                                sqllocal = "SELECT tt.ULT_CVE FROM TBLCONTROL" + pNUMEMP.ToString + " tt WHERE tt.ID_TABLA = 44"
                                LabelTABLA.Text = "Q18s_TBLCONTROL"
                                TextBox1.Text = "REmp16:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                readerMov = cmd.ExecuteReader()
                                While readerMov.Read()
                                    vconta7 = readerMov.Item(0).ToString
                                    vconta7 = Val(vconta7) + 1
                                End While
                                If vconta7 = "" Then vconta7 = "1"
                                vNum_Mov = vconta7
                                readerMov.Close()
                                '----------traer la cantidad
                                CANT = "0"
                                Dim readerPC As SqlDataReader
                                SqlSelection = "select quantity_received from Logistik_order_detail" +
                                " where id_order = '" + pcve_doc_origen + "' and product_upc = '" + CVE_ART + "' and num_empresa='" + pNUMEMP + "'"
                                LabelTABLA.Text = "Q19s_Logistik_order_detail"
                                TextBox1.Text = "REmp17:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                '+ _
                                '" and id_order_detail = '" + NUM_PAR + "'"
                                If conn.State = ConnectionState.Closed Then
                                    conn.Open()
                                End If
                                cmd = New SqlCommand(SqlSelection, conn)
                                readerPC = cmd.ExecuteReader()
                                While readerPC.Read()
                                    CANT = readerPC.Item(0).ToString
                                    PXS = readerPC.Item(0).ToString
                                End While
                                If Len(CANT) > 0 And Len(PREC) > 0 Then
                                    TOT_PARTIDA = Convert.ToDecimal(CANT) * Convert.ToDecimal(PREC)
                                Else
                                    TOT_PARTIDA = "0"
                                End If
                                If Len(CANT) > 0 And Len(PREC) > 0 And Len(IMPU4) > 0 Then
                                    TOTIMP4 = Convert.ToDecimal(CANT * PREC) * Convert.ToDecimal(IMPU4 / 100)
                                Else
                                    TOTIMP4 = "0"
                                End If
                                'comision = comision + (Convert.ToDecimal(COMI / 100) * Convert.ToDecimal(TOT_PARTIDA))
                                'COMI = comision
                                readerPC.Close()
                                If Val(CANT) > 0 Then

                                    '-------------------------------------------
                                    Dim vUUID2 = Guid.NewGuid.ToString()
                                    vUUID2 = UCase(vUUID2)
                                    sqllocal = "Insert Into PAR_FACTR" + pNUMEMP.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                    ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                    ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                    ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR,UUID," +
                                    "CUOTA_IEPS,APL_MAN_IEPS,MTO_PORC,MTO_CUOTA,CVE_ESQ,VERSION_SINC,MAN_IEPS,APL_MAN_IMP,PREC_NETO) values (" +
                                    "'" + pcvedoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT + "','" + PXS + "','" +
                                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                                    IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                                    DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                                    NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                                    CVE_OBS + "','" + REG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                                    TOT_PARTIDA + "','S','" + vUUID2 + "','0','C','0','0','1','" + time.ToString("yyyy/MM/dd HH:mm:ss") + "','N','1','0')"
                                    LabelTABLA.Text = "Q20i_PAR_FACTR"
                                    TextBox1.Text = "REmp18:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    If pNUMEMP = "01" Or pNUMEMP = "1" Then
                                        Dim readerPAR_FACTP_CLIB As SqlDataReader
                                        sqllocal = "SELECT NUM_PART,CAMPLIB1,CAMPLIB2,CAMPLIB3,CAMPLIB4,CAMPLIB5" +
                                        ",CAMPLIB6,CAMPLIB7,CAMPLIB8,CAMPLIB9,CAMPLIB10" +
                                        ",CAMPLIB11,CAMPLIB12,CAMPLIB13,CAMPLIB14,CAMPLIB15" +
                                        ",CAMPLIB16,CAMPLIB17,CAMPLIB18" +
                                        " FROM PAR_FACTP_CLIB" + pNUMEMP.ToString +
                                        " WHERE CLAVE_DOC ='" + CVE_DOC + "'" +
                                        " AND NUM_PART='" + NUM_PAR + "'"
                                        LabelTABLA.Text = "Q200s_PAR_FACTP_CLIB"
                                        Me.Refresh()
                                        If conn2.State = ConnectionState.Closed Then
                                            conn2.Open()
                                        End If
                                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                        readerPAR_FACTP_CLIB = cmd.ExecuteReader()
                                        While readerPAR_FACTP_CLIB.Read()
                                            DCampoLib1 = readerPAR_FACTP_CLIB.Item(1).ToString
                                            DCampoLib2 = readerPAR_FACTP_CLIB.Item(2).ToString
                                            DCampoLib3 = readerPAR_FACTP_CLIB.Item(3).ToString
                                            DCampoLib4 = readerPAR_FACTP_CLIB.Item(4).ToString
                                            DCampoLib5 = readerPAR_FACTP_CLIB.Item(5).ToString
                                            DCampoLib6 = readerPAR_FACTP_CLIB.Item(6).ToString
                                            DCampoLib7 = readerPAR_FACTP_CLIB.Item(7).ToString
                                            DCampoLib8 = readerPAR_FACTP_CLIB.Item(8).ToString
                                            DCampoLib9 = readerPAR_FACTP_CLIB.Item(9).ToString
                                            DCampoLib10 = readerPAR_FACTP_CLIB.Item(10).ToString
                                            DCampoLib11 = readerPAR_FACTP_CLIB.Item(11).ToString
                                            DCampoLib12 = readerPAR_FACTP_CLIB.Item(12).ToString
                                            DCampoLib13 = readerPAR_FACTP_CLIB.Item(13).ToString
                                            DCampoLib14 = readerPAR_FACTP_CLIB.Item(14).ToString
                                            DCampoLib15 = readerPAR_FACTP_CLIB.Item(15).ToString
                                            DCampoLib16 = readerPAR_FACTP_CLIB.Item(16).ToString
                                            DCampoLib17 = readerPAR_FACTP_CLIB.Item(17).ToString
                                            DCampoLib18 = readerPAR_FACTP_CLIB.Item(18).ToString
                                        End While
                                        readerPAR_FACTP_CLIB.Close()
                                        'INSERTAR EL INDICE
                                        sqllocal = "Insert into PAR_FACTR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC,NUM_PART,CAMPLIB1,CAMPLIB2" +
                                        ",CAMPLIB3,CAMPLIB4,CAMPLIB5,CAMPLIB6,CAMPLIB7,CAMPLIB8,CAMPLIB9,CAMPLIB10,CAMPLIB11,CAMPLIB12" +
                                        ",CAMPLIB13, CAMPLIB14, CAMPLIB15, CAMPLIB16, CAMPLIB17" +
                                        ",CAMPLIB18) VALUES ('" + pcvedoc + "','" + NUM_PAR + "','" + DCampoLib1 + "','" + DCampoLib2 +
                                        "','" + DCampoLib3 + "','" + DCampoLib4 + "','" + DCampoLib5 + "','" + DCampoLib6 + "','" + DCampoLib7 +
                                        "','" + DCampoLib8 + "','" + DCampoLib9 + "','" + DCampoLib10 + "','" + DCampoLib11 + "','" + DCampoLib12 +
                                        "','" + DCampoLib13 + "','" + DCampoLib14 + "','" + DCampoLib15 + "','" + DCampoLib16 + "','" + DCampoLib17 +
                                        "','" + DCampoLib18 + "')"
                                        LabelTABLA.Text = "Q21i_PAR_FACTR_CLIB"
                                        TextBox1.Text = "REmp19:" + OrdenVenta + ":" + Str1
                                        Me.Refresh()
                                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                        cmd.ExecuteNonQuery()
                                    End If
                                    If pNUMEMP = "04" Or pNUMEMP = "4" Then
                                        Dim readerPAR_FACTP_CLIB As SqlDataReader
                                        sqllocal = "SELECT NUM_PART,CAMPLIB1,CAMPLIB2,CAMPLIB3,CAMPLIB4,CAMPLIB5" +
                                        ",CAMPLIB6,CAMPLIB7,CAMPLIB8,CAMPLIB9,CAMPLIB10" +
                                        " FROM PAR_FACTP_CLIB" + pNUMEMP.ToString +
                                        " WHERE CLAVE_DOC ='" + CVE_DOC + "'" +
                                        " AND NUM_PART='" + NUM_PAR + "'"
                                        LabelTABLA.Text = "Q200s_PAR_FACTP_CLIB"
                                        Me.Refresh()
                                        If conn2.State = ConnectionState.Closed Then
                                            conn2.Open()
                                        End If
                                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                        readerPAR_FACTP_CLIB = cmd.ExecuteReader()
                                        While readerPAR_FACTP_CLIB.Read()
                                            DCampoLib1 = readerPAR_FACTP_CLIB.Item(1).ToString
                                            DCampoLib2 = readerPAR_FACTP_CLIB.Item(2).ToString
                                            DCampoLib3 = readerPAR_FACTP_CLIB.Item(3).ToString
                                            DCampoLib4 = readerPAR_FACTP_CLIB.Item(4).ToString
                                            DCampoLib5 = readerPAR_FACTP_CLIB.Item(5).ToString
                                            DCampoLib6 = readerPAR_FACTP_CLIB.Item(6).ToString
                                            DCampoLib7 = readerPAR_FACTP_CLIB.Item(7).ToString
                                            DCampoLib8 = readerPAR_FACTP_CLIB.Item(8).ToString
                                            DCampoLib9 = readerPAR_FACTP_CLIB.Item(9).ToString
                                            DCampoLib10 = readerPAR_FACTP_CLIB.Item(10).ToString
                                        End While
                                        readerPAR_FACTP_CLIB.Close()
                                        'INSERTAR EL INDICE
                                        sqllocal = "Insert into PAR_FACTR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC,NUM_PART,CAMPLIB1,CAMPLIB2" +
                                        ",CAMPLIB3,CAMPLIB4,CAMPLIB5,CAMPLIB6,CAMPLIB7,CAMPLIB8,CAMPLIB9,CAMPLIB10) VALUES ('" + pcvedoc + "','" + NUM_PAR + "','" + DCampoLib1 + "','" + DCampoLib2 +
                                        "','" + DCampoLib3 + "','" + DCampoLib4 + "','" + DCampoLib5 + "','" + DCampoLib6 + "','" + DCampoLib7 +
                                        "','" + DCampoLib8 + "','" + DCampoLib9 + "','" + DCampoLib10 + "')"
                                        LabelTABLA.Text = "Q21i_PAR_FACTR_CLIB"
                                        TextBox1.Text = "REmp19:" + OrdenVenta + ":" + Str1
                                        Me.Refresh()
                                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                        cmd.ExecuteNonQuery()
                                    End If

                                    'actualizar detalle PAR_FACTP01
                                    sqllocal = "update PAR_FACTP" + pNUMEMP.ToString + " set PXS = PXS - " + CANT.ToString +
                                    " where CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                                    LabelTABLA.Text = "Q22u_PAR_FACTP"
                                    TextBox1.Text = "REmp20:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    'actualizar ACUMULADOR de remisiones y facturas
                                    RCOMI = RCOMI + (Convert.ToDecimal(COM_TOT_PORC) * Convert.ToDecimal(CANT)) * (Convert.ToDecimal(PREC)) / 100
                                    sqllocal = "update AFACT" + pNUMEMP.ToString + " set RVTA_COM = RVTA_COM + '" + TOT_PARTIDA + "'," +
                                    " RIMP = RIMP + '" + TOTIMP4 + "'" +
                                    " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                                    LabelTABLA.Text = "Q23u_AFACT"
                                    TextBox1.Text = "REmp21:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    'sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
                                    'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    'cmd.ExecuteNonQuery()
                                    'sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
                                    'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    'cmd.ExecuteNonQuery()
                                    LabelTABLA.Text = "Q24u_TBLCONTROL"
                                    TextBox1.Text = "REmp22:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    'insertar documentos siguientes
                                    sqllocal = "INSERT INTO DOCTOSIGF" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                                    "PARTIDA, PART_E, CANT_E) VALUES (" +
                                    "'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" +
                                    NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    sqllocal = "INSERT INTO DOCTOSIGF" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                                    "PARTIDA, PART_E, CANT_E) VALUES (" +
                                    "'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" +
                                    NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    LabelTABLA.Text = "Q25i_DOCTOSIGF"
                                    TextBox1.Text = "REmp23:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    'actualizar las existencias
                                    'Call ActualizarExistencias(CVE_ART, CANT)
                                    'time = Today.Now
                                    'sqllocal = "update INVE" + pNUMEMP.ToString + " SET FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
                                    '" COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
                                    '"VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
                                    '" WHERE CVE_ART ='" + CVE_ART + "'"
                                    '' sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
                                    ''" COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
                                    ''"VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
                                    ''" WHERE CVE_ART ='" + CVE_ART + "'"
                                    'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    'cmd.ExecuteNonQuery()
                                    'sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST - '" + CANT + "', FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
                                    '" PEND_SURT = PEND_SURT - '" + CANT + "', COSTO_PROM = '" + COST + "'," + _
                                    '" ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + '" + CANT + "', VTAS_ANL_M = VTAS_ANL_M + '" + TOT_PARTIDA + "'" + _
                                    '" WHERE CVE_ART ='" + CVE_ART + "'"
                                    'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    'cmd.ExecuteNonQuery()
                                    sqllocal = "update INVE" + pNUMEMP.ToString + " SET PEND_SURT = PEND_SURT - '" + CANT + "'" +
                                    " WHERE CVE_ART ='" + CVE_ART + "'"
                                    LabelTABLA.Text = "Q27u_INVE"
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    '---------EXTRAER CLAVE DEL FOLIO
                                    Dim CVE_FOLIO As String = "0"
                                    Dim readerCONTROL As SqlDataReader
                                    sqllocal = "Select ULT_CVE FROM TBLCONTROL" + pNUMEMP.ToString + " WHERE ID_TABLA='32'"
                                    LabelTABLA.Text = "Q28s_TBLCONTROL"
                                    TextBox1.Text = "REmp24:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    readerCONTROL = cmd.ExecuteReader()
                                    While readerCONTROL.Read()
                                        CVE_FOLIO = readerCONTROL.Item(0).ToString
                                    End While
                                    If CVE_FOLIO = "" Then CVE_FOLIO = "1"
                                    readerCONTROL.Close()
                                    '-----------------------------------------------
                                    'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                                    Dim vExistencia As String = "0"
                                    Dim reader3 As SqlDataReader
                                    sqllocal = "Select ISNULL(max(EXIST),0) AS num from INVE" + pNUMEMP.ToString + " where CVE_ART = '" + CVE_ART + "'"
                                    LabelTABLA.Text = "Q29s_INVE"
                                    TextBox1.Text = "REmp25:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    reader3 = cmd.ExecuteReader()
                                    While reader3.Read()
                                        'MsgBox(reader3.Item(0))
                                        vExistencia = reader3.Item(0).ToString
                                        vExistencia = Val(vExistencia) - Val(CANT)
                                    End While
                                    If vExistencia = "" Then vExistencia = "1"
                                    reader3.Close()
                                    ''--------existe almacen
                                    Dim vExistAlm As String = "0"
                                    Dim rederExistAlm As SqlDataReader
                                    If UCase(camplib34) = "GDL" Then
                                        sqllocal = "SELECT EXIST FROM MULT" + pNUMEMP.ToString +
                                        " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM='104'"
                                    Else
                                        sqllocal = "SELECT EXIST FROM MULT" + pNUMEMP.ToString +
                                        " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM='1'"
                                    End If
                                    LabelTABLA.Text = "Q30s_MULT"
                                    TextBox1.Text = "REmp26:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    rederExistAlm = cmd.ExecuteReader()
                                    While rederExistAlm.Read
                                        vExistAlm = rederExistAlm.Item(0).ToString
                                        vExistAlm = Val(vExistAlm) - CANT
                                    End While
                                    If vExistAlm = "" Then vExistAlm = "1"
                                    rederExistAlm.Close()
                                    '-----------------------------------------------
                                    '-------------traer tipo de producto y unida de medida
                                    Dim vUM As String = ""
                                    Dim vTip_Art As String = ""
                                    Dim reader321 As SqlDataReader
                                    sqllocal = "Select UNI_MED, TIPO_ELE, COSTO_PROM from INVE" + pNUMEMP.ToString + " where CVE_ART = '" + CVE_ART + "'"
                                    LabelTABLA.Text = "Q31s_INVE"
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    reader321 = cmd.ExecuteReader()
                                    While reader321.Read()
                                        vUM = reader321.Item(0).ToString
                                        vTip_Art = reader321.Item(1).ToString
                                        COST = reader321.Item(2).ToString
                                    End While
                                    reader321.Close()
                                    'TextError.Text = "SALE1"
                                    sqllocal = "INSERT INTO MINVE" + pNUMEMP.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXIST_G, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, COSTO_PROM_GRAL, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                    "'R','" + pcvedoc + "','" + CVE_CLPV + "','" + VEND + "','" + CANT + "','" +
                                    "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                                    "'" + REG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + vExistAlm + "',NULL,'" +
                                    "1','" + time.ToString("yyyy/MM/dd") + "','','" + CVE_FOLIO + "','-1','" +
                                    "S','" + COST + "','" + COST + "','" + COST + "','N','0')"
                                    LabelTABLA.Text = "Q32i_MINVE"
                                    TextBox1.Text = "REmp27:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    'sqllocal = "INSERT INTO OMINVE" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                                    'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    'cmd.ExecuteNonQuery()
                                    Dim VERSION_SINC As String
                                    VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                    'TextError.Text = "SALE2"
                                    sqllocal = "UPDATE MULT" + pNUMEMP.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" +
                                    " WHERE CVE_ART = '" + CVE_ART + "'" +
                                    " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
                                    LabelTABLA.Text = "Q33u_MULT"
                                    TextBox1.Text = "REmp28:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    'TextError.Text = "SALE3"
                                    time = Today.Now
                                    sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                                   " COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                                   "VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" +
                                   " WHERE CVE_ART ='" + CVE_ART + "'"
                                    LabelTABLA.Text = "Q34u_INVE"
                                    TextBox1.Text = "REmp29:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    'TextError.Text = "SALE4"
                                    sqllocal = "UPDATE MINVE" + pNUMEMP.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " +
                                    " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" +
                                    " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
                                    LabelTABLA.Text = "Q35u_MINVE"
                                    TextBox1.Text = "REmp30:" + OrdenVenta + ":" + Str1
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                End If
                                If Len(DESC1) > 0 And Len(DESC2) > 0 And Len(DESC3) > 0 Then
                                    vlFlagDesc = 1
                                    vlFlagDescVerify = 1
                                    vlFlagDesc2 = 1
                                    vlFlagDescVerify2 = 1
                                    vlFlagDesc3 = 1
                                    vlFlagDescVerify3 = 1
                                ElseIf Len(DESC1) > 0 And Len(DESC2) > 0 Then
                                    vlFlagDesc = 1
                                    vlFlagDescVerify = 1
                                    vlFlagDesc2 = 1
                                    vlFlagDescVerify2 = 1
                                ElseIf Len(DESC1) > 0 Then
                                    vlFlagDesc = 1
                                    vlFlagDescVerify = 1
                                ElseIf Len(DESC2) > 0 Then
                                    vlFlagDesc2 = 1
                                    vlFlagDescVerify2 = 1
                                ElseIf Len(DESC3) > 0 Then
                                    vlFlagDesc3 = 1
                                    vlFlagDescVerify3 = 1
                                Else
                                    vlFlagDesc = 0
                                End If

                                If vlFlagDesc = 1 And vlFlagDesc2 = 1 And vlFlagDesc3 = 1 Then
                                    descuentoPart = Convert.ToDouble(DESC1) / 100    '.10
                                    descuentoPart2 = Convert.ToDouble(DESC2) / 100   '.10
                                    descuentoPart3 = Convert.ToDouble(DESC3) / 100   '.10
                                    descuentoPartMoney = (PREC * CANT) * descuentoPart '1000*1*.10=100
                                    descuentoPartMoney2 = ((PREC * CANT) - descuentoPartMoney) * descuentoPart2 '1000*1-100=900*.10=90
                                    descuentoPartMoney3 = ((PREC * CANT) - (descuentoPartMoney + descuentoPartMoney2)) * descuentoPart3 '1000*1-190=810*.10=81
                                    descPartMoneyTot = descuentoPartMoney + descuentoPartMoney2 + descuentoPartMoney3 '100+90+81=271

                                    vlsubtotPart = (PREC * CANT) - descPartMoneyTot '1000*1-271=729
                                    vlsubtotalConDesc = vlsubtotalConDesc + vlsubtotPart '0+729
                                    vlsubtotal = vlsubtotal + (PREC * CANT) '1000*1
                                    vlFlagDesc = 0
                                    vlFlagDesc2 = 0
                                    vlFlagDesc3 = 0
                                ElseIf vlFlagDesc = 1 And vlFlagDesc2 = 1 Then
                                    descuentoPart = Convert.ToDouble(DESC1) / 100
                                    descuentoPart2 = Convert.ToDouble(DESC2) / 100
                                    descuentoPartMoney = (PREC * CANT) * descuentoPart
                                    descuentoPartMoney2 = ((PREC * CANT) - descuentoPartMoney) * descuentoPart2
                                    descPartMoneyTot = descuentoPartMoney + descuentoPartMoney2

                                    vlsubtotPart = (PREC * CANT) - descPartMoneyTot
                                    vlsubtotalConDesc = vlsubtotalConDesc + vlsubtotPart
                                    vlsubtotal = vlsubtotal + (PREC * CANT)
                                    vlFlagDesc = 0
                                    vlFlagDesc2 = 0
                                ElseIf vlFlagDesc = 1 Then
                                    descuentoPart = Convert.ToDouble(DESC1) / 100
                                    descuentoPartMoney = (PREC * CANT) * descuentoPart
                                    descPartMoneyTot = descuentoPartMoney
                                    vlsubtotPart = (PREC * CANT) - descuentoPartMoney
                                    vlsubtotalConDesc = vlsubtotalConDesc + vlsubtotPart
                                    vlsubtotal = vlsubtotal + (PREC * CANT)
                                    vlFlagDesc = 0
                                ElseIf vlFlagDesc2 = 1 Then
                                    descuentoPart2 = Convert.ToDouble(DESC2) / 100
                                    descuentoPartMoney2 = (PREC * CANT) * descuentoPart2
                                    descPartMoneyTot2 = descuentoPartMoney2
                                    vlsubtotPart = (PREC * CANT) - descuentoPartMoney2
                                    vlsubtotalConDesc = vlsubtotalConDesc + vlsubtotPart
                                    vlsubtotal = vlsubtotal + (PREC * CANT)
                                    vlFlagDesc2 = 0
                                ElseIf vlFlagDesc3 = 1 Then
                                    descuentoPart3 = Convert.ToDouble(DESC3) / 100
                                    descuentoPartMoney3 = (PREC * CANT) * descuentoPart3
                                    descPartMoneyTot3 = descuentoPartMoney3
                                    vlsubtotPart = (PREC * CANT) - descuentoPartMoney3
                                    vlsubtotalConDesc = vlsubtotalConDesc + vlsubtotPart
                                    vlsubtotal = vlsubtotal + (PREC * CANT)
                                    vlFlagDesc3 = 0
                                Else
                                    vlsubtotalConDesc = vlsubtotalConDesc + (PREC * CANT)
                                    vlsubtotal = vlsubtotal + (PREC * CANT)
                                End If
                                '////////////////////////actualizar datos/////////////////////
                            End While
                            reader2.Close()
                            RCOMI = Round(RCOMI, 2)
                            'Format(x, "0.00") 
                            'sqllocal = "update AFACT" + pNUMEMP.ToString + " set  RCOMI=RCOMI+'" + RCOMI.ToString + "'" + _
                            '" where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                            'TextBox1.Text = "REmp21:" + OrdenVenta + ":" + Str1
                            'Me.Refresh()
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            'poner fecha actual
                            sqllocal = "UPDATE FOLIOSF" + pNUMEMP.ToString + " SET ULT_DOC = ULT_DOC + 1, FECH_ULT_DOC = '" + vfechayhora.ToString("yyyy/MM/dd") + "'" +
                                " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + pNUMEMP.ToString + " WHERE TIP_DOC='R')"
                            LabelTABLA.Text = "Q36u_FOLIOSF"
                            TextBox1.Text = "REmp31:" + OrdenVenta + ":" + Str1
                            Me.Refresh()
                            '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            Dim verifcardato As Integer = 0
                            If Len(DES_TOT_PORC) > 0 Then
                                verifcardato = Convert.ToInt32(DES_TOT_PORC)
                            End If
                            Dim iva As Double = 0
                            Dim vImporte As Double = 0
                            Dim vsubtotDesc As Double = 0
                            If vlFlagDescVerify = 1 And vlFlagDescVerify2 = 1 And vlFlagDescVerify3 = 1 Then
                                CAN_TOT = vlsubtotal.ToString '1000
                                comision = (Convert.ToDouble(COM_TOT_PORC) / 100) * (Convert.ToDouble(CAN_TOT)) '.06*1000=
                                comision = Round(comision, 2)
                                vlFlagDescVerify = 0
                                vlFlagDescVerify2 = 0
                                vlFlagDescVerify3 = 0
                                iva = vlsubtotalConDesc * 0.16 '1455.71*.16=232.92
                                IMP_TOT4 = iva.ToString
                                If Len(IMP_TOT4) >= 1 Then
                                    Dim Resul As Decimal = Convert.ToDecimal(IMP_TOT4)
                                    'IMP_TOT4 = FormatNumber(Resul, 2)
                                    IMP_TOT4 = Resul.ToString("##########.##")
                                End If
                                vImporte = Math.Round((vlsubtotalConDesc + iva), 5)
                                vImporte = Round(vImporte, 2)
                                sqllocal = "update AFACT" + pNUMEMP.ToString + " set  RCOMI=RCOMI+'" + RCOMI.ToString + "', RDESCTO=RDESCTO+'" + descPartMoneyTot.ToString + "'" +
                                            " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                                LabelTABLA.Text = "Q37u_AFACT"
                                TextBox1.Text = "REmp21:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                            ElseIf verifcardato > 0 And vlFlagDescVerify = 1 And vlFlagDescVerify2 = 0 And vlFlagDescVerify3 = 0 Then
                                CAN_TOT = vlsubtotal.ToString
                                'DES_FIN_PORC,  DES_TOT_PORC
                                descuento = ((Convert.ToDouble(DES_TOT_PORC) / 100)) * (Convert.ToDouble(CAN_TOT))
                                vsubtotDesc = Convert.ToDouble(CAN_TOT) - descuento
                                vsubtotDesc = Round(vsubtotDesc, 2)
                                comision = ((Convert.ToDouble(COM_TOT_PORC) / 100)) * (vsubtotDesc)
                                comision = Round(comision, 2)
                                iva = vsubtotDesc * 0.16
                                IMP_TOT4 = iva.ToString
                                If Len(IMP_TOT4) >= 1 Then
                                    Dim Resul As Decimal = Convert.ToDecimal(IMP_TOT4)
                                    'IMP_TOT4 = FormatNumber(Resul, 2)
                                    IMP_TOT4 = Resul.ToString("##########.##")
                                End If
                                vImporte = Math.Round((vsubtotDesc + iva), 5)
                                vImporte = Round(vImporte, 2)
                                sqllocal = "update AFACT" + pNUMEMP.ToString + " set  RCOMI=RCOMI+'" + RCOMI.ToString + "', RDESCTO=RDESCTO+'" + descuento.ToString + "'" +
                                            " where   (MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                                LabelTABLA.Text = "Q38u_AFACT"
                                TextBox1.Text = "REmp21:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                            Else
                                CAN_TOT = vlsubtotal.ToString
                                comision = (Convert.ToDouble(COM_TOT_PORC) / 100) * (Convert.ToDouble(CAN_TOT))
                                comision = Round(comision, 2)
                                iva = Convert.ToDouble(CAN_TOT) * 0.16
                                IMP_TOT4 = iva.ToString
                                If Len(IMP_TOT4) >= 1 Then
                                    Dim Resul As Decimal = Convert.ToDecimal(IMP_TOT4)
                                    'IMP_TOT4 = FormatNumber(Resul, 2)
                                    IMP_TOT4 = Resul.ToString("##########.00")
                                End If
                                vImporte = Math.Round((vlsubtotal + iva), 5)
                                vImporte = Round(vImporte, 2)
                                sqllocal = "update AFACT" + pNUMEMP.ToString + " set  RCOMI=RCOMI+'" + RCOMI.ToString + "'" +
                                        " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                                LabelTABLA.Text = "Q39u_AFACT"
                                TextBox1.Text = "REmp21:" + OrdenVenta + ":" + Str1
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                            End If
                            sqllocal = "INSERT INTO BITA" + pNUMEMP.ToString +
                            "(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" +
                            " VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + vImporte.ToString + "', 'F', 'Administrador')"
                            LabelTABLA.Text = "Q40i_BITA"
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            If vlFlagDescVerify = 1 Then
                                sqllocal = "UPDATE FACTR" + pNUMEMP.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
                               " ,CAN_TOT='" + CAN_TOT + "', IMP_TOT4 = '" + IMP_TOT4 + "', IMPORTE='" + vImporte.ToString + "', DES_TOT='" + descPartMoneyTot.ToString + "', COM_TOT='" + comision.ToString + "'" +
                               " WHERE CVE_DOC = '" + vCveDoc + "'"
                            ElseIf verifcardato > 0 Then
                                sqllocal = "UPDATE FACTR" + pNUMEMP.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
                               " ,CAN_TOT='" + CAN_TOT + "', IMP_TOT4 = '" + IMP_TOT4 + "', IMPORTE='" + vImporte.ToString + "', DES_TOT='" + descuento.ToString + "', COM_TOT='" + comision.ToString + "'" +
                               " WHERE CVE_DOC = '" + vCveDoc + "'"
                            Else
                                sqllocal = "UPDATE FACTR" + pNUMEMP.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
                                " ,CAN_TOT='" + CAN_TOT + "', IMP_TOT4 = '" + IMP_TOT4 + "', IMPORTE='" + vImporte.ToString + "', COM_TOT='" + comision.ToString + "'" +
                                " WHERE CVE_DOC = '" + vCveDoc + "'"
                            End If
                            LabelTABLA.Text = "Q41u_FACTR"
                            TextBox1.Text = "REmp32:" + OrdenVenta + ":" + Str1
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '------------------------ poner el estado T o P campo enlazado en pedido para poder cancelar
                            'sqllocal = "UPDATE FACTP" + pNUMEMP.ToString + " SET ULT_DOC =ENLAZADO FROM TBLCONTROL" + pNUMEMP.ToString + " tt WHERE tt.ID_TABLA = 44"
                            'cmd = New SqlCommand(sqllocal, conn)
                            'cmd.ExecuteNonQuery()
                            '--------------------------------------------------------------------
                            objTrans.Commit()
                            OK = 1
                            empresa = MI_BD_x.ToString
                            documento = pcvedoc.ToString
                            mensaje = "Registro de Remision Correcta:" + pcvedoc.ToString + " del Pedido:" + OrdenVenta.ToString
                            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            LabelTABLA.Text = "Q42i_Logistik_log"
                            TextBox1.Text = "REmp33:" + OrdenVenta + ":" + Str1
                            Me.Refresh()
                            '------------------------
                        End If
                    Else
                        Exit For
                    End If
                Next
                OrdenVenta = Val(OrdenVenta)
                OrdenVenta = espacios(OrdenVenta, 20)
                'If OK = 1 Then
                Dim sql As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state='9'" +
                    " WHERE id_order = '" + OrdenVenta + "' and num_empresa='" + pNUMEMP.Trim + "'"
                TextBox1.Text = "REmp34:" + OrdenVenta + ":" + Str1
                Me.Refresh()
                EjecutarQuerySQL_EMPRESA_X(sql, "LogistikMasterValvulerias06")
                LabelTABLA.Text = "Q43u_Logistik_orders"
                Me.Refresh()
                'Else
                'Dim sql As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state='62'" +
                '   " WHERE id_order = '" + OrdenVenta + "' and num_empresa='" + pNUMEMP.Trim + "'"
                'TextBox1.Text = "REmp34:" + OrdenVenta + ":" + Str1
                'Me.Refresh()
                'EjecutarQuerySQL_EMPRESA_X(sql, "LogistikMasterValvulerias06")
                'End If
            Next
            'MsgBox("Almacenado correctamente")
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = " Favor de realizar manualmente la remision en SAE" + CVE_DOC.ToString + " Tabla:" + LabelTABLA.Text
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','62')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            'TextBox1.Text = "REmp35:"
            'Me.Refresh()
            Dim sql11 As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state = '62'" +
                    " WHERE id_order = '" + OrdenVenta + "' and num_empresa='" + pNUMEMP + "'"
            EjecutarQuerySQL_EMPRESA_X(sql11, "LogistikMasterValvulerias06")
            objTrans.Rollback()
            Throw es
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = " Favor de realizar manualmente la remision en SAE" + CVE_DOC.ToString + " Tabla:" + LabelTABLA.Text
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','62')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            'TextBox1.Text = "REmp36:"
            'Me.Refresh()
            Dim sql11 As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state = '62'" +
                    " WHERE id_order = '" + OrdenVenta + "' and num_empresa='" + pNUMEMP + "'"
            EjecutarQuerySQL_EMPRESA_X(sql11, "LogistikMasterValvulerias06")
            objTrans.Rollback()
            Throw ex
        End Try
    End Sub
    Function fVificarCant(ByVal pMiBD As String, ByVal pcvedoc As String, ByVal pNUMEMP As String) As Boolean
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim conn As New SqlConnection(Str)
        Dim readerOrders As SqlDataReader
        sqllocal = "SELECT od.quantity_received, od.product_quantity" +
        " FROM Logistik_order_detail as od WHERE TRIM(od.id_order) ='" + pcvedoc.Trim + "' and num_empresa='" + pNUMEMP + "'" +
        " and od.quantity_received>0"
        cmd = New SqlCommand(sqllocal, conn)
        If conn.State = ConnectionState.Closed Then
            conn.Open()
        End If
        readerOrders = cmd.ExecuteReader()
        Dim cant1 As Double
        Dim Cant2 As Double
        While readerOrders.Read()
            cant1 = readerOrders.Item(0)
            Cant2 = readerOrders.Item(1)
            If cant1 <> Cant2 Then
                Return False
            End If
        End While
        Return True
    End Function
    Private Sub RemisionesDatalleSAE(ByVal pcvedoc As String, ByVal pObser As String, ByVal pcve_doc_origen As String, ByVal VEND As String)
        'envia datos al sae
        Dim SqlSelection As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=PASS;"
            Dim conn As New SqlConnection(Str)
            Dim CVE_DOC As String
            Dim NUM_PAR As String
            Dim CVE_ART As String
            Dim CANT As String
            Dim PXS As String
            Dim PREC As String
            Dim COST As String
            Dim IMPU1 As String
            Dim IMPU2 As String
            Dim IMPU3 As String
            Dim IMPU4 As String
            Dim IMP1APLA As String
            Dim IMP2APLA As String
            Dim IMP3APLA As String
            Dim IMP4APLA As String
            Dim TOTIMP1 As String
            Dim TOTIMP2 As String
            Dim TOTIMP3 As String
            Dim TOTIMP4 As String
            Dim DESC1 As String
            Dim DESC2 As String
            Dim DESC3 As String
            Dim COMI As String
            Dim APAR As String
            Dim ACT_INV As String
            Dim NUM_ALM As String
            Dim POLIT_APLI As String
            Dim TIP_CAM As String
            Dim UNI_VENTA As String
            Dim TIPO_PROD As String
            Dim CVE_OBS As String
            Dim REG_SERIE As String
            Dim E_LTPD As String
            Dim TIPO_ELEM As String
            Dim NUM_MOV As String
            Dim TOT_PARTIDA As String
            Dim IMPRIMIR As String
            Dim reader2 As SqlDataReader
            SqlSelection = "SELECT CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
            ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
            ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
            ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" +
             " FROM PAR_FACTP" + vgNumEmpresa.ToString + " where CVE_DOC = '" + pcve_doc_origen + "'"
            cmd = New SqlCommand(SqlSelection, connSAE, objTrans)
            reader2 = cmd.ExecuteReader()
            While reader2.Read()
                'MsgBox(reader2.Item(0))
                CVE_DOC = reader2.Item(0).ToString
                NUM_PAR = reader2.Item(1).ToString
                CVE_ART = reader2.Item(2).ToString
                CANT = "0" 'reader2.Item(3).ToString
                PXS = reader2.Item(4).ToString
                PREC = reader2.Item(5).ToString
                COST = reader2.Item(6).ToString
                IMPU1 = reader2.Item(7).ToString
                IMPU2 = reader2.Item(8).ToString
                IMPU3 = reader2.Item(9).ToString

                IMPU4 = reader2.Item(10).ToString
                IMP1APLA = reader2.Item(11).ToString
                IMP2APLA = reader2.Item(12).ToString
                IMP3APLA = reader2.Item(13).ToString
                IMP4APLA = reader2.Item(14).ToString
                TOTIMP1 = reader2.Item(15).ToString
                TOTIMP2 = reader2.Item(16).ToString
                TOTIMP3 = reader2.Item(17).ToString
                TOTIMP4 = reader2.Item(18).ToString
                DESC1 = reader2.Item(19).ToString

                DESC2 = reader2.Item(20).ToString
                DESC3 = reader2.Item(21).ToString
                COMI = reader2.Item(22).ToString
                APAR = reader2.Item(23).ToString
                ACT_INV = reader2.Item(24).ToString
                NUM_ALM = reader2.Item(25).ToString
                POLIT_APLI = reader2.Item(26).ToString
                TIP_CAM = reader2.Item(27).ToString
                UNI_VENTA = reader2.Item(28).ToString
                TIPO_PROD = reader2.Item(29).ToString

                CVE_OBS = reader2.Item(30).ToString
                REG_SERIE = reader2.Item(31).ToString
                E_LTPD = reader2.Item(32).ToString
                TIPO_ELEM = reader2.Item(33).ToString
                NUM_MOV = reader2.Item(34).ToString
                TOT_PARTIDA = reader2.Item(35).ToString
                IMPRIMIR = reader2.Item(36).ToString
                '-------------------Traer la clave siguiente
                'CVE_OBS = TraerClaveSiguiente()
                Dim vcont As String = ""
                Dim vnum As Integer
                Dim reader As SqlDataReader
                Dim Sql As String = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCF" + vgNumEmpresa.ToString
                cmd = New SqlCommand(Sql, connSAE, objTrans)
                reader = cmd.ExecuteReader()
                While reader.Read()
                    'MsgBox(reader.Item(0))
                    vcont = reader.Item(0).ToString
                    vcont = Val(vcont) + 1
                End While
                If vcont = "" Then vcont = "1"
                CVE_OBS = vcont
                reader.Close()
                '-------------------------------------------
                sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                '---------------------crear el o los movimientos
                'Dim vNum_Mov As String = ConsecutivoMovimiento()
                Dim vNum_Mov As String
                Dim vcont7 As String = ""
                Dim reader7 As SqlDataReader
                Sql = "Select ISNULL(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
                cmd = New SqlCommand(Sql, connSAE, objTrans)
                reader7 = cmd.ExecuteReader()
                While reader7.Read()
                    'MsgBox(reader7.Item(0))
                    vcont7 = reader7.Item(0).ToString
                    vcont7 = Val(vcont7) + 1
                End While
                If vcont7 = "" Then vcont7 = "1"
                vNum_Mov = vcont7
                reader7.Close()
                '----------traer la cantidad
                Dim readerPC As SqlDataReader
                SqlSelection = "select quantity_received from Logistik_order_detail" +
                " where id_order = '" + pcve_doc_origen + "' and product_upc = '" + CVE_ART + "'"
                conn.Open()
                cmd = New SqlCommand(SqlSelection, conn)
                readerPC = cmd.ExecuteReader()
                While readerPC.Read()
                    CANT = readerPC.Item(0).ToString
                End While
                conn.Close()
                readerPC.Close()
                '-------------------------------------------
                sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                "'" + pcvedoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT + "','" + PXS + "','" +
                PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                CVE_OBS + "','" + REG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                TOT_PARTIDA + "','" + POLIT_APLI + "')"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                'INSERTAR EL INDICE
                sqllocal = "insert into  PAR_FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR + "')"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                'actualizar detalle PAR_FACTP01
                sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString +
                " where CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                'actualizar ACUMULADOR de remisiones y facturas
                sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + '" + TOT_PARTIDA + "'," +
                " PIMP = PIMP + '" + TOTIMP4 + "'" +
                " where CVE_AFACT = '11'"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()

                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()

                'insertar documentos siguientes
                sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                "PARTIDA, PART_E, CANT_E) VALUES (" +
                "'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" +
                NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                "PARTIDA, PART_E, CANT_E) VALUES (" +
                "'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" +
                NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()

                sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
                '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                'actualizar las existencias
                'Call ActualizarExistencias(CVE_ART, CANT)
                sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - '" + CANT + "', FCH_ULTVTA='" + time.ToString("dd-MM-yyyy") + "'," +
                " PEND_SURT = PEND_SURT - '" + CANT + "', COSTO_PROM = '" + COST + "'," +
                " ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + '" + CANT + "', VTAS_ANL_M = VTAS_ANL_M + '" + TOT_PARTIDA + "'" +
                " WHERE CVE_ART ='" + CVE_ART + "'"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                '-----------------------------------------------
                'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                Dim vExistencia As String = ""
                Dim reader3 As SqlDataReader
                Sql = "Select ISNULL(max(EXIST),0) AS num from INVE" + vgNumEmpresa.ToString + " where CVE_ART = '" + CVE_ART + "'"
                cmd = New SqlCommand(Sql, connSAE, objTrans)
                reader3 = cmd.ExecuteReader()
                While reader3.Read()
                    'MsgBox(reader3.Item(0))
                    vExistencia = reader3.Item(0).ToString
                    'vExistencia = Val(vExistencia) - Val(CANT)
                End While
                If vExistencia = "" Then vExistencia = "1"
                reader3.Close()
                '-----------------------------------------------
                sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                "'" + CVE_ART + "','1','" + vNum_Mov + "','1','" + time.ToString("dd/MM/yyyy") + "'," +
                "'R','" + CVE_DOC + "','         1','" + VEND + "','" + CANT + "','" +
                "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                "'" + REG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                "1','" + time.ToString("dd/MM/yyyy") + "','','1','1','" +
                "S','0','" + COST + "','N','0')"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                cmd.ExecuteNonQuery()
            End While
            reader2.Close()

        Catch es As SqlException
            objTrans.Rollback()
            Throw es
        Catch ex As Exception
            '***** rollback the transaction ************************************************'
            objTrans.Rollback()
            MsgBox(ex.Message.ToString)
        End Try
    End Sub


#End Region
#Region "EnvioOrdenesdeCompraSAE"
    Private Sub LlevarOrdenesCompraSAE(ByVal pMiBD As String, ByVal pNUMEMP As String, ByVal OrdenCompra As String)
        If vgTipoBD = "S" Then
            Label5.Text = "Sincronizando Compras del SQL a SAE"
            Me.Refresh()
            Call Compras(pMiBD, pNUMEMP, OrdenCompra)
        Else
            Label5.Text = "Sincronizando Compras del Fire Bird a SAE"
            'Call LLEVARComprasFB()
            'LlevarComprasSAE_FB()
        End If
    End Sub
    'Private Sub LlevarComprasSAE_FB()
    '    'enviar compras al sae
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=PASS;MultipleActiveResultSets=true;"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        'EnviadaSAE = S
    '        'EnviadaSAE = N
    '        'sqllocal = "select lso.id_supply_order, lso.id_supply_order_state, lso.EnviadaSAE, lsod.quantity_received" + _
    '        '" from Logistik_supply_order as lso, Logistik_supply_order_detail as lsod" + _
    '        '" where lso.id_supply_order = lsod.id_supply_order" + _
    '        '" and lso.EnviadaSAE = 'N' and lso.id_supply_order_state = 5"
    '        sqllocal = "select id_supply_order, id_supply_order_state, doc_sig_sae from Logistik_supply_order where EnviadaSAE = 'N' and id_supply_order_state in (5,6)"
    '        Dim daPC As New SqlDataAdapter(sqllocal, conn)
    '        Dim dsPC As New DataSet
    '        daPC.Fill(dsPC, "Logistik_supply_order")
    '        Dim oTablePC As New DataTable
    '        oTablePC = dsPC.Tables("Logistik_supply_order")
    '        Dim OrdenCompra As String
    '        Dim RecepcionCompra As String
    '        Dim vEstatus As String
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        For Each oRowPC In oTablePC.Rows
    '            OrdenCompra = oRowPC.Item("id_supply_order").ToString
    '            RecepcionCompra = oRowPC.Item("doc_sig_sae").ToString
    '            vEstatus = oRowPC.Item("id_supply_order_state").ToString
    '            '----------------buscar configuracion DE LA ORDEN DE COMPRA
    '            Dim reader As FbDataReader
    '            Dim vlConf_Cve_Doc As Integer = Nothing
    '            Dim SqlSelection As String = "Select MASCARA from PARAM_FOLIOSC" + vgNumEmpresa.ToString + _
    '            " where NUM_EMP = '1' AND TIPODOCTO = 'O'"
    '            cmdFB = New FbCommand(SqlSelection, connFB)
    '            reader = cmdFB.ExecuteReader()
    '            While reader.Read()
    '                'MsgBox(reader.Item(0))
    '                vlConf_Cve_Doc = Trim(reader.Item(0).ToString)
    '                Exit While
    '            End While
    '            reader.Close()
    '            If vlConf_Cve_Doc <> 0 And vlConf_Cve_Doc <> 1 And vlConf_Cve_Doc <> 2 Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            If vlConf_Cve_Doc = 0 Then OrdenCompra = Trim(OrdenCompra)
    '            If vlConf_Cve_Doc = 1 Then
    '                'agregar ceros
    '                OrdenCompra = ceros(OrdenCompra, 10)
    '                'agregar espacios
    '                OrdenCompra = espacios(OrdenCompra, 20)
    '            End If
    '            If vlConf_Cve_Doc = 2 Then OrdenCompra = espacios(OrdenCompra, 20)
    '            sqllocal = "select TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," + _
    '            "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," + _
    '            "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," + _
    '            "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," + _
    '            "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," + _
    '            "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG from COMPO" + vgNumEmpresa.ToString + _
    '            " WHERE CVE_DOC = '" & OrdenCompra & "'"
    '            '" WHERE ENLAZADO='O' and TIP_DOC_E = 'O'"
    '            Dim da As New FbDataAdapter(sqllocal, connFB)
    '            Dim ds As New DataSet
    '            da.Fill(ds, "COMPO" & vgNumEmpresa.ToString)
    '            Dim oTable As New DataTable
    '            oTable = ds.Tables("COMPO" & vgNumEmpresa.ToString)
    '            '----------------buscar configuracion DE LA RECEPCION
    '            Dim reader33 As FbDataReader
    '            'Dim vlConf_Cve_Doc As Integer = Nothing
    '            SqlSelection = "Select MASCARA from PARAM_FOLIOSC" + vgNumEmpresa.ToString + _
    '            " where NUM_EMP = '1' AND TIPODOCTO = 'R'"
    '            cmdFB = New FbCommand(SqlSelection, connFB)
    '            reader33 = cmdFB.ExecuteReader()
    '            While reader33.Read()
    '                'MsgBox(reader.Item(0))
    '                vlConf_Cve_Doc = Trim(reader33.Item(0).ToString)
    '                Exit While
    '            End While
    '            reader33.Close()
    '            If vlConf_Cve_Doc <> 0 And vlConf_Cve_Doc <> 1 And vlConf_Cve_Doc <> 2 Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            If vlConf_Cve_Doc = 0 Then OrdenCompra = Trim(OrdenCompra)
    '            If vlConf_Cve_Doc = 1 Then
    '                'agregar ceros
    '                OrdenCompra = ceros(OrdenCompra, 10)
    '                'agregar espacios
    '                OrdenCompra = espacios(OrdenCompra, 20)
    '            End If
    '            If vlConf_Cve_Doc = 2 Then OrdenCompra = espacios(OrdenCompra, 20)
    '            Dim TIP_DOC As String
    '            Dim CVE_DOC As String
    '            Dim CVE_CLPV As String
    '            Dim STATUS As String
    '            Dim SU_REFER As String
    '            Dim FECHA_DOC As String
    '            Dim FECHA_REC As String
    '            Dim FECHA_PAG As String
    '            Dim FECHA_CANCELA As String
    '            Dim CAN_TOT As Double
    '            Dim IMP_TOT1 As String
    '            Dim IMP_TOT2 As String
    '            Dim IMP_TOT3 As String
    '            Dim IMP_TOT4 As String
    '            Dim DES_TOT As String
    '            Dim DES_FIN As String
    '            Dim TOT_IND As String
    '            Dim OBS_COND As String
    '            Dim CVE_OBS As String
    '            Dim NUM_ALMA As String
    '            Dim ACT_CXP As String
    '            Dim ACT_COI As String
    '            Dim NUM_MONED As String
    '            Dim TIPCAMB As String
    '            Dim ENLAZADO As String
    '            Dim TIP_DOC_E As String
    '            Dim NUM_PAGOS As String
    '            Dim FECHAELAB As String
    '            Dim SERIE As String
    '            Dim FOLIO As String
    '            Dim CTLPOL As String
    '            Dim ESCFD As String
    '            Dim CONTADO As String
    '            Dim BLOQ As String
    '            Dim DES_FIN_PORC As String
    '            Dim DES_TOT_PORC As String
    '            Dim IMPORTE As String
    '            Dim TIP_DOC_ANT As String
    '            Dim DOC_ANT As String
    '            Dim TIP_DOC_SIG As String
    '            Dim DOC_SIG As String
    '            Dim SigCveDoc As String
    '            Dim vCveDoc As String = ""
    '            If oTable.Rows.Count >= 1 Then
    '                '---------------------------------------
    '                objTransFB = connFB.BeginTransaction
    '                '--------------------------------------
    '                For Each oRow In oTable.Rows
    '                    TIP_DOC = "r"
    '                    'SigCveDoc = TraerCveDocSigRecep()
    '                    'CVE_DOC = SigCveDoc
    '                    CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
    '                    STATUS = oRow.Item("STATUS").ToString
    '                    SU_REFER = oRow.Item("SU_REFER").ToString
    '                    FECHA_DOC = oRow.Item("FECHA_DOC").ToString
    '                    If FECHA_DOC <> "" Then
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd")
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy-MM-dd hh:mm:ss.mmm")
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
    '                        'Dim vfecha As Date = FECHA_DOC
    '                        'FECHA_DOC = Format(vfecha, "dd/MM/yyyy")
    '                    End If
    '                    FECHA_REC = time
    '                    FECHA_REC = Convert.ToDateTime(time).ToString("yyyy/MM/dd")
    '                    'FECHA_REC = oRow.Item("FECHA_REC").ToString
    '                    'If FECHA_REC <> "" Then
    '                    '    'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                    '    FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("yyyy/MM/dd")
    '                    '    'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("dd/MM/yyyy hh:mm:ss")
    '                    '    'Dim vfecha As Date = FECHA_REC
    '                    '    'FECHA_REC = Format(vfecha, "dd/MM/yyyy")
    '                    'End If
    '                    FECHA_PAG = oRow.Item("FECHA_PAG").ToString
    '                    If FECHA_PAG <> "" Then
    '                        'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("yyyy/MM/dd")
    '                        'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("dd/MM/yyyy hh:mm:ss")
    '                        'Dim vfecha As Date = FECHA_PAG
    '                        'FECHA_PAG = Format(vfecha, "dd/MM/yyyy")
    '                    End If
    '                    FECHA_CANCELA = oRow.Item("FECHA_CANCELA").ToString
    '                    If FECHA_CANCELA <> "" Then
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd")
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("dd/MM/yyyy hh:mm:ss")
    '                        'Dim vfecha As Date = FECHA_CANCELA
    '                        'FECHA_CANCELA = Format(vfecha, "dd/MM/yyyy")
    '                    Else
    '                        FECHA_CANCELA = time.ToString("yyyy/MM/dd")
    '                    End If
    '                    CAN_TOT = Convert.ToDouble(oRow.Item("CAN_TOT"))
    '                    IMP_TOT1 = oRow.Item("IMP_TOT1").ToString
    '                    IMP_TOT2 = oRow.Item("IMP_TOT2").ToString
    '                    IMP_TOT3 = oRow.Item("IMP_TOT3").ToString
    '                    IMP_TOT4 = oRow.Item("IMP_TOT4").ToString
    '                    DES_TOT = oRow.Item("DES_TOT").ToString
    '                    DES_FIN = oRow.Item("DES_FIN").ToString
    '                    TOT_IND = oRow.Item("TOT_IND").ToString
    '                    OBS_COND = oRow.Item("OBS_COND").ToString
    '                    CVE_OBS = oRow.Item("CVE_OBS").ToString
    '                    NUM_ALMA = oRow.Item("NUM_ALMA").ToString
    '                    ACT_CXP = oRow.Item("ACT_CXP").ToString
    '                    ACT_COI = oRow.Item("ACT_COI").ToString
    '                    NUM_MONED = oRow.Item("NUM_MONED").ToString
    '                    TIPCAMB = oRow.Item("TIPCAMB").ToString
    '                    ENLAZADO = oRow.Item("ENLAZADO").ToString
    '                    If Trim(vEstatus) = "6" Then
    '                        ENLAZADO = "P"
    '                    Else
    '                        ENLAZADO = "O"
    '                    End If
    '                    TIP_DOC_E = "r"
    '                    NUM_PAGOS = oRow.Item("NUM_PAGOS").ToString
    '                    If Val(NUM_PAGOS) < 1 Then
    '                        NUM_PAGOS = "0"
    '                    End If
    '                    FECHAELAB = vfechayhora
    '                    'FECHAELAB = oRow.Item("FECHAELAB").ToString
    '                    If FECHAELAB <> "" Then
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd hh:mm:ss")
    '                        'FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("dd/MM/yyyy hh:mm:ss")
    '                    End If
    '                    SERIE = oRow.Item("SERIE").ToString
    '                    FOLIO = oRow.Item("FOLIO").ToString
    '                    CTLPOL = oRow.Item("CTLPOL").ToString
    '                    ESCFD = oRow.Item("ESCFD").ToString
    '                    CONTADO = oRow.Item("CONTADO").ToString
    '                    BLOQ = oRow.Item("BLOQ").ToString
    '                    DES_FIN_PORC = oRow.Item("DES_FIN_PORC").ToString
    '                    DES_TOT_PORC = oRow.Item("DES_TOT_PORC").ToString
    '                    IMPORTE = oRow.Item("IMPORTE").ToString
    '                    TIP_DOC_ANT = "o"
    '                    DOC_ANT = CVE_DOC
    '                    TIP_DOC_SIG = Nothing
    '                    DOC_SIG = Nothing
    '                    '----------------buscar clave del documento
    '                    If vgEspecificarDoc = True Then
    '                        vCveDoc = (UCase(RecepcionCompra))
    '                    Else
    '                        '----------------buscar configuracion
    '                        Dim readerDoc As FbDataReader
    '                        Dim SqlSelection7 As String = "Select ULT_DOC from FOLIOSC" + vgNumEmpresa.ToString + _
    '                        " where TIP_DOC = 'r'"
    '                        cmdFB = New FbCommand(SqlSelection7, connFB, objTransFB)
    '                        readerDoc = cmdFB.ExecuteReader()
    '                        While readerDoc.Read()
    '                            'MsgBox(reader.Item(0))
    '                            vCveDoc = Trim(readerDoc.Item(0).ToString)
    '                            'no se si se aumenta el consecutivo
    '                            vCveDoc = Val(vCveDoc) + 1
    '                            Exit While
    '                        End While
    '                        readerDoc.Close()
    '                    End If
    '                    If vCveDoc <> "" Then
    '                        ''---------------------------------------
    '                        'objTrans = connSAE.BeginTransaction()
    '                        ''--------------------------------------
    '                        If vlConf_Cve_Doc = 0 Then
    '                            vCveDoc = Trim(vCveDoc)
    '                            '*********************************
    '                            DOC_ANT = Trim(DOC_ANT)
    '                        End If
    '                        If vlConf_Cve_Doc = 1 Then
    '                            vCveDoc = ceros(vCveDoc, 10)
    '                            vCveDoc = espacios(vCveDoc, 20)
    '                            '**********************************
    '                            DOC_ANT = ceros(DOC_ANT, 10)
    '                            DOC_ANT = espacios(DOC_ANT, 20)
    '                        End If
    '                        If vlConf_Cve_Doc = 2 Then
    '                            vCveDoc = espacios(vCveDoc, 20)
    '                            '**********************************
    '                            DOC_ANT = espacios(DOC_ANT, 20)
    '                        End If
    '                        'If DAT_MOSTR = "" Then DAT_MOSTR = "0"
    '                        'If CAN_TOT = 0 Then CAN_TOT = 0
    '                        If IMP_TOT1 = "" Then IMP_TOT1 = "0"
    '                        If IMP_TOT2 = "" Then IMP_TOT2 = "0"
    '                        If IMP_TOT3 = "" Then IMP_TOT3 = "0"
    '                        If IMP_TOT4 = "" Then IMP_TOT4 = "0"
    '                        If DES_TOT = "" Then DES_TOT = "0"
    '                        If DES_FIN = "" Then DES_FIN = "0"
    '                        If TOT_IND = "" Then TOT_IND = "0"
    '                        If CVE_OBS = "" Then CVE_OBS = "0"
    '                        If NUM_ALMA = "" Then NUM_ALMA = "1"
    '                        If NUM_MONED = "" Then NUM_MONED = "1"
    '                        If TIPCAMB = "" Then TIPCAMB = "0"
    '                        If NUM_PAGOS = "" Then NUM_PAGOS = "0"
    '                        If FOLIO = "" Then FOLIO = "0"
    '                        If CTLPOL = "" Then CTLPOL = "0"
    '                        'If AUTORIZA = "" Then AUTORIZA = "0"
    '                        If FOLIO = "" Then FOLIO = "0"
    '                        'If DAT_ENVIO = "" Then DAT_ENVIO = "0"
    '                        'If CVE_BITA = "" Then CVE_BITA = "0"
    '                        If DES_FIN_PORC = "" Then DES_FIN_PORC = "0"
    '                        If DES_TOT_PORC = "" Then DES_TOT_PORC = "0"
    '                        If IMPORTE = "" Then IMPORTE = "0"
    '                        'If COM_TOT_PORC = "" Then COM_TOT_PORC = "0"
    '                        Dim vfolio As String = "0" 'vCveDoc
    '                        sqllocal = "insert into  COMPR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," + _
    '                        "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," + _
    '                        "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," + _
    '                        "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," + _
    '                        "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," + _
    '                        "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG) values (" + _
    '                        "'r','" + vCveDoc.ToString + "','" + CVE_CLPV + "','" + STATUS + "','" + SU_REFER + "','" + FECHA_DOC + "','" + FECHA_REC + "','" + _
    '                        FECHA_PAG + "','" + FECHA_CANCELA + "','" + CAN_TOT.ToString + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + IMP_TOT4 + "','" + _
    '                        DES_TOT + "','" + DES_FIN + "','" + TOT_IND + "','" + OBS_COND + "','" + CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXP + "','" + _
    '                        ACT_COI + "','" + NUM_MONED + "','" + TIPCAMB + "','" + ENLAZADO + "','o','" + NUM_PAGOS + "','" + FECHAELAB + "','" + _
    '                        SERIE + "','" + vfolio.ToString + "','" + CTLPOL + "','" + ESCFD + "','" + CONTADO + "','" + BLOQ + "','" + DES_FIN_PORC + "','" + _
    '                        DES_TOT_PORC + "','" + IMPORTE + "','" + TIP_DOC_ANT + "','" + DOC_ANT.ToString + "',NULL,NULL)"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        sqllocal = "insert into  COMPR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC) values ('" + vCveDoc.ToString + "')"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'cmdFB.ExecuteNonQuery()
    '                        '---------------------
    '                        'Dim vCve_Obs As String = TraerClaveSiguiente()
    '                        Dim vCve_Obs As String
    '                        Dim vcont7 As String = ""
    '                        Dim reader7 As FbDataReader
    '                        sqllocal = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCC" + vgNumEmpresa.ToString
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        reader7 = cmdFB.ExecuteReader()
    '                        While reader7.Read()
    '                            'MsgBox(reader7.Item(0))
    '                            vcont7 = reader7.Item(0).ToString
    '                            vcont7 = Val(vcont7) + 1
    '                        End While
    '                        If vcont7 = "" Then vcont7 = "1"
    '                        vCve_Obs = vcont7
    '                        reader7.Close()
    '                        '-----------------------------------
    '                        Dim vObser As String = "Buenas O. C. HH"
    '                        'sqllocal = "INSERT INTO OBS_DOCC" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'cmdFB.ExecuteNonQuery()
    '                        'Call UpdateOC(CVE_DOC, vCveDoc)
    '                        If Trim(vEstatus) = "6" Then
    '                            sqllocal = "update COMPO" + vgNumEmpresa.ToString + " SET ENLAZADO='P', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc.ToString + "'" + _
    '                            " WHERE CVE_DOC ='" + CVE_DOC.ToString + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        Else
    '                            sqllocal = "update COMPO" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc.ToString + "'" + _
    '                            " WHERE CVE_DOC ='" + CVE_DOC.ToString + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                        '---------------------------------------
    '                        '----------realizar detalle de la compra
    '                        Dim vvArticulo As String
    '                        '----------------------------------------
    '                        Dim vfSubtot As Double
    '                        'vfSubtot = RecepcionDatalleSAEFB(vCveDoc, vObser, CVE_DOC, CVE_CLPV)
    '                        Dim pcvedoc As String = vCveDoc
    '                        Dim pObser As String = vObser
    '                        Dim pcve_doc_origen As String = CVE_DOC
    '                        Dim pcve_prov As String = CVE_CLPV
    '                        'variables del detalle
    '                        Dim NUM_PAR As String
    '                        Dim CVE_ART As String
    '                        Dim vlsubtotal As Double
    '                        Dim CANT As Double
    '                        Dim CANTp As Double
    '                        Dim PXR As String
    '                        Dim PREC As String
    '                        Dim COST As String
    '                        Dim IMPU1 As String
    '                        Dim IMPU2 As String
    '                        Dim IMPU3 As String
    '                        Dim IMPU4 As String
    '                        Dim IMP1APLA As String
    '                        Dim IMP2APLA As String
    '                        Dim IMP3APLA As String
    '                        Dim IMP4APLA As String
    '                        Dim TOTIMP1 As String
    '                        Dim TOTIMP2 As String
    '                        Dim TOTIMP3 As String
    '                        Dim TOTIMP4 As String
    '                        Dim DESCU As String
    '                        Dim ACT_INV As String
    '                        Dim TIP_CAM As String
    '                        Dim UNI_VENTA As String
    '                        Dim TIPO_ELEM As String
    '                        Dim TIPO_PROD As String
    '                        Dim REG_SERIE As String
    '                        Dim E_LTPD As String
    '                        Dim FACTCONV As String
    '                        Dim COST_DEV As String
    '                        Dim NUM_ALM As String
    '                        Dim MINDIRECTO As String
    '                        Dim NUM_MOV As String
    '                        Dim TOT_PARTIDA As String
    '                        '----------------------------------------------
    '                        '-----------------------------------------------
    '                        Dim readerLotesDet As SqlDataReader
    '                        SqlSelection = "select OD.UPC, od.quantity_received, LP.CVE_ART, LP.LOTE, LP.CANT_ENTRADA, LP.CVE_ALM, LP.PEDIMENTO, LP.FCHCADUC" + _
    '                        ",LP.FCHADUANA,LP.FCHULTMOV,LP.NOM_ADUAN,LP.CANTIDAD,LP.SALDO" + _
    '                        ",LP.CANT_ENTRADA,LP.CANT_SALIDA,LP.REG_LTPD,LP.CVE_OBS,LP.CIUDAD" + _
    '                        ",LP.FRONTERA,LP.FEC_PROD_LT,LP.GLN,LP.STATUS,LP.CVE_DOC" + _
    '                        ",LP.PARCIAL from Logistik_Lote_Pedimento LP RIGHT  JOIN Logistik_supply_order_detail OD " + _
    '                        " ON LP.CVE_ART = OD.upc AND LP.CVE_DOC = OD.id_supply_order" + _
    '                        " where OD.id_supply_order='" + Trim(pcve_doc_origen.ToString) + "'"

    '                        'SqlSelection = "select CVE_ART, LOTE, CANT_ENTRADA, CVE_ALM, PEDIMENTO, FCHCADUC" + _
    '                        '",FCHADUANA,FCHULTMOV,NOM_ADUAN,CANTIDAD,SALDO" + _
    '                        '",CANT_ENTRADA,CANT_SALIDA,REG_LTPD,CVE_OBS,CIUDAD" + _
    '                        '",FRONTERA,FEC_PROD_LT,GLN,STATUS,CVE_DOC" + _
    '                        '",PARCIAL from Logistik_Lote_Pedimento" + _
    '                        '" where CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "'"
    '                        Dim daLOTESDET As New SqlDataAdapter(SqlSelection, conn)
    '                        Dim dsLOTESDET As New DataSet
    '                        daLOTESDET.Fill(dsLOTESDET, "Lote_Pedimento")
    '                        Dim oTableLOTESDET As New DataTable
    '                        oTableLOTESDET = dsLOTESDET.Tables("Lote_Pedimento")
    '                        If conn.State = ConnectionState.Closed Then
    '                            conn.Open()
    '                        End If
    '                        cmd = New SqlCommand(SqlSelection, conn)
    '                        readerLotesDet = cmd.ExecuteReader()
    '                        '--------------------------------------------------
    '                        Dim vlLoteBandera As Boolean = False
    '                        Dim vlCVE_ART As String
    '                        Dim vlCVE_ART2 As String = ""
    '                        Dim vlLOTES As String
    '                        Dim vlCANT_ENTRADA As String
    '                        Dim vlCVE_ALM As String
    '                        '----------------------------------------
    '                        '---EXTRAER DATOS DEL SQL
    '                        Dim pLOTE As String
    '                        Dim pPEDIMENTO As String
    '                        Dim pFCHCADUC As String
    '                        Dim pFCHADUANA As String
    '                        Dim pFCHULTMOV As String
    '                        Dim pNOM_ADUAN As String
    '                        Dim pCANTIDAD As Double
    '                        Dim pCVE_OBS As String
    '                        Dim pCIUDAD As String
    '                        Dim pFRONTERA As String
    '                        Dim pFEC_PROD_LT As String
    '                        Dim pGLN As String
    '                        Dim pSTATUS As String
    '                        Dim pPARCIAL As String
    '                        '---------------------------------------
    '                        'While readerLotesDet.Read()
    '                        NUM_PAR = "0"
    '                        '----------------------------------------
    '                        'si HAY lotes
    '                        '----------------------------------------
    '                        Dim vlUpdateLotesExist As Integer = 1
    '                        For Each oRow777LOTE In oTableLOTESDET.Rows
    '                            'MsgBox(reader2.Item(0))
    '                            'vlCVE_ART = readerLotesDet.Item(0).ToString
    '                            'vlLOTES = readerLotesDet.Item(1).ToString
    '                            'vlCANT_ENTRADA = readerLotesDet.Item(2).ToString
    '                            'vlCVE_ALM = readerLotesDet.Item(3).ToString

    '                            vlLOTES = oRow777LOTE.Item("LOTE").ToString()
    '                            pLOTE = oRow777LOTE.Item("LOTE").ToString()
    '                            vlCVE_ART = oRow777LOTE.Item("CVE_ART").ToString()
    '                            vlCANT_ENTRADA = oRow777LOTE.Item("CANT_ENTRADA").ToString()
    '                            If vlCVE_ART = "" Then
    '                                vlCVE_ART = oRow777LOTE.Item("UPC").ToString()
    '                                vlCANT_ENTRADA = oRow777LOTE.Item("quantity_received").ToString()
    '                            End If
    '                            vlCVE_ALM = oRow777LOTE.Item("CVE_ALM").ToString()
    '                            pLOTE = oRow777LOTE.Item("LOTE").ToString()
    '                            pPEDIMENTO = oRow777LOTE.Item("PEDIMENTO").ToString()
    '                            pFCHCADUC = oRow777LOTE.Item("FCHCADUC").ToString()
    '                            pFCHADUANA = oRow777LOTE.Item("FCHADUANA").ToString()
    '                            pFCHULTMOV = oRow777LOTE.Item("FCHULTMOV").ToString()
    '                            pNOM_ADUAN = oRow777LOTE.Item("NOM_ADUAN").ToString()
    '                            If Len(oRow777LOTE.Item("CANTIDAD").ToString()) >= 1 Then
    '                                pCANTIDAD = oRow777LOTE.Item("CANTIDAD").ToString()
    '                            Else
    '                                pCANTIDAD = vlCANT_ENTRADA
    '                            End If

    '                            pCVE_OBS = oRow777LOTE.Item("CVE_OBS").ToString()
    '                            pCIUDAD = oRow777LOTE.Item("CIUDAD").ToString()
    '                            pFRONTERA = oRow777LOTE.Item("FRONTERA").ToString()
    '                            pFEC_PROD_LT = oRow777LOTE.Item("FEC_PROD_LT").ToString()
    '                            pGLN = oRow777LOTE.Item("GLN").ToString()
    '                            pSTATUS = oRow777LOTE.Item("STATUS").ToString()
    '                            pPARCIAL = oRow777LOTE.Item("PARCIAL").ToString()
    '                            NUM_PAR = Val(NUM_PAR) + 1
    '                            'If conn.State = ConnectionState.Open Then
    '                            '    conn.Close()
    '                            'End If
    '                            vlLoteBandera = True
    '                            Dim readerPAR_COMPO As FbDataReader
    '                            SqlSelection = "Select CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                            "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                            "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                            "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA  FROM PAR_COMPO" + vgNumEmpresa.ToString + " where CVE_DOC = '" + pcve_doc_origen.ToString + "'" + _
    '                            " and CVE_ART = '" + Trim(vlCVE_ART.ToString) + "'"
    '                            cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                            readerPAR_COMPO = cmdFB.ExecuteReader()
    '                            ' esta variable controla el consecutivo de las series
    '                            Dim mREG_SERIE As String
    '                            ' esta variable controla una sola entrada al ciclo de las series
    '                            Dim vlMaxNum As Boolean = True
    '                            Dim vlNumSer As String = "N"
    '                            While readerPAR_COMPO.Read()
    '                                'MsgBox(reader2.Item(0))
    '                                CVE_DOC = readerPAR_COMPO.Item(0).ToString
    '                                'NUM_PAR = readerPAR_COMPO.Item(1).ToString
    '                                CVE_ART = readerPAR_COMPO.Item(2).ToString
    '                                CANT = 0
    '                                CANTp = readerPAR_COMPO.Item(3).ToString
    '                                PXR = readerPAR_COMPO.Item(4).ToString
    '                                PREC = readerPAR_COMPO.Item(5).ToString
    '                                COST = readerPAR_COMPO.Item(6).ToString
    '                                IMPU1 = readerPAR_COMPO.Item(7).ToString
    '                                IMPU2 = readerPAR_COMPO.Item(8).ToString
    '                                IMPU3 = readerPAR_COMPO.Item(9).ToString
    '                                IMPU4 = readerPAR_COMPO.Item(10).ToString
    '                                IMP1APLA = readerPAR_COMPO.Item(11).ToString
    '                                IMP2APLA = readerPAR_COMPO.Item(12).ToString
    '                                IMP3APLA = readerPAR_COMPO.Item(13).ToString
    '                                IMP4APLA = readerPAR_COMPO.Item(14).ToString
    '                                TOTIMP1 = readerPAR_COMPO.Item(15).ToString
    '                                TOTIMP2 = readerPAR_COMPO.Item(16).ToString
    '                                TOTIMP3 = readerPAR_COMPO.Item(17).ToString
    '                                TOTIMP4 = readerPAR_COMPO.Item(18).ToString
    '                                DESCU = readerPAR_COMPO.Item(19).ToString
    '                                ACT_INV = readerPAR_COMPO.Item(20).ToString
    '                                TIP_CAM = readerPAR_COMPO.Item(21).ToString
    '                                UNI_VENTA = readerPAR_COMPO.Item(22).ToString
    '                                TIPO_ELEM = readerPAR_COMPO.Item(23).ToString
    '                                TIPO_PROD = readerPAR_COMPO.Item(24).ToString
    '                                CVE_OBS = readerPAR_COMPO.Item(25).ToString
    '                                REG_SERIE = readerPAR_COMPO.Item(26).ToString
    '                                E_LTPD = readerPAR_COMPO.Item(27).ToString
    '                                FACTCONV = readerPAR_COMPO.Item(28).ToString
    '                                COST_DEV = readerPAR_COMPO.Item(29).ToString
    '                                If COST_DEV = "" Then
    '                                    COST_DEV = "0"
    '                                End If
    '                                NUM_ALM = readerPAR_COMPO.Item(30).ToString
    '                                MINDIRECTO = readerPAR_COMPO.Item(31).ToString
    '                                NUM_MOV = readerPAR_COMPO.Item(32).ToString
    '                                'TOT_PARTIDA = readerPAR_COMPO.Item(33).ToString
    '                                'TOT_PARTIDA = PREC * CANT
    '                                '-------------------Traer la clave siguiente
    '                                'CVE_OBS = TraerClaveSiguiente()
    '                                Dim vcont As String = ""
    '                                Dim vnum As Integer
    '                                Dim readerMaxObser As FbDataReader
    '                                Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCC" + vgNumEmpresa.ToString
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerMaxObser = cmdFB.ExecuteReader()
    '                                While readerMaxObser.Read()
    '                                    'MsgBox(reader.Item(0))
    '                                    vcont = readerMaxObser.Item(0).ToString
    '                                    vcont = Val(vcont) + 1
    '                                End While
    '                                If vcont = "" Then vcont = "1"
    '                                CVE_OBS = vcont
    '                                readerMaxObser.Close()
    '                                '-------------------------------------------
    '                                'sqllocal = "INSERT INTO OBS_DOCC" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                '---------------------crear el o los movimientos
    '                                'Dim vNum_Mov As String = ConsecutivoMovimiento()
    '                                Dim vNum_Mov As String
    '                                Dim vcont777 As String = ""
    '                                Dim readerMaxMInv As FbDataReader
    '                                Sql = "Select coalesce(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerMaxMInv = cmdFB.ExecuteReader()
    '                                While readerMaxMInv.Read()
    '                                    'MsgBox(readerMaxMInv.Item(0))
    '                                    vcont777 = readerMaxMInv.Item(0).ToString
    '                                    vcont777 = Val(vcont777) + 1
    '                                End While
    '                                If vcont777 = "" Then vcont777 = "1"
    '                                vNum_Mov = vcont777
    '                                readerMaxMInv.Close()
    '                                '----------traer la cantidad
    '                                Dim vlPedimento_OC As String = "0"
    '                                Dim vlLote_OC As String = "0"
    '                                Dim readerOD As SqlDataReader
    '                                SqlSelection = "select OD.quantity_received, OD.Pedimento, OD.Lote from Logistik_supply_order_detail OD" + _
    '                                " where OD.id_supply_order = '" + Trim(pcve_doc_origen.ToString) + "' and OD.upc = '" + CVE_ART + "'"
    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                cmd = New SqlCommand(SqlSelection, conn)
    '                                readerOD = cmd.ExecuteReader()
    '                                While readerOD.Read()
    '                                    CANT = vlCANT_ENTRADA
    '                                    vlPedimento_OC = readerOD.Item(1).ToString
    '                                    vlLote_OC = readerOD.Item(2).ToString
    '                                End While
    '                                TOT_PARTIDA = CANT * COST
    '                                TOTIMP4 = (CANT * COST) * (IMPU4 / 100)

    '                                If conn.State = ConnectionState.Open Then
    '                                    conn.Close()
    '                                End If
    '                                readerOD.Close()
    '                                'verificar el numero de decimales en la configuracion del sae
    '                                'quitar o poner decimales en la cantidad
    '                                '-------------------------------------------
    '                                '-------------------------------------------
    '                                '----------tiene pedimento y numero de serie
    '                                Dim vlPedimento As String = "N"

    '                                Dim vlLote As String = "N"
    '                                Dim readerPedi As SqlDataReader
    '                                SqlSelection = "select Pedimento, NumSerie, Lote from Logistik_product" + _
    '                                " where upc = '" + CVE_ART + "'"
    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                cmd = New SqlCommand(SqlSelection, conn)
    '                                readerPedi = cmd.ExecuteReader()
    '                                While readerPedi.Read()
    '                                    vlPedimento = readerPedi.Item(0)
    '                                    vlNumSer = readerPedi.Item(1)
    '                                    vlLote = readerPedi.Item(2)
    '                                End While
    '                                If conn.State = ConnectionState.Open Then
    '                                    conn.Close()
    '                                End If
    '                                readerPedi.Close()
    '                                '------------------CANTIDAD
    '                                'If vlNumSer = "S" And vlCVE_ART <> vlCVE_ART2 Then{
    '                                If vlNumSer = "S" Then
    '                                    '--------------------------------------------------------------
    '                                    'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
    '                                    '---------------------------------------------------------------
    '                                    '--------------------------H NUMEROS DE SERIE
    '                                    If vlMaxNum = True Then
    '                                        Dim readerHNUMSER As FbDataReader
    '                                        SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
    '                                        '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                                        readerHNUMSER = cmdFB.ExecuteReader()
    '                                        While readerHNUMSER.Read()
    '                                            mREG_SERIE = readerHNUMSER.Item(0).ToString
    '                                            mREG_SERIE = Val(mREG_SERIE) + 1
    '                                        End While
    '                                        'If connFB.State = ConnectionState.Open Then
    '                                        '    connFB.Close()
    '                                        'End If
    '                                        readerHNUMSER.Close()
    '                                        vlMaxNum = False
    '                                    End If
    '                                    '---------------------------------------------------
    '                                    Dim nNUM_SER As String
    '                                    Dim nCOSTO As String
    '                                    Dim nDOCTO_ENT As String
    '                                    Dim nFECHA_ENT As String
    '                                    Dim nREG_SERIE As String
    '                                    Dim readerLogistikNumSerie As SqlDataReader
    '                                    'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
    '                                    '" FROM Logistik_numeros_series" + _
    '                                    '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                                    '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
    '                                    SqlSelection = "SELECT top " + CANT.ToString + " ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" + _
    '                                    " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" + _
    '                                    " where h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" + _
    '                                    " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + Trim(CVE_ART) + _
    '                                    "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='N'"
    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    cmd = New SqlCommand(SqlSelection, conn)
    '                                    readerLogistikNumSerie = cmd.ExecuteReader()
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    Dim vlNo_Par As Integer = 1
    '                                    While readerLogistikNumSerie.Read()
    '                                        Dim NumSer_Cve_Doc As String = pcve_doc_origen.ToString
    '                                        NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
    '                                        nNUM_SER = readerLogistikNumSerie.Item(0).ToString
    '                                        nCOSTO = readerLogistikNumSerie.Item(1).ToString
    '                                        nDOCTO_ENT = readerLogistikNumSerie.Item(2).ToString
    '                                        nFECHA_ENT = readerLogistikNumSerie.Item(3).ToString
    '                                        nREG_SERIE = readerLogistikNumSerie.Item(4).ToString
    '                                        If nFECHA_ENT <> "" Then
    '                                            nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        sqllocal = "INSERT INTO NUMSER" + vgNumEmpresa.ToString + "(CVE_ART,NUM_SER,STATUS,ALMACEN,COSTO,DOCTO_ENT,FECHA_ENT) VALUES ('" + _
    '                                                    CVE_ART + "','" + nNUM_SER + "','D','" + Trim(NUM_ALM) + "','" + _
    '                                                    nCOSTO + "','','" + nFECHA_ENT + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '--------------EL NUMERO DE PARTIDA EMPEZA CON UNO HASTA TERMINAR
    '                                        sqllocal = "INSERT INTO HNUMSER" + vgNumEmpresa.ToString + "(CVE_ART, NUM_SER, TIP_MOV, TIP_DOC, CVE_DOC, ALMACEN, " + _
    '                                                    "REG_SERIE, FECHA, STATUS, NO_PAR) VALUES ('" + _
    '                                                    CVE_ART + "','" + nNUM_SER + "','1','M','" + Trim(NumSer_Cve_Doc) + "','" + _
    '                                                    Trim(NUM_ALM) + "','" + mREG_SERIE.ToString + "','" + nFECHA_ENT + "','D','" + vlNo_Par.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()

    '                                        '--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                                        sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'D'" + _
    '                                        " where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                                        " and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
    '                                        " AND NUM_SER ='" + nNUM_SER + "'"
    '                                        cmd = New SqlCommand(sqllocal, conn)
    '                                        cmd.ExecuteNonQuery()
    '                                        vlNo_Par = vlNo_Par + 1
    '                                    End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If
    '                                    readerLogistikNumSerie.Close()
    '                                    '--------------------------------------------------------------
    '                                    'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
    '                                    '--------------------------------------------------------------
    '                                    'vlCVE_ART2 = vlCVE_ART
    '                                End If

    '                                Dim pREG_LTPD As String
    '                                If vlPedimento = "S" Or vlLote = "S" Then
    '                                    '---- extraer el consecutivo REG_LTPD de SAE
    '                                    Dim vConsecutivoReg_LTPD As Boolean
    '                                    Dim readerMAx As FbDataReader
    '                                    sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    If vConsecutivoReg_LTPD = False Then
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerMAx = cmdFB.ExecuteReader()
    '                                        While readerMAx.Read()
    '                                            pREG_LTPD = readerMAx.Item(0).ToString
    '                                            pREG_LTPD = Val(pREG_LTPD) + 1
    '                                        End While
    '                                        If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                                        readerMAx.Close()
    '                                        vConsecutivoReg_LTPD = True
    '                                    Else
    '                                        pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    End If
    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                End If

    '                                If vlPedimento = "S" And vlLote = "S" Then
    '                                    'Pendiente de resolver
    '                                    '---------------------------------------------------------------
    '                                    'BEGIN INSERTAR LOTES por partida
    '                                    '---------------------------------------------------------------
    '                                    '---- extraer el consecutivo REG_LTPD de SAE
    '                                    ' ''Dim vConsecutivoReg_LTPD As Boolean
    '                                    ' ''Dim pREG_LTPD As String
    '                                    ' ''Dim readerMAx As FbDataReader
    '                                    ' ''sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                                    ' ''If connFB.State = ConnectionState.Closed Then
    '                                    ' ''    connFB.Open()
    '                                    ' ''End If
    '                                    ' ''If vConsecutivoReg_LTPD = False Then
    '                                    ' ''    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    ' ''    readerMAx = cmdFB.ExecuteReader()
    '                                    ' ''    While readerMAx.Read()
    '                                    ' ''        pREG_LTPD = readerMAx.Item(0).ToString
    '                                    ' ''        pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    ' ''    End While
    '                                    ' ''    If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                                    ' ''    readerMAx.Close()
    '                                    ' ''    vConsecutivoReg_LTPD = True
    '                                    ' ''Else
    '                                    ' ''    pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    ' ''End If
    '                                    ' ''If conn.State = ConnectionState.Closed Then
    '                                    ' ''    conn.Open()
    '                                    ' ''End If

    '                                    Dim vvll_ltpd = pPARCIAL
    '                                    '+++++++++++++++++++++++++++++++++++++++++++++++++++
    '                                    '*******************verificar que no exista el lote
    '                                    '+++++++++++++++++++++++++++++++++++++++++++++++++++
    '                                    Dim vvREG_LTPD_Exist As String
    '                                    Dim vvLotesBandera As String = False
    '                                    Dim readerLotes7 As FbDataReader
    '                                    sqllocal = "Select REG_LTPD, CVE_ART, LOTE, CVE_ALM from LTPD" + vgNumEmpresa.ToString + _
    '                                    " where CVE_ART = '" + Trim(CVE_ART.ToString) + "'" + _
    '                                    " and LOTE = '" + Trim(vlLOTES.ToString) + "'" + _
    '                                    " and CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    readerLotes7 = cmdFB.ExecuteReader()
    '                                    While readerLotes7.Read()
    '                                        vvREG_LTPD_Exist = readerLotes7.Item(0).ToString
    '                                        vvLotesBandera = True
    '                                    End While
    '                                    readerLotes7.Close()
    '                                    If pFCHCADUC <> "" Then
    '                                        pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFCHADUANA <> "" Then
    '                                        pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFCHULTMOV <> "" Then
    '                                        pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFEC_PROD_LT <> "" Then
    '                                        pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If vvLotesBandera = True Then
    '                                        'si existe, hacer update en la tabla de acumuladora
    '                                        sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET CANTIDAD = CANTIDAD + " + CANT.ToString + _
    '                                        " WHERE REG_LTPD = '" + Trim(vvREG_LTPD_Exist.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        ' hacer insert en la tabla de desglosados
    '                                        '---- extraer el consecutivo E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        '---------regltpd reiniciar a 1 e incrementar a 1 por partida
    '                                        If vlUpdateLotesExist = 1 Then
    '                                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                            E_LTPD + "','" + vlUpdateLotesExist.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                            cmdFB.ExecuteNonQuery()
    '                                            vlUpdateLotesExist = vlUpdateLotesExist + 1
    '                                        Else
    '                                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                            E_LTPD + "','" + vlUpdateLotesExist.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                            cmdFB.ExecuteNonQuery()
    '                                            vlUpdateLotesExist = vlUpdateLotesExist + 1
    '                                        End If
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()

    '                                    Else
    '                                        'no existe insert
    '                                        '*********************************************
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '------------------INSERTAR PEDIMENTOS EN SAE
    '                                        sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                                        "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                                        "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                        "STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + Trim(NUM_ALM) + "','" + pFCHCADUC + "','" + _
    '                                         pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD.ToString + "','" + pREG_LTPD + "','" + _
    '                                         pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET FCHADUANA = NULL, GLN = '' " + _
    '                                        " WHERE LOTE ='" + pLOTE.ToString + "'" + _
    '                                        " AND CVE_ART = '" + CVE_ART.ToString + "'" + _
    '                                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '---- extraer el consecutivo E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        '----------------------------------------------
    '                                        sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    '+++++++++++++++++++++++++++++++++++++++++++++++++++
    '                                    'End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If

    '                                ElseIf vlLote = "S" Then
    '                                    If Trim(vEstatus) = "6" Then
    '                                        sqllocal = "update COMPO" + vgNumEmpresa.ToString + " SET ENLAZADO='P', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc.ToString + "'" + _
    '                                        " WHERE CVE_DOC ='" + CVE_DOC.ToString + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    Else
    '                                        sqllocal = "update COMPO" + vgNumEmpresa.ToString + " SET ENLAZADO='P', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc.ToString + "'" + _
    '                                        " WHERE CVE_DOC ='" + CVE_DOC.ToString + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    '---------------------------------------------------------------
    '                                    'BEGIN INSERTAR LOTES por partida
    '                                    '---------------------------------------------------------------
    '                                    '---- extraer el consecutivo REG_LTPD de SAE
    '                                    ' ''Dim vConsecutivoReg_LTPD As Boolean
    '                                    ' ''Dim pREG_LTPD As String
    '                                    ' ''Dim readerMAx As FbDataReader
    '                                    ' ''sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                                    ' ''If connFB.State = ConnectionState.Closed Then
    '                                    ' ''    connFB.Open()
    '                                    ' ''End If
    '                                    ' ''If vConsecutivoReg_LTPD = False Then
    '                                    ' ''    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    ' ''    readerMAx = cmdFB.ExecuteReader()
    '                                    ' ''    While readerMAx.Read()
    '                                    ' ''        pREG_LTPD = readerMAx.Item(0).ToString
    '                                    ' ''        pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    ' ''    End While
    '                                    ' ''    If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                                    ' ''    readerMAx.Close()
    '                                    ' ''    vConsecutivoReg_LTPD = True
    '                                    ' ''Else
    '                                    ' ''    pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    ' ''End If


    '                                    '----------------------------PARA PARCIALIDADES EN PEDIMENTOS QUE HAY QUE HACER
    '                                    'N = NO ES PARCIAL, ES TOTAL NO HAY BRONCA
    '                                    'S = SI HAY BRONCA, QUE HAY QUE HACER
    '                                    ' TENEMOS DOS PEDIMENTOS CON EL MISMO DOCUEMNTO NO PUEDE SER HAY VIOLACION
    '                                    'Dim readerPedimento As SqlDataReader
    '                                    'Dim readerLTPD As FbDataReader
    '                                    'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                                    '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                                    '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                    '"STATUS, REG_LTPD, PARCIAL  FROM Logistik_Lote_Pedimento" + _
    '                                    '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                    '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='O'" + _
    '                                    '" and LOTE = '" + Trim(vlLote_OC) + "'"
    '                                    ' ''If conn.State = ConnectionState.Closed Then
    '                                    ' ''    conn.Open()
    '                                    ' ''End If
    '                                    'cmd = New SqlCommand(SqlSelection, conn)
    '                                    'readerPedimento = cmd.ExecuteReader()
    '                                    'While readerPedimento.Read()
    '                                    'pLOTE = readerPedimento.Item(0).ToString
    '                                    'pPEDIMENTO = readerPedimento.Item(1).ToString
    '                                    'pFCHCADUC = readerPedimento.Item(2).ToString
    '                                    'pFCHADUANA = readerPedimento.Item(3).ToString
    '                                    'pFCHULTMOV = readerPedimento.Item(4).ToString
    '                                    'pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                                    'pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6))
    '                                    'pCVE_OBS = readerPedimento.Item(7).ToString
    '                                    'pCIUDAD = readerPedimento.Item(8).ToString
    '                                    'pFRONTERA = readerPedimento.Item(9).ToString
    '                                    'pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                                    'pGLN = readerPedimento.Item(11).ToString
    '                                    'pSTATUS = readerPedimento.Item(12).ToString
    '                                    'pPARCIAL = readerPedimento.Item(13).ToString
    '                                    Dim vvll_ltpd = pPARCIAL
    '                                    '+++++++++++++++++++++++++++++++++++++++++++++++++++
    '                                    '*******************verificar que no exista el lote
    '                                    '+++++++++++++++++++++++++++++++++++++++++++++++++++
    '                                    Dim vvREG_LTPD_Exist As String
    '                                    Dim vvLotesBandera As String = False
    '                                    Dim readerLotes7 As FbDataReader
    '                                    sqllocal = "Select REG_LTPD, CVE_ART, LOTE, CVE_ALM from LTPD" + vgNumEmpresa.ToString + _
    '                                    " where CVE_ART = '" + Trim(CVE_ART.ToString) + "'" + _
    '                                    " and LOTE = '" + Trim(vlLOTES.ToString) + "'" + _
    '                                    " and CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    readerLotes7 = cmdFB.ExecuteReader()
    '                                    While readerLotes7.Read()
    '                                        vvREG_LTPD_Exist = readerLotes7.Item(0).ToString
    '                                        vvLotesBandera = True
    '                                    End While
    '                                    readerLotes7.Close()
    '                                    If pFCHCADUC <> "" Then
    '                                        pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFCHADUANA <> "" Then
    '                                        pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFCHULTMOV <> "" Then
    '                                        pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If pFEC_PROD_LT <> "" Then
    '                                        pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                    End If
    '                                    If vvLotesBandera = True Then
    '                                        'si existe, hacer update en la tabla de acumuladora
    '                                        sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET CANTIDAD = CANTIDAD + " + CANT.ToString + _
    '                                        " WHERE REG_LTPD = '" + Trim(vvREG_LTPD_Exist.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        ' hacer insert en la tabla de desglosados
    '                                        '---- extraer el consecutivo E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        '---------regltpd reiniciar a 1 e incrementar a 1 por partida
    '                                        If vlUpdateLotesExist = 1 Then
    '                                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                            E_LTPD + "','" + vlUpdateLotesExist.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                            cmdFB.ExecuteNonQuery()
    '                                            vlUpdateLotesExist = vlUpdateLotesExist + 1
    '                                        Else
    '                                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                            E_LTPD + "','" + vlUpdateLotesExist.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                            cmdFB.ExecuteNonQuery()
    '                                            vlUpdateLotesExist = vlUpdateLotesExist + 1
    '                                        End If
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()

    '                                    Else
    '                                        'no existe insert

    '                                        '*********************************************
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '------------------INSERTAR PEDIMENTOS EN SAE
    '                                        sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                                        "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                                        "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                        "STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + Trim(NUM_ALM) + "','" + pFCHCADUC + "','" + _
    '                                         pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD.ToString + "','" + pREG_LTPD + "','" + _
    '                                         pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET NOM_ADUAN = '', FCHADUANA = NULL, GLN = '' " + _
    '                                        " WHERE LOTE ='" + pLOTE.ToString + "'" + _
    '                                        " AND CVE_ART = '" + CVE_ART.ToString + "'" + _
    '                                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '---- extraer el consecutivo E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    '+++++++++++++++++++++++++++++++++++++++++++++++++++
    '                                    'End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If
    '                                    'readerPedimento.Close()
    '                                    '---------------------------------------------------------------
    '                                    'END INSERTAR LOTES
    '                                    '---------------------------------------------------------------
    '                                    'COMPRASoc()
    '                                ElseIf vlPedimento = "S" Then
    '                                    '---------------------------------------------------------------
    '                                    'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
    '                                    '---------------------------------------------------------------
    '                                    '---- extraer el consecutivo REG_LTPD de SAE
    '                                    ' ''Dim pREG_LTPD As String
    '                                    ' ''Dim readerMAx As FbDataReader
    '                                    ' ''sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                                    ' ''If connFB.State = ConnectionState.Closed Then
    '                                    ' ''    connFB.Open()
    '                                    ' ''End If
    '                                    ' ''cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    ' ''readerMAx = cmdFB.ExecuteReader()
    '                                    ' ''While readerMAx.Read()
    '                                    ' ''    'MsgBox(reader7.Item(0))
    '                                    ' ''    pREG_LTPD = readerMAx.Item(0).ToString
    '                                    ' ''    pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    ' ''End While
    '                                    ' ''If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                                    ' ''readerMAx.Close()
    '                                    '---EXTRAER DATOS DEL SQL
    '                                    'Dim pLOTE As String
    '                                    'Dim pPEDIMENTO As String
    '                                    'Dim pFCHCADUC As String
    '                                    'Dim pFCHADUANA As String
    '                                    'Dim pFCHULTMOV As String
    '                                    'Dim pNOM_ADUAN As String
    '                                    'Dim pCANTIDAD As Double
    '                                    'Dim pCVE_OBS As String
    '                                    'Dim pCIUDAD As String
    '                                    'Dim pFRONTERA As String
    '                                    'Dim pFEC_PROD_LT As String
    '                                    'Dim pGLN As String
    '                                    'Dim pSTATUS As String
    '                                    'Dim pPARCIAL As String
    '                                    '----------------------------PARA PARCIALIDADES EN PEDIMENTOS QUE HAY QUE HACER
    '                                    'N = NO ES PARCIAL, ES TOTAL NO HAY BRONCA
    '                                    'S = SI HAY BRONCA, QUE HAY QUE HACER
    '                                    ' TENEMOS DOS PEDIMENTOS CON EL MISMO DOCUEMNTO NO PUEDE SER HAY VIOLACION
    '                                    Dim readerPedimento As SqlDataReader
    '                                    'Dim readerLTPD As FbDataReader
    '                                    SqlSelection = "SELECT pp.LOTE ,pp.PEDIMENTO, pp.FCHCADUC," + _
    '                                    "pp.FCHADUANA, pp.FCHULTMOV, pp.NOM_ADUAN, pp.CANTIDAD," + _
    '                                    "pp.CVE_OBS, pp.CIUDAD, pp.FRONTERA, pp.FEC_PROD_LT, pp.GLN," + _
    '                                    "pp.STATUS, pp.REG_LTPD, pp.PARCIAL FROM Logistik_Lote_Pedimento pp" + _
    '                                    " where pp.CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and pp.CVE_ART = '" + CVE_ART + _
    '                                    "' and pp.CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and pp.STATUS ='O'" + _
    '                                    " and pp.PEDIMENTO = '" + Trim(vlPedimento_OC) + "'"
    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    cmd = New SqlCommand(SqlSelection, conn)
    '                                    readerPedimento = cmd.ExecuteReader()
    '                                    While readerPedimento.Read()
    '                                        pLOTE = readerPedimento.Item(0).ToString
    '                                        pPEDIMENTO = readerPedimento.Item(1).ToString
    '                                        pFCHCADUC = readerPedimento.Item(2).ToString
    '                                        pFCHADUANA = readerPedimento.Item(3).ToString
    '                                        pFCHULTMOV = readerPedimento.Item(4).ToString
    '                                        pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                                        pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6))
    '                                        pCVE_OBS = readerPedimento.Item(7).ToString
    '                                        pCIUDAD = readerPedimento.Item(8).ToString
    '                                        pFRONTERA = readerPedimento.Item(9).ToString
    '                                        pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                                        pGLN = readerPedimento.Item(11).ToString
    '                                        pSTATUS = readerPedimento.Item(12).ToString
    '                                        pPARCIAL = readerPedimento.Item(13).ToString
    '                                        Dim vvll_ltpd = readerPedimento.Item(13).ToString
    '                                        If pFCHCADUC <> "" Then
    '                                            pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFCHADUANA <> "" Then
    '                                            pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFCHULTMOV <> "" Then
    '                                            pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFEC_PROD_LT <> "" Then
    '                                            pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        '*********************************************
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '------------------INSERTAR PEDIMENTOS EN SAE
    '                                        sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                                        "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                                        "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                        "STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + Trim(NUM_ALM) + "','" + pFCHCADUC + "','" + _
    '                                         pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD.ToString + "','" + pREG_LTPD + "','" + _
    '                                         pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET LOTE = '', FCHCADUC = NULL, FEC_PROD_LT= NULL, GLN = '' " + _
    '                                        " WHERE PEDIMENTO ='" + pPEDIMENTO.ToString + "'" + _
    '                                        " AND CVE_ART = '" + CVE_ART.ToString + "'" + _
    '                                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '---- extraer el consecutivo E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            'MsgBox(reader7.Item(0))
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        'sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        'E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                                        sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()

    '                                        ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                                        'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
    '                                        '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                        '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='O'" + _
    '                                        '" AND REG_LTPD ='" + vvll_ltpd.ToString + "'"
    '                                        'cmd = New SqlCommand(SqlSelection, conn)
    '                                        'cmd.ExecuteNonQuery()
    '                                    End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If
    '                                    readerPedimento.Close()
    '                                    '---------------------------------------------------------------
    '                                    'END INSERTAR PEDIMENTOS
    '                                    '---------------------------------------------------------------
    '                                End If
    '                                If vlNumSer = "S" Then
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                                        "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','" + _
    '                                        "N','1','0','C','0','0','1')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                                        "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','" + _
    '                                        "N','1','0','C','0','0','1')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                Else
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','0','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "')"
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                                        "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + CANT.ToString + "','" + _
    '                                        Trim(PREC.ToString) + "','" + Trim(COST.ToString) + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + Trim(TOTIMP4.ToString) + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','0','" + Trim(E_LTPD) + "','" + FACTCONV + "','" + Trim(COST.ToString) + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + Trim(vNum_Mov) + "','" + TOT_PARTIDA + "','" + _
    '                                        "N','1','0','C','0','0','1')"
    '                                        'COMPRASSSSS()
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                                        "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + CANT.ToString + "','" + _
    '                                        Trim(PREC.ToString) + "','" + Trim(COST.ToString) + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + Trim(TOTIMP4.ToString) + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','0','" + Trim(E_LTPD) + "','" + FACTCONV + "','" + Trim(COST.ToString) + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + Trim(vNum_Mov) + "','" + TOT_PARTIDA + "','" + _
    '                                        "N','1','0','C','0','0','1')"
    '                                        'COMPRASSSSS()
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                End If
    '                                'INSERTAR EL INDICE
    '                                sqllocal = "insert into PAR_COMPR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc.ToString + "','" + NUM_PAR + "')"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'actualizar detalle
    '                                sqllocal = "update PAR_COMPO" + vgNumEmpresa.ToString + " set PXR = PXR - " + CANT.ToString + _
    '                                " where CVE_DOC = '" + CVE_DOC.ToString + "' and CVE_ART = '" + CVE_ART + "'"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'actualizar ACUMULADOR
    '                                sqllocal = "update ACOMP" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '                                " RIMP = RIMP + " + TOTIMP4 + "" + _
    '                                " where CVE_ACOMP = '11'"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()

    '                                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                'insertar documentos siguientes
    '                                If vlCVE_ART <> vvArticulo Then
    '                                    sqllocal = "INSERT INTO DOCTOSIGC" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '                                    "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '                                    "'o','" + CVE_DOC.ToString + "','S','r','" + pcvedoc.ToString + "','" + _
    '                                    NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                    sqllocal = "INSERT INTO DOCTOSIGC" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '                                    "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '                                    "'r','" + pcvedoc.ToString + "','A','o','" + CVE_DOC.ToString + "','" + _
    '                                    NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                    vvArticulo = vlCVE_ART

    '                                End If
    '                                'Dim dateactual As String = time
    '                                'dateactual = Convert.ToDateTime(dateactual).ToString("yyyy/MM/dd")
    '                                'sqllocal = "UPDATE FOLIOSC" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
    '                                '",FECH_ULT_DOC = '" + dateactual + "' WHERE TIP_DOC = 'r'"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                'actualizar las existencias
    '                                'Call ActualizarExistencias(CVE_ART, CANT)
    '                                If vgVersion = "5" Then
    '                                    sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", FCH_ULTCOM = '" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                    " COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", COSTO_PROM = " + COST + "," + _
    '                                    " ULT_COSTO = " + COST + ", COMP_ANL_C = COMP_ANL_C + " + CANT.ToString + ", COMP_ANL_M = COMP_ANL_M + " + TOT_PARTIDA + "" + _
    '                                    " WHERE CVE_ART ='" + CVE_ART + "'"
    '                                End If
    '                                If vgVersion = "6" Then
    '                                    sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", FCH_ULTCOM = '" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                    " COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", COSTO_PROM = " + COST + ", VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
    '                                    " ULT_COSTO = " + COST + ", COMP_ANL_C = COMP_ANL_C + " + CANT.ToString + ", COMP_ANL_M = COMP_ANL_M + " + TOT_PARTIDA + "" + _
    '                                    " WHERE CVE_ART ='" + CVE_ART + "'"
    '                                End If
    '                                If vgVersion = "7" Then
    '                                    sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", FCH_ULTCOM = '" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                    " COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", COSTO_PROM = " + COST + ", VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
    '                                    " ULT_COSTO = " + COST + ", COMP_ANL_C = COMP_ANL_C + " + CANT.ToString + ", COMP_ANL_M = COMP_ANL_M + " + TOT_PARTIDA + "" + _
    '                                    " WHERE CVE_ART ='" + CVE_ART + "'"
    '                                End If

    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                '-----------------------------------------------
    '                                'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
    '                                Dim vExistencia As String = ""
    '                                Dim reader3 As FbDataReader
    '                                Sql = "Select coalesce(max(EXIST),0) AS num from INVE" + vgNumEmpresa.ToString + " where CVE_ART = '" + CVE_ART + "'"
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                reader3 = cmdFB.ExecuteReader()
    '                                While reader3.Read()
    '                                    'MsgBox(reader3.Item(0))
    '                                    vExistencia = reader3.Item(0).ToString
    '                                    'vExistencia = Val(vExistencia) + 1
    '                                End While
    '                                If vExistencia = "" Then vExistencia = "1"
    '                                reader3.Close()
    '                                '---------EXTRAER CLAVE DEL FOLIO
    '                                Dim CVE_FOLIO As String = ""
    '                                Dim readerFOLIO As FbDataReader
    '                                Sql = "Select ULT_CVE AS num from TBLCONTROL" + vgNumEmpresa.ToString + " where ID_TABLA = 32"
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerFOLIO = cmdFB.ExecuteReader()
    '                                While readerFOLIO.Read()
    '                                    'MsgBox(reader3.Item(0))
    '                                    CVE_FOLIO = readerFOLIO.Item(0).ToString
    '                                    'CVE_FOLIO = CVE_FOLIO + 1
    '                                    'vExistencia = Val(vExistencia) + 1
    '                                End While
    '                                If CVE_FOLIO = "" Then CVE_FOLIO = "1"
    '                                readerFOLIO.Close()
    '                                '-----------------------------------------------
    '                                CTLPOL = "0"
    '                                If vlNumSer = "S" Then
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + Trim(COST.ToString) + "','','" + CVE_OBS + "'," + _
    '                                        "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                                        "S','0','" + COST + "','N','0')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + Trim(COST.ToString) + "','','" + CVE_OBS + "'," + _
    '                                        "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                                        "S','0','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'R','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + Trim(COST.ToString) + "','','" + CVE_OBS + "'," + _
    '                                        "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                                        "S','0','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                Else
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + Trim(COST.ToString) + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                                        "S','0','" + COST + "','N','0')"
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'r','" + pcvedoc.ToString + "','" + pcve_prov + "','','" + CANT.ToString + "','0','0','" + Trim(COST.ToString) + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','" + CVE_FOLIO + "','1','" + _
    '                                        "S','" + COST + "','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'R','" + pcvedoc.ToString + "','" + pcve_prov + "','','" + CANT.ToString + "','0','0','" + Trim(COST.ToString) + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','" + CVE_FOLIO + "','1','" + _
    '                                        "S','" + COST + "','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                    sqllocal = "UPDATE MINVE" + vgNumEmpresa.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " + _
    '                                    " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" + _
    '                                    " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcvedoc.ToString + "'"
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                End If
    '                                Dim VERSION_SINC As String
    '                                VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
    '                                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" + _
    '                                " WHERE CVE_ART = '" + CVE_ART + "'" + _
    '                                " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                If vlNumSer = "S" Then
    '                                    mREG_SERIE = Val(mREG_SERIE) + 1
    '                                End If
    '                                vlsubtotal = vlsubtotal + (COST * CANT)
    '                            End While
    '                            readerPAR_COMPO.Close()

    '                            If conn.State = ConnectionState.Closed Then
    '                                conn.Open()
    '                            End If

    '                            'End While
    '                        Next
    '                        'readerLotesDet.Close()
    '                        If conn.State = ConnectionState.Open Then
    '                            conn.Close()
    '                        End If
    '                        '-------------------------------------------------------------------------
    '                        '---------fala registrar los productos que no tienen lotes y pedimentos
    '                        '-------------------------------------------------------------------------

    '                        '-----------------------------------------------------------------------------------
    '                        '-------INICIAR no hay lotes
    '                        '-----------------------------------------------------------------------------------
    '                        If vlLoteBandera = False Then
    '                            Dim readerPAR_COMPO As FbDataReader
    '                            SqlSelection = "Select CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                            "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                            "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                            "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA FROM PAR_COMPO" + vgNumEmpresa.ToString + " where CVE_DOC = '" + pcve_doc_origen.ToString + "'"
    '                            cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                            readerPAR_COMPO = cmdFB.ExecuteReader()
    '                            ' esta variable controla el consecutivo de las series
    '                            Dim mREG_SERIE As String
    '                            ' esta variable controla una sola entrada al ciclo de las series
    '                            Dim vlMaxNum As Boolean = True
    '                            While readerPAR_COMPO.Read()
    '                                'MsgBox(reader2.Item(0))
    '                                CVE_DOC = readerPAR_COMPO.Item(0).ToString
    '                                NUM_PAR = readerPAR_COMPO.Item(1).ToString
    '                                CVE_ART = readerPAR_COMPO.Item(2).ToString
    '                                CANT = 0
    '                                CANTp = readerPAR_COMPO.Item(3).ToString
    '                                PXR = readerPAR_COMPO.Item(4).ToString
    '                                PREC = readerPAR_COMPO.Item(5).ToString
    '                                COST = readerPAR_COMPO.Item(6).ToString
    '                                IMPU1 = readerPAR_COMPO.Item(7).ToString
    '                                IMPU2 = readerPAR_COMPO.Item(8).ToString
    '                                IMPU3 = readerPAR_COMPO.Item(9).ToString
    '                                IMPU4 = readerPAR_COMPO.Item(10).ToString
    '                                IMP1APLA = readerPAR_COMPO.Item(11).ToString
    '                                IMP2APLA = readerPAR_COMPO.Item(12).ToString
    '                                IMP3APLA = readerPAR_COMPO.Item(13).ToString
    '                                IMP4APLA = readerPAR_COMPO.Item(14).ToString
    '                                TOTIMP1 = readerPAR_COMPO.Item(15).ToString
    '                                TOTIMP2 = readerPAR_COMPO.Item(16).ToString
    '                                TOTIMP3 = readerPAR_COMPO.Item(17).ToString
    '                                TOTIMP4 = readerPAR_COMPO.Item(18).ToString
    '                                DESCU = readerPAR_COMPO.Item(19).ToString
    '                                ACT_INV = readerPAR_COMPO.Item(20).ToString
    '                                TIP_CAM = readerPAR_COMPO.Item(21).ToString
    '                                UNI_VENTA = readerPAR_COMPO.Item(22).ToString
    '                                TIPO_ELEM = readerPAR_COMPO.Item(23).ToString
    '                                TIPO_PROD = readerPAR_COMPO.Item(24).ToString
    '                                CVE_OBS = readerPAR_COMPO.Item(25).ToString
    '                                REG_SERIE = readerPAR_COMPO.Item(26).ToString
    '                                E_LTPD = readerPAR_COMPO.Item(27).ToString
    '                                FACTCONV = readerPAR_COMPO.Item(28).ToString
    '                                COST_DEV = readerPAR_COMPO.Item(29).ToString
    '                                If COST_DEV = "" Then
    '                                    COST_DEV = "0"
    '                                End If
    '                                NUM_ALM = readerPAR_COMPO.Item(30).ToString
    '                                MINDIRECTO = readerPAR_COMPO.Item(31).ToString
    '                                NUM_MOV = readerPAR_COMPO.Item(32).ToString
    '                                TOT_PARTIDA = readerPAR_COMPO.Item(33).ToString
    '                                '-------------------Traer la clave siguiente
    '                                'CVE_OBS = TraerClaveSiguiente()
    '                                Dim vcont As String = ""
    '                                Dim vnum As Integer
    '                                Dim readerMaxObser As FbDataReader
    '                                Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCC" + vgNumEmpresa.ToString
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerMaxObser = cmdFB.ExecuteReader()
    '                                While readerMaxObser.Read()
    '                                    'MsgBox(reader.Item(0))
    '                                    vcont = readerMaxObser.Item(0).ToString
    '                                    vcont = Val(vcont) + 1
    '                                End While
    '                                If vcont = "" Then vcont = "1"
    '                                CVE_OBS = vcont
    '                                readerMaxObser.Close()
    '                                '-------------------------------------------
    '                                'sqllocal = "INSERT INTO OBS_DOCC" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                '---------------------crear el o los movimientos
    '                                'Dim vNum_Mov As String = ConsecutivoMovimiento()
    '                                Dim vNum_Mov As String
    '                                Dim vcont777 As String = ""
    '                                Dim readerMaxMInv As FbDataReader
    '                                Sql = "Select coalesce(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerMaxMInv = cmdFB.ExecuteReader()
    '                                While readerMaxMInv.Read()
    '                                    'MsgBox(readerMaxMInv.Item(0))
    '                                    vcont777 = readerMaxMInv.Item(0).ToString
    '                                    vcont777 = Val(vcont777) + 1
    '                                End While
    '                                If vcont777 = "" Then vcont777 = "1"
    '                                vNum_Mov = vcont777
    '                                readerMaxMInv.Close()
    '                                '----------traer la cantidad
    '                                Dim vlPedimento_OC As String = "0"
    '                                Dim vlLote_OC As String = "0"
    '                                Dim readerORD_DET As SqlDataReader
    '                                SqlSelection = "select quantity_received, Pedimento,Lote from Logistik_supply_order_detail" + _
    '                                " where id_supply_order = '" + Trim(pcve_doc_origen.ToString) + "' and upc = '" + CVE_ART + "'"

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                cmd = New SqlCommand(SqlSelection, conn)
    '                                readerORD_DET = cmd.ExecuteReader()
    '                                While readerORD_DET.Read()
    '                                    CANT = Convert.ToDouble(readerORD_DET.Item(0))
    '                                    vlPedimento_OC = readerORD_DET.Item(1).ToString
    '                                    vlLote_OC = readerORD_DET.Item(2).ToString
    '                                End While
    '                                If conn.State = ConnectionState.Open Then
    '                                    conn.Close()
    '                                End If
    '                                readerORD_DET.Close()
    '                                'verificar el numero de decimales en la configuracion del sae
    '                                'quitar o poner decimales en la cantidad
    '                                '-------------------------------------------
    '                                '-------------------------------------------
    '                                '----------tiene pedimento y numero de serie
    '                                Dim vlPedimento As String = "N"
    '                                Dim vlNumSer As String = "N"
    '                                Dim vlLote As String = "N"
    '                                Dim readerPedi As SqlDataReader
    '                                SqlSelection = "select Pedimento, NumSerie, Lote from Logistik_product" + _
    '                                " where upc = '" + CVE_ART + "'"
    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                cmd = New SqlCommand(SqlSelection, conn)
    '                                readerPedi = cmd.ExecuteReader()
    '                                While readerPedi.Read()
    '                                    vlPedimento = readerPedi.Item(0)
    '                                    vlNumSer = readerPedi.Item(1)
    '                                    vlLote = readerPedi.Item(2)
    '                                End While
    '                                If conn.State = ConnectionState.Open Then
    '                                    conn.Close()
    '                                End If
    '                                readerPedi.Close()
    '                                If vlNumSer = "S" Then
    '                                    '--------------------------------------------------------------
    '                                    'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
    '                                    '---------------------------------------------------------------
    '                                    '--------------------------H NUMEROS DE SERIE
    '                                    If vlMaxNum = True Then
    '                                        Dim readerHNUMSER As FbDataReader
    '                                        SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
    '                                        '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                                        readerHNUMSER = cmdFB.ExecuteReader()
    '                                        While readerHNUMSER.Read()
    '                                            mREG_SERIE = readerHNUMSER.Item(0).ToString
    '                                            mREG_SERIE = Val(mREG_SERIE) + 1
    '                                        End While
    '                                        'If connFB.State = ConnectionState.Open Then
    '                                        '    connFB.Close()
    '                                        'End If
    '                                        readerHNUMSER.Close()
    '                                        vlMaxNum = False
    '                                    End If
    '                                    '---------------------------------------------------
    '                                    Dim nNUM_SER As String
    '                                    Dim nCOSTO As String
    '                                    Dim nDOCTO_ENT As String
    '                                    Dim nFECHA_ENT As String
    '                                    Dim nREG_SERIE As String
    '                                    Dim readerLogistikNumSerie As SqlDataReader
    '                                    'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
    '                                    '" FROM Logistik_numeros_series" + _
    '                                    '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                                    '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
    '                                    SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" + _
    '                                    " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" + _
    '                                    " where h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" + _
    '                                    " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART + _
    '                                    "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='N'"
    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    cmd = New SqlCommand(SqlSelection, conn)
    '                                    readerLogistikNumSerie = cmd.ExecuteReader()
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    Dim vlNo_Par As Integer = 1
    '                                    While readerLogistikNumSerie.Read()
    '                                        Dim NumSer_Cve_Doc As String = pcve_doc_origen.ToString
    '                                        NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
    '                                        nNUM_SER = readerLogistikNumSerie.Item(0).ToString
    '                                        nCOSTO = readerLogistikNumSerie.Item(1).ToString
    '                                        nDOCTO_ENT = readerLogistikNumSerie.Item(2).ToString
    '                                        nFECHA_ENT = readerLogistikNumSerie.Item(3).ToString
    '                                        nREG_SERIE = readerLogistikNumSerie.Item(4).ToString
    '                                        If nFECHA_ENT <> "" Then
    '                                            nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        sqllocal = "INSERT INTO NUMSER" + vgNumEmpresa.ToString + "(CVE_ART,NUM_SER,STATUS,ALMACEN,COSTO,DOCTO_ENT,FECHA_ENT) VALUES ('" + _
    '                                                    CVE_ART + "','" + nNUM_SER + "','D','" + Trim(NUM_ALM) + "','" + _
    '                                                    nCOSTO + "','','" + nFECHA_ENT + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '--------------EL NUMERO DE PARTIDA EMPEZA CON UNO HASTA TERMINAR
    '                                        sqllocal = "INSERT INTO HNUMSER" + vgNumEmpresa.ToString + "(CVE_ART, NUM_SER, TIP_MOV, TIP_DOC, CVE_DOC, ALMACEN, " + _
    '                                                    "REG_SERIE, FECHA, STATUS, NO_PAR) VALUES ('" + _
    '                                                    CVE_ART + "','" + nNUM_SER + "','1','M','" + Trim(NumSer_Cve_Doc) + "','" + _
    '                                                    Trim(NUM_ALM) + "','" + mREG_SERIE.ToString + "','" + nFECHA_ENT + "','D','" + vlNo_Par.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()

    '                                        ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                                        'sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'D'" + _
    '                                        '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                                        '" and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
    '                                        '" AND NUM_SER ='" + nNUM_SER + "'"
    '                                        'cmd = New SqlCommand(sqllocal, conn)
    '                                        'cmd.ExecuteNonQuery()

    '                                        vlNo_Par = vlNo_Par + 1
    '                                    End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If
    '                                    readerLogistikNumSerie.Close()
    '                                    '--------------------------------------------------------------
    '                                    'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
    '                                    '--------------------------------------------------------------
    '                                End If
    '                                If vlPedimento = "S" And vlLote = "S" Then
    '                                    'Pendiente de resolver

    '                                ElseIf vlLote = "S" Then
    '                                    '---------------------------------------------------------------
    '                                    'BEGIN INSERTAR LOTES por partida
    '                                    '---------------------------------------------------------------
    '                                    '---- extraer el consecutivo REG_LTPD de SAE
    '                                    Dim pREG_LTPD As String
    '                                    Dim readerMAx As FbDataReader
    '                                    sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    readerMAx = cmdFB.ExecuteReader()
    '                                    While readerMAx.Read()
    '                                        pREG_LTPD = readerMAx.Item(0).ToString
    '                                        pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    End While
    '                                    If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                                    readerMAx.Close()
    '                                    '---EXTRAER DATOS DEL SQL
    '                                    'Dim pLOTE As String
    '                                    'Dim pPEDIMENTO As String
    '                                    'Dim pFCHCADUC As String
    '                                    'Dim pFCHADUANA As String
    '                                    'Dim pFCHULTMOV As String
    '                                    'Dim pNOM_ADUAN As String
    '                                    'Dim pCANTIDAD As Double
    '                                    'Dim pCVE_OBS As String
    '                                    'Dim pCIUDAD As String
    '                                    'Dim pFRONTERA As String
    '                                    'Dim pFEC_PROD_LT As String
    '                                    'Dim pGLN As String
    '                                    'Dim pSTATUS As String
    '                                    'Dim pPARCIAL As String
    '                                    '----------------------------PARA PARCIALIDADES EN PEDIMENTOS QUE HAY QUE HACER
    '                                    'N = NO ES PARCIAL, ES TOTAL NO HAY BRONCA
    '                                    'S = SI HAY BRONCA, QUE HAY QUE HACER
    '                                    ' TENEMOS DOS PEDIMENTOS CON EL MISMO DOCUEMNTO NO PUEDE SER HAY VIOLACION
    '                                    Dim readerPedimento As SqlDataReader
    '                                    'Dim readerLTPD As FbDataReader
    '                                    SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                                    "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                                    "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                    "STATUS, REG_LTPD, PARCIAL  FROM Logistik_Lote_Pedimento" + _
    '                                    " where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                    "' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='O'" + _
    '                                    " and LOTE = '" + Trim(vlLote_OC) + "'"
    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    cmd = New SqlCommand(SqlSelection, conn)
    '                                    readerPedimento = cmd.ExecuteReader()
    '                                    While readerPedimento.Read()
    '                                        pLOTE = readerPedimento.Item(0).ToString
    '                                        pPEDIMENTO = readerPedimento.Item(1).ToString
    '                                        pFCHCADUC = readerPedimento.Item(2).ToString
    '                                        pFCHADUANA = readerPedimento.Item(3).ToString
    '                                        pFCHULTMOV = readerPedimento.Item(4).ToString
    '                                        pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                                        pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6))
    '                                        pCVE_OBS = readerPedimento.Item(7).ToString
    '                                        pCIUDAD = readerPedimento.Item(8).ToString
    '                                        pFRONTERA = readerPedimento.Item(9).ToString
    '                                        pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                                        pGLN = readerPedimento.Item(11).ToString
    '                                        pSTATUS = readerPedimento.Item(12).ToString
    '                                        pPARCIAL = readerPedimento.Item(13).ToString
    '                                        Dim vvll_ltpd = readerPedimento.Item(13).ToString
    '                                        If pFCHCADUC <> "" Then
    '                                            pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFCHADUANA <> "" Then
    '                                            pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFCHULTMOV <> "" Then
    '                                            pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFEC_PROD_LT <> "" Then
    '                                            pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        '*********************************************
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '------------------INSERTAR PEDIMENTOS EN SAE
    '                                        sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                                        "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                                        "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                        "STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + Trim(NUM_ALM) + "','" + pFCHCADUC + "','" + _
    '                                         pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD.ToString + "','" + pREG_LTPD + "','" + _
    '                                         pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET NOM_ADUAN = '', FCHADUANA = NULL, GLN = '' " + _
    '                                        " WHERE LOTE ='" + pLOTE.ToString + "'" + _
    '                                        " AND CVE_ART = '" + CVE_ART.ToString + "'" + _
    '                                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '---- extraer el consecutivo E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If
    '                                    readerPedimento.Close()
    '                                    '---------------------------------------------------------------
    '                                    'END INSERTAR LOTES
    '                                    '---------------------------------------------------------------
    '                                ElseIf vlPedimento = "S" Then
    '                                    '---------------------------------------------------------------
    '                                    'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
    '                                    '---------------------------------------------------------------
    '                                    '---- extraer el consecutivo REG_LTPD de SAE
    '                                    Dim pREG_LTPD As String
    '                                    Dim readerMAx As FbDataReader
    '                                    sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                                    If connFB.State = ConnectionState.Closed Then
    '                                        connFB.Open()
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    readerMAx = cmdFB.ExecuteReader()
    '                                    While readerMAx.Read()
    '                                        'MsgBox(reader7.Item(0))
    '                                        pREG_LTPD = readerMAx.Item(0).ToString
    '                                        pREG_LTPD = Val(pREG_LTPD) + 1
    '                                    End While
    '                                    If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                                    readerMAx.Close()
    '                                    '---EXTRAER DATOS DEL SQL
    '                                    'Dim pLOTE As String
    '                                    'Dim pPEDIMENTO As String
    '                                    'Dim pFCHCADUC As String
    '                                    'Dim pFCHADUANA As String
    '                                    'Dim pFCHULTMOV As String
    '                                    'Dim pNOM_ADUAN As String
    '                                    'Dim pCANTIDAD As Double
    '                                    'Dim pCVE_OBS As String
    '                                    'Dim pCIUDAD As String
    '                                    'Dim pFRONTERA As String
    '                                    'Dim pFEC_PROD_LT As String
    '                                    'Dim pGLN As String
    '                                    'Dim pSTATUS As String
    '                                    'Dim pPARCIAL As String
    '                                    '----------------------------PARA PARCIALIDADES EN PEDIMENTOS QUE HAY QUE HACER
    '                                    'N = NO ES PARCIAL, ES TOTAL NO HAY BRONCA
    '                                    'S = SI HAY BRONCA, QUE HAY QUE HACER
    '                                    ' TENEMOS DOS PEDIMENTOS CON EL MISMO DOCUEMNTO NO PUEDE SER HAY VIOLACION
    '                                    Dim readerPedimento As SqlDataReader
    '                                    'Dim readerLTPD As FbDataReader
    '                                    SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                                    "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                                    "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                    "STATUS, REG_LTPD, PARCIAL  FROM Logistik_Lote_Pedimento" + _
    '                                    " where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                    "' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='O'" + _
    '                                    " and PEDIMENTO = '" + Trim(vlPedimento_OC) + "'"
    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    cmd = New SqlCommand(SqlSelection, conn)
    '                                    readerPedimento = cmd.ExecuteReader()
    '                                    While readerPedimento.Read()
    '                                        pLOTE = readerPedimento.Item(0).ToString
    '                                        pPEDIMENTO = readerPedimento.Item(1).ToString
    '                                        pFCHCADUC = readerPedimento.Item(2).ToString
    '                                        pFCHADUANA = readerPedimento.Item(3).ToString
    '                                        pFCHULTMOV = readerPedimento.Item(4).ToString
    '                                        pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                                        pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6))
    '                                        pCVE_OBS = readerPedimento.Item(7).ToString
    '                                        pCIUDAD = readerPedimento.Item(8).ToString
    '                                        pFRONTERA = readerPedimento.Item(9).ToString
    '                                        pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                                        pGLN = readerPedimento.Item(11).ToString
    '                                        pSTATUS = readerPedimento.Item(12).ToString
    '                                        pPARCIAL = readerPedimento.Item(13).ToString
    '                                        Dim vvll_ltpd = readerPedimento.Item(13).ToString
    '                                        If pFCHCADUC <> "" Then
    '                                            pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFCHADUANA <> "" Then
    '                                            pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFCHULTMOV <> "" Then
    '                                            pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        If pFEC_PROD_LT <> "" Then
    '                                            pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                                        End If
    '                                        '*********************************************
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '------------------INSERTAR PEDIMENTOS EN SAE
    '                                        sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                                        "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                                        "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                                        "STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + Trim(NUM_ALM) + "','" + pFCHCADUC + "','" + _
    '                                         pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD.ToString + "','" + pREG_LTPD + "','" + _
    '                                         pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET LOTE = '', FCHCADUC = NULL, FEC_PROD_LT= NULL, GLN = '' " + _
    '                                        " WHERE PEDIMENTO ='" + pPEDIMENTO.ToString + "'" + _
    '                                        " AND CVE_ART = '" + CVE_ART.ToString + "'" + _
    '                                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                        '---- extraer el consecutivo E_LTPD de SAE
    '                                        Dim readerLTPD As FbDataReader
    '                                        sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                                        If connFB.State = ConnectionState.Closed Then
    '                                            connFB.Open()
    '                                        End If
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        readerLTPD = cmdFB.ExecuteReader()
    '                                        While readerLTPD.Read()
    '                                            'MsgBox(reader7.Item(0))
    '                                            E_LTPD = readerLTPD.Item(0).ToString
    '                                            E_LTPD = Val(E_LTPD) + 1
    '                                        End While
    '                                        If E_LTPD = "" Then E_LTPD = "1"
    '                                        readerLTPD.Close()
    '                                        'sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        'E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                                        sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                                        E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()

    '                                        ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                                        'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
    '                                        '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                                        '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='O'" + _
    '                                        '" AND REG_LTPD ='" + vvll_ltpd.ToString + "'"
    '                                        'cmd = New SqlCommand(SqlSelection, conn)
    '                                        'cmd.ExecuteNonQuery()
    '                                    End While
    '                                    If conn.State = ConnectionState.Open Then
    '                                        conn.Close()
    '                                    End If
    '                                    readerPedimento.Close()
    '                                    '---------------------------------------------------------------
    '                                    'END INSERTAR PEDIMENTOS
    '                                    '---------------------------------------------------------------
    '                                End If
    '                                If vlNumSer = "S" Then
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                                        "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','" + _
    '                                        "N','1','0','C','0','0','1')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                                        "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','" + _
    '                                        "N','1','0','C','0','0','1')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                Else
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','0','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "')"
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                                        "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','0','" + E_LTPD + "','" + FACTCONV + "','" + COST + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','" + _
    '                                        "N','1','0','C','0','0','1')"
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                                        "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                                        "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                                        CVE_OBS + "','0','" + E_LTPD + "','" + FACTCONV + "','" + COST + "','" + _
    '                                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','" + _
    '                                        "N','1','0','C','0','0','1')"
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                End If
    '                                'INSERTAR EL INDICE
    '                                sqllocal = "insert into PAR_COMPR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc.ToString + "','" + NUM_PAR + "')"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'actualizar detalle
    '                                sqllocal = "update PAR_COMPO" + vgNumEmpresa.ToString + " set PXR = PXR - " + CANT.ToString + _
    '                                " where CVE_DOC = '" + CVE_DOC.ToString + "' and CVE_ART = '" + CVE_ART + "'"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'actualizar ACUMULADOR 102
    '                                sqllocal = "update ACOMP" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '                                " RIMP = RIMP + " + TOTIMP4 + "" + _
    '                                " where CVE_ACOMP = '11'"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()

    '                                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                'insertar documentos siguientes
    '                                sqllocal = "INSERT INTO DOCTOSIGC" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '                                "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '                                "'r','" + pcvedoc.ToString + "','A','o','" + CVE_DOC.ToString + "','" + _
    '                                NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                sqllocal = "INSERT INTO DOCTOSIGC" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '                                "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '                                "'o','" + CVE_DOC.ToString + "','S','r','" + pcvedoc.ToString + "','" + _
    '                                NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'Dim dateactual As String = time
    '                                'dateactual = Convert.ToDateTime(dateactual).ToString("yyyy/MM/dd")
    '                                'sqllocal = "UPDATE FOLIOSC" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
    '                                '",FECH_ULT_DOC = '" + dateactual + "' WHERE TIP_DOC = 'r'"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                'actualizar las existencias
    '                                'Call ActualizarExistencias(CVE_ART, CANT)
    '                                If vgVersion = "5" Then
    '                                    sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", FCH_ULTCOM = '" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                    " COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", COSTO_PROM = " + COST + "," + _
    '                                    " ULT_COSTO = " + COST + ", COMP_ANL_C = COMP_ANL_C + " + CANT.ToString + ", COMP_ANL_M = COMP_ANL_M + " + TOT_PARTIDA + "" + _
    '                                    " WHERE CVE_ART ='" + CVE_ART + "'"
    '                                End If
    '                                If vgVersion = "6" Then
    '                                    sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", FCH_ULTCOM = '" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                    " COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", COSTO_PROM = " + COST + ", VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
    '                                    " ULT_COSTO = " + COST + ", COMP_ANL_C = COMP_ANL_C + " + CANT.ToString + ", COMP_ANL_M = COMP_ANL_M + " + TOT_PARTIDA + "" + _
    '                                    " WHERE CVE_ART ='" + CVE_ART + "'"
    '                                End If
    '                                If vgVersion = "7" Then
    '                                    sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", FCH_ULTCOM = '" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                    " COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", COSTO_PROM = " + COST + ", VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
    '                                    " ULT_COSTO = " + COST + ", COMP_ANL_C = COMP_ANL_C + " + CANT.ToString + ", COMP_ANL_M = COMP_ANL_M + " + TOT_PARTIDA + "" + _
    '                                    " WHERE CVE_ART ='" + CVE_ART + "'"
    '                                End If
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                '-----------------------------------------------
    '                                'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
    '                                Dim vExistencia As String = ""
    '                                Dim reader3 As FbDataReader
    '                                Sql = "Select coalesce(max(EXIST),0) AS num from INVE" + vgNumEmpresa.ToString + " where CVE_ART = '" + CVE_ART + "'"
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                reader3 = cmdFB.ExecuteReader()
    '                                While reader3.Read()
    '                                    'MsgBox(reader3.Item(0))
    '                                    vExistencia = reader3.Item(0).ToString
    '                                    'vExistencia = Val(vExistencia) + 1
    '                                End While
    '                                If vExistencia = "" Then vExistencia = "1"
    '                                reader3.Close()
    '                                '---------EXTRAER CLAVE DEL FOLIO
    '                                Dim CVE_FOLIO As String = ""
    '                                Dim readerFOLIO As FbDataReader
    '                                Sql = "Select ULT_CVE AS num from TBLCONTROL" + vgNumEmpresa.ToString + " where ID_TABLA = 32"
    '                                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                                readerFOLIO = cmdFB.ExecuteReader()
    '                                While readerFOLIO.Read()
    '                                    'MsgBox(reader3.Item(0))
    '                                    CVE_FOLIO = readerFOLIO.Item(0).ToString
    '                                    'vExistencia = Val(vExistencia) + 1
    '                                End While
    '                                If CVE_FOLIO = "" Then CVE_FOLIO = "1"
    '                                readerFOLIO.Close()
    '                                '-----------------------------------------------
    '                                CTLPOL = "0"
    '                                If vlNumSer = "S" Then
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                                        "S','0','" + COST + "','N','0')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                                        "S','0','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'R','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                                        "S','0','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                        cmdFB.ExecuteNonQuery()
    '                                    End If
    '                                Else
    '                                    If vgVersion = "5" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                                        "S','0','" + COST + "','N','0')"
    '                                    End If
    '                                    If vgVersion = "6" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'r','" + pcvedoc.ToString + "','" + pcve_prov + "','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','" + CVE_FOLIO + "','1','" + _
    '                                        "S','" + COST + "','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                    End If
    '                                    If vgVersion = "7" Then
    '                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                                        "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                                        "'R','" + pcvedoc.ToString + "','" + pcve_prov + "','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                                        FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','" + CVE_FOLIO + "','1','" + _
    '                                        "S','" + COST + "','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                                    End If
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                    sqllocal = "UPDATE MINVE" + vgNumEmpresa.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " + _
    '                                    " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" + _
    '                                    " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcvedoc.ToString + "'"
    '                                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                    cmdFB.ExecuteNonQuery()
    '                                End If
    '                                Dim VERSION_SINC As String
    '                                VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
    '                                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" + _
    '                                " WHERE CVE_ART = '" + CVE_ART + "'" + _
    '                                " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
    '                                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                cmdFB.ExecuteNonQuery()
    '                                'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                                'cmdFB.ExecuteNonQuery()
    '                                If vlNumSer = "S" Then
    '                                    mREG_SERIE = Val(mREG_SERIE) + 1
    '                                End If
    '                                vlsubtotal = vlsubtotal + (COST * CANT)
    '                            End While
    '                            readerPAR_COMPO.Close()
    '                        End If
    '                        '-------------------------------------------------------------------------------------------
    '                        '-----------------------FIN SIN LOTES

    '                        Dim dateactual As String = time
    '                        dateactual = Convert.ToDateTime(dateactual).ToString("yyyy/MM/dd")
    '                        sqllocal = "UPDATE FOLIOSC" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
    '                                   ",FECH_ULT_DOC = '" + dateactual + "' WHERE TIP_DOC = 'r'"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        '------------------------
    '                        '------------------------
    '                        vfSubtot = vlsubtotal
    '                        objTransFB.Commit()
    '                        '------------------------
    '                        '------------------------
    '                        If vfSubtot >= 1 Then
    '                            Dim vfIVA As Double = vfSubtot * 0.16
    '                            Dim vfNeto As Double = vfSubtot + vfIVA
    '                            sqllocal = "update COMPR" + vgNumEmpresa.ToString + " set CAN_TOT = '" + vfSubtot.ToString + "', IMP_TOT4 = '" + vfIVA.ToString + "'," + _
    '                            " IMPORTE = '" + vfNeto.ToString + "', FECHA_CANCELA = NULL, NUM_PAGOS=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                    End If
    '                Next
    '                '-------------------PENDIENTE
    '                If vlConf_Cve_Doc = 0 Then OrdenCompra = Trim(OrdenCompra)
    '                If vlConf_Cve_Doc = 1 Then
    '                    'QUITAR espacios
    '                    OrdenCompra = Trim(OrdenCompra)
    '                    'QUITAR DE LA IZQUIERDA ceros
    '                    OrdenCompra = ceros(OrdenCompra, 10)
    '                End If
    '                If vlConf_Cve_Doc = 2 Then OrdenCompra = espacios(OrdenCompra, 20)
    '                '------------------------------------
    '                If Trim(vEstatus) = "6" Then
    '                    Dim sql As String = "update Logistik_supply_order SET EnviadaSAE = 'N', id_supply_order_state = '8'" + _
    '                    " WHERE id_supply_order = '" + Trim(OrdenCompra.ToString) + "'"
    '                    EjecutarQuerySQL_EMPRESA(sql)
    '                    '-------------------------
    '                    Dim vart As String
    '                    Dim readerPC As SqlDataReader
    '                    sql = "select upc from Logistik_supply_order_detail" + _
    '                    " where id_supply_order = '" + Trim(OrdenCompra.ToString) + "'"
    '                    If conn.State = ConnectionState.Closed Then
    '                        conn.Open()
    '                    End If
    '                    cmd = New SqlCommand(sql, conn)
    '                    readerPC = cmd.ExecuteReader()
    '                    While readerPC.Read()
    '                        vart = readerPC.Item(0).ToString
    '                        sql = "update Logistik_supply_order_detail set quantity_expected = quantity_expected - quantity_received," + _
    '                              " quantity_received = 0 " + _
    '                              " where id_supply_order = '" + Trim(OrdenCompra.ToString) + "' and upc = '" + vart + "'"
    '                        EjecutarQuerySQL_EMPRESA(sql)
    '                    End While
    '                    If conn.State = ConnectionState.Open Then
    '                        conn.Close()
    '                    End If
    '                    readerPC.Close()
    '                    '--------------------------
    '                    sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'D'" + _
    '                    " WHERE CVE_DOC_SQL ='" + Trim(OrdenCompra.ToString) + "' and STATUS ='N'"
    '                    EjecutarQuerySQL_EMPRESA(sqllocal)
    '                Else
    '                    Dim sql As String = "update Logistik_supply_order SET EnviadaSAE = 'S', id_supply_order_state = '7'" + _
    '                                    " WHERE id_supply_order = '" + Trim(OrdenCompra.ToString) + "'"
    '                    EjecutarQuerySQL_EMPRESA(sql)

    '                    sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'D'" + _
    '                    " WHERE CVE_DOC_SQL ='" + Trim(OrdenCompra.ToString) + "' and STATUS ='N'"
    '                    EjecutarQuerySQL_EMPRESA(sqllocal)

    '                End If
    '            End If
    '        Next
    '        'MsgBox("Almacenado correctamente")
    '    Catch es As SqlException
    '        objTransFB.Rollback()
    '        Throw es

    '    Catch ex As Exception
    '        '***** rollback the transaction ************************************************'
    '        objTransFB.Rollback()
    '        MsgBox(ex.Message.ToString)
    '        Throw ex

    '    Finally
    '        If connSAE.State <> ConnectionState.Closed Then connSAE.Close()
    '    End Try
    'End Sub
    'Private Sub LLEVARComprasFB()
    '    'enviar compras al sae
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=PASS;"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        'EnviadaSAE = S
    '        'EnviadaSAE = N
    '        'sqllocal = "select lso.id_supply_order, lso.id_supply_order_state, lso.EnviadaSAE, lsod.quantity_received" + _
    '        '" from Logistik_supply_order as lso, Logistik_supply_order_detail as lsod" + _
    '        '" where lso.id_supply_order = lsod.id_supply_order" + _
    '        '" and lso.EnviadaSAE = 'N' and lso.id_supply_order_state = 5"
    '        sqllocal = "select id_supply_order, id_supply_order_state, doc_sig_sae from Logistik_supply_order where EnviadaSAE = 'N' and id_supply_order_state in (5,6)"
    '        Dim daPC As New SqlDataAdapter(sqllocal, conn)
    '        Dim dsPC As New DataSet
    '        daPC.Fill(dsPC, "Logistik_supply_order")
    '        Dim oTablePC As New DataTable
    '        oTablePC = dsPC.Tables("Logistik_supply_order")
    '        Dim OrdenCompra As String
    '        Dim RecepcionCompra As String
    '        Dim vEstatus As String
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        For Each oRowPC In oTablePC.Rows
    '            OrdenCompra = oRowPC.Item("id_supply_order").ToString
    '            RecepcionCompra = oRowPC.Item("doc_sig_sae").ToString
    '            vEstatus = oRowPC.Item("id_supply_order_state").ToString
    '            '----------------buscar configuracion DE LA ORDEN DE COMPRA
    '            Dim reader As FbDataReader
    '            Dim vlConf_Cve_Doc As Integer = Nothing
    '            Dim SqlSelection As String = "Select MASCARA from PARAM_FOLIOSC" + vgNumEmpresa.ToString + _
    '            " where NUM_EMP = '1' AND TIPODOCTO = 'O'"
    '            cmdFB = New FbCommand(SqlSelection, connFB)
    '            reader = cmdFB.ExecuteReader()
    '            While reader.Read()
    '                'MsgBox(reader.Item(0))
    '                vlConf_Cve_Doc = Trim(reader.Item(0).ToString)
    '                Exit While
    '            End While
    '            reader.Close()
    '            If vlConf_Cve_Doc <> 0 And vlConf_Cve_Doc <> 1 And vlConf_Cve_Doc <> 2 Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            If vlConf_Cve_Doc = 0 Then OrdenCompra = espacios(OrdenCompra, 20)
    '            If vlConf_Cve_Doc = 1 Then
    '                'agregar ceros
    '                OrdenCompra = ceros(OrdenCompra, 10)
    '                'agregar espacios
    '                OrdenCompra = espacios(OrdenCompra, 20)
    '            End If
    '            If vlConf_Cve_Doc = 2 Then OrdenCompra = Trim(OrdenCompra)
    '            sqllocal = "select TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," + _
    '            "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," + _
    '            "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," + _
    '            "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," + _
    '            "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," + _
    '            "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG from COMPO" + vgNumEmpresa.ToString + _
    '            " WHERE CVE_DOC = '" & OrdenCompra & "'"
    '            '" WHERE ENLAZADO='O' and TIP_DOC_E = 'O'"
    '            Dim da As New FbDataAdapter(sqllocal, connFB)
    '            Dim ds As New DataSet
    '            da.Fill(ds, "COMPO" & vgNumEmpresa.ToString)
    '            Dim oTable As New DataTable
    '            oTable = ds.Tables("COMPO" & vgNumEmpresa.ToString)
    '            '----------------buscar configuracion DE LA RECEPCION
    '            Dim reader33 As FbDataReader
    '            'Dim vlConf_Cve_Doc As Integer = Nothing
    '            SqlSelection = "Select MASCARA from PARAM_FOLIOSC" + vgNumEmpresa.ToString + _
    '            " where NUM_EMP = '1' AND TIPODOCTO = 'R'"
    '            cmdFB = New FbCommand(SqlSelection, connFB)
    '            reader33 = cmdFB.ExecuteReader()
    '            While reader33.Read()
    '                'MsgBox(reader.Item(0))
    '                vlConf_Cve_Doc = Trim(reader33.Item(0).ToString)
    '                Exit While
    '            End While
    '            reader33.Close()
    '            If vlConf_Cve_Doc <> 0 And vlConf_Cve_Doc <> 1 And vlConf_Cve_Doc <> 2 Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            If vlConf_Cve_Doc = 0 Then OrdenCompra = espacios(OrdenCompra, 20)
    '            If vlConf_Cve_Doc = 1 Then
    '                'agregar ceros
    '                OrdenCompra = ceros(OrdenCompra, 10)
    '                'agregar espacios
    '                OrdenCompra = espacios(OrdenCompra, 20)
    '            End If
    '            If vlConf_Cve_Doc = 2 Then OrdenCompra = Trim(OrdenCompra)
    '            Dim TIP_DOC As String
    '            Dim CVE_DOC As String
    '            Dim CVE_CLPV As String
    '            Dim STATUS As String
    '            Dim SU_REFER As String
    '            Dim FECHA_DOC As String
    '            Dim FECHA_REC As String
    '            Dim FECHA_PAG As String
    '            Dim FECHA_CANCELA As String
    '            Dim CAN_TOT As Double
    '            Dim IMP_TOT1 As String
    '            Dim IMP_TOT2 As String
    '            Dim IMP_TOT3 As String
    '            Dim IMP_TOT4 As String
    '            Dim DES_TOT As String
    '            Dim DES_FIN As String
    '            Dim TOT_IND As String
    '            Dim OBS_COND As String
    '            Dim CVE_OBS As String
    '            Dim NUM_ALMA As String
    '            Dim ACT_CXP As String
    '            Dim ACT_COI As String
    '            Dim NUM_MONED As String
    '            Dim TIPCAMB As String
    '            Dim ENLAZADO As String
    '            Dim TIP_DOC_E As String
    '            Dim NUM_PAGOS As String
    '            Dim FECHAELAB As String
    '            Dim SERIE As String
    '            Dim FOLIO As String
    '            Dim CTLPOL As String
    '            Dim ESCFD As String
    '            Dim CONTADO As String
    '            Dim BLOQ As String
    '            Dim DES_FIN_PORC As String
    '            Dim DES_TOT_PORC As String
    '            Dim IMPORTE As String
    '            Dim TIP_DOC_ANT As String
    '            Dim DOC_ANT As String
    '            Dim TIP_DOC_SIG As String
    '            Dim DOC_SIG As String
    '            Dim SigCveDoc As String
    '            Dim vCveDoc As String = ""
    '            If oTable.Rows.Count >= 1 Then
    '                '---------------------------------------
    '                objTransFB = connFB.BeginTransaction
    '                '--------------------------------------
    '                For Each oRow In oTable.Rows
    '                    TIP_DOC = "r"
    '                    'SigCveDoc = TraerCveDocSigRecep()
    '                    'CVE_DOC = SigCveDoc
    '                    CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
    '                    STATUS = oRow.Item("STATUS").ToString
    '                    SU_REFER = oRow.Item("SU_REFER").ToString
    '                    FECHA_DOC = oRow.Item("FECHA_DOC").ToString
    '                    If FECHA_DOC <> "" Then
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd")
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy-MM-dd hh:mm:ss.mmm")
    '                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
    '                        'Dim vfecha As Date = FECHA_DOC
    '                        'FECHA_DOC = Format(vfecha, "dd/MM/yyyy")
    '                    End If
    '                    FECHA_REC = time
    '                    FECHA_REC = Convert.ToDateTime(time).ToString("yyyy/MM/dd")
    '                    'FECHA_REC = oRow.Item("FECHA_REC").ToString
    '                    'If FECHA_REC <> "" Then
    '                    '    'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                    '    FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("yyyy/MM/dd")
    '                    '    'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("dd/MM/yyyy hh:mm:ss")
    '                    '    'Dim vfecha As Date = FECHA_REC
    '                    '    'FECHA_REC = Format(vfecha, "dd/MM/yyyy")
    '                    'End If
    '                    FECHA_PAG = oRow.Item("FECHA_PAG").ToString
    '                    If FECHA_PAG <> "" Then
    '                        'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("yyyy/MM/dd")
    '                        'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("dd/MM/yyyy hh:mm:ss")
    '                        'Dim vfecha As Date = FECHA_PAG
    '                        'FECHA_PAG = Format(vfecha, "dd/MM/yyyy")
    '                    End If
    '                    FECHA_CANCELA = oRow.Item("FECHA_CANCELA").ToString
    '                    If FECHA_CANCELA <> "" Then
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd")
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("dd/MM/yyyy hh:mm:ss")
    '                        'Dim vfecha As Date = FECHA_CANCELA
    '                        'FECHA_CANCELA = Format(vfecha, "dd/MM/yyyy")
    '                    Else
    '                        FECHA_CANCELA = time.ToString("yyyy/MM/dd")
    '                    End If
    '                    CAN_TOT = Convert.ToDouble(oRow.Item("CAN_TOT"))
    '                    IMP_TOT1 = oRow.Item("IMP_TOT1").ToString
    '                    IMP_TOT2 = oRow.Item("IMP_TOT2").ToString
    '                    IMP_TOT3 = oRow.Item("IMP_TOT3").ToString
    '                    IMP_TOT4 = oRow.Item("IMP_TOT4").ToString
    '                    DES_TOT = oRow.Item("DES_TOT").ToString
    '                    DES_FIN = oRow.Item("DES_FIN").ToString
    '                    TOT_IND = oRow.Item("TOT_IND").ToString
    '                    OBS_COND = oRow.Item("OBS_COND").ToString
    '                    CVE_OBS = oRow.Item("CVE_OBS").ToString
    '                    NUM_ALMA = oRow.Item("NUM_ALMA").ToString
    '                    ACT_CXP = oRow.Item("ACT_CXP").ToString
    '                    ACT_COI = oRow.Item("ACT_COI").ToString
    '                    NUM_MONED = oRow.Item("NUM_MONED").ToString
    '                    TIPCAMB = oRow.Item("TIPCAMB").ToString
    '                    ENLAZADO = oRow.Item("ENLAZADO").ToString
    '                    If Trim(vEstatus) = "6" Then
    '                        ENLAZADO = "P"
    '                    Else
    '                        ENLAZADO = "O"
    '                    End If
    '                    TIP_DOC_E = "r"
    '                    NUM_PAGOS = oRow.Item("NUM_PAGOS").ToString
    '                    If Val(NUM_PAGOS) < 1 Then
    '                        NUM_PAGOS = "0"
    '                    End If
    '                    FECHAELAB = vfechayhora
    '                    'FECHAELAB = oRow.Item("FECHAELAB").ToString
    '                    If FECHAELAB <> "" Then
    '                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                        FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd hh:mm:ss")
    '                        'FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("dd/MM/yyyy hh:mm:ss")
    '                    End If
    '                    SERIE = oRow.Item("SERIE").ToString
    '                    FOLIO = oRow.Item("FOLIO").ToString
    '                    CTLPOL = oRow.Item("CTLPOL").ToString
    '                    ESCFD = oRow.Item("ESCFD").ToString
    '                    CONTADO = oRow.Item("CONTADO").ToString
    '                    BLOQ = oRow.Item("BLOQ").ToString
    '                    DES_FIN_PORC = oRow.Item("DES_FIN_PORC").ToString
    '                    DES_TOT_PORC = oRow.Item("DES_TOT_PORC").ToString
    '                    IMPORTE = oRow.Item("IMPORTE").ToString
    '                    TIP_DOC_ANT = "o"
    '                    DOC_ANT = CVE_DOC
    '                    TIP_DOC_SIG = Nothing
    '                    DOC_SIG = Nothing
    '                    '----------------buscar clave del documento
    '                    If vgEspecificarDoc = True Then
    '                        vCveDoc = (UCase(RecepcionCompra))
    '                    Else
    '                        '----------------buscar configuracion
    '                        Dim readerDoc As FbDataReader
    '                        Dim SqlSelection7 As String = "Select ULT_DOC from FOLIOSC" + vgNumEmpresa.ToString + _
    '                        " where TIP_DOC = 'r'"
    '                        cmdFB = New FbCommand(SqlSelection7, connFB, objTransFB)
    '                        readerDoc = cmdFB.ExecuteReader()
    '                        While readerDoc.Read()
    '                            'MsgBox(reader.Item(0))
    '                            vCveDoc = Trim(readerDoc.Item(0).ToString)
    '                            'no se si se aumenta el consecutivo
    '                            vCveDoc = Val(vCveDoc) + 2
    '                            Exit While
    '                        End While
    '                        readerDoc.Close()
    '                    End If
    '                    If vCveDoc <> "" Then
    '                        ''---------------------------------------
    '                        'objTrans = connSAE.BeginTransaction()
    '                        ''--------------------------------------
    '                        If vlConf_Cve_Doc = 0 Then
    '                            vCveDoc = espacios(vCveDoc, 20)
    '                            '**********************************
    '                            DOC_ANT = espacios(DOC_ANT, 20)
    '                        End If
    '                        If vlConf_Cve_Doc = 1 Then
    '                            vCveDoc = ceros(vCveDoc, 10)
    '                            vCveDoc = espacios(vCveDoc, 20)
    '                            '**********************************
    '                            DOC_ANT = ceros(DOC_ANT, 10)
    '                            DOC_ANT = espacios(DOC_ANT, 20)
    '                        End If
    '                        If vlConf_Cve_Doc = 2 Then
    '                            vCveDoc = Trim(vCveDoc)
    '                            '*********************************
    '                            DOC_ANT = Trim(DOC_ANT)
    '                        End If
    '                        'If DAT_MOSTR = "" Then DAT_MOSTR = "0"
    '                        'If CAN_TOT = 0 Then CAN_TOT = 0
    '                        If IMP_TOT1 = "" Then IMP_TOT1 = "0"
    '                        If IMP_TOT2 = "" Then IMP_TOT2 = "0"
    '                        If IMP_TOT3 = "" Then IMP_TOT3 = "0"
    '                        If IMP_TOT4 = "" Then IMP_TOT4 = "0"
    '                        If DES_TOT = "" Then DES_TOT = "0"
    '                        If DES_FIN = "" Then DES_FIN = "0"
    '                        If TOT_IND = "" Then TOT_IND = "0"
    '                        If CVE_OBS = "" Then CVE_OBS = "0"
    '                        If NUM_ALMA = "" Then NUM_ALMA = "1"
    '                        If NUM_MONED = "" Then NUM_MONED = "1"
    '                        If TIPCAMB = "" Then TIPCAMB = "0"
    '                        If NUM_PAGOS = "" Then NUM_PAGOS = "0"
    '                        If FOLIO = "" Then FOLIO = "0"
    '                        If CTLPOL = "" Then CTLPOL = "0"
    '                        'If AUTORIZA = "" Then AUTORIZA = "0"
    '                        If FOLIO = "" Then FOLIO = "0"
    '                        'If DAT_ENVIO = "" Then DAT_ENVIO = "0"
    '                        'If CVE_BITA = "" Then CVE_BITA = "0"
    '                        If DES_FIN_PORC = "" Then DES_FIN_PORC = "0"
    '                        If DES_TOT_PORC = "" Then DES_TOT_PORC = "0"
    '                        If IMPORTE = "" Then IMPORTE = "0"
    '                        'If COM_TOT_PORC = "" Then COM_TOT_PORC = "0"
    '                        Dim vfolio As String = "0" 'vCveDoc
    '                        sqllocal = "insert into  COMPR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," + _
    '                        "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," + _
    '                        "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," + _
    '                        "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," + _
    '                        "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," + _
    '                        "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG) values (" + _
    '                        "'r','" + vCveDoc.ToString + "','" + CVE_CLPV + "','" + STATUS + "','" + SU_REFER + "','" + FECHA_DOC + "','" + FECHA_REC + "','" + _
    '                        FECHA_PAG + "','" + FECHA_CANCELA + "','" + CAN_TOT.ToString + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + IMP_TOT4 + "','" + _
    '                        DES_TOT + "','" + DES_FIN + "','" + TOT_IND + "','" + OBS_COND + "','" + CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXP + "','" + _
    '                        ACT_COI + "','" + NUM_MONED + "','" + TIPCAMB + "','" + ENLAZADO + "','o','" + NUM_PAGOS + "','" + FECHAELAB + "','" + _
    '                        SERIE + "','" + vfolio.ToString + "','" + CTLPOL + "','" + ESCFD + "','" + CONTADO + "','" + BLOQ + "','" + DES_FIN_PORC + "','" + _
    '                        DES_TOT_PORC + "','" + IMPORTE + "','" + TIP_DOC_ANT + "','" + DOC_ANT.ToString + "',NULL,NULL)"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        sqllocal = "insert into  COMPR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC) values ('" + vCveDoc.ToString + "')"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'cmdFB.ExecuteNonQuery()
    '                        '---------------------
    '                        'Dim vCve_Obs As String = TraerClaveSiguiente()
    '                        Dim vCve_Obs As String
    '                        Dim vcont7 As String = ""
    '                        Dim reader7 As FbDataReader
    '                        sqllocal = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCC" + vgNumEmpresa.ToString
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        reader7 = cmdFB.ExecuteReader()
    '                        While reader7.Read()
    '                            'MsgBox(reader7.Item(0))
    '                            vcont7 = reader7.Item(0).ToString
    '                            vcont7 = Val(vcont7) + 1
    '                        End While
    '                        If vcont7 = "" Then vcont7 = "1"
    '                        vCve_Obs = vcont7
    '                        reader7.Close()
    '                        '-----------------------------------
    '                        Dim vObser As String = "Buenas O. C. HH"
    '                        'sqllocal = "INSERT INTO OBS_DOCC" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'cmdFB.ExecuteNonQuery()
    '                        'Call UpdateOC(CVE_DOC, vCveDoc)
    '                        If Trim(vEstatus) = "6" Then
    '                            sqllocal = "update COMPO" + vgNumEmpresa.ToString + " SET ENLAZADO='P', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc.ToString + "'" + _
    '                            " WHERE CVE_DOC ='" + CVE_DOC.ToString + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        Else
    '                            sqllocal = "update COMPO" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc.ToString + "'" + _
    '                            " WHERE CVE_DOC ='" + CVE_DOC.ToString + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                        '------------------------
    '                        objTransFB.Commit()
    '                        '------------------------
    '                        Dim vfSubtot As Double
    '                        vfSubtot = RecepcionDatalleSAEFB(vCveDoc, vObser, CVE_DOC, CVE_CLPV)
    '                        '------------------------
    '                        'objTransFB.Commit()
    '                        '------------------------
    '                        If vfSubtot >= 1 Then
    '                            Dim vfIVA As Double = vfSubtot * 0.16
    '                            Dim vfNeto As Double = vfSubtot + vfIVA
    '                            sqllocal = "update COMPR" + vgNumEmpresa.ToString + " set CAN_TOT = '" + vfSubtot.ToString + "', IMP_TOT4 = '" + vfIVA.ToString + "'," + _
    '                            " IMPORTE = '" + vfNeto.ToString + "', FECHA_CANCELA = NULL, NUM_PAGOS=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
    '                            cmdFB = New FbCommand(sqllocal, connFB)
    '                            cmdFB.ExecuteNonQuery()
    '                        End If
    '                    End If
    '                Next
    '                '-------------------PENDIENTE
    '                If vlConf_Cve_Doc = 0 Then OrdenCompra = Trim(OrdenCompra)
    '                If vlConf_Cve_Doc = 1 Then
    '                    'QUITAR espacios
    '                    OrdenCompra = Trim(OrdenCompra)
    '                    'QUITAR DE LA IZQUIERDA ceros
    '                    OrdenCompra = Quitarceros(OrdenCompra)

    '                End If
    '                If vlConf_Cve_Doc = 2 Then OrdenCompra = Trim(OrdenCompra)
    '                '------------------------------------
    '                If Trim(vEstatus) = "6" Then
    '                    Dim sql As String = "update Logistik_supply_order SET EnviadaSAE = 'N', id_supply_order_state = '8'" + _
    '                    " WHERE id_supply_order = '" + Trim(OrdenCompra.ToString) + "'"
    '                    EjecutarQuerySQL_EMPRESA(sql)
    '                    '-------------------------
    '                    Dim vart As String
    '                    Dim readerPC As SqlDataReader
    '                    sql = "select upc from Logistik_supply_order_detail" + _
    '                    " where id_supply_order = '" + Trim(OrdenCompra.ToString) + "'"
    '                    conn.Open()
    '                    cmd = New SqlCommand(sql, conn)
    '                    readerPC = cmd.ExecuteReader()
    '                    While readerPC.Read()
    '                        vart = readerPC.Item(0).ToString
    '                        sql = "update Logistik_supply_order_detail set quantity_expected = quantity_expected - quantity_received," + _
    '                              " quantity_received = 0 " + _
    '                              " where id_supply_order = '" + Trim(OrdenCompra.ToString) + "' and upc = '" + vart + "'"
    '                        EjecutarQuerySQL_EMPRESA(sql)
    '                    End While
    '                    conn.Close()
    '                    readerPC.Close()
    '                    '--------------------------
    '                    sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'D'" + _
    '                    " WHERE CVE_DOC_SQL ='" + Trim(OrdenCompra.ToString) + "' and STATUS ='N'"
    '                    EjecutarQuerySQL_EMPRESA(sqllocal)
    '                Else
    '                    Dim sql As String = "update Logistik_supply_order SET EnviadaSAE = 'S', id_supply_order_state = '7'" + _
    '                    " WHERE id_supply_order = '" + Trim(OrdenCompra.ToString) + "'"
    '                    EjecutarQuerySQL_EMPRESA(sql)

    '                    sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'D'" + _
    '                    " WHERE CVE_DOC_SQL ='" + Trim(OrdenCompra.ToString) + "' and STATUS ='N'"
    '                    EjecutarQuerySQL_EMPRESA(sqllocal)

    '                End If
    '            End If
    '        Next
    '        'MsgBox("Almacenado correctamente")
    '    Catch es As SqlException
    '        objTransFB.Rollback()
    '        Throw es

    '    Catch ex As Exception
    '        '***** rollback the transaction ************************************************'
    '        objTransFB.Rollback()
    '        MsgBox(ex.Message.ToString)
    '        Throw ex

    '    Finally
    '        If connSAE.State <> ConnectionState.Closed Then connSAE.Close()
    '    End Try
    'End Sub
    'Function RecepcionDatalleSAEFB(ByVal pcvedoc As String, ByVal pObser As String, ByVal pcve_doc_origen As String, ByVal pcve_prov As String) As Double
    '    'envia datos al sae
    '    Dim SqlSelection As String
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=PASS;"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        Dim CVE_DOC As String
    '        Dim NUM_PAR As String
    '        Dim CVE_ART As String
    '        Dim vlsubtotal As Double
    '        Dim CANT As Double
    '        Dim CANTp As Double
    '        Dim PXR As String
    '        Dim PREC As String
    '        Dim COST As String
    '        Dim IMPU1 As String
    '        Dim IMPU2 As String
    '        Dim IMPU3 As String
    '        Dim IMPU4 As String
    '        Dim IMP1APLA As String
    '        Dim IMP2APLA As String
    '        Dim IMP3APLA As String
    '        Dim IMP4APLA As String
    '        Dim TOTIMP1 As String
    '        Dim TOTIMP2 As String
    '        Dim TOTIMP3 As String
    '        Dim TOTIMP4 As String
    '        Dim DESCU As String
    '        Dim ACT_INV As String
    '        Dim TIP_CAM As String
    '        Dim UNI_VENTA As String
    '        Dim TIPO_ELEM As String
    '        Dim TIPO_PROD As String
    '        Dim CVE_OBS As String
    '        Dim REG_SERIE As String
    '        Dim E_LTPD As String
    '        Dim FACTCONV As String
    '        Dim COST_DEV As String
    '        Dim NUM_ALM As String
    '        Dim MINDIRECTO As String
    '        Dim NUM_MOV As String
    '        Dim TOT_PARTIDA As String
    '        '---------------------------------------
    '        objTransFB = connFB.BeginTransaction
    '        '--------------------------------------
    '        Dim readerPAR_COMPO As FbDataReader
    '        SqlSelection = "Select CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA  FROM PAR_COMPO" + vgNumEmpresa.ToString + " where CVE_DOC = '" + pcve_doc_origen.ToString + "'"
    '        cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '        readerPAR_COMPO = cmdFB.ExecuteReader()
    '        ' esta variable controla el consecutivo de las series
    '        Dim mREG_SERIE As String
    '        ' esta variable controla una sola entrada al ciclo de las series
    '        Dim vlMaxNum As Boolean = True
    '        While readerPAR_COMPO.Read()
    '            'MsgBox(reader2.Item(0))
    '            CVE_DOC = readerPAR_COMPO.Item(0).ToString
    '            NUM_PAR = readerPAR_COMPO.Item(1).ToString
    '            CVE_ART = readerPAR_COMPO.Item(2).ToString
    '            CANT = 0
    '            CANTp = readerPAR_COMPO.Item(3).ToString
    '            PXR = readerPAR_COMPO.Item(4).ToString
    '            PREC = readerPAR_COMPO.Item(5).ToString
    '            COST = readerPAR_COMPO.Item(6).ToString
    '            IMPU1 = readerPAR_COMPO.Item(7).ToString
    '            IMPU2 = readerPAR_COMPO.Item(8).ToString
    '            IMPU3 = readerPAR_COMPO.Item(9).ToString
    '            IMPU4 = readerPAR_COMPO.Item(10).ToString
    '            IMP1APLA = readerPAR_COMPO.Item(11).ToString
    '            IMP2APLA = readerPAR_COMPO.Item(12).ToString
    '            IMP3APLA = readerPAR_COMPO.Item(13).ToString
    '            IMP4APLA = readerPAR_COMPO.Item(14).ToString
    '            TOTIMP1 = readerPAR_COMPO.Item(15).ToString
    '            TOTIMP2 = readerPAR_COMPO.Item(16).ToString
    '            TOTIMP3 = readerPAR_COMPO.Item(17).ToString
    '            TOTIMP4 = readerPAR_COMPO.Item(18).ToString
    '            DESCU = readerPAR_COMPO.Item(19).ToString
    '            ACT_INV = readerPAR_COMPO.Item(20).ToString
    '            TIP_CAM = readerPAR_COMPO.Item(21).ToString
    '            UNI_VENTA = readerPAR_COMPO.Item(22).ToString
    '            TIPO_ELEM = readerPAR_COMPO.Item(23).ToString
    '            TIPO_PROD = readerPAR_COMPO.Item(24).ToString
    '            CVE_OBS = readerPAR_COMPO.Item(25).ToString
    '            REG_SERIE = readerPAR_COMPO.Item(26).ToString
    '            E_LTPD = readerPAR_COMPO.Item(27).ToString
    '            FACTCONV = readerPAR_COMPO.Item(28).ToString
    '            COST_DEV = readerPAR_COMPO.Item(29).ToString
    '            If COST_DEV = "" Then
    '                COST_DEV = "0"
    '            End If
    '            NUM_ALM = readerPAR_COMPO.Item(30).ToString
    '            MINDIRECTO = readerPAR_COMPO.Item(31).ToString
    '            NUM_MOV = readerPAR_COMPO.Item(32).ToString
    '            TOT_PARTIDA = readerPAR_COMPO.Item(33).ToString
    '            '-------------------Traer la clave siguiente
    '            'CVE_OBS = TraerClaveSiguiente()
    '            Dim vcont As String = ""
    '            Dim vnum As Integer
    '            Dim reader As FbDataReader
    '            Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num from OBS_DOCC" + vgNumEmpresa.ToString
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            reader = cmdFB.ExecuteReader()
    '            While reader.Read()
    '                'MsgBox(reader.Item(0))
    '                vcont = reader.Item(0).ToString
    '                vcont = Val(vcont) + 1
    '            End While
    '            If vcont = "" Then vcont = "1"
    '            CVE_OBS = vcont
    '            reader.Close()
    '            '-------------------------------------------
    '            'sqllocal = "INSERT INTO OBS_DOCC" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            '---------------------crear el o los movimientos
    '            'Dim vNum_Mov As String = ConsecutivoMovimiento()
    '            Dim vNum_Mov As String
    '            Dim vcont7 As String = ""
    '            Dim reader7 As FbDataReader
    '            Sql = "Select coalesce(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            reader7 = cmdFB.ExecuteReader()
    '            While reader7.Read()
    '                'MsgBox(reader7.Item(0))
    '                vcont7 = reader7.Item(0).ToString
    '                vcont7 = Val(vcont7) + 1
    '            End While
    '            If vcont7 = "" Then vcont7 = "1"
    '            vNum_Mov = vcont7
    '            reader7.Close()
    '            '----------traer la cantidad
    '            Dim vlPedimento_OC As String = "0"
    '            Dim readerPC As SqlDataReader
    '            SqlSelection = "select quantity_received, Pedimento from Logistik_supply_order_detail" + _
    '            " where id_supply_order = '" + Trim(pcve_doc_origen.ToString) + "' and upc = '" + CVE_ART + "'"
    '            conn.Open()
    '            cmd = New SqlCommand(SqlSelection, conn)
    '            readerPC = cmd.ExecuteReader()
    '            While readerPC.Read()
    '                CANT = Convert.ToDouble(readerPC.Item(0))
    '                vlPedimento_OC = readerPC.Item(1).ToString
    '            End While
    '            conn.Close()
    '            readerPC.Close()
    '            'verificar el numero de decimales en la configuracion del sae
    '            'quitar o poner decimales en la cantidad
    '            '-------------------------------------------
    '            '-------------------------------------------
    '            '----------tiene pedimento y numero de serie
    '            Dim vlPedimento As String = "N"
    '            Dim vlNumSer As String = "N"
    '            Dim readerPedi As SqlDataReader
    '            SqlSelection = "select Pedimento, NumSerie from Logistik_product" + _
    '            " where upc = '" + CVE_ART + "'"
    '            conn.Open()
    '            cmd = New SqlCommand(SqlSelection, conn)
    '            readerPedi = cmd.ExecuteReader()
    '            While readerPedi.Read()
    '                vlPedimento = readerPedi.Item(0)
    '                vlNumSer = readerPedi.Item(1)
    '            End While
    '            conn.Close()
    '            readerPedi.Close()
    '            If vlNumSer = "S" Then
    '                '--------------------------------------------------------------
    '                'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
    '                '---------------------------------------------------------------
    '                '--------------------------H NUMEROS DE SERIE
    '                If vlMaxNum = True Then
    '                    Dim readerHNUMSER As FbDataReader
    '                    SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
    '                    '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                    If connFB.State = ConnectionState.Closed Then
    '                        connFB.Open()
    '                    End If
    '                    cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                    readerHNUMSER = cmdFB.ExecuteReader()
    '                    While readerHNUMSER.Read()
    '                        mREG_SERIE = readerHNUMSER.Item(0).ToString
    '                        mREG_SERIE = Val(mREG_SERIE) + 1
    '                    End While
    '                    'If connFB.State = ConnectionState.Open Then
    '                    '    connFB.Close()
    '                    'End If
    '                    readerHNUMSER.Close()
    '                    vlMaxNum = False
    '                End If
    '                '---------------------------------------------------
    '                Dim nNUM_SER As String
    '                Dim nCOSTO As String
    '                Dim nDOCTO_ENT As String
    '                Dim nFECHA_ENT As String
    '                Dim nREG_SERIE As String
    '                Dim readerLogistikNumSerie As SqlDataReader
    '                'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
    '                '" FROM Logistik_numeros_series" + _
    '                '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
    '                SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" + _
    '                " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" + _
    '                " where h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" + _
    '                " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART + _
    '                "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='N'"
    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                cmd = New SqlCommand(SqlSelection, conn)
    '                readerLogistikNumSerie = cmd.ExecuteReader()
    '                If connFB.State = ConnectionState.Closed Then
    '                    connFB.Open()
    '                End If
    '                Dim vlNo_Par As Integer = 1
    '                While readerLogistikNumSerie.Read()
    '                    Dim NumSer_Cve_Doc As String = pcve_doc_origen.ToString
    '                    NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
    '                    nNUM_SER = readerLogistikNumSerie.Item(0).ToString
    '                    nCOSTO = readerLogistikNumSerie.Item(1).ToString
    '                    nDOCTO_ENT = readerLogistikNumSerie.Item(2).ToString
    '                    nFECHA_ENT = readerLogistikNumSerie.Item(3).ToString
    '                    nREG_SERIE = readerLogistikNumSerie.Item(4).ToString
    '                    If nFECHA_ENT <> "" Then
    '                        nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    sqllocal = "INSERT INTO NUMSER" + vgNumEmpresa.ToString + "(CVE_ART,NUM_SER,STATUS,ALMACEN,COSTO,DOCTO_ENT,FECHA_ENT) VALUES ('" + _
    '                                CVE_ART + "','" + nNUM_SER + "','D','" + Trim(NUM_ALM) + "','" + _
    '                                nCOSTO + "','','" + nFECHA_ENT + "')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    '--------------EL NUMERO DE PARTIDA EMPEZA CON UNO HASTA TERMINAR
    '                    sqllocal = "INSERT INTO HNUMSER" + vgNumEmpresa.ToString + "(CVE_ART, NUM_SER, TIP_MOV, TIP_DOC, CVE_DOC, ALMACEN, " + _
    '                                "REG_SERIE, FECHA, STATUS, NO_PAR) VALUES ('" + _
    '                                CVE_ART + "','" + nNUM_SER + "','1','M','" + Trim(NumSer_Cve_Doc) + "','" + _
    '                                Trim(NUM_ALM) + "','" + mREG_SERIE.ToString + "','" + nFECHA_ENT + "','D','" + vlNo_Par.ToString + "')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()

    '                    ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                    'sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'D'" + _
    '                    '" where ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                    '" and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
    '                    '" AND NUM_SER ='" + nNUM_SER + "'"
    '                    'cmd = New SqlCommand(sqllocal, conn)
    '                    'cmd.ExecuteNonQuery()

    '                    vlNo_Par = vlNo_Par + 1
    '                End While
    '                If conn.State = ConnectionState.Open Then
    '                    conn.Close()
    '                End If
    '                readerLogistikNumSerie.Close()
    '                '--------------------------------------------------------------
    '                'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
    '                '--------------------------------------------------------------
    '            End If
    '            If vlPedimento = "S" Then
    '                '---------------------------------------------------------------
    '                'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
    '                '---------------------------------------------------------------
    '                '---- extraer el consecutivo REG_LTPD de SAE
    '                Dim pREG_LTPD As String
    '                Dim readerMAx As FbDataReader
    '                sqllocal = "Select coalesce(max(REG_LTPD),1) AS num from LTPD" + vgNumEmpresa.ToString
    '                If connFB.State = ConnectionState.Closed Then
    '                    connFB.Open()
    '                End If
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                readerMAx = cmdFB.ExecuteReader()
    '                While readerMAx.Read()
    '                    'MsgBox(reader7.Item(0))
    '                    pREG_LTPD = readerMAx.Item(0).ToString
    '                    pREG_LTPD = Val(pREG_LTPD) + 1
    '                End While
    '                If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                readerMAx.Close()
    '                '---EXTRAER DATOS DEL SQL
    '                Dim pLOTE As String
    '                Dim pPEDIMENTO As String
    '                Dim pFCHCADUC As String
    '                Dim pFCHADUANA As String
    '                Dim pFCHULTMOV As String
    '                Dim pNOM_ADUAN As String
    '                Dim pCANTIDAD As Double
    '                Dim pCVE_OBS As String
    '                Dim pCIUDAD As String
    '                Dim pFRONTERA As String
    '                Dim pFEC_PROD_LT As String
    '                Dim pGLN As String
    '                Dim pSTATUS As String
    '                Dim pPARCIAL As String
    '                '----------------------------PARA PARCIALIDADES EN PEDIMENTOS QUE HAY QUE HACER
    '                'N = NO ES PARCIAL, ES TOTAL NO HAY BRONCA
    '                'S = SI HAY BRONCA, QUE HAY QUE HACER
    '                ' TENEMOS DOS PEDIMENTOS CON EL MISMO DOCUEMNTO NO PUEDE SER HAY VIOLACION
    '                Dim readerPedimento As SqlDataReader
    '                'Dim readerLTPD As FbDataReader
    '                SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                "STATUS, REG_LTPD, PARCIAL  FROM Logistik_Lote_Pedimento" + _
    '                " where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                "' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='O'" + _
    '                " and PEDIMENTO = '" + Trim(vlPedimento_OC) + "'"
    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                cmd = New SqlCommand(SqlSelection, conn)
    '                readerPedimento = cmd.ExecuteReader()
    '                While readerPedimento.Read()
    '                    pLOTE = readerPedimento.Item(0).ToString
    '                    pPEDIMENTO = readerPedimento.Item(1).ToString
    '                    pFCHCADUC = readerPedimento.Item(2).ToString
    '                    pFCHADUANA = readerPedimento.Item(3).ToString
    '                    pFCHULTMOV = readerPedimento.Item(4).ToString
    '                    pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                    pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6))
    '                    pCVE_OBS = readerPedimento.Item(7).ToString
    '                    pCIUDAD = readerPedimento.Item(8).ToString
    '                    pFRONTERA = readerPedimento.Item(9).ToString
    '                    pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                    pGLN = readerPedimento.Item(11).ToString
    '                    pSTATUS = readerPedimento.Item(12).ToString
    '                    pPARCIAL = readerPedimento.Item(13).ToString
    '                    Dim vvll_ltpd = readerPedimento.Item(13).ToString
    '                    If pFCHCADUC <> "" Then
    '                        pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFCHADUANA <> "" Then
    '                        pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFCHULTMOV <> "" Then
    '                        pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFEC_PROD_LT <> "" Then
    '                        pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    '*********************************************
    '                    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    '------------------INSERTAR PEDIMENTOS EN SAE
    '                    sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                    "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                    "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                    "STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + Trim(NUM_ALM) + "','" + pFCHCADUC + "','" + _
    '                     pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD.ToString + "','" + pREG_LTPD + "','" + _
    '                     pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    sqllocal = "UPDATE LTPD" + vgNumEmpresa.ToString + " SET LOTE = '', FCHCADUC = NULL, FEC_PROD_LT= NULL, GLN = '' " + _
    '                    " WHERE PEDIMENTO ='" + pPEDIMENTO.ToString + "'" + _
    '                    " AND CVE_ART = '" + CVE_ART.ToString + "'" + _
    '                    " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    '---- extraer el consecutivo E_LTPD de SAE
    '                    Dim readerLTPD As FbDataReader
    '                    sqllocal = "Select coalesce(max(E_LTPD),1) AS num from ENLACE_LTPD" + vgNumEmpresa.ToString
    '                    If connFB.State = ConnectionState.Closed Then
    '                        connFB.Open()
    '                    End If
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    readerLTPD = cmdFB.ExecuteReader()
    '                    While readerLTPD.Read()
    '                        'MsgBox(reader7.Item(0))
    '                        E_LTPD = readerLTPD.Item(0).ToString
    '                        E_LTPD = Val(E_LTPD) + 1
    '                    End While
    '                    If E_LTPD = "" Then E_LTPD = "1"
    '                    readerLTPD.Close()
    '                    'sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                    'E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                    sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                    E_LTPD + "','" + pREG_LTPD.ToString + "','" + pCANTIDAD.ToString + "','" + pCANTIDAD.ToString + "')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()

    '                    ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                    'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
    '                    '" where CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                    '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='O'" + _
    '                    '" AND REG_LTPD ='" + vvll_ltpd.ToString + "'"
    '                    'cmd = New SqlCommand(SqlSelection, conn)
    '                    'cmd.ExecuteNonQuery()
    '                End While
    '                If conn.State = ConnectionState.Open Then
    '                    conn.Close()
    '                End If
    '                readerPedimento.Close()
    '                '---------------------------------------------------------------
    '                'END INSERTAR PEDIMENTOS
    '                '---------------------------------------------------------------
    '            End If
    '            If vlNumSer = "S" Then
    '                If vgVersion = "5" Then
    '                    sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                    "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                    "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                    "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA) values (" + _
    '                    "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                    IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                    "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                    CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                    NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                End If
    '                If vgVersion = "6" Then
    '                    sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                    "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                    "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                    "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                    "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                    "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                    IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                    "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                    CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                    NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','" + _
    '                    "N','1','0','C','0','0','1')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                End If
    '            Else
    '                If vgVersion = "5" Then
    '                    sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                    "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                    "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                    "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA) values (" + _
    '                    "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                    IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                    "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                    CVE_OBS + "','0','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" + _
    '                    NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "')"
    '                End If
    '                If vgVersion = "6" Then
    '                    sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " + _
    '                    "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," + _
    '                    "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," + _
    '                    "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA," + _
    '                    "MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                    "'" + pcvedoc.ToString + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXR + "','" + _
    '                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                    IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" + _
    '                    "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" + _
    '                    CVE_OBS + "','0','" + E_LTPD + "','" + FACTCONV + "','" + COST + "','" + _
    '                    NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','" + _
    '                    "N','1','0','C','0','0','1')"
    '                End If
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '            End If
    '            'INSERTAR EL INDICE
    '            sqllocal = "insert into PAR_COMPR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc.ToString + "','" + NUM_PAR + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'actualizar detalle
    '            sqllocal = "update PAR_COMPO" + vgNumEmpresa.ToString + " set PXR = PXR - " + CANT.ToString + _
    '            " where CVE_DOC = '" + CVE_DOC.ToString + "' and CVE_ART = '" + CVE_ART + "'"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'actualizar ACUMULADOR
    '            sqllocal = "update ACOMP" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '            " RIMP = RIMP + " + TOTIMP4 + "" + _
    '            " where CVE_ACOMP = '11'"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()

    '            sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            'insertar documentos siguientes
    '            sqllocal = "INSERT INTO DOCTOSIGC" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '            "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '            "'r','" + pcvedoc.ToString + "','A','o','" + CVE_DOC.ToString + "','" + _
    '            NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            sqllocal = "INSERT INTO DOCTOSIGC" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '            "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '            "'o','" + CVE_DOC.ToString + "','S','r','" + pcvedoc.ToString + "','" + _
    '            NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            Dim dateactual As String = time
    '            dateactual = Convert.ToDateTime(dateactual).ToString("yyyy/MM/dd")
    '            sqllocal = "UPDATE FOLIOSC" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
    '            ",FECH_ULT_DOC = '" + dateactual + "' WHERE TIP_DOC = 'r'"
    '            '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'actualizar las existencias
    '            'Call ActualizarExistencias(CVE_ART, CANT)
    '            If vgVersion = "5" Then
    '                sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", FCH_ULTCOM = '" + time.ToString("yyyy/MM/dd") + "'," + _
    '                " COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", COSTO_PROM = " + COST + "," + _
    '                " ULT_COSTO = " + COST + ", COMP_ANL_C = COMP_ANL_C + " + CANT.ToString + ", COMP_ANL_M = COMP_ANL_M + " + TOT_PARTIDA + "" + _
    '                " WHERE CVE_ART ='" + CVE_ART + "'"
    '            End If
    '            If vgVersion = "6" Then
    '                sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", FCH_ULTCOM = '" + time.ToString("yyyy/MM/dd") + "'," + _
    '                " COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", COSTO_PROM = " + COST + ", VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'," + _
    '                " ULT_COSTO = " + COST + ", COMP_ANL_C = COMP_ANL_C + " + CANT.ToString + ", COMP_ANL_M = COMP_ANL_M + " + TOT_PARTIDA + "" + _
    '                " WHERE CVE_ART ='" + CVE_ART + "'"
    '            End If

    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            '-----------------------------------------------
    '            'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
    '            Dim vExistencia As String = ""
    '            Dim reader3 As FbDataReader
    '            Sql = "Select coalesce(max(EXIST),0) AS num from INVE" + vgNumEmpresa.ToString + " where CVE_ART = '" + CVE_ART + "'"
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            reader3 = cmdFB.ExecuteReader()
    '            While reader3.Read()
    '                'MsgBox(reader3.Item(0))
    '                vExistencia = reader3.Item(0).ToString
    '                'vExistencia = Val(vExistencia) + 1
    '            End While
    '            If vExistencia = "" Then vExistencia = "1"
    '            reader3.Close()
    '            '---------EXTRAER CLAVE DEL FOLIO
    '            Dim CVE_FOLIO As String = ""
    '            Dim readerFOLIO As FbDataReader
    '            Sql = "Select ULT_CVE AS num from TBLCONTROL" + vgNumEmpresa.ToString + " where ID_TABLA = 32"
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            readerFOLIO = cmdFB.ExecuteReader()
    '            While readerFOLIO.Read()
    '                'MsgBox(reader3.Item(0))
    '                CVE_FOLIO = readerFOLIO.Item(0).ToString
    '                'vExistencia = Val(vExistencia) + 1
    '            End While
    '            If CVE_FOLIO = "" Then CVE_FOLIO = "1"
    '            readerFOLIO.Close()
    '            '-----------------------------------------------
    '            Dim CTLPOL As String = "0"
    '            If vlNumSer = "S" Then
    '                If vgVersion = "5" Then
    '                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                    "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                    FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                    "S','0','" + COST + "','N','0')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                End If
    '                If vgVersion = "6" Then
    '                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                    "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                    FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                    "S','0','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                End If
    '            Else
    '                If vgVersion = "5" Then
    '                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    "'r','" + pcvedoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                    "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                    FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','1','1','" + _
    '                    "S','0','" + COST + "','N','0')"
    '                End If
    '                If vgVersion = "6" Then
    '                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                    "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    "'r','" + pcvedoc.ToString + "','" + pcve_prov + "','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," + _
    '                    "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                    FACTCONV + "','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','" + CTLPOL + "','" + CVE_FOLIO + "','1','" + _
    '                    "S','" + COST + "','" + COST + "','N','0','" + vExistencia + "','" + COST + "')"
    '                End If
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '                sqllocal = "UPDATE MINVE" + vgNumEmpresa.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " + _
    '                " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" + _
    '                " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcvedoc.ToString + "'"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '            End If
    '            Dim VERSION_SINC As String
    '            VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
    '            sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + " + CANT.ToString + ", COMP_X_REC = COMP_X_REC - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" + _
    '            " WHERE CVE_ART = '" + CVE_ART + "'" + _
    '            " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            If vlNumSer = "S" Then
    '                mREG_SERIE = Val(mREG_SERIE) + 1
    '            End If
    '            vlsubtotal = vlsubtotal + (COST * CANT)
    '        End While
    '        readerPAR_COMPO.Close()
    '        '------------------------
    '        objTransFB.Commit()
    '        '------------------------

    '        Return vlsubtotal
    '    Catch es As SqlException
    '        objTransFB.Rollback()
    '        Throw es
    '        Return 0
    '    Catch ex As Exception
    '        '***** rollback the transaction ************************************************'
    '        objTransFB.Rollback()
    '        MsgBox(ex.Message.ToString)
    '        Return 0
    '    End Try
    'End Function

    Private Sub Compras(ByVal pMiBD As String, ByVal pNUMEMP As String, ByVal OrdenCompra As String)
        Label5.Text = "Sincronizar Compras del SQL al SAE parte 2"
        Me.Refresh()
        ' SACAR LA EMPRESA DEL SAE
        Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + My.Settings.vgCrearBD_Name + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim connection7 As New SqlConnection(Str1)
        Dim sqllocal As String = "SELECT NOMBRE_BD from EmpresaSAE " +
        " WHERE BASEDATOS = '" + pMiBD + "'"
        Dim daPC1 As New SqlDataAdapter(sqllocal, connection7)
        Dim dsPC1 As New DataSet
        daPC1.Fill(dsPC1, "EmpresaSAE")
        Dim oTablePC1 As New DataTable
        oTablePC1 = dsPC1.Tables("EmpresaSAE")
        Dim MI_BD_x As String = ""
        For Each oRowPC7 In oTablePC1.Rows
            MI_BD_x = oRowPC7.Item("NOMBRE_BD").ToString
        Next
        'enviar compras al sae
        'TextErrorEmp2.Text = TextErrorEmp2.Text + " BDsae2:" + MI_BD_x + " BDlog2:" + pMiBD
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + MI_BD_x + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";MultipleActiveResultSets=True;"
        'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD_x + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim Str3 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim conn As New SqlConnection(Str)
        Dim conn2 As New SqlConnection(Str2)
        Dim conn3 As New SqlConnection(Str3)
        'Dim comd1 As SqlCommand = New SqlCommand
        Dim TIP_DOC As String
        Dim CVE_DOC As String
        Dim CVE_CLPV As String
        Dim STATUS As String
        Dim SU_REFER As String
        Dim FECHA_DOC As String
        Dim FECHA_REC As String
        Dim FECHA_PAG As String
        Dim FECHA_CANCELA As String
        Dim CAN_TOT As Double
        Dim IMP_TOT1 As String
        Dim IMP_TOT2 As String
        Dim IMP_TOT3 As String
        Dim IMP_TOT4 As String
        Dim DES_TOT As String
        Dim DES_FIN As String
        Dim TOT_IND As String
        Dim OBS_COND As String
        Dim CVE_OBS As String
        Dim NUM_ALMA As String
        Dim ACT_CXP As String
        Dim ACT_COI As String
        Dim NUM_MONED As String
        Dim TIPCAMB As String
        Dim ENLAZADO As String
        Dim TIP_DOC_E As String
        Dim NUM_PAGOS As String
        Dim FECHAELAB As String
        Dim SERIE As String
        Dim FOLIO As String
        Dim CTLPOL As String
        Dim ESCFD As String
        Dim CONTADO As String
        Dim BLOQ As String
        Dim DES_FIN_PORC As String
        Dim DES_TOT_PORC As String
        Dim IMPORTE As String
        Dim TIP_DOC_ANT As String
        Dim DOC_ANT As String
        Dim TIP_DOC_SIG As String
        Dim DOC_SIG As String
        Dim SigCveDoc As String
        Try
            'EnviadaSAE = S
            'EnviadaSAE = N
            'sqllocal = "select lso.id_supply_order, lso.id_supply_order_state, lso.EnviadaSAE, lsod.quantity_received" + _
            '" from Logistik_supply_order as lso, Logistik_supply_order_detail as lsod" + _
            '" where lso.id_supply_order = lsod.id_supply_order" + _
            '" and lso.EnviadaSAE = 'N' and lso.id_supply_order_state = 5"
            sqllocal = "select id_supply_order from Logistik_supply_order where TRIM(id_supply_order) = '" + Trim(OrdenCompra) + "'"
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            daPC.Fill(dsPC, "Logistik_supply_order")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_supply_order")
            'Dim OrdenCompra As String

            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            For Each oRowPC In oTablePC.Rows
                OrdenCompra = oRowPC.Item("id_supply_order").ToString
                'agregar ceros
                'OrdenCompra = ceros(OrdenCompra, 10)
                'agregar espacios
                OrdenCompra = espacios(OrdenCompra, 20)
                sqllocal = "select TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," +
                "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," +
                "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," +
                "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," +
                "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," +
                "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG from COMPO" + pNUMEMP.ToString +
                " WHERE CVE_DOC = '" + OrdenCompra + "'"
                '" WHERE ENLAZADO='O' and TIP_DOC_E = 'O'"
                Dim da As New SqlDataAdapter(sqllocal, conn2)
                Dim ds As New DataSet
                If conn2.State = ConnectionState.Closed Then
                    conn2.Open()
                End If
                da.Fill(ds, "COMPO" & pNUMEMP.ToString)
                Dim oTable As New DataTable
                oTable = ds.Tables("COMPO" & pNUMEMP.ToString)

                Dim vCveDoc As String = ""
                '---------------------------------------
                objTrans = conn2.BeginTransaction()
                '--------------------------------------
                For Each oRow In oTable.Rows
                    TIP_DOC = "r"
                    'SigCveDoc = TraerCveDocSigRecep()
                    'CVE_DOC = SigCveDoc
                    CVE_DOC = oRow.Item("CVE_DOC").ToString
                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
                    'STATUS = oRow.Item("STATUS").ToString
                    STATUS = "O"
                    'SU_REFER = oRow.Item("SU_REFER").ToString
                    'If SU_REFER = "" Then SU_REFER = CVE_DOC
                    SU_REFER = ""
                    FECHA_DOC = oRow.Item("FECHA_DOC").ToString
                    If FECHA_DOC <> "" Then
                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd")
                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy-MM-dd hh:mm:ss.mmm")
                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    End If
                    FECHA_REC = oRow.Item("FECHA_REC").ToString
                    If FECHA_REC <> "" Then
                        'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("yyyy/MM/dd")
                        'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    End If
                    FECHA_PAG = oRow.Item("FECHA_PAG").ToString
                    If FECHA_PAG <> "" Then
                        'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("yyyy/MM/dd")
                        'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    End If
                    FECHA_CANCELA = oRow.Item("FECHA_CANCELA").ToString
                    If FECHA_CANCELA <> "" Then
                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd")
                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    End If
                    CAN_TOT = Convert.ToDouble(oRow.Item("CAN_TOT"))
                    IMP_TOT1 = oRow.Item("IMP_TOT1").ToString
                    IMP_TOT2 = oRow.Item("IMP_TOT2").ToString
                    IMP_TOT3 = oRow.Item("IMP_TOT3").ToString
                    IMP_TOT4 = oRow.Item("IMP_TOT4").ToString
                    DES_TOT = oRow.Item("DES_TOT").ToString
                    DES_FIN = oRow.Item("DES_FIN").ToString
                    TOT_IND = oRow.Item("TOT_IND").ToString
                    OBS_COND = oRow.Item("OBS_COND").ToString
                    CVE_OBS = oRow.Item("CVE_OBS").ToString
                    NUM_ALMA = oRow.Item("NUM_ALMA").ToString
                    ACT_CXP = oRow.Item("ACT_CXP").ToString
                    ACT_COI = oRow.Item("ACT_COI").ToString
                    NUM_MONED = oRow.Item("NUM_MONED").ToString
                    NUM_MONED = "1"
                    'TIPCAMB = oRow.Item("TIPCAMB").ToString
                    TIPCAMB = "1"
                    ENLAZADO = oRow.Item("ENLAZADO").ToString
                    TIP_DOC_E = "r"
                    NUM_PAGOS = oRow.Item("NUM_PAGOS").ToString
                    FECHAELAB = oRow.Item("FECHAELAB").ToString
                    If FECHAELAB <> "" Then
                        'FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd hh:mm:ss")
                        'FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("dd-MM-yyyy hh:mm:ss.mmm")
                    End If
                    SERIE = oRow.Item("SERIE").ToString
                    FOLIO = oRow.Item("FOLIO").ToString
                    CTLPOL = oRow.Item("CTLPOL").ToString
                    ESCFD = oRow.Item("ESCFD").ToString
                    CONTADO = oRow.Item("CONTADO").ToString
                    BLOQ = oRow.Item("BLOQ").ToString
                    DES_FIN_PORC = oRow.Item("DES_FIN_PORC").ToString
                    DES_TOT_PORC = oRow.Item("DES_TOT_PORC").ToString
                    IMPORTE = Math.Round(oRow.Item("IMPORTE"), 2)

                    TIP_DOC_ANT = "o"
                    DOC_ANT = CVE_DOC
                    TIP_DOC_SIG = Nothing
                    DOC_SIG = Nothing
                    'vCveDoc = BuscarClaveDoc()
                    '----------------buscar clave del documento
                    Dim vcont As String = ""
                    Dim vnum As Integer
                    Dim readerCOMPR_CLIB As SqlDataReader
                    'TextErrorEmp2.Text = TextErrorEmp2.Text + " readerCOMPR_CLIB"
                    Dim SqlSelection As String = "Select ISNULL(max(CLAVE_DOC),1) AS num from COMPR_CLIB" + pNUMEMP.ToString
                    cmd = New SqlCommand(SqlSelection, conn2, objTrans)
                    readerCOMPR_CLIB = cmd.ExecuteReader()
                    While readerCOMPR_CLIB.Read()
                        'MsgBox(readerCOMPR_CLIB.Item(0))
                        vcont = readerCOMPR_CLIB.Item(0).ToString
                        'Convertir a numero y 'aumentar mas uno
                        vcont = Val(vcont) + 1
                        'agregar ceros
                        'vcont = ceros(vnum, 10)
                        'agregar espacios
                        vcont = espacios(vcont, 20)
                        'regresar valor
                        'Me.TextBox1.Text = vcont
                        vCveDoc = vcont
                    End While
                    readerCOMPR_CLIB.Close()
                    'cmd.Dispose()
                    If vCveDoc <> "" Then
                        ''---------------------------------------
                        'objTrans = conn2.BeginTransaction()
                        ''--------------------------------------
                        'DOC_ANT = ceros(DOC_ANT, 10)
                        DOC_ANT = espacios(DOC_ANT, 20)
                        Dim vfolio As String = vCveDoc
                        sqllocal = "insert into  COMPR" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," +
                        "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," +
                        "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," +
                        "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," +
                        "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," +
                        "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG) values (" +
                        "'r','" + vCveDoc.ToString + "','" + CVE_CLPV + "','" + STATUS + "','" + SU_REFER + "','" + FECHA_DOC + "','" + FECHA_REC + "','" +
                        FECHA_PAG + "','" + FECHA_CANCELA + "','" + CAN_TOT.ToString + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + IMP_TOT4 + "','" +
                        DES_TOT + "','" + DES_FIN + "','" + TOT_IND + "','" + OBS_COND + "','" + CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXP + "','" +
                        ACT_COI + "','" + NUM_MONED + "','" + TIPCAMB + "','" + ENLAZADO + "','o','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                        SERIE + "','" + vfolio.ToString + "','" + CTLPOL + "','" + ESCFD + "','" + CONTADO + "','" + BLOQ + "','" + DES_FIN_PORC + "','" +
                        DES_TOT_PORC + "','" + IMPORTE + "','" + TIP_DOC_ANT + "','" + DOC_ANT.ToString + "',NULL,NULL)"
                        'sqllocal = "insert into  COMPR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," + _
                        '"FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," + _
                        '"DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," + _
                        '"ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," + _
                        '"SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," + _
                        '"DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG) values (" + _
                        '"'r','" + vCveDoc.ToString + "','" + CVE_CLPV.ToString + "','" + STATUS.ToString + "','" + SU_REFER.ToString + "','" + FECHA_DOC.ToString + "','" + FECHA_REC.ToString + "','" + _
                        'FECHA_PAG.ToString + "','" + FECHA_CANCELA.ToString + "','" + CAN_TOT.ToString + "','" + IMP_TOT1.ToString + "','" + IMP_TOT2.ToString + "','" + IMP_TOT3.ToString + "','" + IMP_TOT4.ToString + "','" + _
                        'DES_TOT.ToString + "','" + DES_FIN.ToString + "','" + TOT_IND.ToString + "','" + OBS_COND.ToString + "','" + CVE_OBS.ToString + "','" + NUM_ALMA.ToString + "','" + ACT_CXP.ToString + "','" + _
                        'ACT_COI.ToString + "','" + NUM_MONED.ToString + "','" + TIPCAMB.ToString + "','" + ENLAZADO.ToString + "','o','" + NUM_PAGOS.ToString + "','" + FECHAELAB.ToString + "','" + _
                        'SERIE.ToString + "','" + vCveDoc.ToString + "','" + CTLPOL.ToString + "','" + ESCFD.ToString + "','" + CONTADO.ToString + "','" + BLOQ.ToString + "','" + DES_FIN_PORC.ToString + "','" + _
                        'DES_TOT_PORC.ToString + "','" + IMPORTE.ToString + "','" + TIP_DOC_ANT.ToString + "','" + DOC_ANT.ToString + "','" + TIP_DOC_SIG.ToString + "','" + DOC_SIG.ToString + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "insert into  COMPR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE FOLIOSC" + pNUMEMP.ToString + " SET ULT_DOC = ULT_DOC + 1, " +
                        "FECH_ULT_DOC = '" + FECHA_DOC.ToString + "' WHERE TIP_DOC = 'r'"
                        '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '---------------------
                        'Dim vCve_Obs As String = TraerClaveSiguiente()
                        Dim vCve_Obs As String
                        Dim vcont7 As String = ""
                        Dim readerOBS_DOCC As SqlDataReader
                        'TextErrorEmp2.Text = TextErrorEmp2.Text + " readerOBS_DOCC"
                        sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCC" + pNUMEMP.ToString
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        readerOBS_DOCC = cmd.ExecuteReader()
                        While readerOBS_DOCC.Read()
                            'MsgBox(readerOBS_DOCC.Item(0))
                            vcont7 = readerOBS_DOCC.Item(0).ToString
                            vcont7 = Val(vcont7) + 1
                        End While
                        If vcont7 = "" Then vcont7 = "1"
                        vCve_Obs = vcont7
                        readerOBS_DOCC.Close()
                        '-----------------------------------
                        'Dim vObser As String = "Buenas O. C. HH"
                        'sqllocal = "INSERT INTO OBS_DOCC" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'cmd.ExecuteNonQuery()
                        'Call UpdateOC(CVE_DOC, vCveDoc)
                        'OOOOOO() 'ENLAZADO = P PARCIAL T COMPLETO
                        'sqllocal = "update COMPO" + pNUMEMP.ToString + " SET ENLAZADO='T', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc + "'" + _
                        '" WHERE CVE_DOC ='" + CVE_DOC + "'"
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'cmd.ExecuteNonQuery()
                        '-------------------------------------------------------------------
                        'Call RecepcionDatalleSAE2(vCveDoc, vObser, CVE_DOC)
                        'Dim CVE_DOC As String
                        Dim NUM_PAR As String
                        Dim CVE_ART As String
                        Dim CANT As String
                        Dim CANPEDI As String
                        Dim PARCIAL As Integer
                        Dim PXR As String
                        Dim PREC As String
                        Dim COST As String = "0"
                        Dim IMPU1 As String
                        Dim IMPU2 As String
                        Dim IMPU3 As String
                        Dim IMPU4 As String
                        Dim IMP1APLA As String
                        Dim IMP2APLA As String
                        Dim IMP3APLA As String
                        Dim IMP4APLA As String
                        Dim TOTIMP1 As String
                        Dim TOTIMP2 As String
                        Dim TOTIMP3 As String
                        Dim TOTIMP4 As String
                        Dim DESCU As String
                        Dim ACT_INV As String
                        Dim TIP_CAM As String
                        Dim UNI_VENTA As String
                        Dim TIPO_ELEM As String
                        Dim TIPO_PROD As String
                        'Dim CVE_OBS As String
                        Dim REG_SERIE As String
                        Dim E_LTPD As String
                        Dim FACTCONV As String
                        Dim COST_DEV As String
                        Dim NUM_ALM As String
                        Dim MINDIRECTO As String
                        Dim NUM_MOV As String
                        Dim TOT_PARTIDA As String
                        Dim vfSubtot As Double
                        '-------------------------------------------------------------------------------------------------
                        Dim reader2 As SqlDataReader
                        SqlSelection = "Select CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " +
                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," +
                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," +
                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA  FROM PAR_COMPO" + pNUMEMP.ToString + " where CVE_DOC = '" + CVE_DOC + "'"
                        cmd = New SqlCommand(SqlSelection, conn2, objTrans)
                        'TextErrorEmp2.Text = TextErrorEmp2.Text + " reader2"
                        reader2 = cmd.ExecuteReader()
                        While reader2.Read()
                            'MsgBox(reader2.Item(0))
                            CVE_DOC = reader2.Item(0).ToString
                            NUM_PAR = reader2.Item(1).ToString
                            CVE_ART = reader2.Item(2).ToString
                            CANPEDI = reader2.Item(3).ToString()
                            CANT = "0" '
                            PXR = reader2.Item(4).ToString
                            PREC = reader2.Item(5).ToString
                            PREC = "0"
                            'errrrttt()
                            Dim readerKardex1 As SqlDataReader
                            'TextErrorEmp2.Text = TextErrorEmp2.Text + " readerKardex"
                            'se cambio de precio_pesos a costo_pesos
                            sqllocal = "SELECT precio, costo_pesos from vLogistik_Kardex " +
                            " WHERE trim(oc)='" + CVE_DOC.Trim() + "' AND codigo_producto='" & CVE_ART & "'" +
                            " And trim(vLogistik_Kardex.estado_inicial)='0' and trim(vLogistik_Kardex.estado_final)='1'"
                            If conn3.State = ConnectionState.Closed Then
                                conn3.Open()
                            End If
                            cmd = New SqlCommand(sqllocal, conn3)
                            readerKardex1 = cmd.ExecuteReader()
                            While readerKardex1.Read()
                                COST = readerKardex1.Item(1).ToString
                                'COST = readerKardex1.Item("costo").ToString
                            End While
                            readerKardex1.Close()
                            IMPU1 = reader2.Item(7).ToString
                            IMPU2 = reader2.Item(8).ToString
                            IMPU3 = reader2.Item(9).ToString
                            IMPU4 = reader2.Item(10).ToString
                            IMP1APLA = reader2.Item(11).ToString
                            IMP2APLA = reader2.Item(12).ToString
                            IMP3APLA = reader2.Item(13).ToString
                            IMP4APLA = reader2.Item(14).ToString
                            TOTIMP1 = reader2.Item(15).ToString
                            TOTIMP2 = reader2.Item(16).ToString
                            TOTIMP3 = reader2.Item(17).ToString
                            'TOTIMP4 = reader2.Item(18).ToString

                            DESCU = reader2.Item(19).ToString
                            ACT_INV = reader2.Item(20).ToString
                            'TIP_CAM = reader2.Item(21).ToString
                            TIP_CAM = "1"
                            UNI_VENTA = reader2.Item(22).ToString
                            TIPO_ELEM = reader2.Item(23).ToString
                            TIPO_PROD = reader2.Item(24).ToString
                            CVE_OBS = reader2.Item(25).ToString
                            REG_SERIE = reader2.Item(26).ToString
                            E_LTPD = reader2.Item(27).ToString
                            FACTCONV = reader2.Item(28).ToString
                            COST_DEV = reader2.Item(29).ToString
                            NUM_ALM = reader2.Item(30).ToString
                            MINDIRECTO = reader2.Item(31).ToString
                            NUM_MOV = reader2.Item(32).ToString
                            TOT_PARTIDA = reader2.Item(33).ToString
                            '----------traer la cantidad
                            Dim readerPC As SqlDataReader
                            'TextErrorEmp2.Text = TextErrorEmp2.Text + " readerPC"
                            SqlSelection = "select quantity_received from Logistik_supply_order_detail" +
                            " where id_supply_order = '" + CVE_DOC + "' and upc = '" + CVE_ART + "'" +
                            " AND id_supply_order_detail = '" + NUM_PAR + "'"
                            LabelQuery.Text = SqlSelection
                            Me.Refresh()
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            cmd = New SqlCommand(SqlSelection, conn)
                            readerPC = cmd.ExecuteReader()
                            While readerPC.Read()
                                CANT = readerPC.Item(0).ToString
                            End While
                            readerPC.Close()
                            If Val(CANT) = Val(CANPEDI) Then
                                PARCIAL = 0
                            Else
                                PARCIAL = 1
                            End If

                            If pNUMEMP.ToString = "02" Then
                                '?????????????????????????????????pedidmiento????????????????????????????????????????
                                Dim vped As String = "N"
                                Dim readerprodw1 As SqlDataReader
                                'TextErrorEmp2.Text = TextErrorEmp2.Text + " readerKardex"
                                sqllocal = "SELECT Pedimento FROM Logistik_product WHERE upc ='" & CVE_ART.Trim & "'"
                                LabelQuery.Text = "Logistik_Product"
                                Me.Refresh()
                                If conn.State = ConnectionState.Closed Then
                                    conn.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn)
                                LabelQuery.Text = "Logistik_Product2"
                                readerprodw1 = cmd.ExecuteReader()
                                LabelQuery.Text = "Logistik_Product3"
                                While readerprodw1.Read()
                                    vped = readerprodw1.Item(0).ToString
                                End While
                                LabelQuery.Text = "Logistik_Product4"
                                readerprodw1.Close()
                                If vped.Trim = "S" Then
                                    LabelQuery.Text = "vlogistik_embarques1"
                                    Dim readerPedimento As SqlDataReader
                                    sqllocal = "SELECT Pedimento, fchaduana, nom_aduana, ciudad, gln, frontera FROM vLogistik_Embarques WHERE oc='" + CVE_DOC.Trim + "'"
                                    LabelQuery.Text = "vlogistik_embarques2"
                                    Me.Refresh()
                                    If conn3.State = ConnectionState.Closed Then
                                        conn3.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, conn3)
                                    readerPedimento = cmd.ExecuteReader()
                                    Dim Pedimento As String = ""
                                    Dim fchaduana As String = ""
                                    Dim nom_aduana As String = ""
                                    Dim ciudad As String = ""
                                    Dim gln As String = ""
                                    Dim frontera As String = ""
                                    LabelQuery.Text = "vlogistik_embarques1"
                                    Me.Refresh()
                                    While readerPedimento.Read()
                                        Pedimento = readerPedimento.Item(0).ToString
                                        fchaduana = readerPedimento.Item(1).ToString
                                        nom_aduana = readerPedimento.Item(2).ToString
                                        ciudad = readerPedimento.Item(3).ToString
                                        gln = readerPedimento.Item(4).ToString
                                        frontera = readerPedimento.Item(5).ToString
                                    End While
                                    LabelQuery.Text = "vlogistik_embarques2"
                                    Me.Refresh()
                                    readerPedimento.Close()
                                    Dim INCREMENTO As Integer = 0
                                    Dim readerPedimento2 As SqlDataReader
                                    'sqllocal = "Select ULT_CVE  FROM TBLCONTROL" + pNUMEMP.ToString + " WHERE ID_TABLA='67'"
                                    sqllocal = "select MAX(REG_LTPD) AS RRRR From LTPD" + pNUMEMP.ToString
                                    LabelQuery.Text = sqllocal
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    readerPedimento2 = cmd.ExecuteReader()
                                    While readerPedimento2.Read()
                                        INCREMENTO = readerPedimento2.Item(0).ToString
                                        INCREMENTO = INCREMENTO + 1
                                    End While
                                    readerPedimento2.Close()
                                    fchaduana = Convert.ToDateTime(fchaduana).ToString("yyyyMMdd")
                                    sqllocal = "insert into LTPD" + pNUMEMP.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC,FCHADUANA, FCHULTMOV, " +
                                        "NOM_ADUAN, CANTIDAD, REG_LTPD, CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN, STATUS, PEDIMENTOSAT) values (" +
                                        "'" + CVE_ART + "','','" + Pedimento + "','1','','" + fchaduana + "',GETDATE(),'" + nom_aduana + "','0','" +
                                        INCREMENTO.ToString + "','0','" + ciudad + "','" + frontera + "','','" + gln + "','A','" + Pedimento + "')"
                                    LabelQuery.Text = sqllocal
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    sqllocal = "UPDATE LTPD" + pNUMEMP.ToString + " SET FCHCADUC=NULL, FEC_PROD_LT=NULL " +
                                        " WHERE REG_LTPD= '" + INCREMENTO.ToString.Trim + "'" 'AND CVE_ART='" + CVE_ART + "' AND PEDIMENTO='" + Pedimento + "'"
                                    LabelQuery.Text = sqllocal '
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
                                    LabelQuery.Text = sqllocal
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 48"
                                    LabelQuery.Text = sqllocal
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    ''---------EXTRAER CLAVE DEL FOLIO
                                    Dim CVE_FOLIO1 As String = "0"
                                    Dim readerCONTROL2 As SqlDataReader
                                    sqllocal = "Select ULT_CVE  FROM TBLCONTROL" + pNUMEMP.ToString + " WHERE ID_TABLA='67'"
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    readerCONTROL2 = cmd.ExecuteReader()
                                    While readerCONTROL2.Read()
                                        CVE_FOLIO1 = readerCONTROL2.Item(0).ToString
                                    End While
                                    readerCONTROL2.Close()
                                    E_LTPD = CVE_FOLIO1
                                    sqllocal = "INSERT INTO ENLACE_LTPD" + pNUMEMP.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" +
                                    E_LTPD + "','" + INCREMENTO.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
                                    LabelQuery.Text = sqllocal
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                End If

                                '"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
                            End If

                            'Else
                            '    If conn3.State = ConnectionState.Closed Then
                            '        conn3.Open()
                            '    End If
                            '    Dim reader5 As SqlDataReader
                            '    Dim sql3 As String = "SELECT precio, costo from vLogistik_Kardex WHERE oc='" + CVE_DOC + "' AND codigo_producto='" & CVE_ART & "'"
                            '    cmd = New SqlCommand(sql3, conn3)
                            '    reader5 = cmd.ExecuteReader()
                            '    While reader5.Read()
                            '        PREC = reader5.Item("costo").ToString
                            '        'COST = reader5.Item("precio").ToString
                            '        COST = reader5.Item("costo").ToString
                            '    End While
                            '    reader5.Close()
                            '    If conn3.State = ConnectionState.Open Then
                            '        conn3.Close()
                            '    End If
                            'End If
                            '-------------------Traer la clave siguiente
                            'CVE_OBS = TraerClaveSiguiente()
                            vcont = "0"
                            'Dim readerObser As SqlDataReader
                            'TextErrorEmp2.Text = TextErrorEmp2.Text + " readerObser"
                            'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCC" + pNUMEMP.ToString
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'readerObser = cmd.ExecuteReader()
                            'While readerObser.Read()
                            '    'MsgBox(readerObser.Item(0))
                            '    vcont = readerObser.Item(0).ToString
                            '    vcont = Val(vcont) + 1
                            'End While
                            'If vcont = "" Then vcont = "1"
                            CVE_OBS = vcont
                            'readerObser.Close()
                            '---
                            'comd1.Connection = conn3
                            'conn3.Open()
                            'comd1.CommandText = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCC" + vgNumEmpresa.ToString
                            'comd1.CommandTimeout = 120
                            'Dim rd1 As SqlDataReader = comd1.ExecuteReader()
                            'If rd1.Read Then
                            '    While rd1.Read()
                            '        vcont = rd1(0).ToString()
                            '        vcont = Val(vcont) + 1
                            '    End While
                            'End If
                            'rd1.Close()
                            'conn3.Close()
                            'If vcont = "" Then vcont = "1"
                            'CVE_OBS = vcont
                            '---
                            'conn3.Open()
                            'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCC" + vgNumEmpresa.ToString
                            'Dim daObser As New SqlDataAdapter(sqllocal, conn3)
                            'Dim dsObser As New DataSet

                            'daObser.Fill(dsObser, "OBSERBACIONES" & vgNumEmpresa.ToString)
                            'Dim oTableObser As New DataTable
                            'oTableObser = dsObser.Tables("OBSERBACIONES" & vgNumEmpresa.ToString)
                            'For Each oRowObser In oTableObser.Rows
                            '    vcont = oRowObser.Item("num").ToString
                            '    vcont = Val(vcont) + 1
                            'Next
                            'If vcont = "" Then vcont = "1"
                            'CVE_OBS = vcont
                            'conn3.Close()
                            '-------------------------------------------
                            'sqllocal = "INSERT INTO OBS_DOCC" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + vObser + "')"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            '---------------------crear el o los movimientos
                            'Dim vNum_Mov As String = ConsecutivoMovimiento()
                            Dim vNum_Mov As String
                            vcont7 = "0"
                            Dim readerMINVE As SqlDataReader
                            'TextErrorEmp2.Text = TextErrorEmp2.Text + " readerMINVE"
                            sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num from MINVE" + pNUMEMP.ToString
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerMINVE = cmd.ExecuteReader()
                            While readerMINVE.Read()
                                'MsgBox(reader7.Item(0))
                                vcont7 = readerMINVE.Item(0).ToString
                                vcont7 = Val(vcont7) + 1
                            End While
                            If vcont7 = "" Then vcont7 = "1"
                            vNum_Mov = vcont7
                            readerMINVE.Close()

                            TOT_PARTIDA = Convert.ToDouble(PREC) * Convert.ToDouble(CANT)
                            TOTIMP4 = (Convert.ToDouble(PREC) * Convert.ToDouble(CANT)) * (IMPU4 / 100)
                            '-------------------------------------------
                            'MAN_IEPS, APL_MAN_IMP,CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ
                            ''N','1','0','C','0','0','1'

                            sqllocal = "Insert Into PAR_COMPR" + pNUMEMP.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " +
                            "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," +
                            "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," +
                            "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA,MAN_IEPS, APL_MAN_IMP,CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" +
                            "'" + vCveDoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT + "','" + CANT + "','" +
                            "0','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                            IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                            TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" +
                            "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" +
                            CVE_OBS + "','" + REG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST + "','" +
                            NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "','N','1','0','C','0','0','1')"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'INSERTAR EL INDICE
                            sqllocal = "insert into  PAR_COMPR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + vCveDoc + "','" + NUM_PAR + "')"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'actualizar detalle
                            sqllocal = "update PAR_COMPO" + pNUMEMP.ToString + " set PXR = PXR - " + CANT.ToString +
                            " where CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'actualizar ACUMULADOR
                            sqllocal = "update ACOMP" + pNUMEMP.ToString + " set RVTA_COM = RVTA_COM + '" + TOT_PARTIDA + "'," +
                            " RIMP = RIMP + '" + TOTIMP4 + "'" +
                            " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                            sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
                            'LabelQuery.Text = sqllocal
                            'Me.Refresh()
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            'sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
                            'LabelQuery.Text = sqllocal
                            'Me.Refresh()
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            'insertar documentos siguientes
                            sqllocal = "INSERT INTO DOCTOSIGC" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                            "PARTIDA, PART_E, CANT_E) VALUES (" +
                            "'r','" + vCveDoc + "','A','o','" + CVE_DOC + "','" +
                            NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "INSERT INTO DOCTOSIGC" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                            "PARTIDA, PART_E, CANT_E) VALUES (" +
                            "'o','" + CVE_DOC + "','S','r','" + vCveDoc + "','" +
                            NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'sqllocal = "UPDATE FOLIOSC" + pNUMEMP.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'r'"
                            ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            'actualizar las existencias
                            'Call ActualizarExistencias(CVE_ART, CANT)
                            Dim reader7 As SqlDataReader
                            Dim costo_prom As String = "0"
                            sqllocal = "SELECT INV7.COSTO_PROM, INV7.ULT_COSTO FROM INVE" + pNUMEMP.ToString +
                            " AS INV7 WHERE INV7.CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            reader7 = cmd.ExecuteReader()
                            While reader7.Read()
                                Dim ExistA As Double
                                ExistA = Convert.ToDouble(reader7.Item(0).ToString)
                                'ExistA = Math.Round(ExistA, 2)
                                costo_prom = ExistA.ToString
                                If costo_prom = "" Or costo_prom = "0" Then
                                    ExistA = Convert.ToDouble(reader7.Item(1).ToString)
                                    'ExistA = Math.Round(ExistA, 2)
                                    costo_prom = ExistA.ToString
                                End If

                            End While
                            reader7.Close()
                            sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST + '" + CANT + "', FCH_ULTCOM='" + time.ToString("yyyy/MM/dd") + "'," +
                            " COMP_X_REC = COMP_X_REC - '" + CANT + "', COSTO_PROM = '" + COST + "'," +
                            " ULT_COSTO = '" + COST + "', COMP_ANL_C = COMP_ANL_C + '" + CANT + "', COMP_ANL_M = COMP_ANL_M + '" + TOT_PARTIDA + "'" +
                            " WHERE CVE_ART ='" + CVE_ART + "'"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '-----------------------------------------------
                            'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                            Dim vExistencia As String = ""
                            Dim readerINVENT As SqlDataReader
                            'TextErrorEmp2.Text = TextErrorEmp2.Text + " readerINVENT"
                            sqllocal = "Select ISNULL(max(EXIST),0) AS num from INVE" + pNUMEMP.ToString + " where CVE_ART = '" + CVE_ART + "'"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerINVENT = cmd.ExecuteReader()
                            While readerINVENT.Read()
                                'MsgBox(readerINVENT.Item(0))
                                vExistencia = readerINVENT.Item(0).ToString
                                'vExistencia = Val(vExistencia) + 1
                            End While
                            If vExistencia = "" Then vExistencia = "1"
                            readerINVENT.Close()
                            '-----------------------------------------------
                            '---------EXTRAER CLAVE DEL FOLIO
                            Dim CVE_FOLIO As String = "0"
                            Dim readerCONTROL As SqlDataReader
                            sqllocal = "Select ULT_CVE  FROM TBLCONTROL" + pNUMEMP.ToString + " WHERE ID_TABLA='32'"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerCONTROL = cmd.ExecuteReader()
                            While readerCONTROL.Read()
                                CVE_FOLIO = readerCONTROL.Item(0).ToString
                            End While
                            If CVE_FOLIO = "0" Then CVE_FOLIO = "1"
                            readerCONTROL.Close()
                            '--------existe almacen
                            Dim vExistAlm As String = "0"
                            Dim rederExistAlm As SqlDataReader
                            sqllocal = "SELECT EXIST FROM MULT" + pNUMEMP.ToString +
                            " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '" + NUM_ALM + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            rederExistAlm = cmd.ExecuteReader()
                            While rederExistAlm.Read
                                vExistAlm = rederExistAlm.Item(0).ToString
                                vExistAlm = Val(vExistAlm) + CANT
                            End While
                            rederExistAlm.Close()
                            '--------------------------------------------------------
                            Dim reader7fin As SqlDataReader
                            Dim costo_promFin As String = "0"
                            sqllocal = "SELECT COSTO_PROM, ULT_COSTO FROM INVE" + pNUMEMP.ToString +
                            " WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            reader7fin = cmd.ExecuteReader()
                            While reader7fin.Read()
                                Dim ExistA1 As Double
                                ExistA1 = Convert.ToDouble(reader7fin.Item(0).ToString)
                                'ExistA = Math.Round(ExistA, 2)
                                costo_promFin = ExistA1.ToString
                                If costo_promFin = "" Or costo_promFin = "0" Then
                                    ExistA1 = Convert.ToDouble(reader7fin.Item(1).ToString)
                                    'ExistA = Math.Round(ExistA, 2)
                                    costo_promFin = ExistA1.ToString
                                End If

                            End While
                            reader7fin.Close()
                            '--------------------------------------------------------
                            sqllocal = "INSERT INTO MINVE" + pNUMEMP.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXIST_G, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, COSTO_PROM_GRAL, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                            "'" + CVE_ART + "','1','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," +
                            "'r','" + vCveDoc + "','         1','','" + CANT + "','0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                            "'" + REG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + vExistAlm + "',NULL,'" +
                            FACTCONV + "','" + time.ToString("yyyy/MM/dd") + "','','" + CVE_FOLIO + "','1','" +
                            "S','" + COST + "','" + COST + "','" + COST + "','N','0')"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + vObser + "')"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE MULT" + pNUMEMP.ToString + " SET EXIST = EXIST  + " + CANT.ToString +
                            " ,COMP_X_REC = COMP_X_REC - '" + CANT.ToString + "' WHERE CVE_ART = '" + CVE_ART + "' and CVE_ALM = '" + NUM_ALM + "'"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            vfSubtot = vfSubtot + (Convert.ToDouble(PREC) * Val(CANT))
                        End While
                        reader2.Close()

                        Dim vfIVA As Double = vfSubtot * 0.16
                        Dim vfNeto As Double = vfSubtot + vfIVA
                        vfNeto = Math.Round(vfNeto, 2)
                        'ENLAZADO = P PARCIAL T COMPLETO
                        If PARCIAL = 0 Then
                            sqllocal = "update COMPO" + pNUMEMP.ToString + " SET ENLAZADO='T', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc + "'" +
                                                    " WHERE CVE_DOC ='" + CVE_DOC + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                        Else
                            sqllocal = "update COMPO" + pNUMEMP.ToString + " SET ENLAZADO='P', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc + "'" +
                                                    " WHERE CVE_DOC ='" + CVE_DOC + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                        End If
                        sqllocal = "update COMPR" + pNUMEMP.ToString + " set CAN_TOT = '" + vfSubtot.ToString + "', IMP_TOT4 = '" + vfIVA.ToString + "'," +
                        " IMPORTE = '" + vfNeto.ToString + "', FECHA_CANCELA = NULL, NUM_PAGOS=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
                        LabelQuery.Text = sqllocal
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '------------------------
                        objTrans.Commit()

                        empresa = MI_BD_x.ToString
                        documento = vCveDoc.ToString
                        mensaje = "Registrar Recepcion Correcto:" + vCveDoc.ToString + " Orden de compra:" + OrdenCompra.ToString
                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        Me.Refresh()
                        '------------------------
                    End If
                Next
                OrdenCompra = Val(OrdenCompra)
                Dim sql As String = "update Logistik_supply_order SET EnviadaSAE = 'S'" +
                " WHERE id_supply_order = '" + OrdenCompra + "'"
                EjecutarQuerySQL_EMPRESA_X(sql, pMiBD)
            Next
            'MsgBox("Almacenado correctamente")
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Registrar Recepcion: InCorrecto Recepcion:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTrans.Rollback()

            Throw es
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Registrar Recepcion: Correcto Recepcion:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTrans.Rollback()
            Throw ex
        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            If conn2.State = ConnectionState.Open Then
                conn2.Close()
            End If
            If conn3.State = ConnectionState.Open Then
                conn3.Close()
            End If
        End Try
    End Sub

    Private Sub RecepcionDatalleSAE2(ByVal pcvedoc As String, ByVal pObser As String, ByVal pcve_doc_origen As String)
        'envia datos al sae
        Dim SqlSelection As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + ";Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + vgEmpresa + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + ";Password=" + My.Settings.pass + ";"
            Dim conn2 As New SqlConnection(Str2)
            Dim CVE_DOC As String
            Dim NUM_PAR As String
            Dim CVE_ART As String
            Dim CANT As String
            Dim PXR As String
            Dim PREC As String
            Dim COST As String
            Dim IMPU1 As String
            Dim IMPU2 As String
            Dim IMPU3 As String
            Dim IMPU4 As String
            Dim IMP1APLA As String
            Dim IMP2APLA As String
            Dim IMP3APLA As String
            Dim IMP4APLA As String
            Dim TOTIMP1 As String
            Dim TOTIMP2 As String
            Dim TOTIMP3 As String
            Dim TOTIMP4 As String
            Dim DESCU As String
            Dim ACT_INV As String
            Dim TIP_CAM As String
            Dim UNI_VENTA As String
            Dim TIPO_ELEM As String
            Dim TIPO_PROD As String
            Dim CVE_OBS As String
            Dim REG_SERIE As String
            Dim E_LTPD As String
            Dim FACTCONV As String
            Dim COST_DEV As String
            Dim NUM_ALM As String
            Dim MINDIRECTO As String
            Dim NUM_MOV As String
            Dim TOT_PARTIDA As String
            Dim reader2 As SqlDataReader
            SqlSelection = "Select CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " +
            "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," +
            "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," +
            "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA  FROM PAR_COMPO" + vgNumEmpresa.ToString + " where CVE_DOC = '" + pcve_doc_origen + "'"
            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            cmd = New SqlCommand(SqlSelection, conn2, objTrans)
            reader2 = cmd.ExecuteReader()
            While reader2.Read()
                'MsgBox(reader2.Item(0))
                CVE_DOC = reader2.Item(0).ToString
                NUM_PAR = reader2.Item(1).ToString
                CVE_ART = reader2.Item(2).ToString
                CANT = "0" 'reader2.Item(3).ToString
                PXR = reader2.Item(4).ToString
                PREC = reader2.Item(5).ToString
                COST = reader2.Item(6).ToString
                IMPU1 = reader2.Item(7).ToString
                IMPU2 = reader2.Item(8).ToString
                IMPU3 = reader2.Item(9).ToString
                IMPU4 = reader2.Item(10).ToString
                IMP1APLA = reader2.Item(11).ToString
                IMP2APLA = reader2.Item(12).ToString
                IMP3APLA = reader2.Item(13).ToString
                IMP4APLA = reader2.Item(14).ToString
                TOTIMP1 = reader2.Item(15).ToString
                TOTIMP2 = reader2.Item(16).ToString
                TOTIMP3 = reader2.Item(17).ToString
                TOTIMP4 = reader2.Item(18).ToString
                DESCU = reader2.Item(19).ToString
                ACT_INV = reader2.Item(20).ToString
                TIP_CAM = reader2.Item(21).ToString
                UNI_VENTA = reader2.Item(22).ToString
                TIPO_ELEM = reader2.Item(23).ToString
                TIPO_PROD = reader2.Item(24).ToString
                CVE_OBS = reader2.Item(25).ToString
                REG_SERIE = reader2.Item(26).ToString
                E_LTPD = reader2.Item(27).ToString
                FACTCONV = reader2.Item(28).ToString
                COST_DEV = reader2.Item(29).ToString
                NUM_ALM = reader2.Item(30).ToString
                MINDIRECTO = reader2.Item(31).ToString
                NUM_MOV = reader2.Item(32).ToString
                TOT_PARTIDA = reader2.Item(33).ToString
                '-------------------Traer la clave siguiente
                'CVE_OBS = TraerClaveSiguiente()
                Dim vcont As String = ""
                Dim vnum As Integer
                Dim reader As SqlDataReader
                Dim Sql As String = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCC" + vgNumEmpresa.ToString
                cmd = New SqlCommand(Sql, conn2, objTrans)
                reader = cmd.ExecuteReader()
                While reader.Read()
                    'MsgBox(reader.Item(0))
                    vcont = reader.Item(0).ToString
                    vcont = Val(vcont) + 1
                End While
                If vcont = "" Then vcont = "1"
                CVE_OBS = vcont
                reader.Close()
                '-------------------------------------------
                sqllocal = "INSERT INTO OBS_DOCC" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                '---------------------crear el o los movimientos
                'Dim vNum_Mov As String = ConsecutivoMovimiento()
                Dim vNum_Mov As String
                Dim vcont7 As String = ""
                Dim reader7 As SqlDataReader
                Sql = "Select ISNULL(max(NUM_MOV),1) AS num from MINVE" + vgNumEmpresa.ToString
                cmd = New SqlCommand(Sql, conn2, objTrans)
                reader7 = cmd.ExecuteReader()
                While reader7.Read()
                    'MsgBox(reader7.Item(0))
                    vcont7 = reader7.Item(0).ToString
                    vcont7 = Val(vcont7) + 1
                End While
                If vcont7 = "" Then vcont7 = "1"
                vNum_Mov = vcont7
                reader7.Close()
                '----------traer la cantidad
                Dim readerPC As SqlDataReader
                SqlSelection = "select quantity_received from Logistik_supply_order_detail" +
                " where id_supply_order = '" + pcve_doc_origen + "' and upc = '" + CVE_ART + "'"
                conn.Open()
                cmd = New SqlCommand(SqlSelection, conn)
                readerPC = cmd.ExecuteReader()
                While readerPC.Read()
                    CANT = readerPC.Item(0).ToString
                End While
                conn.Close()
                readerPC.Close()
                '-------------------------------------------
                sqllocal = "insert into  PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " +
                "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," +
                "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," +
                "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA) values (" +
                "'" + pcvedoc + "','" + NUM_PAR + "','" + CVE_ART + "','" + CANT + "','" + PXR + "','" +
                PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" +
                "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" +
                CVE_OBS + "','" + REG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" +
                NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "')"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                'INSERTAR EL INDICE
                sqllocal = "insert into  PAR_COMPR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR + "')"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                'actualizar detalle
                sqllocal = "update PAR_COMPO" + vgNumEmpresa.ToString + " set PXR = PXR - " + CANT.ToString +
                " where CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                'actualizar ACUMULADOR
                sqllocal = "update ACOMP" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + '" + TOT_PARTIDA + "'," +
                " RIMP = RIMP + '" + TOTIMP4 + "'" +
                " where CVE_ACOMP = '11'"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()

                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                'insertar documentos siguientes
                sqllocal = "INSERT INTO DOCTOSIGC" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                "PARTIDA, PART_E, CANT_E) VALUES (" +
                "'r','" + pcvedoc + "','A','o','" + CVE_DOC + "','" +
                NUM_PAR + "','" + NUM_PAR + "','" + CANT.ToString + "')"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "INSERT INTO DOCTOSIGC" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                "PARTIDA, PART_E, CANT_E) VALUES (" +
                "'o','" + CVE_DOC + "','S','r','" + pcvedoc + "','" +
                NUM_PAR(+"','" + NUM_PAR + "','" + CANT.ToString + "')")
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "UPDATE FOLIOSC" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'r'"
                '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                'actualizar las existencias
                'Call ActualizarExistencias(CVE_ART, CANT)
                sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + '" + CANT + "', FCH_ULTCOM='" + time.ToString("dd-MM-yyyy") + "'," +
                " COMP_X_REC = COMP_X_REC - '" + CANT + "', COSTO_PROM = '" + COST + "'," +
                " ULT_COSTO = '" + COST + "', COMP_ANL_C = COMP_ANL_C + '" + CANT + "', COMP_ANL_M = COMP_ANL_M + '" + TOT_PARTIDA + "'" +
                " WHERE CVE_ART ='" + CVE_ART + "'"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                '-----------------------------------------------
                'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                Dim vExistencia As String = ""
                Dim reader3 As SqlDataReader
                Sql = "Select ISNULL(max(EXIST),0) AS num from INVE" + vgNumEmpresa.ToString + " where CVE_ART = '" + CVE_ART + "'"
                cmd = New SqlCommand(Sql, conn2, objTrans)
                reader3 = cmd.ExecuteReader()
                While reader3.Read()
                    'MsgBox(reader3.Item(0))
                    vExistencia = reader3.Item(0).ToString
                    'vExistencia = Val(vExistencia) + 1
                End While
                If vExistencia = "" Then vExistencia = "1"
                reader3.Close()
                '-----------------------------------------------
                sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                "'" + CVE_ART + "','1','" + vNum_Mov + "','1','" + time.ToString("dd/MM/yyyy") + "'," +
                "'R','" + CVE_DOC + "','         1','','" + CANT + "','0','0','" + COST + "','','" + CVE_OBS + "'," +
                "'" + REG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + FACTCONV + "','" + time.ToString("dd/MM/yyyy") + "','','1','1','" +
                "S','0','" + COST + "','N','0')"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
                sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                cmd.ExecuteNonQuery()
            End While
            reader2.Close()

        Catch es As SqlException
            objTrans.Rollback()
            Throw es
        Catch ex As Exception
            '***** rollback the transaction ************************************************'
            objTrans.Rollback()
            MsgBox(ex.Message.ToString)
        End Try
    End Sub

    Public Function ceros(ByVal Nro As String, ByVal Cantidad As Integer) As String
        Dim numero As String, cuantos As String, i As Integer
        numero = Trim(Nro) 'Trim quita los espacion en blanco
        cuantos = "0"
        For i = 1 To Cantidad
            cuantos = cuantos & "0"
        Next i
        ceros = Mid(cuantos, 1, Cantidad - Len(numero)) & numero
    End Function

    Public Function Quitarceros(ByVal sEntrada As String) As String
        Dim i As Integer, j As Integer, sIntermedio As String
        For j = 1 To Len(sEntrada)
            If Mid(sEntrada, j, 1) <> "0" Then
                sIntermedio = Mid(sEntrada, j)
                Exit For
            End If
        Next
        Quitarceros = sIntermedio
    End Function

    Public Function espacios(ByVal Nro As String, ByVal Cantidad As Integer) As String
        Dim numero As String, cuantos As String, i As Integer
        numero = Trim(Nro) 'Trim quita los espacion en blanco
        cuantos = " "
        For i = 1 To Cantidad
            cuantos = cuantos & " "
        Next i
        espacios = Mid(cuantos, 1, Cantidad - Len(numero)) & numero
    End Function


#End Region
    Private Sub TraerDatosSAE(ByVal pMiBD As String, ByVal tipoemp As String)
        Label5.Text = "Sincronizando Clientes del SAE a SQL"
        Me.Refresh()
        Call TraerClientes(pMiBD)
        'leer datos
        Dim Str11 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn2 As New SqlConnection(Str11)
        Dim reader7 As SqlDataReader
        sqllocal = "SELECT sincronizacion_completa FROM Logistik_Servidor_Status"
        TextBox1.Text = "Logistik_Servidor_Status"
        Me.Refresh()
        cmd = New SqlCommand(sqllocal, conn2)
        If conn2.State = ConnectionState.Closed Then
            conn2.Open()
        End If
        reader7 = cmd.ExecuteReader()
        While reader7.Read()
            vlSyncCompleta = reader7.Item(0)
        End While
        If vlSyncCompleta = Nothing Then
            vlSyncCompleta = 0
        End If
        reader7.Close()

        If vlSyncCompleta = 1 Then
            Label5.Text = "Sincronizando Artículos del SAE a SQL"
            Me.Refresh()
            Call TraerArticulos(pMiBD)
            Label5.Text = "Sincronizando Proveedores del SAE a SQL"
            Me.Refresh()
            Call TraerProveedores(pMiBD)
            Label5.Text = "Sincronizando Líneas de Productos del SAE a SQL"
            Me.Refresh()
            Call TraerLinesProducts(pMiBD)
            Label5.Text = "Sincronizando Almacenes del SAE a SQL"
            Me.Refresh()
            Call TraerAlmacenes(pMiBD)
            Label5.Text = "Sincronizando Lista de Precios del SAE a SQL"
            Me.Refresh()
            Call TraerListaPrecios(pMiBD)
            Label5.Text = "Sincronizando Lista de Precios de los Productos del SAE a SQL"
            Me.Refresh()
            Call TraerListaPreciosProductos(pMiBD)
            Label5.Text = "Sincronizando Numeros de Serie del SAE a SQL"
            Me.Refresh()
            Call TraerNumerosSerie(pMiBD)
            Call TraerNumerosSerie2(pMiBD)
            Label5.Text = "Sincronizando Pedidmentos del SAE a SQL"
            Me.Refresh()
            Call TraerPedimentos(pMiBD)
            Label5.Text = "Sincronizando Pedidmentos2 del SAE a SQL"
            Me.Refresh()
            Call TraerPedimentos2(pMiBD)
            Label5.Text = "Sincronizando Artículos Claves Complemto del SAE a SQL"
            Me.Refresh()
            Call TraerArticulosClavesAlternas2(pMiBD)
            'If vgCodigoAlterno = True Then
            '    Label5.Text = "Sincronizando Artículos Claves Alternas del SAE a SQL"
            '    Me.Refresh()
            '    Call TraerArticulosClavesAlternas(pMiBD)
            'End If
            'Label5.Text = "Sincronizando Tipos de Pago del SAE Fire Bird a SQL"
            'Call TraerTipoPagos()
            'Label5.Text = "Sincronizando Stock del SAE Fire Bird a SQL"
            'Call ActualizarStockFB()
            Label5.Text = "Sincronizando Vendedores del SAE a SQL"
            Call ActualizarVendedores(pMiBD)
            Label5.Text = "Sincronizando Impuestos del SAE a SQL"
            Call ActualizarImpuestos(pMiBD)
            Label5.Text = "Sincronizando Conceptos de Movimiento del SAE a SQL"
            Call ActualizarConceptosMov(pMiBD)
            Label5.Text = "Sincronizando Tipo de Cambio del SAE a SQL"
            Call ActualizarTipoCambio(pMiBD)
            'Label5.Text = "Sincronizando existecias multi almacen SAE Fire Bird a SQL"
            'Call TraerExisteMultiAlmProv(pMiBD)

        End If
        'Me.TextError.Text = "Finalizo los catalogos..."
        'Me.Refresh()

        If DesactivarOCPed = False And Trim(vgNumEmpresa) = "01" Or Trim(vgNumEmpresa) = "04" Or Trim(vgNumEmpresa) = "02" Then
            If tipoemp = "Vende" Then
                Label5.Text = "Sincronizando Traer Pedidos de venta del SAE a SQL"
                Me.Refresh()
                Call TraerPedidosCtes(pMiBD) 'Pedidos
                'If vgNumEmpresa <> "06" Then
                '    Label5.Text = "Sincronizando Pedidos EMP06 del SAE a SQL"
                '    Call PedidosEmp6(pMiBD)
                'End If
                'Label5.Text = "Sincronizando Index Remisiones de venta del SAE a SQL"
                'Me.Refresh()
                'Call TraerIndexPedidosCtes(pMiBD)
            End If
            If tipoemp = "Compra" Then
                Label5.Text = "Sincronizando Pedidos de compra del SAE a SQL"
                Me.Refresh()
                Call TraerPedidosProv(pMiBD)
                'If vgNumEmpresa <> "06" Then
                '    Label5.Text = "Sincronizando O.C. EMP06 del SAE a SQL"
                '    Call OrdenCompraEmp6(pMiBD)
                'End If
                'Label5.Text = "Sincronizando Index Recepciones de venta del SAE a SQL"
                'Me.Refresh()
                'Call TraerIndexPedidosProv(pMiBD)
            End If
        End If



        Label5.Text = "Sincronización finalizada"
        'Label5.Text = "Trasportando Tipos de Pago del SAE a SQL"
        'Call TraerTipoPagos()
        'Label5.Text = "Sincronizando Stock del SAE a SQL"
        'Call ActualizarStock()
        '24CAL,12CEM,6MOR
        'Label5.Text = "Sincronizando Tipos de Pago del SAE Fire Bird a SQL"
        'Call TraerTipoPagos()
        'Label5.Text = "Sincronizando Stock del SAE Fire Bird a SQL"
        'Call ActualizarStockFB()
        Label5.Text = ""
    End Sub
    Private Sub PedidosEmp6Error(ByVal pMiBD As String, ByVal pPEDIDO As String)
        Dim CVE_DOC As String = ""
        Try
            'Me.TextError.Text = "iniciar emp06... pedidos"
            Dim Str4 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn4 As New SqlConnection(Str4)
            Dim sql4 As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Almacen'"
            Dim daBD As New SqlDataAdapter(sql4, conn4)
            Dim dsbd As New DataSet()
            daBD.Fill(dsbd, "EmpresaSAE")
            Dim oTabla4 As DataTable
            oTabla4 = dsbd.Tables("EmpresaSAE")
            Dim SERVIDOR2 As String = ""
            Dim USUARIO2 As String = ""
            Dim NOMBRE_BD2 As String = ""
            Dim PASSWROD2 As String = ""
            Dim BASEDATOS2 As String = ""
            'Dim VTIPO As String = ""
            If oTabla4.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla4.Rows
                    SERVIDOR2 = oFila.Item("SERVIDOR").ToString
                    BASEDATOS2 = oFila.Item("BASEDATOS").ToString
                    USUARIO2 = oFila.Item("USUARIO").ToString
                    PASSWROD2 = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD2 = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness2 As String = Mid(NOMBRE_BD2, LongitudBD)
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD2.Trim + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn2 As New SqlConnection(Str2)
            '------------------------------------------
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            'Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-vgDiasActulizarSAE) 'Resta días
            sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR, CVE_VEND, CVE_PEDI, FECHA_DOC, FECHA_ENT, FECHA_VEN" +
            ",FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4, DES_TOT, DES_FIN, COM_TOT, CONDICION" +
            ",CVE_OBS, NUM_ALMA, ACT_CXC, ACT_COI, ENLAZADO, TIP_DOC_E, NUM_MONED, TIPCAMB, NUM_PAGOS, FECHAELAB" +
            ",PRIMERPAGO, RFC, CTLPOL, ESCFD, AUTORIZA, SERIE, FOLIO, AUTOANIO, DAT_ENVIO, CONTADO" +
            ",CVE_BITA, BLOQ, FORMAENVIO, DES_FIN_PORC, DES_TOT_PORC, IMPORTE, COM_TOT_PORC, METODODEPAGO, NUMCTAPAGO, TIP_DOC_ANT" +
            ",DOC_ANT, TIP_DOC_SIG, DOC_SIG FROM FACTP" + vgNumEmpresa.ToString +
            " WHERE CVE_DOC = '" & pPEDIDO & "'"
            TextBox1.Text = "sae/P67"
            Me.Refresh()
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            'Me.TextError.Text = "iniciar emp06... cnn sae"
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "FACTP" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("FACTP" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim TIP_DOC As String
            Dim NOMBRE_CLPV As String
            Dim CVE_CLPV As String
            Dim STATUS As String
            Dim DAT_MOSTR As String
            Dim CVE_VEND As String
            Dim CVE_PEDI As String
            Dim FECHA_DOC As String
            Dim FECHA_ENT As String
            Dim FECHA_VEN As String
            Dim FECHA_CANCELA As String
            Dim CAN_TOT As String
            Dim IMP_TOT1 As String
            Dim IMP_TOT2 As String
            Dim IMP_TOT3 As String
            Dim IMP_TOT4 As String
            Dim DES_TOT As String
            Dim DES_FIN As String
            Dim COM_TOT As String
            Dim CONDICION As String
            Dim CVE_OBS As String
            Dim NUM_ALMA As String
            Dim ACT_CXC As String
            Dim ACT_COI As String
            Dim ENLAZADO As String
            Dim TIP_DOC_E As String
            Dim NUM_MONED As String
            Dim TIPCAMB As String
            Dim NUM_PAGOS As String
            Dim FECHAELAB As String
            Dim PRIMERPAGO As String
            Dim RFC As String
            Dim CTLPOL As String
            Dim ESCFD As String
            Dim AUTORIZA As String
            Dim SERIE As String
            Dim FOLIO As String
            Dim AUTOANIO As String
            Dim DAT_ENVIO As String
            Dim CONTADO As String
            Dim CVE_BITA As String
            Dim BLOQ As String
            Dim FORMAENVIO As String
            Dim DES_FIN_PORC As String
            Dim DES_TOT_PORC As String
            Dim IMPORTE As String
            Dim COM_TOT_PORC As String
            Dim METODODEPAGO As String
            Dim NUMCTAPAGO As String
            Dim TIP_DOC_ANT As String
            Dim DOC_ANT As String
            Dim TIP_DOC_SIG As String
            Dim DOC_SIG As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                'VerificarSiExiste = VerificarSiExistePedidosCtes(CVE_DOC)
                VerificarSiExiste = VerificarSiExistePedidosCtes6(CVE_DOC, vgNumEmpresa)
                'Me.TextError.Text = "iniciar emp06... verifica existe Pedido cte. PASO"
                If VerificarSiExiste = False Then
                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString ' clave del cliente
                    IMPORTE = oRow.Item("IMPORTE").ToString
                    CAN_TOT = oRow.Item("CAN_TOT").ToString
                    ENLAZADO = oRow.Item("ENLAZADO").ToString
                    TIP_DOC_E = oRow.Item("TIP_DOC_E").ToString
                    FECHA_ENT = oRow.Item("FECHA_ENT").ToString
                    RFC = oRow.Item("RFC").ToString
                    If Len(FECHA_ENT) > 1 Then
                        FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("yyyy/MM/dd HH:mm:ss")
                        'FECHA_ENT = FormatDateTime(FECHA_ENT, DateFormat.GeneralDate)
                        Dim time As Date = FECHA_ENT
                        FECHA_ENT = time.ToString("yyyy/MM/dd")
                    End If
                    'If ENLAZADO = "O" And TIP_DOC_E = "O" Then
                    If ENLAZADO = "O" And (TIP_DOC_E = "O" Or TIP_DOC_E = "C") Then
                        '----- BUSCAR RFC
                        CVE_CLPV = "0"
                        'eeeerr()
                        If vlRFC = "" Then
                            CVE_CLPV = "0"
                        Else
                            Dim reader7 As SqlDataReader
                            'Me.TextError.Text = "iniciar emp06... TABLA CLIE"
                            sqllocal = "SELECT CLAVE, NOMBRE FROM CLIE" + nnBisness2.ToString + " WHERE  RFC = '" + vlRFC.ToString + "'"
                            TextBox1.Text = "sae/P68"
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn2)
                            'Me.TextError.Text = "iniciar emp06... CN CTE:" + Str2.ToString
                            If conn2.State = ConnectionState.Closed Then
                                conn2.Open()
                            End If
                            'Me.TextError.Text = "iniciar emp06... CN CTE2"
                            reader7 = cmd.ExecuteReader()
                            While reader7.Read()
                                CVE_CLPV = reader7.Item(0).ToString
                                NOMBRE_CLPV = reader7.Item(1).ToString.Trim
                            End While
                            If CVE_CLPV = "" Then
                                CVE_CLPV = "0"
                                NOMBRE_CLPV = ""
                            End If
                            reader7.Close()
                            conn2.Close()
                        End If
                        If Trim(CVE_CLPV) <> "MOSTR" Then
                            CVE_CLPV = espacios(CVE_CLPV, 10)
                        End If
                        '------------------------------------------
                        'Me.TextError.Text = "iniciar emp06... INSERTAR ENCABEZADO"
                        sqllocal = "INSERT INTO Logistik_orders(id_order, reference, id_shop_group, id_shop, id_carrier" +
                        ",id_lang, id_customer, id_cart, id_currency, id_address_delivery" +
                        ",id_address_invoice, current_state, secure_key, payment, conversion_rate" +
                        ",module, recyclable, gift, gift_message, mobile_theme" +
                        ",shipping_number, total_discounts, total_discounts_tax_incl, total_discounts_tax_excl, total_paid" +
                        ",total_paid_tax_incl, total_paid_tax_excl, total_paid_real, total_products, total_products_wt" +
                        ",total_shipping, total_shipping_tax_incl, total_shipping_tax_excl, carrier_tax_rate, total_wrapping" +
                        ",total_wrapping_tax_incl, total_wrapping_tax_excl, round_mode, invoice_number, delivery_number" +
                        ",invoice_date, delivery_date ,valid ,date_add ,date_upd, EnviadaSAE, num_empresa,taxid,flagPrint) VALUES (" +
                        "'" + CVE_DOC + "','Ref','1','1','1'," +
                        "'2','" + CVE_CLPV + "','1','1','1'," +
                        "'1','1','202cb962ac59075b964b07152d234b70','Pago500',300," +
                        "'Modulo','1','1','bueno','1'," +
                        "'NumEnv5454',0,0,0,'" + CAN_TOT + "'," +
                        "16,0,'" + IMPORTE + "',1,100," +
                        "1,1,1,1,1," +
                        "1,1,1,1,1,'01/01/2020','01/01/2020'," +
                        "0,'" + FECHA_ENT.ToString + "','01/01/2020','N','" + vgNumEmpresa.ToString + "','" + RFC + "','7')"
                        'Me.TextError.Text = "iniciar emp06... INSERTAR ENCABEZADO2" + sqllocal.ToString
                        EjecutarQuerySQL_EMPRESA6(sqllocal)
                        'Me.TextError.Text = "iniciar emp06... pedidos detalle"
                        'Call DetallePedidosClientes(CVE_DOC, pMiBD)
                        TextBox1.Text = "sae/P69"
                        Me.Refresh()
                        Call DetallePedidosClientes6Error(CVE_DOC, pMiBD, vgNumEmpresa)
                        sqllocal = "UPDATE Logistik_orders set flagPrint='0' where id_order='" + CVE_DOC + "'"
                        EjecutarQuerySQL_EMPRESA6(sqllocal)
                    End If
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "InCorrecto pedido:" + CVE_DOC.ToString + " NO PASO A LA EMPRESA 6"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            If vgControlEntrada = 1 Then
                sqllocal = "delete from Logistik_orders where id_order='" + CVE_DOC + "'"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, pMiBD)
                sqllocal = "delete from Logistik_order_detail where id_order='" + CVE_DOC + "'"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, pMiBD)
                vgControlEntrada = 2
            Else
                sqllocal = "update Logistik_orders  set current_state='77' where id_order='" + CVE_DOC + "'"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, pMiBD)
                empresa = vgEmpresa.ToString
                documento = ""
                mensaje = "InCorrecto pedido:" + CVE_DOC.ToString + " NO PASO A LA EMPRESA 6 DOS VECES VERIFICAR"
                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                Me.Refresh()
                vgControlEntrada = 0
            End If
        End Try
    End Sub
    Private Sub PedidosEmp6(ByVal pMiBD As String, ByVal pPEDIDO As String, CAMPLIB34 As String, numBusiness As String, pRFC As String)
        Dim CVE_DOC As String = ""
        Dim cmdPedidos As SqlCommand
        Try
            'Me.TextError.Text = "iniciar emp06... pedidos"
            Dim Str4 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn4 As New SqlConnection(Str4)
            Dim sql4 As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Almacen'"
            Dim daBD As New SqlDataAdapter(sql4, conn4)
            Dim dsbd As New DataSet()
            daBD.Fill(dsbd, "EmpresaSAE")
            Dim oTabla4 As DataTable
            oTabla4 = dsbd.Tables("EmpresaSAE")
            Dim SERVIDOR2 As String = ""
            Dim USUARIO2 As String = ""
            Dim NOMBRE_BD2 As String = ""
            Dim PASSWROD2 As String = ""
            Dim BASEDATOS2 As String = ""
            'Dim VTIPO As String = ""
            If oTabla4.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla4.Rows
                    SERVIDOR2 = oFila.Item("SERVIDOR").ToString
                    BASEDATOS2 = oFila.Item("BASEDATOS").ToString
                    USUARIO2 = oFila.Item("USUARIO").ToString
                    PASSWROD2 = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD2 = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness2 As String = Mid(NOMBRE_BD2, LongitudBD)
            'sae06
            Dim Str06 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=LogistikMasterValvulerias06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim connLG06 As New SqlConnection(Str06)
            'sae06
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + BASEDATOS2.Trim + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim connLg As New SqlConnection(Str2)
            'Logistik 01,04
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'sae01
            Dim Str3 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=SAE80_EMP01;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn3 As New SqlConnection(Str3)
            '///////////////////////////////////////////////////////////
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-vgDiasActulizarSAE) 'Resta días
            sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR, CVE_VEND, CVE_PEDI, FECHA_DOC, FECHA_ENT, FECHA_VEN" +
            ",FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4, DES_TOT, DES_FIN, COM_TOT, CONDICION" +
            ",CVE_OBS, NUM_ALMA, ACT_CXC, ACT_COI, ENLAZADO, TIP_DOC_E, NUM_MONED, TIPCAMB, NUM_PAGOS, FECHAELAB" +
            ",PRIMERPAGO, RFC, CTLPOL, ESCFD, AUTORIZA, SERIE, FOLIO, AUTOANIO, DAT_ENVIO, CONTADO" +
            ",CVE_BITA, BLOQ, FORMAENVIO, DES_FIN_PORC, DES_TOT_PORC, IMPORTE, COM_TOT_PORC, METODODEPAGO, NUMCTAPAGO, TIP_DOC_ANT" +
            ",DOC_ANT, TIP_DOC_SIG, DOC_SIG FROM FACTP" + numBusiness.ToString +
            " WHERE CVE_DOC = '" + pPEDIDO + "'"
            TextBox1.Text = "sae_to_logistik/L06_P1"
            Me.Refresh()
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            'Me.TextError.Text = "iniciar emp06... cnn sae"
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "FACTP" & numBusiness.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("FACTP" & numBusiness.ToString)
            Dim TIP_DOC As String
            Dim NOMBRE_CLPV As String
            Dim CVE_CLPV As String = ""
            Dim STATUS As String
            Dim DAT_MOSTR As String
            Dim CVE_VEND As String
            Dim CVE_PEDI As String
            Dim FECHA_DOC As String
            Dim FECHA_ENT As String
            Dim FECHA_VEN As String
            Dim FECHA_CANCELA As String
            Dim CAN_TOT As String
            Dim IMP_TOT1 As String
            Dim IMP_TOT2 As String
            Dim IMP_TOT3 As String
            Dim IMP_TOT4 As String
            Dim DES_TOT As String
            Dim DES_FIN As String
            Dim COM_TOT As String
            Dim CONDICION As String
            Dim CVE_OBS As String
            Dim NUM_ALMA As String
            Dim ACT_CXC As String
            Dim ACT_COI As String
            Dim ENLAZADO As String
            Dim TIP_DOC_E As String
            Dim NUM_MONED As String
            Dim TIPCAMB As String
            Dim NUM_PAGOS As String
            Dim FECHAELAB As String
            Dim PRIMERPAGO As String
            Dim RFC As String
            Dim CTLPOL As String
            Dim ESCFD As String
            Dim AUTORIZA As String
            Dim SERIE As String
            Dim FOLIO As String
            Dim AUTOANIO As String
            Dim DAT_ENVIO As String
            Dim CONTADO As String
            Dim CVE_BITA As String
            Dim BLOQ As String
            Dim FORMAENVIO As String
            Dim DES_FIN_PORC As String
            Dim DES_TOT_PORC As String
            Dim IMPORTE As String
            Dim COM_TOT_PORC As String
            Dim METODODEPAGO As String
            Dim NUMCTAPAGO As String
            Dim TIP_DOC_ANT As String
            Dim DOC_ANT As String
            Dim TIP_DOC_SIG As String
            Dim DOC_SIG As String
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                'VerificarSiExiste = VerificarSiExistePedidosCtes(CVE_DOC)
                VerificarSiExiste = VerificarSiExistePedidosCtes6(CVE_DOC, numBusiness)
                'Me.TextError.Text = "iniciar emp06... verifica existe Pedido cte. PASO"

                If VerificarSiExiste = False Then
                    'pRFC   buscar en la tabla l20 y traer el id del cliente
                    '////////////////////////////////////////////////////////////////////////////
                    Dim reader As SqlDataReader
                    Dim SqlSelection As String = "Select id_customer FROM Logistik_customer " +
                    " WHERE taxid ='" + pRFC + "'"
                    If connLg.State = ConnectionState.Closed Then
                        connLg.Open()
                    End If
                    cmd = New SqlCommand(SqlSelection, connLg)
                    reader = cmd.ExecuteReader
                    While reader.Read()
                        CVE_CLPV = reader.Item(0).ToString
                    End While
                    reader.Close()
                    If CVE_CLPV = "" Then
                        CVE_CLPV = oRow.Item("CVE_CLPV").ToString ' clave del cliente
                    End If
                    '////////////////////////////////////////////////////////////////////////////
                    'realizar una validacion del RFC si no existe
                    IMPORTE = oRow.Item("IMPORTE").ToString
                    CAN_TOT = oRow.Item("CAN_TOT").ToString
                    ENLAZADO = oRow.Item("ENLAZADO").ToString
                    TIP_DOC_E = oRow.Item("TIP_DOC_E").ToString
                    FECHA_ENT = oRow.Item("FECHA_ENT").ToString
                    RFC = oRow.Item("RFC").ToString
                    If Len(FECHA_ENT) > 1 Then
                        FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("yyyyMMdd HH:mm:ss")
                        FECHA_ENT = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                        'Dim time As Date = FECHA_ENT
                        'FECHA_ENT = time.ToString("yyyyMMdd")
                    Else
                        'Dim vFecha7 As Date = Today.Date.Now
                        'FECHA_ENT = vFecha7.ToString("yyyyMMdd")
                        FECHA_ENT = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                    End If
                    If connLg.State = ConnectionState.Closed Then
                        connLg.Open()
                    End If
                    objTransPedidos = connLg.BeginTransaction()
                    'cmdPedidos = New SqlCommand(Querys(i), connLg, objTransPedidos)
                    'objTransPedidos.Commit()
                    'objTransPedidos.Rollback()
                    If ENLAZADO = "O" And (UCase(TIP_DOC_E) = "O" Or UCase(TIP_DOC_E) = "C") Then
                        If CAMPLIB34 = "" Then
                            sqllocal = "INSERT INTO Logistik_orders(id_order, reference, id_shop_group, id_shop, id_carrier" +
                            ",id_lang, id_customer, id_cart, id_currency, id_address_delivery" +
                            ",id_address_invoice, current_state, secure_key, payment, conversion_rate" +
                            ",module, recyclable, gift, gift_message, mobile_theme" +
                            ",shipping_number, total_discounts, total_discounts_tax_incl, total_discounts_tax_excl, total_paid" +
                            ",total_paid_tax_incl, total_paid_tax_excl, total_paid_real, total_products, total_products_wt" +
                            ",total_shipping, total_shipping_tax_incl, total_shipping_tax_excl, carrier_tax_rate, total_wrapping" +
                            ",total_wrapping_tax_incl, total_wrapping_tax_excl, round_mode, invoice_number, delivery_number" +
                            ",invoice_date, delivery_date ,valid ,date_add ,date_upd, EnviadaSAE, num_empresa,taxid,flagPrint,CAMPLIB34) VALUES (" +
                            "'" + CVE_DOC + "','Ref','1','1','1'," +
                            "'2','" + CVE_CLPV + "','1','1','1'," +
                            "'1','1','202cb962ac59075b964b07152d234b70','Pago500',300," +
                            "'Modulo','1','1','bueno','1'," +
                            "'NumEnv5454',0,0,0,'" + CAN_TOT + "'," +
                            "16,0,'" + IMPORTE + "',1,100," +
                            "1,1,1,1,1," +
                            "1,1,1,1,1,'" + FECHA_ENT.ToString + "','" + FECHA_ENT.ToString + "'," +
                            "0,'" + FECHA_ENT.ToString + "','" + FECHA_ENT.ToString + "','N','" + numBusiness.ToString + "','" + RFC + "','0',NULL)"
                        Else
                            sqllocal = "INSERT INTO Logistik_orders(id_order, reference, id_shop_group, id_shop, id_carrier" +
                            ",id_lang, id_customer, id_cart, id_currency, id_address_delivery" +
                            ",id_address_invoice, current_state, secure_key, payment, conversion_rate" +
                            ",module, recyclable, gift, gift_message, mobile_theme" +
                            ",shipping_number, total_discounts, total_discounts_tax_incl, total_discounts_tax_excl, total_paid" +
                            ",total_paid_tax_incl, total_paid_tax_excl, total_paid_real, total_products, total_products_wt" +
                            ",total_shipping, total_shipping_tax_incl, total_shipping_tax_excl, carrier_tax_rate, total_wrapping" +
                            ",total_wrapping_tax_incl, total_wrapping_tax_excl, round_mode, invoice_number, delivery_number" +
                            ",invoice_date, delivery_date ,valid ,date_add ,date_upd, EnviadaSAE, num_empresa,taxid,flagPrint,CAMPLIB34) VALUES (" +
                            "'" + CVE_DOC + "','Ref','1','1','1'," +
                            "'2','" + CVE_CLPV + "','1','1','1'," +
                            "'1','1','202cb962ac59075b964b07152d234b70','Pago500',300," +
                            "'Modulo','1','1','bueno','1'," +
                            "'NumEnv5454',0,0,0,'" + CAN_TOT + "'," +
                            "16,0,'" + IMPORTE + "',1,100," +
                            "1,1,1,1,1," +
                            "1,1,1,1,1,'" + FECHA_ENT.ToString + "','" + FECHA_ENT.ToString + "'," +
                            "0,'" + FECHA_ENT.ToString + "','" + FECHA_ENT.ToString + "','N','" + numBusiness.ToString + "','" + RFC + "','0','" + CAMPLIB34 + "')"
                        End If
                        cmdPedidos = New SqlCommand(sqllocal, connLg, objTransPedidos)
                        cmdPedidos.ExecuteNonQuery()
                        'EjecutarQuerySQL_EMPRESA6(sqllocal)
                        TextBox1.Text = "sae_to_logistik/L06_P2"
                        Me.Refresh()
                        '/////////////////////////////////////////////////////////////////////////////////////////////////////////
                        'poner el detalle junto
                        'Call DetallePedidosClientes6(CVE_DOC, pMiBD, numBusiness, CAMPLIB34)
                        Dim CAMPLIB34gdl As String = CAMPLIB34
                        sqllocal = "Select PD.CVE_DOC, PD.NUM_PAR, PD.CVE_ART, ART.DESCR, PD.CANT, PD.PXS, PD.PREC, PD.COST, PD.IMPU1, PD.IMPU2, PD.IMPU3" +
                        ",PD.IMPU4, PD.IMP1APLA, PD.IMP2APLA, PD.IMP3APLA, PD.IMP4APLA, PD.TOTIMP1, PD.TOTIMP2, PD.TOTIMP3, PD.TOTIMP4, PD.DESC1" +
                        ",PD.DESC2, PD.DESC3, PD.COMI, PD.APAR, PD.ACT_INV, PD.NUM_ALM, PD.POLIT_APLI, PD.TIP_CAM, PD.UNI_VENTA, PD.TIPO_PROD" +
                        ",PD.CVE_OBS, PD.REG_SERIE, PD.E_LTPD, PD.TIPO_ELEM, PD.NUM_MOV, PD.TOT_PARTIDA, PD.IMPRIMIR FROM PAR_FACTP" + numBusiness.ToString + " PD, INVE" + numBusiness.ToString + " ART" +
                        " WHERE PD.CVE_ART = ART.CVE_ART AND PD.CVE_DOC = '" + CVE_DOC + "'"
                        TextBox1.Text = "sae/P70:" + Str
                        Me.Refresh()
                        Dim da7 As New SqlDataAdapter(sqllocal, conn)
                        Dim ds7 As New DataSet
                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        da7.Fill(ds7, "PAR_FACTP" & numBusiness.ToString)
                        Dim oTable2 As New DataTable
                        oTable2 = ds7.Tables("PAR_FACTP" & numBusiness.ToString)
                        'Dim CVE_DOC As String
                        Dim NUM_PAR As String
                        Dim CVE_ART As String
                        Dim DESCR As String
                        Dim CANT As String
                        Dim PXR As String
                        Dim PREC As String
                        Dim COST As String
                        Dim IMPU1 As String
                        Dim IMPU2 As String
                        Dim IMPU3 As String
                        Dim IMPU4 As String
                        Dim IMP1APLA As String
                        Dim IMP2APLA As String
                        Dim IMP3APLA As String
                        Dim IMP4APLA As String
                        Dim TOTIMP1 As String
                        Dim TOTIMP2 As String
                        Dim TOTIMP3 As String
                        Dim TOTIMP4 As String
                        Dim DESCU As String
                        Dim ACT_INV As String
                        Dim TIP_CAM As String
                        Dim UNI_VENTA As String
                        Dim TIPO_ELEM As String
                        Dim TIPO_PROD As String
                        'Dim CVE_OBS As String
                        Dim E_LTPD As String
                        Dim REG_SERIE As String
                        Dim FACTCONV As String
                        Dim COST_DEV As String
                        Dim NUM_ALM As String = 0
                        Dim MINDIRECTO As String
                        Dim NUM_MOV As String
                        Dim TOT_PARTIDA As String
                        Dim id_attributes As String = 0
                        Dim CampLib1, CampLib2, CampLib3, CampLib4, CampLib5, CampLib6, CampLib7 As String
                        Dim CampLib8, CampLib9, CampLib10, CampLib11, CampLib12 As String
                        Dim CampLib13, CampLib14, CampLib15, CampLib16, CampLib17 As String
                        Dim CampLib18, CampLib19, CampLib20, CampLib21, CampLib22 As String
                        Dim CampLib23, CampLib24, CampLib25, CampLib26, CampLib27 As String
                        Dim CampLib28, CampLib29, CampLib30, CampLib31, CampLib32 As String
                        Dim CampLib33, CampLib344, CampLib35, CampLib36, CampLib37 As String
                        Dim CampLib38, CampLib39, CampLib40, CampLib41, CampLib42 As String
                        Dim CampLib43, CampLib44, CampLib45 As String

                        Dim CampLibA1, CampLibA2, CampLibA3, CampLibA4, CampLibA5, CampLibA6, CampLibA7 As String
                        Dim CampLibA8, CampLibA9, CampLibA10, CampLibA11, CampLibA12 As String
                        Dim CampLibA13, CampLibA14, CampLibA15, CampLibA16, CampLibA17 As String
                        Dim CampLibA18, CampLibA19, CampLibA20, CampLibA21, CampLibA22 As String
                        Dim CampLibA23, CampLibA24, CampLibA25, CampLibA26, CampLibA27 As String
                        Dim CampLibA28, CampLibA29, CampLibA30, CampLibA31, CampLibA32 As String
                        Dim CampLibA33, CampLibA34, CampLibA35, CampLibA36, CampLibA37 As String
                        Dim CampLibA38, CampLibA39, CampLibA40, CampLibA41, CampLibA42 As String
                        Dim CampLibA43, CampLibA44, CampLibA45 As String
                        For Each oRow2 In oTable2.Rows
                            CVE_DOC = oRow2.Item("CVE_DOC").ToString
                            NUM_PAR = oRow2.Item("NUM_PAR").ToString
                            CVE_ART = oRow2.Item("CVE_ART").ToString
                            DESCR = oRow2.Item("DESCR").ToString
                            DESCR = DESCR.Replace("'", "")
                            TIP_CAM = oRow2.Item("TIP_CAM").ToString
                            CANT = oRow2.Item("CANT").ToString
                            PREC = oRow2.Item("PREC").ToString
                            If Trim(UCase(CAMPLIB34gdl)) = "GDL" Then
                                NUM_ALM = "984"
                            Else
                                NUM_ALM = "1"
                            End If
                            Dim FECHA_DOC2 As String = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                            TOT_PARTIDA = oRow2.Item("TOT_PARTIDA").ToString
                            If TOT_PARTIDA = "" Then TOT_PARTIDA = "1"
                            TextBox1.Text = "sae/P70.1"
                            Me.Refresh()
                            'verificar cve_art si existe o no 
                            'verificar que la empresa sea la 01
                            If numBusiness = "01" Then
                                sqllocal = "SELECT CAMPLIB1, CAMPLIB2, CAMPLIB3, CAMPLIB4
                                ,CAMPLIB5,CAMPLIB6,CAMPLIB7,CAMPLIB8,CAMPLIB9
                                ,CAMPLIB10,CAMPLIB11,CAMPLIB12,CAMPLIB13,CAMPLIB14
                                ,CAMPLIB15,CAMPLIB16,CAMPLIB17,CAMPLIB18,CAMPLIB19
                                ,CAMPLIB20,CAMPLIB21,CAMPLIB22,CAMPLIB23,CAMPLIB24
                                ,CAMPLIB25,CAMPLIB26,CAMPLIB27,CAMPLIB28,CAMPLIB29
                                ,CAMPLIB30,CAMPLIB31,CAMPLIB32,CAMPLIB33,CAMPLIB34
                                ,CAMPLIB35,CAMPLIB36,CAMPLIB37,CAMPLIB38,CAMPLIB39
                                ,CAMPLIB40,CAMPLIB41,CAMPLIB42,CAMPLIB43,CAMPLIB44
                                ,CAMPLIB45 FROM INVE_CLIB01 where CVE_PROD ='" + CVE_ART + "'"
                                If conn3.State = ConnectionState.Closed Then
                                    conn3.Open()
                                End If
                                Dim readerINVE_CLIB As SqlDataReader
                                cmd = New SqlCommand(sqllocal, conn3)
                                readerINVE_CLIB = cmd.ExecuteReader()
                                CampLib1 = "" : CampLib2 = "" : CampLib3 = "" : CampLib4 = ""
                                CampLib5 = "" : CampLib6 = "" : CampLib7 = "" : CampLib8 = ""
                                CampLib9 = "" : CampLib10 = "" : CampLib11 = "" : CampLib12 = ""
                                CampLib13 = "" : CampLib14 = "" : CampLib15 = "" : CampLib16 = ""
                                CampLib17 = "" : CampLib18 = "" : CampLib19 = "" : CampLib20 = ""
                                CampLib21 = "" : CampLib22 = "" : CampLib23 = "" : CampLib24 = ""
                                CampLib25 = "" : CampLib26 = "" : CampLib27 = "" : CampLib28 = ""
                                CampLib29 = "" : CampLib30 = "" : CampLib31 = "" : CampLib32 = ""
                                CampLib33 = "" : CampLib344 = "" : CampLib35 = "" : CampLib36 = ""
                                CampLib37 = "" : CampLib38 = "" : CampLib39 = "" : CampLib40 = ""
                                CampLib41 = "" : CampLib42 = "" : CampLib43 = "" : CampLib44 = ""
                                CampLib45 = ""
                                While readerINVE_CLIB.Read()
                                    CampLibA1 = "" : CampLibA2 = "" : CampLibA3 = "" : CampLibA4 = ""
                                    CampLibA5 = "" : CampLibA6 = "" : CampLibA7 = "" : CampLibA8 = ""
                                    CampLibA9 = "" : CampLibA10 = "" : CampLibA11 = "" : CampLibA12 = ""
                                    CampLibA13 = "" : CampLibA14 = "" : CampLibA15 = "" : CampLibA16 = ""
                                    CampLibA17 = "" : CampLibA18 = "" : CampLibA19 = "" : CampLibA20 = ""
                                    CampLibA21 = "" : CampLibA22 = "" : CampLibA23 = "" : CampLibA24 = ""
                                    CampLibA25 = "" : CampLibA26 = "" : CampLibA27 = "" : CampLibA28 = ""
                                    CampLibA29 = "" : CampLibA30 = "" : CampLibA31 = "" : CampLibA32 = ""
                                    CampLibA33 = "" : CampLibA34 = "" : CampLibA35 = "" : CampLibA36 = ""
                                    CampLibA37 = "" : CampLibA38 = "" : CampLibA39 = "" : CampLibA40 = ""
                                    CampLibA41 = "" : CampLibA42 = "" : CampLibA43 = "" : CampLibA44 = ""
                                    CampLibA45 = ""
                                    '/////////////query quien si y quin no
                                    sqllocal = "SELECT NUM_EMP, MascaraOrdenCompra, MascaraRecepcion, MascaraPedido, MascaraRemision" +
                                    ",MultiAlmacen, InvNumDecimales, ActivarQuerys, CampLib1, CampLib2" +
                                    ",CampLib3, CampLib4, CampLib5, CampLib6, CampLib7" +
                                    ",CampLib8, CampLib9, CampLib10, CampLib11, CampLib12" +
                                    ",CampLib13, CampLib14, CampLib15, CampLib16, CampLib17" +
                                    ",CampLib18, CampLib19, CampLib20, CampLib21, CampLib22" +
                                    ",CampLib23, CampLib24, CampLib25, CampLib26, CampLib27" +
                                    ",CampLib28, CampLib29, CampLib30, CampLib31, CampLib32" +
                                    ",CampLib33, CampLib34, CampLib35, CampLib36, CampLib37" +
                                    ",CampLib38, CampLib39, CampLib40, CampLib41, CampLib42" +
                                    ",CampLib43, CampLib44, CampLib45" +
                                    " From Logistik_Config_SAE"
                                    Dim readerActivos As SqlDataReader
                                    If connLg.State = ConnectionState.Closed Then
                                        connLg.Open()
                                    End If
                                    cmdPedidos = New SqlCommand(sqllocal, connLg, objTransPedidos)
                                    readerActivos = cmdPedidos.ExecuteReader()
                                    While readerActivos.Read()
                                        CampLibA1 = readerActivos.Item("camplib1").ToString
                                        CampLibA2 = readerActivos.Item("camplib2").ToString
                                        CampLibA3 = readerActivos.Item("camplib3").ToString
                                        CampLibA4 = readerActivos.Item("camplib4").ToString
                                        CampLibA5 = readerActivos.Item("camplib5").ToString
                                        CampLibA6 = readerActivos.Item("camplib6").ToString
                                        CampLibA7 = readerActivos.Item("camplib7").ToString
                                        CampLibA8 = readerActivos.Item("camplib8").ToString
                                        CampLibA9 = readerActivos.Item("camplib9").ToString
                                        CampLibA10 = readerActivos.Item("camplib10").ToString
                                        CampLibA11 = readerActivos.Item("camplib11").ToString
                                        CampLibA12 = readerActivos.Item("camplib12").ToString
                                        CampLibA13 = readerActivos.Item("camplib13").ToString
                                        CampLibA14 = readerActivos.Item("camplib14").ToString
                                        CampLibA15 = readerActivos.Item("camplib15").ToString
                                        CampLibA16 = readerActivos.Item("camplib16").ToString
                                        CampLibA17 = readerActivos.Item("camplib17").ToString
                                        CampLibA18 = readerActivos.Item("camplib18").ToString
                                        CampLibA19 = readerActivos.Item("camplib19").ToString
                                        CampLibA20 = readerActivos.Item("camplib20").ToString
                                        CampLibA21 = readerActivos.Item("camplib21").ToString
                                        CampLibA22 = readerActivos.Item("camplib22").ToString
                                        CampLibA23 = readerActivos.Item("camplib23").ToString
                                        CampLibA24 = readerActivos.Item("camplib24").ToString
                                        CampLibA25 = readerActivos.Item("camplib25").ToString
                                        CampLibA26 = readerActivos.Item("camplib26").ToString
                                        CampLibA27 = readerActivos.Item("camplib27").ToString
                                        CampLibA28 = readerActivos.Item("camplib28").ToString
                                        CampLibA29 = readerActivos.Item("camplib29").ToString
                                        CampLibA30 = readerActivos.Item("camplib30").ToString
                                        CampLibA31 = readerActivos.Item("camplib31").ToString
                                        CampLibA32 = readerActivos.Item("camplib32").ToString
                                        CampLibA33 = readerActivos.Item("camplib33").ToString
                                        CampLibA34 = readerActivos.Item("camplib34").ToString
                                        CampLibA35 = readerActivos.Item("camplib35").ToString
                                        CampLibA36 = readerActivos.Item("camplib36").ToString
                                        CampLibA37 = readerActivos.Item("camplib37").ToString
                                        CampLibA38 = readerActivos.Item("camplib38").ToString
                                        CampLibA39 = readerActivos.Item("camplib39").ToString
                                        CampLibA40 = readerActivos.Item("camplib40").ToString
                                        CampLibA41 = readerActivos.Item("camplib41").ToString
                                        CampLibA42 = readerActivos.Item("camplib42").ToString
                                        CampLibA43 = readerActivos.Item("camplib43").ToString
                                        CampLibA44 = readerActivos.Item("camplib44").ToString
                                        CampLibA45 = readerActivos.Item("camplib45").ToString
                                    End While
                                    readerActivos.Close()
                                    If CampLibA1 = "1" Then CampLib1 = readerINVE_CLIB.Item("CAMPLIB1").ToString
                                    If CampLibA2 = "1" Then CampLib2 = readerINVE_CLIB.Item("CAMPLIB2").ToString
                                    If CampLibA3 = "1" Then CampLib3 = readerINVE_CLIB.Item("CAMPLIB3").ToString
                                    If CampLibA4 = "1" Then 'int
                                        CampLib4 = readerINVE_CLIB.Item("CAMPLIB4").ToString
                                        If Len(CampLib4) <= 0 Then
                                            CampLib4 = "0"
                                        End If
                                    Else
                                        CampLib4 = "0"
                                    End If
                                    If CampLibA5 = "1" Then 'float
                                        CampLib5 = readerINVE_CLIB.Item("CAMPLIB5").ToString
                                        If Len(CampLib5) <= 0 Then
                                            CampLib5 = "0"
                                        End If
                                    Else
                                        CampLib5 = "0"
                                    End If
                                    If CampLibA6 = "1" Then 'float
                                        CampLib6 = readerINVE_CLIB.Item("CAMPLIB6").ToString
                                        If Len(CampLib6) <= 0 Then
                                            CampLib6 = "0"
                                        End If
                                    Else
                                        CampLib6 = "0"
                                    End If
                                    If CampLibA7 = "1" Then CampLib7 = readerINVE_CLIB.Item("CAMPLIB7").ToString
                                    If CampLibA8 = "1" Then CampLib8 = readerINVE_CLIB.Item("CAMPLIB8").ToString
                                    If CampLibA9 = "1" Then CampLib9 = readerINVE_CLIB.Item("CAMPLIB9").ToString
                                    If CampLibA10 = "1" Then CampLib10 = readerINVE_CLIB.Item("CAMPLIB10").ToString
                                    If CampLibA11 = "1" Then CampLib11 = readerINVE_CLIB.Item("CAMPLIB11").ToString
                                    If CampLibA12 = "1" Then CampLib12 = readerINVE_CLIB.Item("CAMPLIB12").ToString
                                    If CampLibA13 = "1" Then CampLib13 = readerINVE_CLIB.Item("CAMPLIB13").ToString
                                    If CampLibA14 = "1" Then CampLib14 = readerINVE_CLIB.Item("CAMPLIB14").ToString
                                    If CampLibA15 = "1" Then CampLib15 = readerINVE_CLIB.Item("CAMPLIB15").ToString
                                    If CampLibA16 = "1" Then CampLib16 = readerINVE_CLIB.Item("CAMPLIB16").ToString
                                    If CampLibA17 = "1" Then CampLib17 = readerINVE_CLIB.Item("CAMPLIB17").ToString
                                    If CampLibA18 = "1" Then CampLib18 = readerINVE_CLIB.Item("CAMPLIB18").ToString
                                    If CampLibA19 = "1" Then CampLib19 = readerINVE_CLIB.Item("CAMPLIB19").ToString
                                    If CampLibA20 = "1" Then CampLib20 = readerINVE_CLIB.Item("CAMPLIB20").ToString
                                    If CampLibA21 = "1" Then CampLib21 = readerINVE_CLIB.Item("CAMPLIB21").ToString
                                    If CampLibA22 = "1" Then CampLib22 = readerINVE_CLIB.Item("CAMPLIB22").ToString
                                    If CampLibA23 = "1" Then CampLib23 = readerINVE_CLIB.Item("CAMPLIB23").ToString
                                    If CampLibA24 = "1" Then CampLib24 = readerINVE_CLIB.Item("CAMPLIB24").ToString
                                    If CampLibA25 = "1" Then CampLib25 = readerINVE_CLIB.Item("CAMPLIB25").ToString
                                    If CampLibA26 = "1" Then CampLib26 = readerINVE_CLIB.Item("CAMPLIB26").ToString
                                    If CampLibA27 = "1" Then CampLib27 = readerINVE_CLIB.Item("CAMPLIB27").ToString
                                    If CampLibA28 = "1" Then CampLib28 = readerINVE_CLIB.Item("CAMPLIB28").ToString
                                    If CampLibA29 = "1" Then CampLib29 = readerINVE_CLIB.Item("CAMPLIB29").ToString
                                    If CampLibA30 = "1" Then CampLib30 = readerINVE_CLIB.Item("CAMPLIB30").ToString
                                    If CampLibA31 = "1" Then CampLib31 = readerINVE_CLIB.Item("CAMPLIB31").ToString
                                    If CampLibA32 = "1" Then 'datetime
                                        CampLib32 = readerINVE_CLIB.Item("CAMPLIB32").ToString
                                        If CampLib32 = "" Then
                                            CampLib32 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                                        Else
                                            CampLib32 = Format(CDate(CampLib32), "yyyyMMdd HH:mm:ss").ToString
                                            'CampLib32 = Convert.ToDateTime(CampLib32, "yyyyMMdd HH:mm:ss").ToString
                                        End If
                                    Else
                                        CampLib32 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                                    End If
                                    If CampLibA33 = "1" Then CampLib33 = readerINVE_CLIB.Item("CAMPLIB33").ToString
                                    If CampLibA34 = "1" Then CampLib344 = readerINVE_CLIB.Item("CAMPLIB34").ToString
                                    If CampLibA35 = "1" Then 'datetime
                                        CampLib35 = readerINVE_CLIB.Item("CAMPLIB35").ToString
                                        If CampLib35 = "" Then
                                            CampLib35 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                                        Else
                                            CampLib35 = Format(CDate(CampLib35), "yyyyMMdd HH:mm:ss").ToString
                                            'CampLib35 = Convert.ToDateTime(CampLib35, "yyyyMMdd HH:mm:ss").ToString
                                        End If
                                    Else
                                        CampLib35 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                                    End If
                                    If CampLibA36 = "1" Then 'float
                                        CampLib36 = readerINVE_CLIB.Item("CAMPLIB36").ToString
                                        If Len(CampLib36) <= 0 Then
                                            CampLib36 = "0"
                                        End If
                                    Else
                                        CampLib36 = "0"
                                    End If
                                    If CampLibA37 = "1" Then 'float
                                        CampLib37 = readerINVE_CLIB.Item("CAMPLIB37").ToString
                                        If Len(CampLib37) <= 0 Then
                                            CampLib37 = "0"
                                        End If
                                    Else
                                        CampLib37 = "0"
                                    End If
                                    If CampLibA38 = "1" Then 'float
                                        CampLib38 = readerINVE_CLIB.Item("CAMPLIB38").ToString
                                        If Len(CampLib38) <= 0 Then
                                            CampLib38 = "0"
                                        End If
                                    Else
                                        CampLib38 = "0"
                                    End If
                                    If CampLibA39 = "1" Then 'float
                                        CampLib39 = readerINVE_CLIB.Item("CAMPLIB39").ToString
                                        If Len(CampLib39) <= 0 Then
                                            CampLib39 = "0"
                                        End If
                                    Else
                                        CampLib39 = "0"
                                    End If
                                    If CampLibA40 = "1" Then CampLib40 = readerINVE_CLIB.Item("CAMPLIB40").ToString
                                    If CampLibA41 = "1" Then 'datetime
                                        CampLib41 = readerINVE_CLIB.Item("CAMPLIB41").ToString
                                        If CampLib41 = "" Then
                                            CampLib41 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                                        Else
                                            CampLib41 = Format(CDate(CampLib41), "yyyyMMdd HH:mm:ss").ToString
                                            'CampLib41 = Convert.ToDateTime(CampLib41, "yyyyMMdd HH:mm:ss").ToString
                                        End If
                                    Else
                                        CampLib41 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                                    End If
                                    If CampLibA42 = "1" Then CampLib42 = readerINVE_CLIB.Item("CAMPLIB42").ToString
                                    If CampLibA43 = "1" Then CampLib43 = readerINVE_CLIB.Item("CAMPLIB43").ToString
                                    If CampLibA44 = "1" Then CampLib44 = readerINVE_CLIB.Item("CAMPLIB44").ToString
                                    If CampLibA45 = "1" Then CampLib45 = readerINVE_CLIB.Item("CAMPLIB45").ToString
                                End While
                                readerINVE_CLIB.Close()
                            End If
                            '///////////////////////////////////////////////
                            'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                            Dim vIDArticulo As String
                            Dim readerIDArticulo As SqlDataReader
                            sqllocal = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + CVE_ART.Trim + "'"
                            LabelTABLA.Text = "sae/P4/1 Logistik_product"
                            LabelQuery.Text = sqllocal
                            If connLg.State = ConnectionState.Closed Then
                                connLg.Open()
                            End If
                            cmd = New SqlCommand(sqllocal, connLg, objTransPedidos)
                            readerIDArticulo = cmd.ExecuteReader()
                            While readerIDArticulo.Read()
                                vIDArticulo = readerIDArticulo.Item(0).ToString
                            End While
                            If vIDArticulo = "" Then
                                empresa = pMiBD.ToString
                                documento = CVE_DOC.ToString
                                mensaje = "No existe el producto en logistik:" + CVE_ART.ToString
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                Me.Refresh()
                                Exit For
                            End If
                            readerIDArticulo.Close()
                            TextBox1.Text = "sae/P70.2"
                            Me.Refresh()
                            sqllocal = "INSERT INTO Logistik_order_detail (id_order_detail, id_order, id_order_invoice, id_warehouse, id_shop" +
                            ",product_id, product_attribute_id, product_name, product_quantity, quantity_received" +
                            ",product_quantity_in_stock, product_quantity_refunded, product_quantity_return, product_quantity_reinjected, product_price" +
                            ",reduction_percent, reduction_amount, reduction_amount_tax_incl, reduction_amount_tax_excl, group_reduction" +
                            ",product_quantity_discount, product_ean13, product_upc, product_reference, product_supplier_reference" +
                            ",product_weight, id_tax_rules_group, tax_computation_method, tax_name, tax_rate" +
                            ",ecotax, ecotax_tax_rate, discount_quantity_applied, download_hash, download_nb" +
                            ",download_deadline, total_price_tax_incl, total_price_tax_excl, unit_price_tax_incl, unit_price_tax_excl" +
                            ",total_shipping_price_tax_incl, total_shipping_price_tax_excl, purchase_supplier_price, original_product_price,num_empresa,CampLib1, CampLib2" +
                            ",CampLib3, CampLib4, CampLib5, CampLib6, CampLib7" +
                            ",CampLib8, CampLib9, CampLib10, CampLib11, CampLib12" +
                            ",CampLib13, CampLib14, CampLib15, CampLib16, CampLib17" +
                            ",CampLib18, CampLib19, CampLib20, CampLib21, CampLib22" +
                            ",CampLib23, CampLib24, CampLib25, CampLib26, CampLib27" +
                            ",CampLib28, CampLib29, CampLib30, CampLib31, CampLib32" +
                            ",CampLib33, CampLib34, CampLib35, CampLib36, CampLib37" +
                            ",CampLib38, CampLib39, CampLib40, CampLib41, CampLib42" +
                            ",CampLib43, CampLib44, CampLib45) VALUES (" +
                            "'" + NUM_PAR + "','" + CVE_DOC + "',1,'" + NUM_ALM + "',1," +
                            "'" + vIDArticulo + "','" + id_attributes + "','" + DESCR + "','" + CANT + "',0," +
                            "1,1,1,1,'" + PREC + "'," +
                            "0,0,0,0,0," +
                            "0,'','" + CVE_ART + "','',''," +
                            "0,0,1,'IVA',1," +
                            "1,1,1,'',1," +
                            "'" + FECHA_DOC2 + "',16,0,0,0," +
                            "'" + TOT_PARTIDA + "',0,0,0,'" + numBusiness.ToString +
                            "','" + CampLib1 + "','" + CampLib2 +
                            "','" + CampLib3 + "','" + CampLib4 + "','" + CampLib5 + "','" + CampLib6 + "','" + CampLib7 +
                            "','" + CampLib8 + "','" + CampLib9 + "','" + CampLib10 + "','" + CampLib11 + "','" + CampLib12 +
                            "','" + CampLib13 + "','" + CampLib14 + "','" + CampLib15 + "','" + CampLib16 + "','" + CampLib17 +
                            "','" + CampLib18 + "','" + CampLib19 + "','" + CampLib20 + "','" + CampLib21 + "','" + CampLib22 +
                            "','" + CampLib23 + "','" + CampLib24 + "','" + CampLib25 + "','" + CampLib26 + "','" + CampLib27 +
                            "','" + CampLib28 + "','" + CampLib29 + "','" + CampLib30 + "','" + CampLib31 + "','" + CampLib32 +
                            "','" + CampLib33 + "','" + CampLib344 + "','" + CampLib35 + "','" + CampLib36 + "','" + CampLib37 +
                            "','" + CampLib38 + "','" + CampLib39 + "','" + CampLib40 + "','" + CampLib41 + "','" + CampLib42 +
                            "','" + CampLib43 + "','" + CampLib44 + "','" + CampLib45 + "')"
                            TextBox1.Text = "sae/P71"
                            Me.Refresh()
                            cmdPedidos = New SqlCommand(sqllocal, connLg, objTransPedidos)
                            cmdPedidos.ExecuteNonQuery()
                            'EjecutarQuerySQL_EMPRESA6(sqllocal)
                        Next
                        If conn.State = ConnectionState.Open Then
                            conn.Close()
                        End If
                        '/////////////////////////////////////////////////////////////////////////////////////////////////////////
                        'sqllocal = "UPDATE Logistik_orders set flagPrint='0' where id_order='" + CVE_DOC + "'"
                        'EjecutarQuerySQL_EMPRESA6(sqllocal)
                    End If
                    objTransPedidos.Commit()
                End If
                'If objTransPedidos.Connection Is Nothing Then

                'Else

                'End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

        Catch ex As Exception
            ErrorEMp06 = 1
            empresa = numBusiness.ToString
            documento = ""
            mensaje = "Sincronizar Pedido emp06: InCorrecta pedido emp06:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            'If objTransPedidos.Connection Is Nothing Then

            'Else
            objTransPedidos.Rollback()
            'End If

        Catch ex2 As SqlException
            ErrorEMp06 = 1
            empresa = numBusiness.ToString
            documento = ""
            mensaje = "Sincronizar Pedido emp06: InCorrecta pedido emp06:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTransPedidos.Rollback()
        End Try
    End Sub


    Private Sub TraerExisteMultiAlmProv(ByVal pMiBD As String)
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "Select CVE_ART,CVE_ALM,STATUS,CTRL_ALM,EXIST,STOCK_MIN,STOCK_MAX,COMP_X_REC FROM MULT" + vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "MULT" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("MULT" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim CVE_ART, CVE_ALM, STATUS, CTRL_ALM, EXIST, STOCK_MIN, STOCK_MAX, COMP_X_REC As String

            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ART = oRow.Item("CVE_ART").ToString
                CVE_ALM = oRow.Item("CVE_ALM").ToString

                VerificarSiExiste = VerifSiExistMulti(CVE_ART, CVE_ALM)
                If VerificarSiExiste = False Then
                    EXIST = oRow.Item("EXIST").ToString
                    sqllocal = "INSERT INTO wLogistik_Existencias(id_almacen,codigo_producto,existencia,apartado,disponible) VALUES ('" +
                    CVE_ALM.ToString + "','" + CVE_ART.ToString + "','" + EXIST.ToString + "','0','" + EXIST.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)

                Else
                    EXIST = oRow.Item("EXIST").ToString
                    Dim reader As SqlDataReader
                    Dim SqlSelection As String = "Select apartado FROM wLogistik_Existencias WHERE id_almacen ='" +
                    CVE_ALM.ToString + "' AND codigo_producto='" + CVE_ART.ToString + "'"
                    cmd = New SqlCommand(SqlSelection, conn)
                    reader = cmd.ExecuteReader
                    Dim existencia_apartada As Double
                    While reader.Read()
                        existencia_apartada = reader.Item(0).ToString
                    End While
                    reader.Close()
                    Dim Disponible As Double = EXIST - existencia_apartada
                    sqllocal = "UPDATE wLogistik_Existencias SET existencia ='" + EXIST.ToString + "', apartado ='" + Disponible.ToString +
                    "' WHERE id_almacen ='" + CVE_ALM.ToString + "' AND codigo_producto='" + CVE_ART.ToString + "'"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Function VerifSiExistMulti(ByVal particulo As String, ByVal palmacen As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_almacen FROM wLogistik_Existencias " +
            " WHERE codigo_producto ='" + particulo + "' and id_almacen = '" + palmacen + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "wLogistik_Existencias")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("wLogistik_Existencias")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If
        Catch ex As Exception
            Return False
        End Try
    End Function
    Private Sub TraerIndexPedidosProv(ByVal pMiBD As String)
        Dim CLAVE_DOC As String
        Try
            TextBox1.Text = "sae/IP1"
            Me.Refresh()
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "Select CLAVE_DOC FROM COMPR_CLIB" + vgNumEmpresa.ToString
            TextBox1.Text = "sae/IP2"
            Me.Refresh()
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "COMPR_CLIB" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("COMPR_CLIB" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If


            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CLAVE_DOC = oRow.Item("CLAVE_DOC").ToString
                VerificarSiExiste = VerifSiExistIndexPedidoProv(CLAVE_DOC)
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO Logistik_Index_supplyOrder(CLAVE_DOC) VALUES ('" +
                    CLAVE_DOC.ToString + "')"
                    TextBox1.Text = "sae/IP3"
                    Me.Refresh()
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            '    TextError.Text = TextError.Text + "fin de la sincronizacion de index compras ..." + vbCrLf

        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Index Orden de compra: InCorrecta Documento:" + CLAVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            TextBox1.Text = "sae/IP4"
            Me.Refresh()
            Me.Refresh()
        End Try
    End Sub

    Private Sub TraerIndexPedidosCtes(ByVal pMiBD As String)
        Dim CLAVE_DOC As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "Select CLAVE_DOC FROM FACTR_CLIB" + vgNumEmpresa.ToString
            TextBox1.Text = "sae/I1"
            Me.Refresh()
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "FACTR_CLIB" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("FACTR_CLIB" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CLAVE_DOC = oRow.Item("CLAVE_DOC").ToString
                VerificarSiExiste = VerifSiExistIndexPedido(CLAVE_DOC)
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO Logistik_Index_Order(CLAVE_DOC) VALUES ('" +
                    CLAVE_DOC.ToString + "')"
                    TextBox1.Text = "sae/I2"
                    Me.Refresh()
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                    'lee articulos
                    'Else ' actualizar existencia
                    '    sqllocal = "UPDATE Logistik_Impuestos SET DESCRIP = '" + DESCRIPESQ.ToString + "'," + _
                    '    "IMPUESTO = '" + IMPUESTO4.ToString + "', ESTATUS = '" + STATUS.ToString + "'" + _
                    '    " WHERE  CVE_IMP = '" + CVE_ESQIMPU.ToString + "'"
                    '    EjecutarQuerySQL(sqllocal)
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Index pedidos: InCorrecta Pedido:" + CLAVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            TextBox1.Text = "sae/I3"
            Me.Refresh()
        End Try
    End Sub

    Private Sub ActualizarTipoCambio(ByVal pMiBD As String)
        Dim NUM_MONED As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT NUM_MONED, DESCR, SIMBOLO, TCAMBIO, FULTCAMB, STATUS, UUID, VERSION_SINC" +
            " FROM MONED" + vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "MONED" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("MONED" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim DESCR As String
            Dim SIMBOLO As String
            Dim TCAMBIO As Double
            'Dim TCAMBIO As String
            Dim FULTCAMB As String
            Dim STATUS As String
            Dim UUID As String
            Dim VERSION_SINC As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                NUM_MONED = oRow.Item("NUM_MONED").ToString
                DESCR = oRow.Item("DESCR").ToString
                SIMBOLO = oRow.Item("SIMBOLO").ToString
                TCAMBIO = Convert.ToDouble(oRow.Item("TCAMBIO").ToString)
                'TCAMBIO = oRow.Item("TCAMBIO").ToString
                FULTCAMB = oRow.Item("FULTCAMB").ToString
                STATUS = oRow.Item("STATUS").ToString
                UUID = oRow.Item("UUID").ToString
                VERSION_SINC = oRow.Item("VERSION_SINC").ToString
                VerificarSiExiste = VerificarSiExistTipoCambio(NUM_MONED)
                FULTCAMB = Convert.ToDateTime(FULTCAMB).ToString("MM-dd-yyyy")
                VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("MM-dd-yyyy HH:mm:ss.mmm")
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO logistik_TipoCambio(NUM_MONED, DESCR, SIMBOLO, TCAMBIO, FULTCAMB, STATUS, UUID, VERSION_SINC) VALUES ('" +
                    NUM_MONED.ToString + "','" + DESCR.ToString + "','" + SIMBOLO.ToString + "','" + TCAMBIO.ToString + "','" + FULTCAMB.ToString + "','" +
                    STATUS.ToString + "','" + UUID.ToString + "','" + VERSION_SINC.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                    'lee articulos
                Else 'actualizar existencia
                    sqllocal = "UPDATE logistik_TipoCambio SET TCAMBIO = '" + TCAMBIO.ToString + "'" +
                    " WHERE  NUM_MONED = '" + NUM_MONED.ToString + "' and STATUS ='A'"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Tipo de Cambio: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Tipo de Cambio: InCorrecta Tipo de Cambio:" + NUM_MONED.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Private Sub ActualizarConceptosMov(ByVal pMiBD As String)
        Dim CVE_CPTO As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_CPTO, DESCR, CPN, CUEN_CONT, TIPO_MOV,STATUS, SIGNO FROM CONM" + vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "CONM" + vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("CONM" + vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim DESCR As String
            Dim CPN As String
            Dim CUEN_CONT As String
            Dim TIPO_MOV As String
            Dim STATUS As String
            Dim SIGNO As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_CPTO = oRow.Item("CVE_CPTO").ToString
                DESCR = oRow.Item("DESCR").ToString
                CPN = oRow.Item("CPN").ToString
                CUEN_CONT = oRow.Item("CUEN_CONT").ToString
                TIPO_MOV = oRow.Item("TIPO_MOV").ToString
                STATUS = oRow.Item("STATUS").ToString
                SIGNO = oRow.Item("SIGNO").ToString
                VerificarSiExiste = VerificarSiExistConceptosMov(CVE_CPTO)
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO Logistik_ConceposMov(CVE_CPTO, DESCR, CPN, CUEN_CONT, TIPO_MOV,STATUS, SIGNO) VALUES ('" +
                    CVE_CPTO.ToString + "','" + DESCR.ToString + "','" + CPN.ToString + "','" + CUEN_CONT.ToString + "','" +
                    TIPO_MOV.ToString + "','" + STATUS.ToString + "','" + SIGNO.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Conceptos movimientos: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Conceptos movimientos: InCorrecta Concepto movimiento:" + CVE_CPTO.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Function VerificarSiExistConceptosMov(ByVal pcodigo As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CVE_CPTO FROM Logistik_ConceposMov WHERE CVE_CPTO = '" & pcodigo & "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_ConceposMov")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_ConceposMov")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Private Sub ActualizarImpuestos(ByVal pMiBD As String)
        Dim CVE_ESQIMPU As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "Select CVE_ESQIMPU, DESCRIPESQ, IMPUESTO1, IMP1APLICA, IMPUESTO2," +
            " IMP2APLICA, IMPUESTO3, IMP3APLICA, IMPUESTO4, IMP4APLICA, STATUS" +
            " FROM IMPU" + vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "IMPU" + vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("IMPU" + vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim DESCRIPESQ As String
            Dim IMPUESTO1 As String
            Dim IMP1APLICA As String = "0"
            Dim IMPUESTO2 As String
            Dim IMP2APLICA As String
            Dim IMPUESTO3 As String
            Dim IMP3APLICA As String = "0"
            Dim IMPUESTO4 As String
            Dim IMP4APLICA As String
            Dim STATUS As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ESQIMPU = oRow.Item("CVE_ESQIMPU").ToString
                STATUS = oRow.Item("STATUS").ToString
                DESCRIPESQ = oRow.Item("DESCRIPESQ").ToString
                IMPUESTO4 = oRow.Item("IMPUESTO4").ToString
                VerificarSiExiste = VerificarSiExistImpuestos(CVE_ESQIMPU)
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO Logistik_Impuestos(CVE_IMP, DESCRIP, IMPUESTO, ESTATUS) VALUES ('" +
                    CVE_ESQIMPU.ToString + "','" + DESCRIPESQ.ToString + "','" + IMPUESTO4.ToString + "','" + STATUS.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                    'lee articulos
                Else ' actualizar existencia
                    sqllocal = "UPDATE Logistik_Impuestos SET DESCRIP = '" + DESCRIPESQ.ToString + "'," +
                    "IMPUESTO = '" + IMPUESTO4.ToString + "', ESTATUS = '" + STATUS.ToString + "'" +
                    " WHERE  CVE_IMP = '" + CVE_ESQIMPU.ToString + "'"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Impuestos: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Impuestos: InCorrecta impuesto:" + CVE_ESQIMPU.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Function VerifSiExistIndexPedidoProv(ByVal pcodigo As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CLAVE_DOC FROM Logistik_Index_supplyOrder WHERE CLAVE_DOC = '" & pcodigo & "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_Index_supplyOrder")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_Index_supplyOrder")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerifSiExistIndexPedido(ByVal pcodigo As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CLAVE_DOC FROM Logistik_Index_Order WHERE CLAVE_DOC = '" & pcodigo & "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_Index_Order")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_Index_Order")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExistTipoCambio(ByVal pcodigo As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT NUM_MONED FROM logistik_TipoCambio WHERE NUM_MONED = '" & pcodigo & "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "logistik_TipoCambio")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("logistik_TipoCambio")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExistImpuestos(ByVal pcodigo As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CVE_IMP FROM Logistik_Impuestos WHERE CVE_IMP = '" & pcodigo & "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_Impuestos")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_Impuestos")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Private Sub ActualizarVendedores(ByVal pMiBD As String)
        Dim CVE_VEND As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_VEND, STATUS, NOMBRE, COMI, CLASIFIC, CORREOE" +
            " FROM VEND" + vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "VEND" + vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("VEND" + vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

            Dim STATUS As String
            Dim NOMBRE As String
            Dim COMI As String = "0"
            Dim CLASIFIC As String
            Dim CORREOE As String

            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_VEND = oRow.Item("CVE_VEND").ToString
                STATUS = oRow.Item("STATUS").ToString
                NOMBRE = oRow.Item("NOMBRE").ToString
                COMI = oRow.Item("COMI").ToString
                If COMI = "" Then COMI = "0"
                CLASIFIC = oRow.Item("CLASIFIC").ToString
                CORREOE = oRow.Item("CORREOE").ToString
                VerificarSiExiste = VerificarSiExistVendedor(CVE_VEND)
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO Logistik_Vendedor(CVE_VEND, ESTATUS, NOMBRE, COMISION, CLASIFIC, CORREOE) VALUES ('" +
                    CVE_VEND.ToString + "','" + STATUS.ToString + "','" + NOMBRE.ToString + "','" + COMI.ToString + "','" + CLASIFIC.ToString + "','" + CORREOE.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                    'lee articulos
                Else ' actualizar existencia
                    sqllocal = "UPDATE Logistik_Vendedor SET NOMBRE = '" + NOMBRE.ToString + "'," +
                    "COMISION = '" + COMI.ToString + "', CLASIFIC = '" + CLASIFIC.ToString + "', CORREOE = '" + CORREOE.ToString + "'" +
                    " WHERE  CVE_VEND = '" + CVE_VEND.ToString + "'"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar vendedores: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar vendedores: InCorrecta vendedor:" + CVE_VEND.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Function VerificarSiExistVendedor(ByVal pcodigo As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CVE_VEND FROM Logistik_Vendedor WHERE CVE_VEND = '" & pcodigo & "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_Vendedor")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_Vendedor")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Private Sub ActualizarStock()

    End Sub
    'Private Sub ActualizarStockFB()
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "SELECT M.CVE_ART, M.ALMACEN, MAX(M.NUM_MOV) AS NUM_MOV, " + _
    '        "(SELECT EXISTENCIA FROM MINVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = M.CVE_ART AND ALMACEN = M.ALMACEN AND NUM_MOV = MAX(M.NUM_MOV)) AS EXIST" + _
    '        " FROM MINVE" + vgNumEmpresa.ToString + " AS M GROUP BY M.CVE_ART, M.ALMACEN"

    '        'sqllocal = "SELECT M.CVE_ART, M.ALMACEN, MAX(M.FECHAELAB) AS FECHA, " + _
    '        '"(SELECT EXISTENCIA FROM MINVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = M.CVE_ART AND ALMACEN = M.ALMACEN AND FECHAELAB = MAX(M.FECHAELAB)) AS EXIST" + _
    '        '" FROM MINVE" + vgNumEmpresa.ToString + " AS M GROUP BY M.CVE_ART, M.ALMACEN"
    '        Dim da As New FbDataAdapter(sqllocal, connFB)
    '        Dim ds As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da.Fill(ds, "MINVE" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds.Tables("MINVE" & vgNumEmpresa.ToString)
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        Dim CVE_ART As String
    '        Dim ALMACEN As String
    '        Dim EXISTENCIA As String
    '        Dim COSTO As String = "0"
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        Dim VerificarSiExiste As Boolean
    '        Dim vIDproducto As String
    '        For Each oRow In oTable.Rows
    '            CVE_ART = oRow.Item("CVE_ART").ToString
    '            ALMACEN = oRow.Item("ALMACEN").ToString
    '            EXISTENCIA = oRow.Item("EXIST").ToString
    '            'COSTO = oRow.Item("COSTO").ToString
    '            VerificarSiExiste = VerificarSiExistRegStock(CVE_ART, ALMACEN)
    '            vIDproducto = TraerIDArtticulo(CVE_ART)
    '            If VerificarSiExiste = False Then
    '                sqllocal = "INSERT INTO Logistik_stock(id_warehouse, id_product, id_product_attribute, reference, ean13" + _
    '                ",upc, physical_quantity, usable_quantity, price_te, lote, id_supplier, clave_Remplace) VALUES ('" + _
    '                 ALMACEN.ToString + "','" + vIDproducto.ToString + "','0','Referencia','','" + _
    '                CVE_ART.ToString + "','" + EXISTENCIA.ToString + "','" + EXISTENCIA.ToString + "','" + COSTO.ToString + "','','1','')"
    '                EjecutarQuerySQL_EMPRESA(sqllocal)
    '                'lee articulos
    '            Else ' actualizar existencia
    '                sqllocal = "UPDATE Logistik_stock SET physical_quantity = '" + EXISTENCIA.ToString + "'," + _
    '                "usable_quantity = '" + EXISTENCIA.ToString + "'" + _
    '                " WHERE id_warehouse = '" + ALMACEN.ToString + "' AND id_product = '" + vIDproducto.ToString + "'"
    '                EjecutarQuerySQL_EMPRESA(sqllocal)
    '            End If
    '        Next
    '        If conn.State = ConnectionState.Open Then
    '            conn.Close()
    '        End If
    '    Catch ex As Exception
    '        MsgBox(ex.Message)
    '    End Try
    'End Sub
    Function VerificarSiExistRegStock(ByVal pcodigo As String, ByVal pAlmacen As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_stock FROM Logistik_stock WHERE id_warehouse = '" + pAlmacen + "' and upc = '" & pcodigo & "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_stock")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_stock")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Private Sub TraerLinesProducts(ByVal pMiBD As String)
        Dim CVE_LIN As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_LIN,DESC_LIN,ESUNGPO,CUENTA_COI,STATUS FROM CLIN" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "CLIN" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("CLIN" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim DESCR As String
            Dim ESUNGPO As String
            Dim CUENTA_COI As String
            Dim STATUS As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_LIN = oRow.Item("CVE_LIN").ToString
                VerificarSiExiste = VerificarSiExisteLineProduct(CVE_LIN)
                If VerificarSiExiste = False Then
                    DESCR = oRow.Item("DESC_LIN").ToString
                    ESUNGPO = oRow.Item("ESUNGPO").ToString
                    CUENTA_COI = oRow.Item("CUENTA_COI").ToString
                    STATUS = oRow.Item("STATUS").ToString
                    sqllocal = "INSERT INTO Logistik_LineProduct(CVE_LIN,DESC_LIN,ESUNGPO,CUENTA_COI,STATUS) VALUES ('" +
                    CVE_LIN.ToString + "','" + DESCR.ToString + "','" + ESUNGPO.ToString + "','" + CUENTA_COI.ToString + "','" + STATUS.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If

            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Linea de Productos: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Linea de Productos: InCorrecta Linea de producto:" + CVE_LIN.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Private Sub TraerAlmacenes(ByVal pMiBD As String)
        Dim CVE_ALM As String = "0"
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 +
                ";Initial Catalog=" + pMiBD +
                ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User +
                "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CVE_ALM, DESCR, DIRECCION, ENCARGADO, TELEFONO" +
            ",LISTA_PREC, CUEN_CONT, CVE_MENT, CVE_MSAL, STATUS" +
            " FROM ALMACENES" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "ALMACENES" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("ALMACENES" & vgNumEmpresa.ToString)
            Dim DESCR As String
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ALM = oRow.Item("CVE_ALM").ToString
                VerificarSiExiste = VerificarSiExisteAlmacen(CVE_ALM)
                If VerificarSiExiste = False Then
                    DESCR = oRow.Item("DESCR").ToString ' clave del cliente
                    sqllocal = "INSERT INTO Logistik_warehouse(id_warehouse, id_currency, id_address, id_employee, reference" +
                    ",name, management_type, deleted) VALUES ('" + CVE_ALM.ToString + "','1','1','1','Referencia','" +
                    DESCR.ToString + "','m','1')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                    sqllocal = "INSERT INTO Logistik_warehouse_shop(id_shop, id_warehouse) VALUES ('" +
                    "1','" + CVE_ALM.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If

            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Almacenes: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Almacenes: InCorrecta almacen:" + CVE_ALM.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Function VerificarSiExisteLineProduct(ByVal pcve As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CVE_LIN FROM Logistik_LineProduct WHERE LTRIM(RTRIM(CVE_LIN)) ='" + Trim(pcve) + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_warehouse")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_warehouse")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExisteAlmacen(ByVal pcve As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP +
                ";Initial Catalog=" + MI_BD +
                ";Integrated Security=False" +
                ";Uid=" + My.Settings.vgBDOtroLado_User +
                ";Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_warehouse FROM Logistik_warehouse WHERE id_warehouse ='" + Trim(pcve) + "'"
            Dim dsExisteAlmacen As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsExisteAlmacen, "Logistik_warehouse")
            Dim oTabla As DataTable
            oTabla = dsExisteAlmacen.Tables("Logistik_warehouse")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If
        Catch ex As Exception
            Return False
        End Try
    End Function
    Private Sub TraerPedimentos2(ByVal pMiBD As String)
        Dim E_LTPD As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT E_LTPD,REG_LTPD,CANTIDAD, PXRS FROM ENLACE_LTPD" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "ENLACE_LTPD" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("ENLACE_LTPD" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim REG_LTPD As String
            Dim CANTIDAD As String
            Dim PXRS As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                E_LTPD = oRow.Item("E_LTPD").ToString
                REG_LTPD = oRow.Item("REG_LTPD").ToString
                CANTIDAD = oRow.Item("CANTIDAD").ToString
                PXRS = oRow.Item("PXRS").ToString
                VerificarSiExiste = VerificarSiExistePedimento2(REG_LTPD)
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO Logistik_enlace_LotePedimento(E_LTPD,REG_LTPD,CANTIDAD, PXRS) VALUES ('" +
                    E_LTPD.ToString + "','" + REG_LTPD.ToString + "','" +
                    CANTIDAD.ToString + "','" + PXRS.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Lote Pedimento: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Lote Pedimento: InCorrecta Lote Pedimento:" + E_LTPD.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Private Sub TraerPedimentos(ByVal pMiBD As String)
        Dim PEDIMENTO As String = ""
        Dim CANTIDAD As String = "0"
        Dim CVE_ALM As String = "0"
        Dim CVE_ART As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC, FCHADUANA,FCHULTMOV," +
            "NOM_ADUAN,CANTIDAD,REG_LTPD,CVE_OBS,CIUDAD,FRONTERA,FEC_PROD_LT,GLN,STATUS FROM LTPD" & vgNumEmpresa.ToString +
            " WHERE CANTIDAD > 0"
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "LTPD" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("LTPD" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

            Dim LOTE As String


            Dim FCHCADUC As String
            Dim FCHADUANA As String
            Dim FCHULTMOV As String
            Dim NOM_ADUAN As String

            Dim REG_LTPD As String
            Dim CVE_OBS As String
            Dim CIUDAD As String

            Dim FRONTERA As String
            Dim FEC_PROD_LT As String
            Dim GLN As String
            Dim STATUS As String

            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ART = oRow.Item("CVE_ART").ToString
                If CVE_ART = "001-006-0113" Then
                    CVE_ART = oRow.Item("CVE_ART").ToString
                End If
                LOTE = oRow.Item("LOTE").ToString
                PEDIMENTO = oRow.Item("PEDIMENTO").ToString
                If oRow.Item("CVE_ALM").ToString = "" Then
                    CVE_ALM = "1"
                Else
                    CVE_ALM = oRow.Item("CVE_ALM").ToString
                End If
                FCHCADUC = oRow.Item("FCHCADUC").ToString
                If (Not FCHCADUC Is Nothing) And FCHCADUC <> "" Then
                    FCHCADUC = FormatDateTime(FCHCADUC, DateFormat.GeneralDate)
                    'Dim time As Date = FCHCADUC
                    Dim MESDIA As String = Mid(FCHCADUC, 1, 6)
                    Dim ANIO As String = Mid(FCHCADUC, 7, 4)
                    'Dim ANIO As Integer = Mid(time, 7, 4)
                    If ANIO = "95" Or ANIO = "96" Or ANIO = "97" Or ANIO = "98" Or ANIO = "99" Or ANIO = "00" Then
                        ANIO = "19" & ANIO
                    End If
                    If ANIO = "15" Or ANIO = "16" Or ANIO = "17" Or ANIO = "18" Or ANIO = "19" Then
                        ANIO = "20" & ANIO
                    End If
                    If ANIO = "1899" Then ANIO = "1999"
                    Dim vFechaCaducReal As Date = MESDIA & ANIO
                    'MsgBox(vFechaCaducReal.ToString)
                    FCHCADUC = vFechaCaducReal.ToString("MM/dd/yyyy HH:mm:ss")
                Else
                    Dim time As Date = Now
                    FCHCADUC = time.ToString("MM/dd/yyyy HH:mm:ss")
                End If
                FCHADUANA = oRow.Item("FCHADUANA").ToString
                'If Len(FCHADUANA) > 1 Then
                If (Not FCHADUANA Is Nothing) And FCHADUANA <> "" Then
                    FCHADUANA = FormatDateTime(FCHADUANA, DateFormat.GeneralDate)
                    'Dim time As Date = FCHADUANA
                    Dim MESDIA As String = Mid(FCHADUANA, 1, 6)
                    Dim ANIO As String = Mid(FCHADUANA, 7, 4)
                    'Dim ANIO As Integer = Mid(time, 7, 4)
                    If ANIO = "95" Or ANIO = "96" Or ANIO = "97" Or ANIO = "98" Or ANIO = "99" Or ANIO = "00" Then
                        ANIO = "19" & ANIO
                    End If
                    If ANIO = "15" Or ANIO = "16" Or ANIO = "17" Or ANIO = "18" Or ANIO = "19" Then
                        ANIO = "20" & ANIO
                    End If
                    If ANIO = "1899" Then ANIO = "1999"
                    Dim vFechaCaducReal As Date = MESDIA & ANIO
                    'MsgBox(vFechaCaducReal.ToString)
                    FCHADUANA = vFechaCaducReal.ToString("MM/dd/yyyy HH:mm:ss")
                Else
                    Dim time As Date = Now
                    FCHADUANA = time.ToString("MM/dd/yyyy HH:mm:ss")
                End If
                FCHULTMOV = oRow.Item("FCHULTMOV").ToString
                'If Len(FCHULTMOV) > 1 Then
                If (Not FCHULTMOV Is Nothing) And FCHULTMOV <> "" Then
                    FCHULTMOV = FormatDateTime(FCHULTMOV, DateFormat.GeneralDate)
                    'Dim time As Date = FCHULTMOV
                    Dim MESDIA As String = Mid(FCHULTMOV, 1, 6)
                    Dim ANIO As String = Mid(FCHULTMOV, 7, 4)
                    'Dim ANIO As Integer = Mid(time, 7, 4)
                    If ANIO = "95" Or ANIO = "96" Or ANIO = "97" Or ANIO = "98" Or ANIO = "99" Or ANIO = "00" Then
                        ANIO = "19" & ANIO
                    End If
                    If ANIO = "15" Or ANIO = "16" Or ANIO = "17" Or ANIO = "18" Or ANIO = "19" Then
                        ANIO = "20" & ANIO
                    End If
                    If ANIO = "1899" Then ANIO = "1999"
                    Dim vFechaCaducReal As Date = MESDIA & ANIO
                    'MsgBox(vFechaCaducReal.ToString)
                    FCHULTMOV = vFechaCaducReal.ToString("MM/dd/yyyy HH:mm:ss")
                Else
                    Dim time As Date = Now
                    FCHULTMOV = time.ToString("MM/dd/yyyy HH:mm:ss")
                End If
                NOM_ADUAN = oRow.Item("NOM_ADUAN").ToString
                If oRow.Item("CANTIDAD").ToString = "" Then
                    CANTIDAD = "0"
                Else
                    CANTIDAD = oRow.Item("CANTIDAD").ToString
                    'CANTIDAD = System.Math.Round(CANTIDAD, 2)
                    'Dim VCANTDOUBLE As Double = FormatNumber(CANTIDAD, 4)
                    'Dim VCANTDOUBLE As Double = CANTIDAD
                    'VCANTDOUBLE = System.Math.Round(VCANTDOUBLE, 2)
                    'CANTIDAD = VCANTDOUBLE.ToString
                End If
                'If CANTIDAD = "" Then CANTIDAD = "0"
                If oRow.Item("REG_LTPD").ToString = "" Then
                    REG_LTPD = "0"
                Else
                    REG_LTPD = Val(oRow.Item("REG_LTPD").ToString)
                End If
                If oRow.Item("CVE_OBS").ToString = "" Then
                    CVE_OBS = "0"
                Else
                    CVE_OBS = Val(oRow.Item("CVE_OBS").ToString)
                End If
                CIUDAD = oRow.Item("CIUDAD").ToString
                FRONTERA = oRow.Item("FRONTERA").ToString
                FEC_PROD_LT = oRow.Item("FEC_PROD_LT").ToString
                'If Len(FEC_PROD_LT) > 1 Then
                If (Not FEC_PROD_LT Is Nothing) And FEC_PROD_LT <> "" Then
                    FEC_PROD_LT = FormatDateTime(FEC_PROD_LT, DateFormat.GeneralDate)
                    'Dim time As Date = FEC_PROD_LT
                    Dim MESDIA As String = Mid(FEC_PROD_LT, 1, 6)
                    Dim ANIO As String = Mid(FEC_PROD_LT, 7, 4)
                    'Dim ANIO As Integer = Mid(time, 7, 4)
                    If ANIO = "95" Or ANIO = "96" Or ANIO = "97" Or ANIO = "98" Or ANIO = "99" Or ANIO = "00" Then
                        ANIO = "19" & ANIO
                    End If
                    If ANIO = "15" Or ANIO = "16" Or ANIO = "17" Or ANIO = "18" Or ANIO = "19" Then
                        ANIO = "20" & ANIO
                    End If
                    If ANIO = "1899" Then ANIO = "1999"
                    Dim vFechaCaducReal As Date = MESDIA & ANIO
                    'MsgBox(vFechaCaducReal.ToString)
                    FEC_PROD_LT = vFechaCaducReal.ToString("MM/dd/yyyy HH:mm:ss")
                Else
                    Dim time As Date = Now
                    FEC_PROD_LT = time.ToString("MM/dd/yyyy HH:mm:ss")
                End If
                GLN = oRow.Item("GLN").ToString
                STATUS = oRow.Item("STATUS").ToString
                VerificarSiExiste = VerificarSiExistePedimento1(REG_LTPD)
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO Logistik_Lote_Pedimento(CVE_ART,LOTE,PEDIMENTO,CVE_ALM,FCHCADUC,FCHADUANA,FCHULTMOV,NOM_ADUAN,CANTIDAD," +
                    "REG_LTPD,CVE_OBS,CIUDAD,FRONTERA,FEC_PROD_LT,GLN,STATUS) VALUES ('" + CVE_ART.ToString + "','" + LOTE.ToString + "','" +
                    PEDIMENTO.ToString + "','" + CVE_ALM.ToString + "','" + FCHCADUC.ToString + "','" + FCHADUANA.ToString + "','" +
                    FCHULTMOV.ToString + "','" + NOM_ADUAN.ToString + "','" + CANTIDAD.ToString + "','" + REG_LTPD.ToString + "','" +
                    CVE_OBS.ToString + "','" + CIUDAD.ToString + "','" + FRONTERA.ToString + "','" + FEC_PROD_LT.ToString + "','" +
                    GLN.ToString + "','" + STATUS.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Pedimentos: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Pedimentos: InCorrecta pedimento:" + PEDIMENTO.ToString + " Producto:" + CVE_ART.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Private Sub TraerNumerosSerie2(ByVal pMiBD As String)
        Dim CVE_ART As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_ART, NUM_SER, ALMACEN, TIP_MOV, TIP_DOC, CVE_DOC, REG_SERIE,FECHA,STATUS,NO_PAR FROM HNUMSER" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "HNUMSER" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("HNUMSER" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim NUM_SER As String
            Dim ALMACEN As String

            Dim TIP_MOV As String
            Dim TIP_DOC As String
            Dim CVE_DOC As String
            Dim REG_SERIE As String
            Dim FECHA As String
            Dim STATUS As String
            Dim NO_PAR As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ART = oRow.Item("CVE_ART").ToString
                NUM_SER = oRow.Item("NUM_SER").ToString
                ALMACEN = oRow.Item("ALMACEN").ToString
                VerificarSiExiste = VerificarSiExisteNumSer2(CVE_ART, NUM_SER, ALMACEN)
                If VerificarSiExiste = False Then
                    TIP_MOV = oRow.Item("TIP_MOV").ToString
                    TIP_DOC = oRow.Item("TIP_DOC").ToString
                    CVE_DOC = oRow.Item("CVE_DOC").ToString
                    REG_SERIE = oRow.Item("REG_SERIE").ToString
                    FECHA = oRow.Item("FECHA").ToString
                    If Len(FECHA) > 1 Then
                        FECHA = FormatDateTime(FECHA, DateFormat.GeneralDate)
                        Dim time As Date = FECHA
                        FECHA = time.ToString("yyyy/MM/dd")
                    End If
                    STATUS = oRow.Item("STATUS").ToString
                    NO_PAR = oRow.Item("NO_PAR").ToString

                    sqllocal = "INSERT INTO Logistik_Hnumeros_series(CVE_ART,NUM_SER,ALMACEN,TIP_MOV,TIP_DOC,CVE_DOC,REG_SERIE,FECHA,STATUS,NO_PAR) VALUES ('" +
                    CVE_ART.ToString + "','" + NUM_SER.ToString + "','" + ALMACEN.ToString + "','" + TIP_MOV.ToString + "','" + TIP_DOC.ToString + "','" +
                    CVE_DOC.ToString + "','" + REG_SERIE.ToString + "','" + FECHA.ToString + "','" + STATUS.ToString + "','" + NO_PAR.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)

                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Numero de serie del producto2: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Numero de serie del producto2: InCorrecta producto:" + CVE_ART.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Private Sub TraerNumerosSerie(ByVal pMiBD As String)
        Dim CVE_ART As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_ART, NUM_SER, STATUS, ALMACEN, COSTO, DOCTO_ENT, FECHA_ENT FROM NUMSER" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "NUMSER" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("NUMSER" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim NUM_SER As String
            Dim ALMACEN As String

            Dim STATUS As String
            Dim COSTO As String
            Dim DOCTO_ENT As String
            Dim FECHA_ENT As String

            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ART = oRow.Item("CVE_ART").ToString
                NUM_SER = oRow.Item("NUM_SER").ToString
                ALMACEN = oRow.Item("ALMACEN").ToString
                VerificarSiExiste = VerificarSiExisteNumSer1(CVE_ART, NUM_SER, ALMACEN)
                If VerificarSiExiste = False Then
                    COSTO = oRow.Item("COSTO").ToString
                    DOCTO_ENT = oRow.Item("DOCTO_ENT").ToString
                    FECHA_ENT = oRow.Item("FECHA_ENT").ToString
                    If Len(FECHA_ENT) > 1 Then
                        FECHA_ENT = FormatDateTime(FECHA_ENT, DateFormat.GeneralDate)
                        Dim time As Date = FECHA_ENT
                        FECHA_ENT = time.ToString("yyyy/MM/dd")
                    End If
                    STATUS = oRow.Item("STATUS").ToString
                    sqllocal = "INSERT INTO Logistik_numeros_series(CVE_ART, NUM_SER, ALMACEN, STATUS, COSTO ,DOCTO_ENT, FECHA_ENT) VALUES ('" +
                     CVE_ART.ToString + "','" + NUM_SER.ToString + "','" + ALMACEN.ToString + "','" +
                     STATUS.ToString + "','" + COSTO.ToString + "','" + DOCTO_ENT.ToString + "','" + FECHA_ENT.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)

                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Numero de serie del producto: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Numero de serie del producto: InCorrecta producto:" + CVE_ART.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Private Sub TraerListaPrecios(ByVal pMiBD As String)
        Dim CVE_PRECIO As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_PRECIO, DESCRIPCION, CVE_BITA, STATUS FROM PRECIOS" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "PRECIOS" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("PRECIOS" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim DESCRIPCION As String
            Dim CVE_BITA As String
            Dim STATUS As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_PRECIO = oRow.Item("CVE_PRECIO").ToString
                VerificarSiExiste = VerificarSiExisteListaPrecios(CVE_PRECIO)
                If VerificarSiExiste = False Then
                    DESCRIPCION = oRow.Item("DESCRIPCION").ToString
                    CVE_BITA = oRow.Item("CVE_BITA").ToString
                    STATUS = oRow.Item("STATUS").ToString

                    sqllocal = "INSERT INTO Logistik_ListaPrecios( CVE_PRECIO, DESCRIPCION," +
                    "CVE_BITA, ESTATUS) VALUES ('" +
                     CVE_PRECIO.ToString + "','" + DESCRIPCION.ToString + "','" +
                     CVE_BITA.ToString + "','" + STATUS.ToString + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)

                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Lista de precio: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Lista de precio: InCorrecta Lista de precio:" + CVE_PRECIO.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub


    Private Sub TraerListaPreciosProductos(ByVal pMiBD As String)
        Dim CVE_PRECIO As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_ART, CVE_PRECIO, PRECIO FROM PRECIO_X_PROD" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "PRECIO_X_PROD" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("PRECIO_X_PROD" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim CVE_ART As String
            Dim PRECIO As Double
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ART = oRow.Item("CVE_ART").ToString
                CVE_PRECIO = oRow.Item("CVE_PRECIO").ToString
                VerificarSiExiste = VerificarSiExisteLPrecios_X_Product(CVE_ART, CVE_PRECIO)
                If VerificarSiExiste = False Then
                    PRECIO = Convert.ToDouble(oRow.Item("PRECIO"))
                    sqllocal = "INSERT INTO Logistik_LPrecios_X_Product(CVE_ART, CVE_PRECIO, PRECIO) VALUES ('" +
                    CVE_ART.ToString + "','" + CVE_PRECIO.ToString + "','" + PRECIO.ToString + "')"

                    EjecutarQuerySQL_EMPRESA(sqllocal)
                    'Dim vidart As String = TraerIDArtticulo(CVE_ART)
                    'sqllocal = "insert into Logistik_product_lang(id_product, id_shop, id_lang, description, description_short" + _
                    '",link_rewrite, meta_description, meta_keywords, meta_title, name, available_now, available_later) VALUES (" + _
                    '"'" + vidart + "','1','2','" + DESCR + "','.','','','','','','','')"
                    'vcambio = EjecutarQuerySQL(sqllocal)
                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Lista de precio por producto: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Lista de precio por producto: InCorrecta Lista de precio por producto:" + CVE_PRECIO.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub
    Private Sub TraerArticulosClavesAlternas2(ByVal pMiBD As String)
        Dim CVE_ART As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_PROD, CAMPLIB1 From INVE_CLIB" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "INVE_CLIB" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("INVE_CLIB" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim CVE_ALTER As String
            Dim TIPO As String
            Dim CVE_CLPV As String

            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ART = oRow.Item("CVE_PROD").ToString
                CVE_ALTER = oRow.Item("CAMPLIB1").ToString
                VerificarSiExiste = VerificarSiExisteArtClaveAlterna(CVE_ART, CVE_ALTER)
                If VerificarSiExiste = False Then
                    sqllocal = "INSERT INTO Logistik_product_Claves_Alter (" +
                    "CVE_ART, CVE_ALTER, TIPO, CVE_CLPV) VALUES (" +
                    "'" + CVE_ART.ToString + "', '" + CVE_ALTER.ToString + "','N','')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar clave compuesta del producto: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar clave compuesta del producto: InCorrecta producto:" + CVE_ART.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub
    Private Sub TraerArticulosClavesAlternas(ByVal pMiBD As String)
        Dim CVE_ART As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
            sqllocal = "SELECT CVE_ART, CVE_ALTER, TIPO, CVE_CLPV From CVES_ALTER" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "CVES_ALTER" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("CVES_ALTER" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim CVE_ALTER As String
            Dim TIPO As String
            Dim CVE_CLPV As String

            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_ART = oRow.Item("CVE_ART").ToString
                CVE_ALTER = oRow.Item("CVE_ALTER").ToString
                VerificarSiExiste = VerificarSiExisteArtClaveAlterna(CVE_ART, CVE_ALTER)
                If VerificarSiExiste = False Then
                    TIPO = oRow.Item("TIPO").ToString
                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
                    sqllocal = "INSERT INTO Logistik_product_Claves_Alter (" +
                    "CVE_ART, CVE_ALTER, TIPO, CVE_CLPV) VALUES (" +
                    "'" + CVE_ART.ToString + "', '" + CVE_ALTER.ToString + "','" +
                    TIPO.ToString + "','" + CVE_CLPV + "')"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next

        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = " clave alterna del producto:" + CVE_ART.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    'Private Sub DetalleOrdenesProvActualizarFB(ByVal cve_doc1 As String)
    '    '--variables detalle PAR_COMPO01
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "SELECT DC.CVE_DOC, DC.NUM_PAR, DC.CVE_ART, ART.DESCR, DC.CANT, DC.PXR, DC.PREC, DC.COST, " + _
    '        "DC.IMPU1, DC.IMPU2, DC.IMPU3, DC.IMPU4, DC.IMP1APLA, DC.IMP2APLA, DC.IMP3APLA, " + _
    '        "DC.IMP4APLA, DC.TOTIMP1, DC.TOTIMP2, DC.TOTIMP3, DC.TOTIMP4, DC.DESCU, DC.ACT_INV, " + _
    '        "DC.TIP_CAM, DC.UNI_VENTA, DC.TIPO_ELEM, DC.TIPO_PROD, DC.CVE_OBS, DC.E_LTPD, DC.REG_SERIE, " + _
    '        "DC.FACTCONV, DC.COST_DEV, DC.NUM_ALM, DC.MINDIRECTO, DC.NUM_MOV, DC.TOT_PARTIDA" + _
    '        " FROM PAR_COMPO" + vgNumEmpresa.ToString + " DC, INVE" + vgNumEmpresa.ToString + " ART WHERE  CVE_DOC = '" + cve_doc1 + "'" + _
    '        " AND DC.CVE_ART = ART.CVE_ART"
    '        Dim da7 As New FbDataAdapter(sqllocal, connFB)
    '        Dim ds7 As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da7.Fill(ds7, "PAR_COMPO" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds7.Tables("PAR_COMPO" & vgNumEmpresa.ToString)
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        Dim CVE_DOC As String
    '        Dim NUM_PAR As String
    '        Dim CVE_ART As String
    '        Dim DESCR As String
    '        Dim CANT As Double
    '        Dim PXR As String
    '        Dim PREC As Double
    '        Dim COST As String
    '        Dim IMPU1 As String
    '        Dim IMPU2 As String
    '        Dim IMPU3 As String
    '        Dim IMPU4 As String
    '        Dim IMP1APLA As String
    '        Dim IMP2APLA As String
    '        Dim IMP3APLA As String
    '        Dim IMP4APLA As String
    '        Dim TOTIMP1 As String
    '        Dim TOTIMP2 As String
    '        Dim TOTIMP3 As String
    '        Dim TOTIMP4 As String
    '        Dim DESCU As String
    '        'Dim ACT_INV As String
    '        Dim TIP_CAM As String
    '        Dim UNI_VENTA As String
    '        Dim TIPO_ELEM As String
    '        Dim TIPO_PROD As String
    '        Dim CVE_OBS As String
    '        Dim E_LTPD As String
    '        Dim REG_SERIE As String
    '        Dim FACTCONV As String
    '        Dim COST_DEV As String
    '        Dim NUM_ALM As String = 0
    '        Dim MINDIRECTO As String
    '        Dim NUM_MOV As String
    '        Dim TOT_PARTIDA As String
    '        Dim id_attributes As String = 0
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        '--------------------------------------------------------------------
    '        '1 NUEVO EN SAE, PC Y TERMINAL
    '        '2
    '        '3
    '        '4 PARCIAL ESTA EN CAPTURA
    '        '5 FINALIZADO EN LA TERMINAL
    '        '6 FINALIZADO PARCIALMENTE EN LA TERMINAL
    '        '7 FINALIZADOS Y ENVIADOS A SAE
    '        '8 FINALIZADO PARCIALMENTE Y ENVIADO A SAE
    '        '911  MODIFICADO EN SAE
    '        '666  CANCELADO EN SAE
    '        'verificar los posibles cambios
    '        Dim vNumRegSAE As Integer = oTable.Rows.Count
    '        Dim vNumRegSQL As Integer '= TrerNumRegOC(CVE_DOC)
    '        Dim vEstatus As String
    '        '----------------extraer el numero de registros del sql
    '        Dim vnum As Integer
    '        Dim reader As SqlDataReader
    '        'Dim SqlSelection As String = "Select count(id_supply_order_detail) AS num FROM Logistik_supply_order_detail " + _
    '        '" WHERE id_supply_order ='" + cve_doc1 + "'"
    '        Dim SqlSelection As String = "Select count(id_supply_order_detail) AS num, o.id_supply_order_state " + _
    '        " FROM Logistik_supply_order_detail od, Logistik_supply_order o" + _
    '        " WHERE o.id_supply_order = od.id_supply_order" + _
    '        " and od.id_supply_order ='" + Trim(cve_doc1) + "'" + _
    '        " group by o.id_supply_order_state"
    '        cmd = New SqlCommand(SqlSelection, conn)
    '        reader = cmd.ExecuteReader
    '        While reader.Read()
    '            vNumRegSQL = reader.Item(0).ToString
    '            vEstatus = reader.Item(1).ToString
    '        End While
    '        reader.Close()
    '        If vEstatus = "8" Or vEstatus = "4" Or vEstatus = "5" Or vEstatus = "7" Or vEstatus = "611" Then
    '            vlActualizarEstatusOC = 0
    '            Exit Sub
    '        End If
    '        '-----------------------------------------------------
    '        If vNumRegSAE = vNumRegSQL Then
    '            Dim vDesicionNum As Integer = VerificarSiHayCambios(cve_doc1)
    '            'desicion 1 no hay cambios exit sub
    '            'desicion 2 hay cambios de cantidad update
    '            'desicion 3 si el articulo es diferente, modificar el id_product y el upc del detalle orden de compra
    '            If vDesicionNum = 1 Then
    '                vlActualizarEstatusOC = 0
    '                Exit Sub
    '            End If
    '            If vDesicionNum = 2 Then
    '                For Each oRow In oTable.Rows
    '                    CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                    NUM_PAR = oRow.Item("NUM_PAR").ToString
    '                    CVE_ART = oRow.Item("CVE_ART").ToString
    '                    DESCR = oRow.Item("DESCR").ToString
    '                    TIP_CAM = oRow.Item("TIP_CAM").ToString
    '                    CANT = Convert.ToDouble(oRow.Item("CANT"))
    '                    PREC = Convert.ToDouble(oRow.Item("PREC"))
    '                    NUM_ALM = oRow.Item("NUM_ALM").ToString

    '                    sqllocal = "update Logistik_supply_order_detail set tax_value = '" + Trim(TIP_CAM) + "'," + _
    '                    "name = '" + Trim(DESCR) + "', quantity_expected = '" + Trim(CANT) + "', unit_price_te ='" + Trim(PREC) + "'" + _
    '                    " WHERE id_supply_order ='" + Trim(CVE_DOC) + "' and upc = '" + Trim(CVE_ART) + "'"
    '                    vcambio = EjecutarQuerySQL(sqllocal)
    '                Next
    '                vlActualizarEstatusOC = 1
    '            End If
    '            If vDesicionNum = 3 Then
    '                sqllocal = "delete FROM  Logistik_supply_order_detail WHERE id_supply_order ='" + Trim(cve_doc1) + "'"
    '                vcambio = EjecutarQuerySQL(sqllocal)
    '                For Each oRow In oTable.Rows
    '                    CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                    NUM_PAR = oRow.Item("NUM_PAR").ToString
    '                    CVE_ART = oRow.Item("CVE_ART").ToString
    '                    DESCR = oRow.Item("DESCR").ToString
    '                    TIP_CAM = oRow.Item("TIP_CAM").ToString
    '                    CANT = oRow.Item("CANT").ToString
    '                    PREC = oRow.Item("PREC").ToString
    '                    NUM_ALM = oRow.Item("NUM_ALM").ToString
    '                    ' no existe inserta
    '                    Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
    '                    sqllocal = "insert into Logistik_supply_order_detail (id_supply_order_detail, id_supply_order, id_currency," + _
    '                    "id_product, id_product_attribute, reference, supplier_reference, name," + _
    '                    "ean13, upc, exchange_rate, unit_price_te, quantity_expected," + _
    '                    "quantity_received, price_te, discount_rate, discount_value_te, price_with_discount_te," + _
    '                    "tax_rate, tax_value, price_ti, tax_value_with_order_discount, price_with_order_discount_te) values ('" + _
    '                    Trim(NUM_PAR) + "','" + Trim(CVE_DOC) + "','1','" + _
    '                    Trim(vIDArticulo) + "','" + Trim(id_attributes) + "','Referecia','','" + Trim(DESCR) + "'," + _
    '                    "'','" + Trim(CVE_ART) + "',5000,'" + Trim(PREC) + "','" + Trim(CANT) + "'," + _
    '                    "0,6000,116,0,0,0," + Trim(TIP_CAM.ToString) + ",0,0,0)"
    '                    vcambio = EjecutarQuerySQL(sqllocal)
    '                Next
    '                vlActualizarEstatusOC = 1
    '            End If
    '        Else
    '            'desicion 4 faltas o sobran registros eliminar todo e insertar todo
    '            'agregar campo a la tabla para saber que producto es
    '            sqllocal = "delete FROM  Logistik_supply_order_detail WHERE id_supply_order ='" + Trim(cve_doc1) + "'"
    '            vcambio = EjecutarQuerySQL(sqllocal)
    '            For Each oRow In oTable.Rows
    '                CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                NUM_PAR = oRow.Item("NUM_PAR").ToString
    '                CVE_ART = oRow.Item("CVE_ART").ToString
    '                DESCR = oRow.Item("DESCR").ToString
    '                TIP_CAM = oRow.Item("TIP_CAM").ToString
    '                CANT = oRow.Item("CANT").ToString
    '                PREC = oRow.Item("PREC").ToString
    '                NUM_ALM = oRow.Item("NUM_ALM").ToString
    '                ' no existe inserta
    '                Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
    '                sqllocal = "insert into Logistik_supply_order_detail (id_supply_order_detail, id_supply_order, id_currency," + _
    '                "id_product, id_product_attribute, reference, supplier_reference, name," + _
    '                "ean13, upc, exchange_rate, unit_price_te, quantity_expected," + _
    '                "quantity_received, price_te, discount_rate, discount_value_te, price_with_discount_te," + _
    '                "tax_rate, tax_value, price_ti, tax_value_with_order_discount, price_with_order_discount_te) values ('" + _
    '                Trim(NUM_PAR) + "','" + Trim(CVE_DOC) + "','1','" + _
    '                Trim(vIDArticulo) + "','" + Trim(id_attributes) + "','Referecia','','" + Trim(DESCR) + "'," + _
    '                "'','" + Trim(CVE_ART) + "',5000,'" + Trim(PREC) + "','" + Trim(CANT) + "'," + _
    '                "0,6000,116,0,0,0," + Trim(TIP_CAM.ToString) + ",0,0,0)"
    '                vcambio = EjecutarQuerySQL(sqllocal)
    '            Next
    '            vlActualizarEstatusOC = 1
    '        End If
    '        '---------------------------------------------------------------------
    '        sqllocal = "UPDATE Logistik_supply_order SET id_warehouse = '" + NUM_ALM + "' WHERE id_supply_order = '" + cve_doc1 + "'"
    '        vcambio = EjecutarQuerySQL(sqllocal)

    '        If conn.State = ConnectionState.Open Then
    '            conn.Close()
    '        End If

    '    Catch ex As Exception
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Sub
    'Function VerificarSiHayCambiosPedidosCts(ByVal cve_doc1 As String) As Integer
    '    'desicion 1 no hay cambios exit sub
    '    'desicion 2 hay cambios de cantidad update
    '    'desicion 3 si el articulo es diferente, modificar el id_product y el upc del detalle orden de compra
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "Select PD.CVE_DOC, PD.NUM_PAR, PD.CVE_ART, ART.DESCR, PD.CANT, PD.PXS, PD.PREC, PD.COST, PD.IMPU1, PD.IMPU2, PD.IMPU3" + _
    '        ",PD.IMPU4, PD.IMP1APLA, PD.IMP2APLA, PD.IMP3APLA, PD.IMP4APLA, PD.TOTIMP1, PD.TOTIMP2, PD.TOTIMP3, PD.TOTIMP4, PD.DESC1" + _
    '        ",PD.DESC2, PD.DESC3, PD.COMI, PD.APAR, PD.ACT_INV, PD.NUM_ALM, PD.POLIT_APLI, PD.TIP_CAM, PD.UNI_VENTA, PD.TIPO_PROD" + _
    '        ",PD.CVE_OBS, PD.REG_SERIE, PD.E_LTPD, PD.TIPO_ELEM, PD.NUM_MOV, PD.TOT_PARTIDA, PD.IMPRIMIR FROM PAR_FACTP" + vgNumEmpresa.ToString + " PD, INVE" + vgNumEmpresa.ToString + " ART" + _
    '        " WHERE PD.CVE_ART = ART.CVE_ART AND PD.CVE_DOC = '" + cve_doc1 + "'"
    '        Dim da7 As New FbDataAdapter(sqllocal, connFB)
    '        Dim ds7 As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da7.Fill(ds7, "PAR_FACTP" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds7.Tables("PAR_FACTP" & vgNumEmpresa.ToString)
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        Dim vpNUM_PAR As String
    '        Dim vpCVE_ART As String
    '        Dim vpDESCR As String
    '        Dim vpCANT As Double
    '        Dim vpPREC As Double
    '        Dim vpTIP_CAM As String
    '        Dim vpNUM_ALM As String = 0
    '        Dim id_attributes As String = 0
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        'desicion 1 no hay cambios exit sub
    '        'desicion 2 hay cambios de cantidad update
    '        'desicion 3 si el articulo es diferente, modificar el id_product y el upc del detalle orden de compra
    '        Dim vlDiferencias As Integer = 0
    '        For Each oRow In oTable.Rows
    '            vpNUM_PAR = oRow.Item("NUM_PAR").ToString
    '            vpCVE_ART = oRow.Item("CVE_ART").ToString
    '            vpDESCR = oRow.Item("DESCR").ToString
    '            vpTIP_CAM = oRow.Item("TIP_CAM").ToString
    '            vpCANT = oRow.Item("CANT").ToString
    '            vpPREC = oRow.Item("PREC").ToString
    '            vpNUM_ALM = oRow.Item("NUM_ALM").ToString
    '            ' no existe inserta
    '            'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
    '            sqllocal = "SELECT  product_upc, product_quantity, product_price FROM Logistik_order_detail" + _
    '            " WHERE  product_upc = '" + Trim(vpCVE_ART) + "' and id_order = '" + Trim(cve_doc1) + "'"
    '            Dim da As New SqlDataAdapter(sqllocal, conn)
    '            Dim ds As New DataSet
    '            If conn.State = ConnectionState.Closed Then
    '                conn.Open()
    '            End If
    '            da.Fill(ds, "Logistik_order_detail7")
    '            Dim oTable1 As New DataTable
    '            oTable1 = ds.Tables("Logistik_order_detail7")
    '            If conn.State = ConnectionState.Open Then
    '                conn.Close()
    '            End If
    '            Dim vlUPC As String
    '            Dim vlCant As Double
    '            Dim vlPrecio As Double
    '            For Each oRow1 In oTable1.Rows
    '                vlUPC = oRow1.Item("product_upc").ToString
    '                vlCant = oRow1.Item("product_quantity").ToString
    '                vlPrecio = oRow1.Item("product_price").ToString
    '                If vpCVE_ART = vlUPC And vpCANT = vlCant And vpPREC = vlPrecio Then
    '                    vlDiferencias = 1
    '                Else
    '                    Return 2
    '                End If
    '            Next
    '        Next
    '        Return 1
    '        If conn.State = ConnectionState.Open Then
    '            conn.Close()
    '        End If

    '    Catch ex As Exception
    '        MsgBox(ex.Message.ToString)
    '    End Try


    'End Function
    'Function VerificarSiHayCambios(ByVal cve_doc1 As String) As Integer
    '    'desicion 1 no hay cambios exit sub
    '    'desicion 2 hay cambios de cantidad update
    '    'desicion 3 si el articulo es diferente, modificar el id_product y el upc del detalle orden de compra
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "SELECT DC.CVE_DOC, DC.NUM_PAR, DC.CVE_ART, ART.DESCR, DC.CANT, DC.PXR, DC.PREC, DC.COST, " + _
    '        "DC.IMPU1, DC.IMPU2, DC.IMPU3, DC.IMPU4, DC.IMP1APLA, DC.IMP2APLA, DC.IMP3APLA, " + _
    '        "DC.IMP4APLA, DC.TOTIMP1, DC.TOTIMP2, DC.TOTIMP3, DC.TOTIMP4, DC.DESCU, DC.ACT_INV, " + _
    '        "DC.TIP_CAM, DC.UNI_VENTA, DC.TIPO_ELEM, DC.TIPO_PROD, DC.CVE_OBS, DC.E_LTPD, DC.REG_SERIE, " + _
    '        "DC.FACTCONV, DC.COST_DEV, DC.NUM_ALM, DC.MINDIRECTO, DC.NUM_MOV, DC.TOT_PARTIDA" + _
    '        " FROM PAR_COMPO" + vgNumEmpresa.ToString + " DC, INVE" + vgNumEmpresa.ToString + " ART WHERE  CVE_DOC = '" + cve_doc1 + "'" + _
    '        " AND DC.CVE_ART = ART.CVE_ART"
    '        Dim da5 As New FbDataAdapter(sqllocal, connFB)
    '        Dim ds5 As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da5.Fill(ds5, "PAR_COMPO" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds5.Tables("PAR_COMPO" & vgNumEmpresa.ToString)
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        Dim vpNUM_PAR As String
    '        Dim vpCVE_ART As String
    '        Dim vpDESCR As String
    '        Dim vpCANT As Double
    '        Dim vpPREC As Double
    '        Dim vpTIP_CAM As String
    '        Dim vpNUM_ALM As String = 0
    '        Dim id_attributes As String = 0
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        'desicion 1 no hay cambios exit sub
    '        'desicion 2 hay cambios de cantidad update
    '        'desicion 3 si el articulo es diferente, modificar el id_product y el upc del detalle orden de compra
    '        Dim vlDiferencias As Integer = 0
    '        For Each oRow In oTable.Rows
    '            vpNUM_PAR = oRow.Item("NUM_PAR").ToString
    '            vpCVE_ART = oRow.Item("CVE_ART").ToString
    '            vpDESCR = oRow.Item("DESCR").ToString
    '            vpTIP_CAM = oRow.Item("TIP_CAM").ToString
    '            vpCANT = oRow.Item("CANT").ToString
    '            vpPREC = oRow.Item("PREC").ToString
    '            vpNUM_ALM = oRow.Item("NUM_ALM").ToString
    '            ' no existe inserta
    '            'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
    '            sqllocal = "SELECT  upc, quantity_expected, unit_price_te FROM Logistik_supply_order_detail" + _
    '            " WHERE  upc = '" + Trim(vpCVE_ART) + "' and id_supply_order = '" + Trim(cve_doc1) + "'"
    '            Dim da As New SqlDataAdapter(sqllocal, conn)
    '            Dim ds As New DataSet
    '            If conn.State = ConnectionState.Closed Then
    '                conn.Open()
    '            End If
    '            da.Fill(ds, "Logistik_supply_order_detail5")
    '            Dim oTable1 As New DataTable
    '            oTable1 = ds.Tables("Logistik_supply_order_detail5")
    '            If conn.State = ConnectionState.Open Then
    '                conn.Close()
    '            End If
    '            Dim vlUPC As String
    '            Dim vlCant As Double
    '            Dim vlPrecio As Double
    '            If oTable1.Rows.Count >= 1 Then
    '                For Each oRow1 In oTable1.Rows
    '                    vlUPC = oRow1.Item("upc").ToString
    '                    vlCant = oRow1.Item("quantity_expected").ToString
    '                    vlPrecio = oRow1.Item("unit_price_te").ToString
    '                    If vpCVE_ART = vlUPC And vpCANT = vlCant And vpPREC = vlPrecio Then
    '                        vlDiferencias = 1
    '                    Else
    '                        Return 2
    '                    End If
    '                Next
    '            Else
    '                'sqllocal = "DELETE FROM Logistik_supply_order_detail" + _
    '                '" WHERE  upc = '" + Trim(vpCVE_ART) + "' and id_supply_order = '" + Trim(cve_doc1) + "'"
    '                'EjecutarQuerySQL(sqllocal)
    '                Return 3
    '            End If
    '        Next
    '        Return 1
    '        If conn.State = ConnectionState.Open Then
    '            conn.Close()
    '        End If

    '    Catch ex As Exception
    '        MsgBox(ex.Message.ToString)
    '    End Try


    'End Function
    'Private Sub DetalleOrdenesProveedoresFB(ByVal cve_doc1 As String)
    '    '--variables detalle PAR_COMPO01
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "SELECT DC.CVE_DOC, DC.NUM_PAR, DC.CVE_ART, ART.DESCR, DC.CANT, DC.PXR, DC.PREC, DC.COST, " + _
    '        "DC.IMPU1, DC.IMPU2, DC.IMPU3, DC.IMPU4, DC.IMP1APLA, DC.IMP2APLA, DC.IMP3APLA, " + _
    '        "DC.IMP4APLA, DC.TOTIMP1, DC.TOTIMP2, DC.TOTIMP3, DC.TOTIMP4, DC.DESCU, DC.ACT_INV, " + _
    '        "DC.TIP_CAM, DC.UNI_VENTA, DC.TIPO_ELEM, DC.TIPO_PROD, DC.CVE_OBS, DC.E_LTPD, DC.REG_SERIE, " + _
    '        "DC.FACTCONV, DC.COST_DEV, DC.NUM_ALM, DC.MINDIRECTO, DC.NUM_MOV, DC.TOT_PARTIDA" + _
    '        " FROM PAR_COMPO" + vgNumEmpresa.ToString + " DC, INVE" + vgNumEmpresa.ToString + " ART WHERE  CVE_DOC = '" + cve_doc1 + "'" + _
    '        " AND DC.CVE_ART = ART.CVE_ART"
    '        Dim da7 As New FbDataAdapter(sqllocal, connFB)
    '        Dim ds7 As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da7.Fill(ds7, "PAR_COMPO" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds7.Tables("PAR_COMPO" & vgNumEmpresa.ToString)
    '        Dim CVE_DOC As String
    '        Dim NUM_PAR As String
    '        Dim CVE_ART As String
    '        Dim DESCR As String
    '        Dim CANT As String
    '        Dim PXR As String
    '        Dim PREC As String
    '        Dim COST As String
    '        Dim IMPU1 As String
    '        Dim IMPU2 As String
    '        Dim IMPU3 As String
    '        Dim IMPU4 As String
    '        Dim IMP1APLA As String
    '        Dim IMP2APLA As String
    '        Dim IMP3APLA As String
    '        Dim IMP4APLA As String
    '        Dim TOTIMP1 As String
    '        Dim TOTIMP2 As String
    '        Dim TOTIMP3 As String
    '        Dim TOTIMP4 As String
    '        Dim DESCU As String
    '        Dim ACT_INV As String
    '        Dim TIP_CAM As String
    '        Dim UNI_VENTA As String
    '        Dim TIPO_ELEM As String
    '        Dim TIPO_PROD As String
    '        Dim CVE_OBS As String
    '        Dim E_LTPD As String
    '        Dim REG_SERIE As String
    '        Dim FACTCONV As String
    '        Dim COST_DEV As String
    '        Dim NUM_ALM As String = 0
    '        Dim MINDIRECTO As String
    '        Dim NUM_MOV As String
    '        Dim TOT_PARTIDA As String
    '        Dim id_attributes As String = 0
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        ''--------------------------------------------------------------------
    '        ''verificar los posibles cambios
    '        'Dim vNumRegSAE As Integer = oTable.Rows.Count
    '        'Dim vNumRegSQL As Integer '= TrerNumRegOC(CVE_DOC)
    '        ''----------------extraer el numero de registros del sql
    '        'Dim vnum As Integer
    '        'Dim reader As SqlDataReader
    '        'Dim SqlSelection As String = "Select count(id_supply_order_detail) AS num from Logistik_supply_order_detail"
    '        'cmd = New SqlCommand(SqlSelection, conn)
    '        'reader = cmd.ExecuteReader()
    '        'While reader.Read()
    '        '    vNumRegSQL = reader.Item(0).ToString
    '        'End While
    '        'reader.Close()
    '        ''-----------------------------------------------------
    '        'If vNumRegSAE = vNumRegSQL Then
    '        '    Dim vDesicionNum As Boolean = VerificarSiHayCambios(CVE_DOC)
    '        '    'desicion 1 no hay cambios exit sub
    '        '    'desicion 2 hay cambios de cantidad update


    '        'Else
    '        '    'desicion 3 faltas o sobran registros eliminar todo e insertar todo
    '        '    sqllocal = "delete FROM  Logistik_supply_order_detail WHERE id_supply_order ='" + Trim(CVE_DOC) + "'"
    '        '    vcambio = EjecutarQuerySQL(sqllocal)

    '        'End If
    '        '---------------------------------------------------------------------
    '        For Each oRow In oTable.Rows
    '            CVE_DOC = oRow.Item("CVE_DOC").ToString
    '            NUM_PAR = oRow.Item("NUM_PAR").ToString
    '            CVE_ART = oRow.Item("CVE_ART").ToString
    '            DESCR = oRow.Item("DESCR").ToString
    '            TIP_CAM = oRow.Item("TIP_CAM").ToString
    '            CANT = oRow.Item("CANT").ToString
    '            PREC = oRow.Item("PREC").ToString
    '            NUM_ALM = oRow.Item("NUM_ALM").ToString
    '            ' no existe inserta
    '            Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
    '            sqllocal = "insert into Logistik_supply_order_detail (id_supply_order_detail, id_supply_order, id_currency," + _
    '            "id_product, id_product_attribute, reference, supplier_reference, name," + _
    '            "ean13, upc, exchange_rate, unit_price_te, quantity_expected," + _
    '            "quantity_received, price_te, discount_rate, discount_value_te, price_with_discount_te," + _
    '            "tax_rate, tax_value, price_ti, tax_value_with_order_discount, price_with_order_discount_te) values ('" + _
    '            Trim(NUM_PAR) + "','" + Trim(CVE_DOC) + "','1','" + _
    '            Trim(vIDArticulo) + "','" + Trim(id_attributes) + "','Referecia','','" + Trim(DESCR) + "'," + _
    '            "'','" + Trim(CVE_ART) + "',5000,'" + Trim(PREC) + "','" + Trim(CANT) + "'," + _
    '            "0,6000,116,0,0,0,'" + Trim(TIP_CAM.ToString) + "',0,0,0)"
    '            EjecutarQuerySQL_EMPRESA(sqllocal)
    '        Next

    '        sqllocal = "UPDATE Logistik_supply_order SET id_warehouse = '" + Trim(NUM_ALM) + "' WHERE id_supply_order = '" + Trim(cve_doc1) + "'"
    '        EjecutarQuerySQL_EMPRESA(sqllocal)

    '        If conn.State = ConnectionState.Open Then
    '            conn.Close()
    '        End If

    '    Catch ex As Exception
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Sub


    'Private Sub DetallePedidosCtsActualizarFB(ByVal cve_doc1 As String)
    '    '--variables detalle PAR_COMPO01
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "Select PD.CVE_DOC, PD.NUM_PAR, PD.CVE_ART, ART.DESCR, PD.CANT, PD.PXS, PD.PREC, PD.COST, PD.IMPU1, PD.IMPU2, PD.IMPU3" + _
    '        ",PD.IMPU4, PD.IMP1APLA, PD.IMP2APLA, PD.IMP3APLA, PD.IMP4APLA, PD.TOTIMP1, PD.TOTIMP2, PD.TOTIMP3, PD.TOTIMP4, PD.DESC1" + _
    '        ",PD.DESC2, PD.DESC3, PD.COMI, PD.APAR, PD.ACT_INV, PD.NUM_ALM, PD.POLIT_APLI, PD.TIP_CAM, PD.UNI_VENTA, PD.TIPO_PROD" + _
    '        ",PD.CVE_OBS, PD.REG_SERIE, PD.E_LTPD, PD.TIPO_ELEM, PD.NUM_MOV, PD.TOT_PARTIDA, PD.IMPRIMIR FROM PAR_FACTP" + vgNumEmpresa.ToString + " PD, INVE" + vgNumEmpresa.ToString + " ART" + _
    '        " WHERE PD.CVE_ART = ART.CVE_ART AND PD.CVE_DOC = '" + cve_doc1 + "'"
    '        Dim da7 As New FbDataAdapter(sqllocal, connFB)
    '        Dim ds7 As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da7.Fill(ds7, "PAR_FACTP" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds7.Tables("PAR_FACTP" & vgNumEmpresa.ToString)
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        Dim CVE_DOC As String
    '        Dim NUM_PAR As String
    '        Dim CVE_ART As String
    '        Dim DESCR As String
    '        Dim CANT As String
    '        Dim PXR As String
    '        Dim PREC As String
    '        Dim COST As String
    '        Dim IMPU1 As String
    '        Dim IMPU2 As String
    '        Dim IMPU3 As String
    '        Dim IMPU4 As String
    '        Dim IMP1APLA As String
    '        Dim IMP2APLA As String
    '        Dim IMP3APLA As String
    '        Dim IMP4APLA As String
    '        Dim TOTIMP1 As String
    '        Dim TOTIMP2 As String
    '        Dim TOTIMP3 As String
    '        Dim TOTIMP4 As String
    '        Dim DESCU As String
    '        Dim ACT_INV As String
    '        Dim TIP_CAM As String
    '        Dim UNI_VENTA As String
    '        Dim TIPO_ELEM As String
    '        Dim TIPO_PROD As String
    '        Dim CVE_OBS As String
    '        Dim E_LTPD As String
    '        Dim REG_SERIE As String
    '        Dim FACTCONV As String
    '        Dim COST_DEV As String
    '        Dim NUM_ALM As String = 0
    '        Dim MINDIRECTO As String
    '        Dim NUM_MOV As String
    '        Dim TOT_PARTIDA As String
    '        Dim id_attributes As String = 0
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        '--------------------------------------------------------------------
    '        'verificar los posibles cambios
    '        Dim vNumRegSAE As Integer = oTable.Rows.Count
    '        Dim vNumRegSQL As Integer '= TrerNumRegOC(CVE_DOC)
    '        Dim vEstatus As String
    '        '----------------extraer el numero de registros del sql
    '        Dim vnum As Integer
    '        Dim reader As SqlDataReader
    '        'Dim SqlSelection As String = "Select count(id_order) AS num FROM Logistik_order_detail WHERE id_order ='" + cve_doc1 + "'"
    '        Dim SqlSelection As String = "Select count(od.id_order_detail) AS num,  o.current_state" + _
    '        " FROM Logistik_order_detail od, Logistik_orders o" + _
    '        " WHERE(od.id_order = o.id_order)" + _
    '        " and od.id_order ='" + Trim(cve_doc1) + "'" + _
    '        " group by o.current_state"
    '        cmd = New SqlCommand(SqlSelection, conn)
    '        reader = cmd.ExecuteReader
    '        While reader.Read()
    '            vNumRegSQL = reader.Item(0).ToString
    '            vEstatus = reader.Item(1).ToString
    '        End While
    '        reader.Close()
    '        '-----------------------------------------------------
    '        If vEstatus = "8" Or vEstatus = "4" Or vEstatus = "5" Or vEstatus = "7" Or vEstatus = "611" Then
    '            vlActualizarEstatusPedidos = 0
    '            Exit Sub
    '        End If
    '        If vNumRegSAE = vNumRegSQL Then
    '            Dim vDesicionNum As Integer = VerificarSiHayCambiosPedidosCts(cve_doc1)
    '            'desicion 1 no hay cambios exit sub
    '            'desicion 2 hay cambios de cantidad update
    '            'desicion 3 si el articulo es diferente, modificar el id_product y el upc del detalle orden de compra
    '            If vDesicionNum = 1 Then
    '                vlActualizarEstatusPedidos = 0
    '                Exit Sub
    '            End If
    '            If vDesicionNum = 2 Then
    '                For Each oRow In oTable.Rows
    '                    CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                    NUM_PAR = oRow.Item("NUM_PAR").ToString
    '                    CVE_ART = oRow.Item("CVE_ART").ToString
    '                    DESCR = oRow.Item("DESCR").ToString
    '                    TIP_CAM = oRow.Item("TIP_CAM").ToString
    '                    CANT = Convert.ToDouble(oRow.Item("CANT"))
    '                    PREC = Convert.ToDouble(oRow.Item("PREC"))
    '                    NUM_ALM = oRow.Item("NUM_ALM").ToString
    '                    ' no existe inserta

    '                    sqllocal = "update Logistik_order_detail set product_name = '" + Trim(DESCR) + _
    '                    "', product_quantity = '" + Trim(CANT) + "', product_price ='" + Trim(PREC) + "'" + _
    '                    " WHERE id_order ='" + Trim(CVE_DOC) + "' and product_upc = '" + Trim(CVE_ART) + "'"
    '                    vcambio = EjecutarQuerySQL(sqllocal)
    '                Next
    '                vlActualizarEstatusPedidos = 1
    '            End If
    '        Else
    '            'desicion 4 faltas o sobran registros eliminar todo e insertar todo
    '            'agregar campo a la tabla para saber que producto es
    '            sqllocal = "delete FROM  Logistik_order_detail WHERE id_order ='" + Trim(cve_doc1) + "'"
    '            vcambio = EjecutarQuerySQL(sqllocal)
    '            For Each oRow In oTable.Rows
    '                CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                NUM_PAR = oRow.Item("NUM_PAR").ToString
    '                CVE_ART = oRow.Item("CVE_ART").ToString
    '                DESCR = oRow.Item("DESCR").ToString
    '                TIP_CAM = oRow.Item("TIP_CAM").ToString
    '                CANT = oRow.Item("CANT").ToString
    '                PREC = oRow.Item("PREC").ToString
    '                NUM_ALM = oRow.Item("NUM_ALM").ToString
    '                TOT_PARTIDA = oRow.Item("TOT_PARTIDA").ToString
    '                Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
    '                sqllocal = "INSERT INTO Logistik_order_detail (id_order_detail, id_order, id_order_invoice, id_warehouse, id_shop" + _
    '                ",product_id, product_attribute_id, product_name, product_quantity, quantity_received" + _
    '                ",product_quantity_in_stock, product_quantity_refunded, product_quantity_return, product_quantity_reinjected, product_price" + _
    '                ",reduction_percent, reduction_amount, reduction_amount_tax_incl, reduction_amount_tax_excl, group_reduction" + _
    '                ",product_quantity_discount, product_ean13, product_upc, product_reference, product_supplier_reference" + _
    '                ",product_weight, id_tax_rules_group, tax_computation_method, tax_name, tax_rate" + _
    '                ",ecotax, ecotax_tax_rate, discount_quantity_applied, download_hash, download_nb" + _
    '                ",download_deadline, total_price_tax_incl, total_price_tax_excl, unit_price_tax_incl, unit_price_tax_excl" + _
    '                ",total_shipping_price_tax_incl, total_shipping_price_tax_excl, purchase_supplier_price, original_product_price) VALUES (" + _
    '                "'" + NUM_PAR + "','" + CVE_DOC + "',1,1,1," + _
    '                "'" + vIDArticulo + "','" + id_attributes + "','" + DESCR + "','" + CANT + "',0," + _
    '                "1,1,1,1,'" + PREC + "'," + _
    '                "0,0,0,0,0," + _
    '                "0,'','" + CVE_ART + "','',''," + _
    '                "0,0,1,'IVA',1," + _
    '                "1,1,1,'',1," + _
    '                "'01/01/2015',16,0,0,0," + _
    '                "'" + TOT_PARTIDA + "',0,0,0)"
    '                EjecutarQuerySQL(sqllocal)
    '            Next
    '            vlActualizarEstatusPedidos = 1
    '            ''actualiza el encabezado estatus 911 hasido modificado
    '        End If
    '        If conn.State = ConnectionState.Open Then
    '            conn.Close()
    '        End If

    '    Catch ex As Exception
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Sub

    'Private Sub DetallePedidosClientesFB(ByVal cve_doc1 As String)
    '    '--variables detalle PAR_COMPO01
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        sqllocal = "Select PD.CVE_DOC, PD.NUM_PAR, PD.CVE_ART, ART.DESCR, PD.CANT, PD.PXS, PD.PREC, PD.COST, PD.IMPU1, PD.IMPU2, PD.IMPU3" + _
    '        ",PD.IMPU4, PD.IMP1APLA, PD.IMP2APLA, PD.IMP3APLA, PD.IMP4APLA, PD.TOTIMP1, PD.TOTIMP2, PD.TOTIMP3, PD.TOTIMP4, PD.DESC1" + _
    '        ",PD.DESC2, PD.DESC3, PD.COMI, PD.APAR, PD.ACT_INV, PD.NUM_ALM, PD.POLIT_APLI, PD.TIP_CAM, PD.UNI_VENTA, PD.TIPO_PROD" + _
    '        ",PD.CVE_OBS, PD.REG_SERIE, PD.E_LTPD, PD.TIPO_ELEM, PD.NUM_MOV, PD.TOT_PARTIDA, PD.IMPRIMIR FROM PAR_FACTP" + vgNumEmpresa.ToString + " PD, INVE" + vgNumEmpresa.ToString + " ART" + _
    '        " WHERE PD.CVE_ART = ART.CVE_ART AND PD.CVE_DOC = '" + cve_doc1 + "'"
    '        Dim da7 As New FbDataAdapter(sqllocal, connFB)
    '        Dim ds7 As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da7.Fill(ds7, "PAR_FACTP" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds7.Tables("PAR_FACTP" & vgNumEmpresa.ToString)
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        Dim CVE_DOC As String
    '        Dim NUM_PAR As String
    '        Dim CVE_ART As String
    '        Dim DESCR As String
    '        Dim CANT As String
    '        Dim PXR As String
    '        Dim PREC As String
    '        Dim COST As String
    '        Dim IMPU1 As String
    '        Dim IMPU2 As String
    '        Dim IMPU3 As String
    '        Dim IMPU4 As String
    '        Dim IMP1APLA As String
    '        Dim IMP2APLA As String
    '        Dim IMP3APLA As String
    '        Dim IMP4APLA As String
    '        Dim TOTIMP1 As String
    '        Dim TOTIMP2 As String
    '        Dim TOTIMP3 As String
    '        Dim TOTIMP4 As String
    '        Dim DESCU As String
    '        Dim ACT_INV As String
    '        Dim TIP_CAM As String
    '        Dim UNI_VENTA As String
    '        Dim TIPO_ELEM As String
    '        Dim TIPO_PROD As String
    '        Dim CVE_OBS As String
    '        Dim E_LTPD As String
    '        Dim REG_SERIE As String
    '        Dim FACTCONV As String
    '        Dim COST_DEV As String
    '        Dim NUM_ALM As String = 0
    '        Dim MINDIRECTO As String
    '        Dim NUM_MOV As String
    '        Dim TOT_PARTIDA As String
    '        Dim id_attributes As String = 0
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        For Each oRow In oTable.Rows
    '            CVE_DOC = oRow.Item("CVE_DOC").ToString
    '            NUM_PAR = oRow.Item("NUM_PAR").ToString
    '            CVE_ART = oRow.Item("CVE_ART").ToString
    '            DESCR = oRow.Item("DESCR").ToString
    '            TIP_CAM = oRow.Item("TIP_CAM").ToString
    '            CANT = oRow.Item("CANT").ToString
    '            PREC = oRow.Item("PREC").ToString
    '            NUM_ALM = oRow.Item("NUM_ALM").ToString
    '            TOT_PARTIDA = oRow.Item("TOT_PARTIDA").ToString
    '            Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
    '            sqllocal = "INSERT INTO Logistik_order_detail (id_order_detail, id_order, id_order_invoice, id_warehouse, id_shop" + _
    '            ",product_id, product_attribute_id, product_name, product_quantity, quantity_received" + _
    '            ",product_quantity_in_stock, product_quantity_refunded, product_quantity_return, product_quantity_reinjected, product_price" + _
    '            ",reduction_percent, reduction_amount, reduction_amount_tax_incl, reduction_amount_tax_excl, group_reduction" + _
    '            ",product_quantity_discount, product_ean13, product_upc, product_reference, product_supplier_reference" + _
    '            ",product_weight, id_tax_rules_group, tax_computation_method, tax_name, tax_rate" + _
    '            ",ecotax, ecotax_tax_rate, discount_quantity_applied, download_hash, download_nb" + _
    '            ",download_deadline, total_price_tax_incl, total_price_tax_excl, unit_price_tax_incl, unit_price_tax_excl" + _
    '            ",total_shipping_price_tax_incl, total_shipping_price_tax_excl, purchase_supplier_price, original_product_price) VALUES (" + _
    '            "'" + NUM_PAR + "','" + Trim(CVE_DOC) + "',1,1,1," + _
    '            "'" + vIDArticulo + "','" + id_attributes + "','" + DESCR + "','" + CANT + "',0," + _
    '            "1,1,1,1,'" + PREC + "'," + _
    '            "0,0,0,0,0," + _
    '            "0,'','" + CVE_ART + "','',''," + _
    '            "0,0,1,'IVA',1," + _
    '            "1,1,1,'',1," + _
    '            "'01/01/2015',16,0,0,0," + _
    '            "'" + TOT_PARTIDA + "',0,0,0)"
    '            EjecutarQuerySQL_EMPRESA(sqllocal)
    '        Next
    '        If conn.State = ConnectionState.Open Then
    '            conn.Close()
    '        End If

    '    Catch ex As Exception
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Sub
    Private Sub TraerPedidosCtes(ByVal pMiBD As String)
        TextBox1.Text = "sae_a_logistik/P1"
        Me.Refresh()
        Dim CVE_DOC As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connLg As New SqlConnection(Str2)
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-vgDiasActulizarSAE) 'Resta días
            'usuari en español
            ' sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR, CVE_VEND, CVE_PEDI, FECHA_DOC, FECHA_ENT, FECHA_VEN" + _
            '",FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4, DES_TOT, DES_FIN, COM_TOT, CONDICION" + _
            '",CVE_OBS, NUM_ALMA, ACT_CXC, ACT_COI, ENLAZADO, TIP_DOC_E, NUM_MONED, TIPCAMB, NUM_PAGOS, FECHAELAB" + _
            '",PRIMERPAGO, RFC, CTLPOL, ESCFD, AUTORIZA, SERIE, FOLIO, AUTOANIO, DAT_ENVIO, CONTADO" + _
            '",CVE_BITA, BLOQ, FORMAENVIO, DES_FIN_PORC, DES_TOT_PORC, IMPORTE, COM_TOT_PORC, METODODEPAGO, NUMCTAPAGO, TIP_DOC_ANT" + _
            '",DOC_ANT, TIP_DOC_SIG, DOC_SIG FROM FACTP" + vgNumEmpresa.ToString + _
            '" WHERE FECHA_DOC BETWEEN '" & Format(vFechaDiasAntes, "dd/MM/yyyy") & "' AND '" & Format(vFechaHoy, "dd/MM/yyyy") & "'"
            'usuario en ingles
            sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR, CVE_VEND, CVE_PEDI, FECHA_DOC, FECHA_ENT, FECHA_VEN" +
            ",FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4, DES_TOT, DES_FIN, COM_TOT, CONDICION" +
            ",CVE_OBS, NUM_ALMA, ACT_CXC, ACT_COI, ENLAZADO, TIP_DOC_E, NUM_MONED, TIPCAMB, NUM_PAGOS, FECHAELAB" +
            ",PRIMERPAGO, RFC, CTLPOL, ESCFD, AUTORIZA, SERIE, FOLIO, AUTOANIO, DAT_ENVIO, CONTADO" +
            ",CVE_BITA, BLOQ, FORMAENVIO, DES_FIN_PORC, DES_TOT_PORC, IMPORTE, COM_TOT_PORC, METODODEPAGO, NUMCTAPAGO, TIP_DOC_ANT" +
            ",DOC_ANT, TIP_DOC_SIG, DOC_SIG FROM FACTP" + vgNumEmpresa.ToString +
            " WHERE FECHA_DOC BETWEEN '" & Format(vFechaDiasAntes, "yyyyMMdd") & "' AND '" & Format(vFechaHoy, "yyyyMMdd") & "'" +
            " and ENLAZADO = 'O' And TIP_DOC_E  in ('O','C')"
            TextBox1.Text = "sae_a_logistik/P2"
            Me.Refresh()
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "FACTP" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("FACTP" & vgNumEmpresa.ToString)
            Dim TIP_DOC As String
            Dim CVE_CLPV As String
            Dim STATUS As String
            Dim DAT_MOSTR As String
            Dim CVE_VEND As String
            Dim CVE_PEDI As String
            Dim FECHA_DOC As String
            Dim FECHA_ENT As String
            Dim FECHA_VEN As String
            Dim FECHA_CANCELA As String
            Dim CAN_TOT As Double
            Dim IMP_TOT1 As String
            Dim IMP_TOT2 As String
            Dim IMP_TOT3 As String
            Dim IMP_TOT4 As Double
            Dim DES_TOT As String
            Dim DES_FIN As String
            Dim COM_TOT As String
            Dim CONDICION As String
            Dim CVE_OBS As String
            Dim NUM_ALMA As String
            Dim ACT_CXC As String
            Dim ACT_COI As String
            Dim ENLAZADO As String
            Dim TIP_DOC_E As String
            Dim NUM_MONED As String
            Dim TIPCAMB As String
            Dim NUM_PAGOS As String
            Dim FECHAELAB As String
            Dim PRIMERPAGO As String
            Dim RFC As String
            Dim CTLPOL As String
            Dim ESCFD As String
            Dim AUTORIZA As String
            Dim SERIE As String
            Dim FOLIO As String
            Dim AUTOANIO As String
            Dim DAT_ENVIO As String
            Dim CONTADO As String
            Dim CVE_BITA As String
            Dim BLOQ As String
            Dim FORMAENVIO As String
            Dim DES_FIN_PORC As String
            Dim DES_TOT_PORC As String
            Dim IMPORTE As Double
            Dim COM_TOT_PORC As String
            Dim METODODEPAGO As String
            Dim NUMCTAPAGO As String
            Dim TIP_DOC_ANT As String
            Dim DOC_ANT As String
            Dim TIP_DOC_SIG As String
            Dim DOC_SIG As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow As DataRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                CVE_CLPV = oRow.Item("CVE_CLPV").ToString        ' clave del cliente
                Dim Verdadero As Boolean = VerificarRFCclienteSAE(CVE_CLPV, vgNumEmpresa)
                If Verdadero = True Then
                    VerificarSiExiste = VerificarSiExistePedidosCtes(CVE_DOC, vgNumEmpresa)
                    If VerificarSiExiste = False Then
                        'verificar productos en la empresa6
                        Dim VerificarArticulos As Boolean = VerificarArticulosEmp6(CVE_DOC, vgNumEmpresa)
                        If VerificarArticulos = False Then
                            IMPORTE = oRow.Item("IMPORTE")
                            CAN_TOT = oRow.Item("CAN_TOT")
                            ENLAZADO = oRow.Item("ENLAZADO").ToString
                            TIP_DOC_E = oRow.Item("TIP_DOC_E").ToString
                            FECHA_ENT = oRow.Item("FECHA_ENT").ToString
                            COM_TOT_PORC = oRow.Item("COM_TOT_PORC").ToString
                            RFC = oRow.Item("RFC").ToString
                            If Len(FECHA_ENT) > 1 Then
                                'FECHA_ENT = FormatDateTime(FECHA_ENT, DateFormat.GeneralDate)
                                'Dim time As Date = FECHA_ENT
                                'FECHA_ENT = time.ToString("dd/MM/yyyy")
                                FECHA_ENT = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                            Else
                                'Dim vFecha7 As Date = Today.Date.Now
                                'FECHA_ENT = vFecha7.ToString("yyyy/MM/dd HH:mm:ss")
                                FECHA_ENT = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                            End If

                            If ENLAZADO = "O" And (TIP_DOC_E = "O" Or TIP_DOC_E = "C") Then
                                '///////////////////////////////////////////////////////////////////////////////
                                Dim readerFACTP_CLIB As SqlDataReader
                                Dim CAMPLIB34 As String = "" 'emp01 vta   camlib34=gdl    y    emp04 vta   camlib34=gdl  
                                Dim CAMPLIB42 As String = "" 'CAMPLIB42 debe llevar 0 = sin impuesto o 1 = con impuesto
                                If vgNumEmpresa = "01" Then
                                    sqllocal = "Select CAMPLIB34 FROM FACTP_CLIB" + vgNumEmpresa.ToString +
                                " WHERE CLAVE_DOC='" + CVE_DOC + "'"
                                End If
                                If vgNumEmpresa = "04" Then
                                    sqllocal = "Select CAMPLIB43 FROM FACTP_CLIB" + vgNumEmpresa.ToString +
                                " WHERE CLAVE_DOC='" + CVE_DOC + "'"
                                End If
                                LabelTABLA.Text = "S FACTP_CLIB"
                                TextBox1.Text = "FACTP_CLIB" + vgNumEmpresa.ToString
                                Me.Refresh()
                                If conn.State = ConnectionState.Closed Then
                                    conn.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn)
                                readerFACTP_CLIB = cmd.ExecuteReader()
                                While readerFACTP_CLIB.Read()
                                    CAMPLIB34 = readerFACTP_CLIB.Item(0).ToString
                                End While
                                readerFACTP_CLIB.Close()
                                '///////////////////////////////////////////////////////////////////////
                                'objTransPedidos = conn2.BeginTransaction()
                                'cmd = New SqlCommand(Querys(i), conn2, objTransPedidos)
                                'objTransPedidos.Commit()
                                'objTransPedidos.Rollback()
                                '//////////////////////////////////////////////////////////////////////
                                sqllocal = "INSERT INTO Logistik_orders(id_order, reference, id_shop_group, id_shop, id_carrier" +
                                        ",id_lang, id_customer, id_cart, id_currency, id_address_delivery" +
                                        ",id_address_invoice, current_state, secure_key, payment, conversion_rate" +
                                        ",module, recyclable, gift, gift_message, mobile_theme" +
                                        ",shipping_number, total_discounts, total_discounts_tax_incl, total_discounts_tax_excl, total_paid" +
                                        ",total_paid_tax_incl, total_paid_tax_excl, total_paid_real, total_products, total_products_wt" +
                                        ",total_shipping, total_shipping_tax_incl, total_shipping_tax_excl, carrier_tax_rate, total_wrapping" +
                                        ",total_wrapping_tax_incl, total_wrapping_tax_excl, round_mode, invoice_number, delivery_number" +
                                        ",invoice_date  ,delivery_date ,valid ,date_add ,date_upd, EnviadaSAE, num_empresa, taxid) VALUES (" +
                                        "'" + CVE_DOC + "','Ref','1','1','1'," +
                                        "'2','" + CVE_CLPV + "','1','1','1'," +
                                        "'1','1','202cb962ac59075b964b07152d234b70','Pago500',300," +
                                        "'Modulo','1','1','bueno','1'," +
                                        "'NumEnv5454',0,0,0,'" + CAN_TOT.ToString() + "'," +
                                        "16,0,'" + IMPORTE.ToString() + "',1,100," +
                                        "1,1,1,1,1," +
                                        "1,1,1,1,1,'" + FECHA_ENT.ToString() + "','" + FECHA_ENT.ToString() + "'," +
                                        "0,'" + FECHA_ENT.ToString() + "','" + FECHA_ENT.ToString() + "','N','" + vgNumEmpresa.ToString + "','" + RFC + "')"
                                TextBox1.Text = "sae_a_logistik/P3"
                                Me.Refresh()
                                EjecutarQuerySQL_EMPRESA(sqllocal)
                                Dim vEmp1 As Boolean = False
                                Dim vEmp6 As Boolean = False
                                'meter detalle en el mismo lugar
                                'Call DetallePedidosClientes(CVE_DOC, pMiBD, vgNumEmpresa)
                                sqllocal = "Select PD.CVE_DOC, PD.NUM_PAR, PD.CVE_ART, ART.DESCR, PD.CANT, PD.PXS, PD.PREC, PD.COST, PD.IMPU1, PD.IMPU2, PD.IMPU3" +
                                ",PD.IMPU4, PD.IMP1APLA, PD.IMP2APLA, PD.IMP3APLA, PD.IMP4APLA, PD.TOTIMP1, PD.TOTIMP2, PD.TOTIMP3, PD.TOTIMP4, PD.DESC1" +
                                ",PD.DESC2, PD.DESC3, PD.COMI, PD.APAR, PD.ACT_INV, PD.NUM_ALM, PD.POLIT_APLI, PD.TIP_CAM, PD.UNI_VENTA, PD.TIPO_PROD" +
                                ",PD.CVE_OBS, PD.REG_SERIE, PD.E_LTPD, PD.TIPO_ELEM, PD.NUM_MOV, PD.TOT_PARTIDA, PD.IMPRIMIR FROM PAR_FACTP" + vgNumEmpresa.ToString + " PD, INVE" + vgNumEmpresa.ToString + " ART" +
                                " WHERE PD.CVE_ART = ART.CVE_ART AND PD.CVE_DOC = '" + CVE_DOC + "'"
                                TextBox1.Text = "sae_a_logistik/P4"
                                Me.Refresh()
                                Dim da7 As New SqlDataAdapter(sqllocal, conn)
                                Dim ds7 As New DataSet
                                If conn.State = ConnectionState.Closed Then
                                    conn.Open()
                                End If
                                da7.Fill(ds7, "PAR_FACTP" & vgNumEmpresa.ToString)
                                Dim oTable7 As New DataTable
                                oTable7 = ds7.Tables("PAR_FACTP" & vgNumEmpresa.ToString)
                                'Dim CVE_DOC As String
                                Dim NUM_PAR As String
                                Dim CVE_ART As String
                                Dim DESCR As String
                                Dim CANT As String
                                Dim PXR As String
                                Dim PREC As String
                                Dim COST As String
                                Dim IMPU1 As String
                                Dim IMPU2 As String
                                Dim IMPU3 As String
                                Dim IMPU4 As String
                                Dim IMP1APLA As String
                                Dim IMP2APLA As String
                                Dim IMP3APLA As String
                                Dim IMP4APLA As String
                                Dim TOTIMP1 As String
                                Dim TOTIMP2 As String
                                Dim TOTIMP3 As String
                                Dim TOTIMP4 As String
                                Dim DESCU As String
                                Dim ACT_INV As String
                                Dim TIP_CAM As String
                                Dim UNI_VENTA As String
                                Dim TIPO_ELEM As String
                                Dim TIPO_PROD As String
                                'Dim CVE_OBS As String
                                Dim E_LTPD As String
                                Dim REG_SERIE As String
                                Dim FACTCONV As String
                                Dim COST_DEV As String
                                Dim NUM_ALM As String = 0
                                Dim MINDIRECTO As String
                                Dim NUM_MOV As String
                                Dim TOT_PARTIDA As String
                                Dim id_attributes As String = 0
                                For Each oRow1 In oTable7.Rows
                                    CVE_DOC = oRow1.Item("CVE_DOC").ToString
                                    NUM_PAR = oRow1.Item("NUM_PAR").ToString
                                    CVE_ART = oRow1.Item("CVE_ART").ToString
                                    DESCR = oRow1.Item("DESCR").ToString
                                    DESCR = DESCR.Replace("'", "")
                                    TIP_CAM = oRow1.Item("TIP_CAM").ToString
                                    CANT = oRow1.Item("CANT").ToString
                                    PREC = oRow1.Item("PREC").ToString
                                    'sacar el almacen correcto 1 o 984
                                    NUM_ALM = oRow1.Item("NUM_ALM").ToString
                                    TOT_PARTIDA = oRow1.Item("TOT_PARTIDA").ToString
                                    If TOT_PARTIDA = "" Then TOT_PARTIDA = "1"
                                    TextBox1.Text = "sae_a_logistik/P5"
                                    Me.Refresh()
                                    '))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
                                    'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                                    Dim vIDArticulo As String
                                    Dim readerIDArticulo As SqlDataReader
                                    sqllocal = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + CVE_ART.Trim + "'"
                                    LabelTABLA.Text = "sae_a_logistik/P6"
                                    LabelQuery.Text = sqllocal
                                    If connLg.State = ConnectionState.Closed Then
                                        connLg.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, connLg)
                                    readerIDArticulo = cmd.ExecuteReader()
                                    While readerIDArticulo.Read()
                                        vIDArticulo = readerIDArticulo.Item(0).ToString
                                    End While
                                    If vIDArticulo = "" Then
                                        empresa = pMiBD.ToString
                                        documento = CVE_DOC.ToString
                                        mensaje = "No existe el producto en logistik:" + CVE_ART.ToString
                                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                        Me.Refresh()
                                        'Exit For
                                    End If
                                    readerIDArticulo.Close()
                                    '((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((
                                    TextBox1.Text = "sae_a_logistik/P7"
                                    Me.Refresh()
                                    Dim FECHA_DOC1 As String = vfechayhora.ToString("yyyyMMdd")
                                    sqllocal = "INSERT INTO Logistik_order_detail (id_order_detail, id_order, id_order_invoice, id_warehouse, id_shop" +
                                    ",product_id, product_attribute_id, product_name, product_quantity, quantity_received" +
                                    ",product_quantity_in_stock, product_quantity_refunded, product_quantity_return, product_quantity_reinjected, product_price" +
                                    ",reduction_percent, reduction_amount, reduction_amount_tax_incl, reduction_amount_tax_excl, group_reduction" +
                                    ",product_quantity_discount, product_ean13, product_upc, product_reference, product_supplier_reference" +
                                    ",product_weight, id_tax_rules_group, tax_computation_method, tax_name, tax_rate" +
                                    ",ecotax, ecotax_tax_rate, discount_quantity_applied, download_hash, download_nb" +
                                    ",download_deadline, total_price_tax_incl, total_price_tax_excl, unit_price_tax_incl, unit_price_tax_excl" +
                                    ",total_shipping_price_tax_incl, total_shipping_price_tax_excl, purchase_supplier_price, original_product_price,num_empresa) VALUES (" +
                                    "'" + NUM_PAR + "','" + CVE_DOC + "',1,'" + NUM_ALM + "',1," +
                                    "'" + vIDArticulo + "','" + id_attributes + "','" + DESCR + "','" + CANT + "',0," +
                                    "1,1,1,1,'" + PREC + "'," +
                                    "0,0,0,0,0," +
                                    "0,'','" + CVE_ART + "','',''," +
                                    "0,0,1,'IVA',1," +
                                    "1,1,1,'',1," +
                                    "'" + FECHA_DOC1.ToString() + "',16,0,0,0," +
                                    "'" + TOT_PARTIDA + "',0,0,0,'" + vgNumEmpresa.ToString + "')"
                                    TextBox1.Text = "sae_a_logistik/P8:" + Str2
                                    Me.Refresh()
                                    'If Trim(CVE_DOC) = "32293" Then
                                    '    EjecutarQuerySQL_EMPRESA(sqllocal)
                                    'Else
                                    EjecutarQuerySQL_EMPRESA(sqllocal)
                                    'End If

                                Next
                                TextBox1.Text = "sae_a_logistik/P9"
                                Me.Refresh()
                                If conn.State = ConnectionState.Open Then
                                    conn.Close()
                                End If
                                If connLg.State = ConnectionState.Open Then
                                    connLg.Close()
                                End If
                                '////////////////////////////////////////////////////////////////////////////////////////////////////
                                vEmp1 = True
                                If vgNumEmpresa <> "06" Then
                                    Label5.Text = "Sincronizando Pedidos EMP06 del SAE a SQL"
                                    TextBox1.Text = "sae_a_logistik/P10"
                                    Me.Refresh()
                                    ErrorEMp06 = 0 '42145"
                                    'If Trim(CVE_DOC) = "42145" Then
                                    Call PedidosEmp6(pMiBD, CVE_DOC, CAMPLIB34, vgNumEmpresa, RFC)
                                    'End If
                                    If ErrorEMp06 = 1 Then
                                        sqllocal = "delete from Logistik_orders where id_order='" + CVE_DOC + "'"
                                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias" + vgNumEmpresa)
                                        sqllocal = "delete from Logistik_order_detail where id_order='" + CVE_DOC + "'"
                                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias" + vgNumEmpresa)
                                    End If
                                    vEmp6 = True
                                End If
                                If vEmp1 = True And vEmp6 = True Then
                                    sqllocal = "UPDATE Logistik_orders SET current_state='1'" +
                                            " WHERE id_order ='" + CVE_DOC.ToString + "'"
                                    TextBox1.Text = "sae_a_logistik/P11"
                                    Me.Refresh()
                                    EjecutarQuerySQL_EMPRESA(sqllocal)
                                Else
                                    vgControlEntrada = 1
                                    Call PedidosEmp6Error(pMiBD, CVE_DOC)
                                End If
                            End If
                        Else
                            empresa = vgEmpresa.ToString
                            documento = CVE_DOC.ToString
                            mensaje = "No existen los productos en la empresa Almacen Valmex"
                            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','7')"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        End If
                    End If
                Else
                    empresa = vgEmpresa.ToString
                    documento = CVE_DOC.ToString
                    mensaje = "El pedido:" + CVE_DOC.ToString + " NO EXISTE EL RFC DEL CLIENTE"
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','7')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                End If

            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Sincronizar Pedidos: InCorrecta pedido:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            'objTransRecepcion.Rollback()
            If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                Me.Dispose()
                'FrmLogin.Dispose()
            End If
            Throw es
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Sincronizar Pedidos: InCorrecta pedido:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Private Function VerificarArticulosEmp6(cVE_DOC As String, Num_empresa As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT * FROM LogistikMasterValvulerias06.dbo.Logistik_order_detail " +
                   " WHERE id_order = '" + cVE_DOC + "' AND num_empresa='" + Num_empresa +
                   "' and product_upc COLLATE Modern_Spanish_CI_AS" +
                   " NOT IN (SELECT CVE_ART FROM SAE80_EMP" + Num_empresa + ".dbo.PAR_FACTP" + Num_empresa +
                   " where CVE_DOC = '" + cVE_DOC + "' COLLATE Modern_Spanish_CI_AS);"
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_order_detail77")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_order_detail77")
            If oTabla.Rows.Count >= 1 Then
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
                Return True
            Else
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function

    Function VerificarSiExistePedidosCtes6(ByVal pcve As String, ByVal numEmp As String) As Boolean
        Try
            'TRAER DATOS DEL ALMACEN
            '------------------------------------------------------------------------------------
            Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn7 As New SqlConnection(Str7)
            Dim sql As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Almacen'"
            Dim dataadapterBD As New SqlDataAdapter(sql, conn7)
            Dim dsCargarbd As New DataSet()

            dataadapterBD.Fill(dsCargarbd, "EmpresaSAE")
            Dim oTabla7 As DataTable
            oTabla7 = dsCargarbd.Tables("EmpresaSAE")
            Dim SERVIDOR As String = ""
            Dim USUARIO As String = ""
            Dim VTIPO As String = ""
            Dim PASSWROD As String = ""
            Dim BASEDATOS As String = ""
            'Dim VTIPO As String = ""
            If oTabla7.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla7.Rows
                    SERVIDOR = oFila.Item("SERVIDOR").ToString
                    BASEDATOS = oFila.Item("BASEDATOS").ToString
                    USUARIO = oFila.Item("USUARIO").ToString
                    PASSWROD = oFila.Item("PASSWROD").ToString
                    VTIPO = oFila.Item("TIPO").ToString
                    'VTIPO = oFila.Item("TIPO").ToString
                Next
            Else
                VTIPO = ""
            End If
            '------------------------------------------------------------------------------------
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + BASEDATOS + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_order FROM Logistik_orders WHERE id_order ='" + pcve + "' and trim(num_empresa)='" + numEmp.Trim + "'"
            Dim dsCargarEncabezado As New DataSet()

            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_orders")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_orders")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExistePedidosCtes(ByVal pcve As String, ByVal numEmp As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_order FROM Logistik_orders WHERE id_order ='" + pcve + "' and trim(num_empresa)='" + numEmp.Trim + "'"
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_orders")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_orders")
            If oTabla.Rows.Count >= 1 Then
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
                Return True
            Else
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Private Sub DetallePedidosClientes6Error(ByVal cve_doc1 As String, ByVal pMiBD As String, ByVal num_empresa As String)
        '--variables detalle PAR_COMPO01
        Dim CVE_DOC As String
        Try
            Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connLg As New SqlConnection(Str2)
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            'Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "Select PD.CVE_DOC, PD.NUM_PAR, PD.CVE_ART, ART.DESCR, PD.CANT, PD.PXS, PD.PREC, PD.COST, PD.IMPU1, PD.IMPU2, PD.IMPU3" +
            ",PD.IMPU4, PD.IMP1APLA, PD.IMP2APLA, PD.IMP3APLA, PD.IMP4APLA, PD.TOTIMP1, PD.TOTIMP2, PD.TOTIMP3, PD.TOTIMP4, PD.DESC1" +
            ",PD.DESC2, PD.DESC3, PD.COMI, PD.APAR, PD.ACT_INV, PD.NUM_ALM, PD.POLIT_APLI, PD.TIP_CAM, PD.UNI_VENTA, PD.TIPO_PROD" +
            ",PD.CVE_OBS, PD.REG_SERIE, PD.E_LTPD, PD.TIPO_ELEM, PD.NUM_MOV, PD.TOT_PARTIDA, PD.IMPRIMIR FROM PAR_FACTP" + vgNumEmpresa.ToString + " PD, INVE" + vgNumEmpresa.ToString + " ART" +
            " WHERE PD.CVE_ART = ART.CVE_ART AND PD.CVE_DOC = '" + cve_doc1 + "'"
            TextBox1.Text = "sae/P70:" + Str
            Me.Refresh()
            Dim da7 As New SqlDataAdapter(sqllocal, conn)
            Dim ds7 As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da7.Fill(ds7, "PAR_FACTP" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds7.Tables("PAR_FACTP" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

            Dim NUM_PAR As String
            Dim CVE_ART As String
            Dim DESCR As String
            Dim CANT As String
            Dim PXR As String
            Dim PREC As String
            Dim COST As String
            Dim IMPU1 As String
            Dim IMPU2 As String
            Dim IMPU3 As String
            Dim IMPU4 As String
            Dim IMP1APLA As String
            Dim IMP2APLA As String
            Dim IMP3APLA As String
            Dim IMP4APLA As String
            Dim TOTIMP1 As String
            Dim TOTIMP2 As String
            Dim TOTIMP3 As String
            Dim TOTIMP4 As String
            Dim DESCU As String
            Dim ACT_INV As String
            Dim TIP_CAM As String
            Dim UNI_VENTA As String
            Dim TIPO_ELEM As String
            Dim TIPO_PROD As String
            Dim CVE_OBS As String
            Dim E_LTPD As String
            Dim REG_SERIE As String
            Dim FACTCONV As String
            Dim COST_DEV As String
            Dim NUM_ALM As String = 0
            Dim MINDIRECTO As String
            Dim NUM_MOV As String
            Dim TOT_PARTIDA As String
            Dim id_attributes As String = 0
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                NUM_PAR = oRow.Item("NUM_PAR").ToString
                CVE_ART = oRow.Item("CVE_ART").ToString
                DESCR = oRow.Item("DESCR").ToString
                DESCR = DESCR.Replace("'", "")
                TIP_CAM = oRow.Item("TIP_CAM").ToString
                CANT = oRow.Item("CANT").ToString
                PREC = oRow.Item("PREC").ToString
                NUM_ALM = oRow.Item("NUM_ALM").ToString
                TOT_PARTIDA = oRow.Item("TOT_PARTIDA").ToString
                If TOT_PARTIDA = "" Then TOT_PARTIDA = "1"
                TextBox1.Text = "sae/P70.1"
                Me.Refresh()

                'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                Dim vIDArticulo As String
                Dim readerIDArticulo As SqlDataReader
                sqllocal = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + CVE_ART.Trim + "'"
                LabelTABLA.Text = "sae/P4/1 Logistik_product"
                LabelQuery.Text = sqllocal
                If connLg.State = ConnectionState.Closed Then
                    connLg.Open()
                End If
                cmd = New SqlCommand(sqllocal, connLg)
                readerIDArticulo = cmd.ExecuteReader()
                While readerIDArticulo.Read()
                    vIDArticulo = readerIDArticulo.Item(0).ToString
                End While
                If vIDArticulo = "" Then
                    empresa = pMiBD.ToString
                    documento = CVE_DOC.ToString
                    mensaje = "No existe el producto en logistik:" + CVE_ART.ToString
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    Exit For
                End If
                readerIDArticulo.Close()
                TextBox1.Text = "sae/P70.2"
                Me.Refresh()
                sqllocal = "INSERT INTO Logistik_order_detail (id_order_detail, id_order, id_order_invoice, id_warehouse, id_shop" +
                ",product_id, product_attribute_id, product_name, product_quantity, quantity_received" +
                ",product_quantity_in_stock, product_quantity_refunded, product_quantity_return, product_quantity_reinjected, product_price" +
                ",reduction_percent, reduction_amount, reduction_amount_tax_incl, reduction_amount_tax_excl, group_reduction" +
                ",product_quantity_discount, product_ean13, product_upc, product_reference, product_supplier_reference" +
                ",product_weight, id_tax_rules_group, tax_computation_method, tax_name, tax_rate" +
                ",ecotax, ecotax_tax_rate, discount_quantity_applied, download_hash, download_nb" +
                ",download_deadline, total_price_tax_incl, total_price_tax_excl, unit_price_tax_incl, unit_price_tax_excl" +
                ",total_shipping_price_tax_incl, total_shipping_price_tax_excl, purchase_supplier_price, original_product_price,num_empresa) VALUES (" +
                "'" + NUM_PAR + "','" + CVE_DOC + "',1,1,1," +
                "'" + vIDArticulo + "','" + id_attributes + "','" + DESCR + "','" + CANT + "',0," +
                "1,1,1,1,'" + PREC + "'," +
                "0,0,0,0,0," +
                "0,'','" + CVE_ART + "','',''," +
                "0,0,1,'IVA',1," +
                "1,1,1,'',1," +
                "'01/01/2020',16,0,0,0," +
                "'" + TOT_PARTIDA + "',0,0,0,'" + vgNumEmpresa.ToString + "')"
                TextBox1.Text = "sae/P71"
                Me.Refresh()
                EjecutarQuerySQL_EMPRESA6(sqllocal)
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Pedidos: InCorrecta pedido:" + CVE_DOC.ToString + " NO PASO A LA EMPRESA 6"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub

    Private Sub DetallePedidosClientes6(ByVal cve_doc1 As String, ByVal pMiBD As String, ByVal num_empresa As String, CAMPLIB34gdl As String)
        '--variables detalle PAR_COMPO01
        Try
            Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connLg As New SqlConnection(Str2)
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            Dim Str3 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=SAE80_EMP01;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn3 As New SqlConnection(Str3)
            sqllocal = "Select PD.CVE_DOC, PD.NUM_PAR, PD.CVE_ART, ART.DESCR, PD.CANT, PD.PXS, PD.PREC, PD.COST, PD.IMPU1, PD.IMPU2, PD.IMPU3" +
            ",PD.IMPU4, PD.IMP1APLA, PD.IMP2APLA, PD.IMP3APLA, PD.IMP4APLA, PD.TOTIMP1, PD.TOTIMP2, PD.TOTIMP3, PD.TOTIMP4, PD.DESC1" +
            ",PD.DESC2, PD.DESC3, PD.COMI, PD.APAR, PD.ACT_INV, PD.NUM_ALM, PD.POLIT_APLI, PD.TIP_CAM, PD.UNI_VENTA, PD.TIPO_PROD" +
            ",PD.CVE_OBS, PD.REG_SERIE, PD.E_LTPD, PD.TIPO_ELEM, PD.NUM_MOV, PD.TOT_PARTIDA, PD.IMPRIMIR FROM PAR_FACTP" + num_empresa.ToString + " PD, INVE" + vgNumEmpresa.ToString + " ART" +
            " WHERE PD.CVE_ART = ART.CVE_ART AND PD.CVE_DOC = '" + cve_doc1 + "'"
            TextBox1.Text = "sae/P70:" + Str
            Me.Refresh()
            Dim da7 As New SqlDataAdapter(sqllocal, conn)
            Dim ds7 As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da7.Fill(ds7, "PAR_FACTP" & num_empresa.ToString)
            Dim oTable As New DataTable
            oTable = ds7.Tables("PAR_FACTP" & num_empresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim CVE_DOC As String
            Dim NUM_PAR As String
            Dim CVE_ART As String
            Dim DESCR As String
            Dim CANT As String
            Dim PXR As String
            Dim PREC As String
            Dim COST As String
            Dim IMPU1 As String
            Dim IMPU2 As String
            Dim IMPU3 As String
            Dim IMPU4 As String
            Dim IMP1APLA As String
            Dim IMP2APLA As String
            Dim IMP3APLA As String
            Dim IMP4APLA As String
            Dim TOTIMP1 As String
            Dim TOTIMP2 As String
            Dim TOTIMP3 As String
            Dim TOTIMP4 As String
            Dim DESCU As String
            Dim ACT_INV As String
            Dim TIP_CAM As String
            Dim UNI_VENTA As String
            Dim TIPO_ELEM As String
            Dim TIPO_PROD As String
            Dim CVE_OBS As String
            Dim E_LTPD As String
            Dim REG_SERIE As String
            Dim FACTCONV As String
            Dim COST_DEV As String
            Dim NUM_ALM As String = 0
            Dim MINDIRECTO As String
            Dim NUM_MOV As String
            Dim TOT_PARTIDA As String
            Dim id_attributes As String = 0
            Dim CampLib1, CampLib2, CampLib3, CampLib4, CampLib5, CampLib6, CampLib7 As String
            Dim CampLib8, CampLib9, CampLib10, CampLib11, CampLib12 As String
            Dim CampLib13, CampLib14, CampLib15, CampLib16, CampLib17 As String
            Dim CampLib18, CampLib19, CampLib20, CampLib21, CampLib22 As String
            Dim CampLib23, CampLib24, CampLib25, CampLib26, CampLib27 As String
            Dim CampLib28, CampLib29, CampLib30, CampLib31, CampLib32 As String
            Dim CampLib33, CampLib34, CampLib35, CampLib36, CampLib37 As String
            Dim CampLib38, CampLib39, CampLib40, CampLib41, CampLib42 As String
            Dim CampLib43, CampLib44, CampLib45 As String

            Dim CampLibA1, CampLibA2, CampLibA3, CampLibA4, CampLibA5, CampLibA6, CampLibA7 As String
            Dim CampLibA8, CampLibA9, CampLibA10, CampLibA11, CampLibA12 As String
            Dim CampLibA13, CampLibA14, CampLibA15, CampLibA16, CampLibA17 As String
            Dim CampLibA18, CampLibA19, CampLibA20, CampLibA21, CampLibA22 As String
            Dim CampLibA23, CampLibA24, CampLibA25, CampLibA26, CampLibA27 As String
            Dim CampLibA28, CampLibA29, CampLibA30, CampLibA31, CampLibA32 As String
            Dim CampLibA33, CampLibA34, CampLibA35, CampLibA36, CampLibA37 As String
            Dim CampLibA38, CampLibA39, CampLibA40, CampLibA41, CampLibA42 As String
            Dim CampLibA43, CampLibA44, CampLibA45 As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                NUM_PAR = oRow.Item("NUM_PAR").ToString
                CVE_ART = oRow.Item("CVE_ART").ToString
                DESCR = oRow.Item("DESCR").ToString
                DESCR = DESCR.Replace("'", "")
                TIP_CAM = oRow.Item("TIP_CAM").ToString
                CANT = oRow.Item("CANT").ToString
                PREC = oRow.Item("PREC").ToString
                If Trim(UCase(CAMPLIB34gdl)) = "GDL" Then
                    NUM_ALM = "984"
                Else
                    NUM_ALM = "1"
                End If
                Dim FECHA_DOC As String = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                TOT_PARTIDA = oRow.Item("TOT_PARTIDA").ToString
                If TOT_PARTIDA = "" Then TOT_PARTIDA = "1"
                TextBox1.Text = "sae/P70.1"
                Me.Refresh()
                'www7
                sqllocal = "SELECT CAMPLIB1, CAMPLIB2, CAMPLIB3, CAMPLIB4
                ,CAMPLIB5,CAMPLIB6,CAMPLIB7,CAMPLIB8,CAMPLIB9
                ,CAMPLIB10,CAMPLIB11,CAMPLIB12,CAMPLIB13,CAMPLIB14
                ,CAMPLIB15,CAMPLIB16,CAMPLIB17,CAMPLIB18,CAMPLIB19
                ,CAMPLIB20,CAMPLIB21,CAMPLIB22,CAMPLIB23,CAMPLIB24
                ,CAMPLIB25,CAMPLIB26,CAMPLIB27,CAMPLIB28,CAMPLIB29
                ,CAMPLIB30,CAMPLIB31,CAMPLIB32,CAMPLIB33,CAMPLIB34
                ,CAMPLIB35,CAMPLIB36,CAMPLIB37,CAMPLIB38,CAMPLIB39
                ,CAMPLIB40,CAMPLIB41,CAMPLIB42,CAMPLIB43,CAMPLIB44
                ,CAMPLIB45 FROM INVE_CLIB01 where CVE_PROD ='" + CVE_ART + "'"
                If conn3.State = ConnectionState.Closed Then
                    conn3.Open()
                End If
                Dim readerINVE_CLIB As SqlDataReader
                cmd = New SqlCommand(sqllocal, conn3)
                readerINVE_CLIB = cmd.ExecuteReader()
                CampLib1 = "" : CampLib2 = "" : CampLib3 = "" : CampLib4 = ""
                CampLib5 = "" : CampLib6 = "" : CampLib7 = "" : CampLib8 = ""
                CampLib9 = "" : CampLib10 = "" : CampLib11 = "" : CampLib12 = ""
                CampLib13 = "" : CampLib14 = "" : CampLib15 = "" : CampLib16 = ""
                CampLib17 = "" : CampLib18 = "" : CampLib19 = "" : CampLib20 = ""
                CampLib21 = "" : CampLib22 = "" : CampLib23 = "" : CampLib24 = ""
                CampLib25 = "" : CampLib26 = "" : CampLib27 = "" : CampLib28 = ""
                CampLib29 = "" : CampLib30 = "" : CampLib31 = "" : CampLib32 = ""
                CampLib33 = "" : CampLib34 = "" : CampLib35 = "" : CampLib36 = ""
                CampLib37 = "" : CampLib38 = "" : CampLib39 = "" : CampLib40 = ""
                CampLib41 = "" : CampLib42 = "" : CampLib43 = "" : CampLib44 = ""
                CampLib45 = ""
                While readerINVE_CLIB.Read()
                    CampLibA1 = "" : CampLibA2 = "" : CampLibA3 = "" : CampLibA4 = ""
                    CampLibA5 = "" : CampLibA6 = "" : CampLibA7 = "" : CampLibA8 = ""
                    CampLibA9 = "" : CampLibA10 = "" : CampLibA11 = "" : CampLibA12 = ""
                    CampLibA13 = "" : CampLibA14 = "" : CampLibA15 = "" : CampLibA16 = ""
                    CampLibA17 = "" : CampLibA18 = "" : CampLibA19 = "" : CampLibA20 = ""
                    CampLibA21 = "" : CampLibA22 = "" : CampLibA23 = "" : CampLibA24 = ""
                    CampLibA25 = "" : CampLibA26 = "" : CampLibA27 = "" : CampLibA28 = ""
                    CampLibA29 = "" : CampLibA30 = "" : CampLibA31 = "" : CampLibA32 = ""
                    CampLibA33 = "" : CampLibA34 = "" : CampLibA35 = "" : CampLibA36 = ""
                    CampLibA37 = "" : CampLibA38 = "" : CampLibA39 = "" : CampLibA40 = ""
                    CampLibA41 = "" : CampLibA42 = "" : CampLibA43 = "" : CampLibA44 = ""
                    CampLibA45 = ""
                    '/////////////query quien si y quin no
                    sqllocal = "SELECT NUM_EMP, MascaraOrdenCompra, MascaraRecepcion, MascaraPedido, MascaraRemision" +
                    ",MultiAlmacen, InvNumDecimales, ActivarQuerys, CampLib1, CampLib2" +
                    ",CampLib3, CampLib4, CampLib5, CampLib6, CampLib7" +
                    ",CampLib8, CampLib9, CampLib10, CampLib11, CampLib12" +
                    ",CampLib13, CampLib14, CampLib15, CampLib16, CampLib17" +
                    ",CampLib18, CampLib19, CampLib20, CampLib21, CampLib22" +
                    ",CampLib23, CampLib24, CampLib25, CampLib26, CampLib27" +
                    ",CampLib28, CampLib29, CampLib30, CampLib31, CampLib32" +
                    ",CampLib33, CampLib34, CampLib35, CampLib36, CampLib37" +
                    ",CampLib38, CampLib39, CampLib40, CampLib41, CampLib42" +
                    ",CampLib43, CampLib44, CampLib45" +
                    " From Logistik_Config_SAE"
                    Dim readerActivos As SqlDataReader
                    If connLg.State = ConnectionState.Closed Then
                        connLg.Open()
                    End If
                    cmd = New SqlCommand(sqllocal, connLg)
                    readerActivos = cmd.ExecuteReader()
                    While readerActivos.Read()
                        CampLibA1 = readerActivos.Item("camplib1").ToString
                        CampLibA2 = readerActivos.Item("camplib2").ToString
                        CampLibA3 = readerActivos.Item("camplib3").ToString
                        CampLibA4 = readerActivos.Item("camplib4").ToString
                        CampLibA5 = readerActivos.Item("camplib5").ToString
                        CampLibA6 = readerActivos.Item("camplib6").ToString
                        CampLibA7 = readerActivos.Item("camplib7").ToString
                        CampLibA8 = readerActivos.Item("camplib8").ToString
                        CampLibA9 = readerActivos.Item("camplib9").ToString
                        CampLibA10 = readerActivos.Item("camplib10").ToString
                        CampLibA11 = readerActivos.Item("camplib11").ToString
                        CampLibA12 = readerActivos.Item("camplib12").ToString
                        CampLibA13 = readerActivos.Item("camplib13").ToString
                        CampLibA14 = readerActivos.Item("camplib14").ToString
                        CampLibA15 = readerActivos.Item("camplib15").ToString
                        CampLibA16 = readerActivos.Item("camplib16").ToString
                        CampLibA17 = readerActivos.Item("camplib17").ToString
                        CampLibA18 = readerActivos.Item("camplib18").ToString
                        CampLibA19 = readerActivos.Item("camplib19").ToString
                        CampLibA20 = readerActivos.Item("camplib20").ToString
                        CampLibA21 = readerActivos.Item("camplib21").ToString
                        CampLibA22 = readerActivos.Item("camplib22").ToString
                        CampLibA23 = readerActivos.Item("camplib23").ToString
                        CampLibA24 = readerActivos.Item("camplib24").ToString
                        CampLibA25 = readerActivos.Item("camplib25").ToString
                        CampLibA26 = readerActivos.Item("camplib26").ToString
                        CampLibA27 = readerActivos.Item("camplib27").ToString
                        CampLibA28 = readerActivos.Item("camplib28").ToString
                        CampLibA29 = readerActivos.Item("camplib29").ToString
                        CampLibA30 = readerActivos.Item("camplib30").ToString
                        CampLibA31 = readerActivos.Item("camplib31").ToString
                        CampLibA32 = readerActivos.Item("camplib32").ToString
                        CampLibA33 = readerActivos.Item("camplib33").ToString
                        CampLibA34 = readerActivos.Item("camplib34").ToString
                        CampLibA35 = readerActivos.Item("camplib35").ToString
                        CampLibA36 = readerActivos.Item("camplib36").ToString
                        CampLibA37 = readerActivos.Item("camplib37").ToString
                        CampLibA38 = readerActivos.Item("camplib38").ToString
                        CampLibA39 = readerActivos.Item("camplib39").ToString
                        CampLibA40 = readerActivos.Item("camplib40").ToString
                        CampLibA41 = readerActivos.Item("camplib41").ToString
                        CampLibA42 = readerActivos.Item("camplib42").ToString
                        CampLibA43 = readerActivos.Item("camplib43").ToString
                        CampLibA44 = readerActivos.Item("camplib44").ToString
                        CampLibA45 = readerActivos.Item("camplib45").ToString
                    End While
                    readerActivos.Close()
                    If CampLibA1 = "1" Then CampLib1 = readerINVE_CLIB.Item("CAMPLIB1").ToString
                    If CampLibA2 = "1" Then CampLib2 = readerINVE_CLIB.Item("CAMPLIB2").ToString
                    If CampLibA3 = "1" Then CampLib3 = readerINVE_CLIB.Item("CAMPLIB3").ToString
                    If CampLibA4 = "1" Then 'int
                        CampLib4 = readerINVE_CLIB.Item("CAMPLIB4").ToString
                        If Len(CampLib4) <= 0 Then
                            CampLib4 = "0"
                        End If
                    Else
                        CampLib4 = "0"
                    End If
                    If CampLibA5 = "1" Then 'float
                        CampLib5 = readerINVE_CLIB.Item("CAMPLIB5").ToString
                        If Len(CampLib5) <= 0 Then
                            CampLib5 = "0"
                        End If
                    Else
                        CampLib5 = "0"
                    End If
                    If CampLibA6 = "1" Then 'float
                        CampLib6 = readerINVE_CLIB.Item("CAMPLIB6").ToString
                        If Len(CampLib6) <= 0 Then
                            CampLib6 = "0"
                        End If
                    Else
                        CampLib6 = "0"
                    End If
                    If CampLibA7 = "1" Then CampLib7 = readerINVE_CLIB.Item("CAMPLIB7").ToString
                    If CampLibA8 = "1" Then CampLib8 = readerINVE_CLIB.Item("CAMPLIB8").ToString
                    If CampLibA9 = "1" Then CampLib9 = readerINVE_CLIB.Item("CAMPLIB9").ToString
                    If CampLibA10 = "1" Then CampLib10 = readerINVE_CLIB.Item("CAMPLIB10").ToString
                    If CampLibA11 = "1" Then CampLib11 = readerINVE_CLIB.Item("CAMPLIB11").ToString
                    If CampLibA12 = "1" Then CampLib12 = readerINVE_CLIB.Item("CAMPLIB12").ToString
                    If CampLibA13 = "1" Then CampLib13 = readerINVE_CLIB.Item("CAMPLIB13").ToString
                    If CampLibA14 = "1" Then CampLib14 = readerINVE_CLIB.Item("CAMPLIB14").ToString
                    If CampLibA15 = "1" Then CampLib15 = readerINVE_CLIB.Item("CAMPLIB15").ToString
                    If CampLibA16 = "1" Then CampLib16 = readerINVE_CLIB.Item("CAMPLIB16").ToString
                    If CampLibA17 = "1" Then CampLib17 = readerINVE_CLIB.Item("CAMPLIB17").ToString
                    If CampLibA18 = "1" Then CampLib18 = readerINVE_CLIB.Item("CAMPLIB18").ToString
                    If CampLibA19 = "1" Then CampLib19 = readerINVE_CLIB.Item("CAMPLIB19").ToString
                    If CampLibA20 = "1" Then CampLib20 = readerINVE_CLIB.Item("CAMPLIB20").ToString
                    If CampLibA21 = "1" Then CampLib21 = readerINVE_CLIB.Item("CAMPLIB21").ToString
                    If CampLibA22 = "1" Then CampLib22 = readerINVE_CLIB.Item("CAMPLIB22").ToString
                    If CampLibA23 = "1" Then CampLib23 = readerINVE_CLIB.Item("CAMPLIB23").ToString
                    If CampLibA24 = "1" Then CampLib24 = readerINVE_CLIB.Item("CAMPLIB24").ToString
                    If CampLibA25 = "1" Then CampLib25 = readerINVE_CLIB.Item("CAMPLIB25").ToString
                    If CampLibA26 = "1" Then CampLib26 = readerINVE_CLIB.Item("CAMPLIB26").ToString
                    If CampLibA27 = "1" Then CampLib27 = readerINVE_CLIB.Item("CAMPLIB27").ToString
                    If CampLibA28 = "1" Then CampLib28 = readerINVE_CLIB.Item("CAMPLIB28").ToString
                    If CampLibA29 = "1" Then CampLib29 = readerINVE_CLIB.Item("CAMPLIB29").ToString
                    If CampLibA30 = "1" Then CampLib30 = readerINVE_CLIB.Item("CAMPLIB30").ToString
                    If CampLibA31 = "1" Then CampLib31 = readerINVE_CLIB.Item("CAMPLIB31").ToString
                    If CampLibA32 = "1" Then 'datetime
                        CampLib32 = readerINVE_CLIB.Item("CAMPLIB32").ToString
                        If CampLib32 = "" Then
                            CampLib32 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                        Else
                            CampLib32 = Format(CDate(CampLib32), "yyyyMMdd HH:mm:ss").ToString
                            'CampLib32 = Convert.ToDateTime(CampLib32, "yyyyMMdd HH:mm:ss").ToString
                        End If
                    Else
                        CampLib32 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                    End If
                    If CampLibA33 = "1" Then CampLib33 = readerINVE_CLIB.Item("CAMPLIB33").ToString
                    If CampLibA34 = "1" Then CampLib34 = readerINVE_CLIB.Item("CAMPLIB34").ToString
                    If CampLibA35 = "1" Then 'datetime
                        CampLib35 = readerINVE_CLIB.Item("CAMPLIB35").ToString
                        If CampLib35 = "" Then
                            CampLib35 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                        Else
                            CampLib35 = Format(CDate(CampLib35), "yyyyMMdd HH:mm:ss").ToString
                            'CampLib35 = Convert.ToDateTime(CampLib35, "yyyyMMdd HH:mm:ss").ToString
                        End If
                    Else
                        CampLib35 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                    End If
                    If CampLibA36 = "1" Then 'float
                        CampLib36 = readerINVE_CLIB.Item("CAMPLIB36").ToString
                        If Len(CampLib36) <= 0 Then
                            CampLib36 = "0"
                        End If
                    Else
                        CampLib36 = "0"
                    End If
                    If CampLibA37 = "1" Then 'float
                        CampLib37 = readerINVE_CLIB.Item("CAMPLIB37").ToString
                        If Len(CampLib37) <= 0 Then
                            CampLib37 = "0"
                        End If
                    Else
                        CampLib37 = "0"
                    End If
                    If CampLibA38 = "1" Then 'float
                        CampLib38 = readerINVE_CLIB.Item("CAMPLIB38").ToString
                        If Len(CampLib38) <= 0 Then
                            CampLib38 = "0"
                        End If
                    Else
                        CampLib38 = "0"
                    End If
                    If CampLibA39 = "1" Then 'float
                        CampLib39 = readerINVE_CLIB.Item("CAMPLIB39").ToString
                        If Len(CampLib39) <= 0 Then
                            CampLib39 = "0"
                        End If
                    Else
                        CampLib39 = "0"
                    End If
                    If CampLibA40 = "1" Then CampLib40 = readerINVE_CLIB.Item("CAMPLIB40").ToString
                    If CampLibA41 = "1" Then 'datetime
                        CampLib41 = readerINVE_CLIB.Item("CAMPLIB41").ToString
                        If CampLib41 = "" Then
                            CampLib41 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                        Else
                            CampLib41 = Format(CDate(CampLib41), "yyyyMMdd HH:mm:ss").ToString
                            'CampLib41 = Convert.ToDateTime(CampLib41, "yyyyMMdd HH:mm:ss").ToString
                        End If
                    Else
                        CampLib41 = vfechayhora.ToString("yyyyMMdd HH:mm:ss")
                    End If
                    If CampLibA42 = "1" Then CampLib42 = readerINVE_CLIB.Item("CAMPLIB42").ToString
                    If CampLibA43 = "1" Then CampLib43 = readerINVE_CLIB.Item("CAMPLIB43").ToString
                    If CampLibA44 = "1" Then CampLib44 = readerINVE_CLIB.Item("CAMPLIB44").ToString
                    If CampLibA45 = "1" Then CampLib45 = readerINVE_CLIB.Item("CAMPLIB45").ToString
                End While
                readerINVE_CLIB.Close()

                '///////////////////////////////////////////////
                'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                Dim vIDArticulo As String
                Dim readerIDArticulo As SqlDataReader
                sqllocal = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + CVE_ART.Trim + "'"
                LabelTABLA.Text = "sae/P4/1 Logistik_product"
                LabelQuery.Text = sqllocal
                If connLg.State = ConnectionState.Closed Then
                    connLg.Open()
                End If
                cmd = New SqlCommand(sqllocal, connLg)
                readerIDArticulo = cmd.ExecuteReader()
                While readerIDArticulo.Read()
                    vIDArticulo = readerIDArticulo.Item(0).ToString
                End While
                If vIDArticulo = "" Then
                    empresa = pMiBD.ToString
                    documento = CVE_DOC.ToString
                    mensaje = "No existe el producto en logistik:" + CVE_ART.ToString
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    Exit For
                End If
                readerIDArticulo.Close()
                TextBox1.Text = "sae/P70.2"
                Me.Refresh()
                sqllocal = "INSERT INTO Logistik_order_detail (id_order_detail, id_order, id_order_invoice, id_warehouse, id_shop" +
                ",product_id, product_attribute_id, product_name, product_quantity, quantity_received" +
                ",product_quantity_in_stock, product_quantity_refunded, product_quantity_return, product_quantity_reinjected, product_price" +
                ",reduction_percent, reduction_amount, reduction_amount_tax_incl, reduction_amount_tax_excl, group_reduction" +
                ",product_quantity_discount, product_ean13, product_upc, product_reference, product_supplier_reference" +
                ",product_weight, id_tax_rules_group, tax_computation_method, tax_name, tax_rate" +
                ",ecotax, ecotax_tax_rate, discount_quantity_applied, download_hash, download_nb" +
                ",download_deadline, total_price_tax_incl, total_price_tax_excl, unit_price_tax_incl, unit_price_tax_excl" +
                ",total_shipping_price_tax_incl, total_shipping_price_tax_excl, purchase_supplier_price, original_product_price,num_empresa,CampLib1, CampLib2" +
                ",CampLib3, CampLib4, CampLib5, CampLib6, CampLib7" +
                ",CampLib8, CampLib9, CampLib10, CampLib11, CampLib12" +
                ",CampLib13, CampLib14, CampLib15, CampLib16, CampLib17" +
                ",CampLib18, CampLib19, CampLib20, CampLib21, CampLib22" +
                ",CampLib23, CampLib24, CampLib25, CampLib26, CampLib27" +
                ",CampLib28, CampLib29, CampLib30, CampLib31, CampLib32" +
                ",CampLib33, CampLib34, CampLib35, CampLib36, CampLib37" +
                ",CampLib38, CampLib39, CampLib40, CampLib41, CampLib42" +
                ",CampLib43, CampLib44, CampLib45) VALUES (" +
                "'" + NUM_PAR + "','" + CVE_DOC + "',1,'" + NUM_ALM + "',1," +
                "'" + vIDArticulo + "','" + id_attributes + "','" + DESCR + "','" + CANT + "',0," +
                "1,1,1,1,'" + PREC + "'," +
                "0,0,0,0,0," +
                "0,'','" + CVE_ART + "','',''," +
                "0,0,1,'IVA',1," +
                "1,1,1,'',1," +
                "'" + FECHA_DOC + "',16,0,0,0," +
                "'" + TOT_PARTIDA + "',0,0,0,'" + num_empresa.ToString +
                "','" + CampLib1 + "','" + CampLib2 +
                "','" + CampLib3 + "','" + CampLib4 + "','" + CampLib5 + "','" + CampLib6 + "','" + CampLib7 +
                "','" + CampLib8 + "','" + CampLib9 + "','" + CampLib10 + "','" + CampLib11 + "','" + CampLib12 +
                "','" + CampLib13 + "','" + CampLib14 + "','" + CampLib15 + "','" + CampLib16 + "','" + CampLib17 +
                "','" + CampLib18 + "','" + CampLib19 + "','" + CampLib20 + "','" + CampLib21 + "','" + CampLib22 +
                "','" + CampLib23 + "','" + CampLib24 + "','" + CampLib25 + "','" + CampLib26 + "','" + CampLib27 +
                "','" + CampLib28 + "','" + CampLib29 + "','" + CampLib30 + "','" + CampLib31 + "','" + CampLib32 +
                "','" + CampLib33 + "','" + CampLib34 + "','" + CampLib35 + "','" + CampLib36 + "','" + CampLib37 +
                "','" + CampLib38 + "','" + CampLib39 + "','" + CampLib40 + "','" + CampLib41 + "','" + CampLib42 +
                "','" + CampLib43 + "','" + CampLib44 + "','" + CampLib45 + "')"
                '''sqllocal = "INSERT INTO Logistik_order_detail (id_order_detail, id_order, id_order_invoice, id_warehouse, id_shop" +
                '''",product_id, product_attribute_id, product_name, product_quantity, quantity_received" +
                '''",product_quantity_in_stock, product_quantity_refunded, product_quantity_return, product_quantity_reinjected, product_price" +
                '''",reduction_percent, reduction_amount, reduction_amount_tax_incl, reduction_amount_tax_excl, group_reduction" +
                '''",product_quantity_discount, product_ean13, product_upc, product_reference, product_supplier_reference" +
                '''",product_weight, id_tax_rules_group, tax_computation_method, tax_name, tax_rate" +
                '''",ecotax, ecotax_tax_rate, discount_quantity_applied, download_hash, download_nb" +
                '''",download_deadline, total_price_tax_incl, total_price_tax_excl, unit_price_tax_incl, unit_price_tax_excl" +
                '''",total_shipping_price_tax_incl, total_shipping_price_tax_excl, purchase_supplier_price, original_product_price,num_empresa) VALUES (" +
                '''"'" + NUM_PAR + "','" + CVE_DOC + "',1,'" + NUM_ALM + "',1," +
                '''"'" + vIDArticulo + "','" + id_attributes + "','" + DESCR + "','" + CANT + "',0," +
                '''"1,1,1,1,'" + PREC + "'," +
                '''"0,0,0,0,0," +
                '''"0,'','" + CVE_ART + "','',''," +
                '''"0,0,1,'IVA',1," +
                '''"1,1,1,'',1," +
                '''"'" + FECHA_DOC + "',16,0,0,0," +
                '''"'" + TOT_PARTIDA + "',0,0,0,'" + vgNumEmpresa.ToString + "')"

                TextBox1.Text = "sae/P71"
                Me.Refresh()
                EjecutarQuerySQL_EMPRESA6(sqllocal)
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

        Catch ex As Exception
            MsgBox(ex.Message.ToString)
        End Try
    End Sub
    Private Sub DetallePedidosClientes(ByVal cve_doc1 As String, ByVal pMiBD As String, ByVal pNumEmp As String)
        '--variables detalle PAR_COMPO01
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connLg As New SqlConnection(Str2)
            sqllocal = "Select PD.CVE_DOC, PD.NUM_PAR, PD.CVE_ART, ART.DESCR, PD.CANT, PD.PXS, PD.PREC, PD.COST, PD.IMPU1, PD.IMPU2, PD.IMPU3" +
            ",PD.IMPU4, PD.IMP1APLA, PD.IMP2APLA, PD.IMP3APLA, PD.IMP4APLA, PD.TOTIMP1, PD.TOTIMP2, PD.TOTIMP3, PD.TOTIMP4, PD.DESC1" +
            ",PD.DESC2, PD.DESC3, PD.COMI, PD.APAR, PD.ACT_INV, PD.NUM_ALM, PD.POLIT_APLI, PD.TIP_CAM, PD.UNI_VENTA, PD.TIPO_PROD" +
            ",PD.CVE_OBS, PD.REG_SERIE, PD.E_LTPD, PD.TIPO_ELEM, PD.NUM_MOV, PD.TOT_PARTIDA, PD.IMPRIMIR FROM PAR_FACTP" + pNumEmp.ToString + " PD, INVE" + pNumEmp.ToString + " ART" +
            " WHERE PD.CVE_ART = ART.CVE_ART AND PD.CVE_DOC = '" + cve_doc1 + "'"
            TextBox1.Text = "sae/P4"
            Me.Refresh()
            Dim da7 As New SqlDataAdapter(sqllocal, conn)
            Dim ds7 As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da7.Fill(ds7, "PAR_FACTP" & pNumEmp.ToString)
            Dim oTable As New DataTable
            oTable = ds7.Tables("PAR_FACTP" & pNumEmp.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim CVE_DOC As String
            Dim NUM_PAR As String
            Dim CVE_ART As String
            Dim DESCR As String
            Dim CANT As String
            Dim PXR As String
            Dim PREC As String
            Dim COST As String
            Dim IMPU1 As String
            Dim IMPU2 As String
            Dim IMPU3 As String
            Dim IMPU4 As String
            Dim IMP1APLA As String
            Dim IMP2APLA As String
            Dim IMP3APLA As String
            Dim IMP4APLA As String
            Dim TOTIMP1 As String
            Dim TOTIMP2 As String
            Dim TOTIMP3 As String
            Dim TOTIMP4 As String
            Dim DESCU As String
            Dim ACT_INV As String
            Dim TIP_CAM As String
            Dim UNI_VENTA As String
            Dim TIPO_ELEM As String
            Dim TIPO_PROD As String
            Dim CVE_OBS As String
            Dim E_LTPD As String
            Dim REG_SERIE As String
            Dim FACTCONV As String
            Dim COST_DEV As String
            Dim NUM_ALM As String = 0
            Dim MINDIRECTO As String
            Dim NUM_MOV As String
            Dim TOT_PARTIDA As String
            Dim id_attributes As String = 0
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                NUM_PAR = oRow.Item("NUM_PAR").ToString
                CVE_ART = oRow.Item("CVE_ART").ToString
                DESCR = oRow.Item("DESCR").ToString
                DESCR = DESCR.Replace("'", "")
                TIP_CAM = oRow.Item("TIP_CAM").ToString
                CANT = oRow.Item("CANT").ToString
                PREC = oRow.Item("PREC").ToString
                'sacar el almacen correcto 1 o 984
                NUM_ALM = oRow.Item("NUM_ALM").ToString
                TOT_PARTIDA = oRow.Item("TOT_PARTIDA").ToString
                If TOT_PARTIDA = "" Then TOT_PARTIDA = "1"
                TextBox1.Text = "sae/P4/1"
                Me.Refresh()
                '))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
                'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                Dim vIDArticulo As String
                Dim readerIDArticulo As SqlDataReader
                sqllocal = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + CVE_ART.Trim + "'"
                LabelTABLA.Text = "sae/P4/1 Logistik_product"
                LabelQuery.Text = sqllocal
                If connLg.State = ConnectionState.Closed Then
                    connLg.Open()
                End If
                cmd = New SqlCommand(sqllocal, connLg)
                readerIDArticulo = cmd.ExecuteReader()
                While readerIDArticulo.Read()
                    vIDArticulo = readerIDArticulo.Item(0).ToString
                End While
                If vIDArticulo = "" Then
                    empresa = pMiBD.ToString
                    documento = CVE_DOC.ToString
                    mensaje = "No existe el producto en logistik:" + CVE_ART.ToString
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    'Exit For
                End If
                readerIDArticulo.Close()
                '((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((
                TextBox1.Text = "sae/P4/2"
                Me.Refresh()
                Dim FECHA_DOC As String = vfechayhora.ToString("yyyyMMdd")
                sqllocal = "INSERT INTO Logistik_order_detail (id_order_detail, id_order, id_order_invoice, id_warehouse, id_shop" +
                ",product_id, product_attribute_id, product_name, product_quantity, quantity_received" +
                ",product_quantity_in_stock, product_quantity_refunded, product_quantity_return, product_quantity_reinjected, product_price" +
                ",reduction_percent, reduction_amount, reduction_amount_tax_incl, reduction_amount_tax_excl, group_reduction" +
                ",product_quantity_discount, product_ean13, product_upc, product_reference, product_supplier_reference" +
                ",product_weight, id_tax_rules_group, tax_computation_method, tax_name, tax_rate" +
                ",ecotax, ecotax_tax_rate, discount_quantity_applied, download_hash, download_nb" +
                ",download_deadline, total_price_tax_incl, total_price_tax_excl, unit_price_tax_incl, unit_price_tax_excl" +
                ",total_shipping_price_tax_incl, total_shipping_price_tax_excl, purchase_supplier_price, original_product_price,num_empresa) VALUES (" +
                "'" + NUM_PAR + "','" + CVE_DOC + "',1,'" + NUM_ALM + "',1," +
                "'" + vIDArticulo + "','" + id_attributes + "','" + DESCR + "','" + CANT + "',0," +
                "1,1,1,1,'" + PREC + "'," +
                "0,0,0,0,0," +
                "0,'','" + CVE_ART + "','',''," +
                "0,0,1,'IVA',1," +
                "1,1,1,'',1," +
                "'" + FECHA_DOC.ToString() + "',16,0,0,0," +
                "'" + TOT_PARTIDA + "',0,0,0,'" + pNumEmp.ToString + "')"
                TextBox1.Text = "sae/P6:" + Str2
                Me.Refresh()
                'If Trim(CVE_DOC) = "32293" Then
                '    EjecutarQuerySQL_EMPRESA(sqllocal)
                'Else
                EjecutarQuerySQL_EMPRESA(sqllocal)
                'End If

            Next
            TextBox1.Text = "sae/P66:" + Str2
            Me.Refresh()
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            If connLg.State = ConnectionState.Open Then
                connLg.Close()
            End If
        Catch ex As Exception
            MsgBox(ex.Message.ToString)
        End Try
    End Sub
    Private Sub TraerClientes(ByVal pMiBD As String)
        Dim CLAVE As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CLAVE, STATUS, NOMBRE, RFC, CALLE, NUMINT, NUMEXT, CRUZAMIENTOS, CRUZAMIENTOS2, COLONIA," +
            "CODIGO, LOCALIDAD, MUNICIPIO, ESTADO, PAIS, NACIONALIDAD, REFERDIR, TELEFONO, CLASIFIC, FAX," +
            "PAG_WEB, CURP, CVE_ZONA, IMPRIR, MAIL, NIVELSEC, ENVIOSILEN, EMAILPRED, DIAREV, DIAPAGO," +
            "CON_CREDITO, DIASCRED, LIMCRED, SALDO, LISTA_PREC, CVE_BITA, ULT_PAGOD, ULT_PAGOM, ULT_PAGOF, DESCUENTO," +
            "ULT_VENTAD, ULT_COMPM, FCH_ULTCOM, VENTAS, CVE_VEND, CVE_OBS, TIPO_EMPRESA, MATRIZ, PROSPECTO, CALLE_ENVIO," +
            "NUMINT_ENVIO, NUMEXT_ENVIO, CRUZAMIENTOS_ENVIO, CRUZAMIENTOS_ENVIO2, COLONIA_ENVIO," +
            "LOCALIDAD_ENVIO, MUNICIPIO_ENVIO, ESTADO_ENVIO, PAIS_ENVIO, CODIGO_ENVIO," +
            "CVE_ZONA_ENVIO, REFERENCIA_ENVIO, CUENTA_CONTABLE, ADDENDAF, ADDENDAD," +
            "NAMESPACE, METODODEPAGO, NUMCTAPAGO FROM CLIE" + vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "CLIE" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("CLIE" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim STATUS As String
            Dim NOMBRE As String
            Dim RFC As String
            Dim CALLE As String
            Dim NUMINT As String
            Dim NUMEXT As String
            Dim CRUZAMIENTOS As String
            Dim CRUZAMIENTOS2 As String
            Dim COLONIA As String
            Dim CODIGO As String
            Dim LOCALIDAD As String
            Dim MUNICIPIO As String
            Dim ESTADO As String
            Dim PAIS As String
            Dim NACIONALIDAD As String
            Dim REFERDIR As String
            Dim TELEFONO As String
            Dim CLASIFIC As String
            Dim FAX As String
            Dim PAG_WEB As String
            Dim CURP As String
            Dim CVE_ZONA As String
            Dim IMPRIR As String
            Dim MAIL As String
            Dim NIVELSEC As String
            Dim ENVIOSILEN As String
            Dim EMAILPRED As String
            Dim DIAREV As String
            Dim DIAPAGO As String
            Dim CON_CREDITO As String
            Dim DIASCRED As String
            Dim LIMCRED As String
            Dim SALDO As String
            Dim LISTA_PREC As String
            Dim CVE_BITA As String
            Dim ULT_PAGOD As String
            Dim ULT_PAGOM As String
            Dim ULT_PAGOF As String
            Dim DESCUENTO As String
            Dim ULT_VENTAD As String
            Dim ULT_COMPM As String
            Dim FCH_ULTCOM As String
            Dim VENTAS As String
            Dim CVE_VEND As String
            Dim CVE_OBS As String
            Dim TIPO_EMPRESA As String
            Dim MATRIZ As String
            Dim PROSPECTO As String
            Dim CALLE_ENVIO As String
            Dim NUMINT_ENVIO As String
            Dim NUMEXT_ENVIO As String
            Dim CRUZAMIENTOS_ENVIO As String
            Dim CRUZAMIENTOS_ENVIO2 As String
            Dim COLONIA_ENVIO As String
            Dim LOCALIDAD_ENVIO As String
            Dim MUNICIPIO_ENVIO As String
            Dim ESTADO_ENVIO As String
            Dim PAIS_ENVIO As String
            Dim CODIGO_ENVIO As String
            Dim CVE_ZONA_ENVIO As String
            Dim REFERENCIA_ENVIO As String
            Dim CUENTA_CONTABLE As String
            Dim ADDENDAF As String
            Dim ADDENDAD As String
            Dim NAMESPACE1 As String
            Dim METODODEPAGO As String
            Dim NUMCTAPAGO As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CLAVE = oRow.Item("CLAVE").ToString
                RFC = oRow.Item("RFC").ToString
                VerificarSiExiste = VerificarSiExisteCliente(CLAVE, RFC)
                If VerificarSiExiste = False Then
                    NOMBRE = oRow.Item("NOMBRE").ToString
                    NOMBRE = NOMBRE.Replace("'", "")
                    MAIL = oRow.Item("MAIL").ToString
                    STATUS = oRow.Item("STATUS").ToString
                    Dim vstatus As String
                    If STATUS = "A" Then
                        vstatus = "1"
                        sqllocal = "INSERT INTO Logistik_customer(id_customer, id_shop_group, id_shop, id_gender, id_default_group" +
                         ",id_lang, id_risk, company, siret, ape, firstname, lastname, email, passwd, last_passwd_gen" +
                         ",birthday, newsletter, ip_registration_newsletter, newsletter_date_add, optin" +
                         ",website, outstanding_allow_amount, show_public_prices, max_payment_days, secure_key" +
                         ",note, active, is_guest, deleted, date_add," +
                         "date_upd, Logistik_gender_lang_id_gender, Logistik_gender_lang_id_lang,taxid) VALUES (" +
                         "'" + CLAVE + "','1','1','1','1'," +
                         "'2','1','" + NOMBRE + "','siret','ape','firstname','lastname','" + MAIL + "','123','123'," +
                         "'01/01/2015','1','1','01/01/2015','1'," +
                         "'1','1','0','1','1'," +
                         "'1','" + vstatus + "','1','1','01/01/2015'," +
                         "'01/01/2015','1','2','" + RFC + "')"
                        EjecutarQuerySQL_EMPRESA(sqllocal)
                    End If
                Else
                    RFC = oRow.Item("RFC").ToString
                    '------------------actualizar
                    sqllocal = "UPDATE Logistik_customer SET taxid = '" & RFC & "' WHERE id_customer ='" & CLAVE & "'"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Clientes: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Clientes: InCorrecta Cliente:" + CLAVE.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub
    Function VerificarSiExisteCliente(ByVal pcve As String, ByVal prfc As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_customer FROM Logistik_customer WHERE id_customer ='" + pcve + "' or taxid ='" + prfc + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_customer")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_customer")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception

            Return False
        End Try
    End Function
    Private Sub TraerProveedores(ByVal pMiBD As String)
        Dim CLAVE As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CLAVE, STATUS, NOMBRE, RFC, CALLE, NUMINT, NUMEXT, CRUZAMIENTOS, CRUZAMIENTOS2, COLONIA" +
            ",CODIGO, LOCALIDAD, MUNICIPIO, ESTADO, CVE_PAIS, NACIONALIDAD, TELEFONO, CLASIFIC, FAX, PAG_WEB" +
            ",CURP, CVE_ZONA, CON_CREDITO, DIASCRED, LIMCRED, CVE_BITA, ULT_PAGOD, ULT_PAGOM, ULT_PAGOF, ULT_COMPD" +
            ",ULT_COMPM, ULT_COMPF, SALDO, VENTAS, DESCUENTO, TIP_TERCERO, TIP_OPERA, CVE_OBS, CUENTA_CONTABLE, FORMA_PAGO" +
            ",BENEFICIARIO, TITULAR_CUENTA, BANCO, SUCURSAL_BANCO, CUENTA_BANCO, CLABE, DESC_OTROS FROM PROV" + vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If

            da.Fill(ds, "PROV" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("PROV" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim STATUS As String
            Dim NOMBRE As String
            Dim RFC As String
            Dim CALLE As String
            Dim NUMINT As String
            Dim NUMEXT As String
            Dim CRUZAMIENTOS As String
            Dim CRUZAMIENTOS2 As String
            Dim COLONIA As String
            Dim CODIGO As String
            Dim LOCALIDAD As String
            Dim MUNICIPIO As String
            Dim ESTADO As String
            Dim CVE_PAIS As String
            Dim NACIONALIDAD As String
            Dim TELEFONO As String
            Dim CLASIFIC As String
            Dim FAX As String
            Dim PAG_WEB As String
            Dim CURP As String
            Dim CVE_ZONA As String
            Dim CON_CREDITO As String
            Dim DIASCRED As String
            Dim LIMCRED As String
            Dim CVE_BITA As String
            Dim ULT_PAGOD As String
            Dim ULT_PAGOM As String
            Dim ULT_PAGOF As String
            Dim ULT_COMPD As String
            Dim ULT_COMPM As String
            Dim ULT_COMPF As String
            Dim SALDO As String
            Dim VENTAS As String
            Dim DESCUENTO As String
            Dim TIP_TERCERO As String
            Dim TIP_OPERA As String
            Dim CVE_OBS As String
            Dim CUENTA_CONTABLE As String
            Dim FORMA_PAGO As String
            Dim BENEFICIARIO As String
            Dim TITULAR_CUENTA As String
            Dim BANCO As String
            Dim SUCURSAL_BANCO As String
            Dim CUENTA_BANCO As String
            Dim CLABE As String
            Dim DESC_OTROS As String
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CLAVE = oRow.Item("CLAVE").ToString
                STATUS = oRow.Item("STATUS").ToString
                VerificarSiExiste = VerificarSiExisteProveedores(CLAVE)
                If VerificarSiExiste = False Then
                    NOMBRE = oRow.Item("NOMBRE").ToString
                    RFC = oRow.Item("RFC").ToString
                    CALLE = oRow.Item("CALLE").ToString
                    NUMINT = oRow.Item("NUMINT").ToString
                    NUMEXT = oRow.Item("NUMEXT").ToString
                    CRUZAMIENTOS = oRow.Item("CRUZAMIENTOS").ToString
                    sqllocal = "INSERT INTO Logistik_supplier (id_supplier, name, date_add, date_upd, active) values (" +
                    "'" + Trim(CLAVE) + "','" + NOMBRE + "','" + time.ToString("yyyy/MM/dd") + "','" + time.ToString("yyyy/MM/dd") + "',1)"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                Else
                    sqllocal = "UPDATE Logistik_supplier SET active='" + STATUS.ToString + "'" +
                    " WHERE id_supplier='" + CLAVE.ToString + "'"
                    EjecutarQuerySQL_EMPRESA(sqllocal)
                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Proveedores: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Proveedores: InCorrecta Proveedor:" + CLAVE.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub
    Function VerificarSiExisteProveedores(ByVal pcve_prov As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_supplier FROM Logistik_supplier WHERE id_supplier = '" + Trim(pcve_prov) + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_supplier")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_supplier")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Private Sub OrdenCompraEmp6(ByVal pMiBD As String, ByVal pOC As String)
        Dim CVE_DOC As String = ""
        Try
            Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connLogistik As New SqlConnection(Str7)
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            'Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connSAE As New SqlConnection(Str)
            'EMPRESA ALMACEN

            Dim Str4 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn4 As New SqlConnection(Str4)
            Dim sql4 As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Almacen'"
            Dim daBD As New SqlDataAdapter(sql4, conn4)
            Dim dsbd As New DataSet()
            daBD.Fill(dsbd, "EmpresaSAE")
            Dim oTabla4 As DataTable
            oTabla4 = dsbd.Tables("EmpresaSAE")
            Dim SERVIDOR2 As String = ""
            Dim USUARIO2 As String = ""
            Dim NOMBRE_BD2 As String = ""
            Dim PASSWROD2 As String = ""
            Dim BASEDATOS2 As String = ""
            'Dim VTIPO As String = ""
            If oTabla4.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla4.Rows
                    SERVIDOR2 = oFila.Item("SERVIDOR").ToString
                    BASEDATOS2 = oFila.Item("BASEDATOS").ToString
                    USUARIO2 = oFila.Item("USUARIO").ToString
                    PASSWROD2 = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD2 = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness2 = Mid(NOMBRE_BD2, LongitudBD)
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD2 + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn2 As New SqlConnection(Str2)
            '------------------------------------------
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-vgDiasActulizarSAE) 'Resta días
            'sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," + _
            '"FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," + _
            '"DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," + _
            '"ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," + _
            '"SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," + _
            '"DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG FROM COMPO" + vgNumEmpresa.ToString + _
            '" WHERE FECHA_DOC >= '" & Format(vFechaDiasAntes, "MM/dd/yyyy") & "' AND FECHA_DOC <= '" & Format(vFechaHoy, "MM/dd/yyyy") & "'"
            sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," +
            "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," +
            "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," +
            "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," +
            "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," +
            "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG FROM COMPO" + vgNumEmpresa.ToString +
            " WHERE CVE_DOC = '" & pOC.ToString & "'"

            'MsgBox(Str)

            Dim da As New SqlDataAdapter(sqllocal, connSAE)
            Dim ds As New DataSet
            If connSAE.State = ConnectionState.Closed Then
                connSAE.Open()
            End If
            da.Fill(ds, "COMPO" + vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("COMPO" + vgNumEmpresa.ToString)
            If connSAE.State = ConnectionState.Open Then
                connSAE.Close()
            End If
            Dim TIP_DOC As String
            Dim CVE_CLPV As String = ""
            Dim NOMBRE_CLPV As String = ""
            Dim STATUS As String
            Dim SU_REFER As String
            Dim FECHA_DOC As String
            Dim FECHA_REC As String
            Dim FECHA_PAG As String
            Dim FECHA_CANCELA As String
            Dim CAN_TOT As String
            Dim IMP_TOT1 As String
            Dim IMP_TOT2 As String
            Dim IMP_TOT3 As String
            Dim IMP_TOT4 As String
            Dim DES_TOT As String
            Dim DES_FIN As String
            Dim TOT_IND As String
            Dim OBS_COND As String
            Dim CVE_OBS As String
            Dim NUM_ALMA As String
            Dim ACT_CXP As String
            Dim ACT_COI As String
            Dim NUM_MONED As String
            Dim TIPCAMB As String
            Dim ENLAZADO As String
            Dim TIP_DOC_E As String
            Dim NUM_PAGOS As String
            Dim FECHAELAB As String
            Dim SERIE As String
            Dim FOLIO As String
            Dim CTLPOL As String
            Dim ESCFD As String
            Dim CONTADO As String
            Dim BLOQ As String
            Dim DES_FIN_PORC As String
            Dim DES_TOT_PORC As String
            Dim IMPORTE As String
            Dim TIP_DOC_ANT As String
            Dim DOC_ANT As String
            Dim TIP_DOC_SIG As String
            Dim DOC_SIG As String
            If connSAE.State = ConnectionState.Closed Then
                connSAE.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                NUM_MONED = oRow.Item("NUM_MONED").ToString
                VerificarSiExiste = VerificarSiExisteOrdenCompraEmp6(CVE_DOC)
                If VerificarSiExiste = False Then
                    IMPORTE = oRow.Item("IMPORTE").ToString
                    ENLAZADO = oRow.Item("ENLAZADO").ToString
                    TIP_DOC_E = oRow.Item("TIP_DOC_E").ToString
                    FECHA_DOC = oRow.Item("FECHA_DOC").ToString
                    'CVE_CLPV = oRow.Item("CVE_CLPV").ToString
                    If Len(FECHA_DOC) > 1 Then
                        FECHA_DOC = FormatDateTime(FECHA_DOC, DateFormat.GeneralDate)
                        Dim time As Date = FECHA_DOC
                        'FECHA_DOC = time.ToString("dd/MM/yyyy")
                        FECHA_DOC = time.ToString("yyyy/MM/dd")
                    End If
                    FECHA_REC = oRow.Item("FECHA_REC").ToString
                    If Len(FECHA_REC) > 1 Then
                        FECHA_REC = FormatDateTime(FECHA_REC, DateFormat.GeneralDate)
                        Dim time As Date = FECHA_REC
                        'FECHA_REC = time.ToString("dd/MM/yyyy")
                        FECHA_REC = time.ToString("yyyy/MM/dd")

                    End If
                    'vcambio = ExisteOrdenProv(CVE_DOC)
                    'If vcambio = False Then
                    If ENLAZADO = "O" And (UCase(TIP_DOC_E) = "O" Or UCase(TIP_DOC_E) = "E" Or UCase(TIP_DOC_E) = "Q") Then
                        '---------------------------------------------------------------
                        'Dim sql As String = "SELECT USER_RECIBIO FROM LOGISTIK_SUPPLY_ORDER WHERE TIPO = 'Almacen'"
                        'Dim daRFC As New SqlDataAdapter(sql, conn4)
                        'Dim dsRFC As New DataSet()
                        'daRFC.Fill(dsRFC, "EmpresaSAE")
                        'Dim oTablaRFC As DataTable
                        'oTablaRFC = dsRFC.Tables("EmpresaSAE")
                        'Dim USER_RECIBIO As String = ""
                        'If oTabla4.Rows.Count >= 1 Then
                        '    Dim oFila As DataRow
                        '    For Each oFila In oTabla4.Rows
                        '        USER_RECIBIO = oFila.Item("USER_RECIBIO").ToString
                        '    Next
                        'End If
                        'Dim NUMNEGOCIO As String = Mid(USER_RECIBIO, 11)
                        '------------------------------------------------------------------
                        '----- BUSCAR RFC
                        CVE_CLPV = "0"
                        If vlRFC = "" Then
                            CVE_CLPV = "0"
                        Else
                            Dim reader7 As SqlDataReader
                            sqllocal = "SELECT CLAVE, NOMBRE FROM PROV" + nnBisness2.ToString +
                            " WHERE  RFC = '" + vlRFC.ToString + "' AND STATUS = 'A'"
                            cmd = New SqlCommand(sqllocal, conn2)
                            conn2.Open()
                            reader7 = cmd.ExecuteReader()
                            While reader7.Read()
                                CVE_CLPV = reader7.Item(0).ToString
                                NOMBRE_CLPV = reader7.Item(1).ToString.Trim
                            End While
                            If CVE_CLPV = "" Then
                                CVE_CLPV = "0"
                                NOMBRE_CLPV = ""
                            End If
                            reader7.Close()
                            conn2.Close()
                        End If
                        CVE_CLPV = espacios(CVE_CLPV, 10)
                        '------------------------------------------

                        sqllocal = "insert into Logistik_supply_order (id_supply_order,id_supplier, supplier_name," +
                        "id_lang, id_warehouse, id_supply_order_state, id_currency, id_ref_currency,  reference," +
                        "date_add, date_upd, date_delivery_expected, total_te, total_with_discount_te, total_tax," +
                        "total_ti, discount_rate, discount_value_te, is_template, EnviadaSAE, User_Recibio, num_empresa) values ('" +
                        Trim(CVE_DOC) & "','" + CVE_CLPV.ToString.Trim + "','" & NOMBRE_CLPV & "',2,1,1," + NUM_MONED + ",1,888,'" & FECHA_DOC & "','" & FECHA_DOC & "','" & FECHA_REC & "','" +
                        IMPORTE & "','" & IMPORTE & "',16,116,0,0,1,'N','" + vlRFC + "','" + vgNumEmpresa.ToString + "')"
                        '2,1,'Tecnologia de Punta', 2,1,2,1,1,888,'01/01/2015','01/01/2015','07/01/2015',100,100,16,116,0,0,1)
                        vcambio = EjecutarQuerySQL_EMPRESA6(sqllocal)

                        'juntardetalle()
                        'Call DetalleOrdenesProveedores6(CVE_DOC, pMiBD)
                        'Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
                        '  Dim conn As New SqlConnection(Str)
                        sqllocal = "SELECT DC.CVE_DOC, DC.NUM_PAR, DC.CVE_ART, ART.DESCR, DC.CANT, DC.PXR, DC.PREC, DC.COST, " +
                        "DC.IMPU1, DC.IMPU2, DC.IMPU3, DC.IMPU4, DC.IMP1APLA, DC.IMP2APLA, DC.IMP3APLA, " +
                        "DC.IMP4APLA, DC.TOTIMP1, DC.TOTIMP2, DC.TOTIMP3, DC.TOTIMP4, DC.DESCU, DC.ACT_INV, " +
                        "DC.TIP_CAM, DC.UNI_VENTA, DC.TIPO_ELEM, DC.TIPO_PROD, DC.CVE_OBS, DC.E_LTPD, DC.REG_SERIE, " +
                        "DC.FACTCONV, DC.COST_DEV, DC.NUM_ALM, DC.MINDIRECTO, DC.NUM_MOV, DC.TOT_PARTIDA" +
                        " FROM PAR_COMPO" + vgNumEmpresa.ToString + " DC, INVE" + vgNumEmpresa.ToString + " ART WHERE  CVE_DOC = '" + pOC.ToString + "'" +
                        " AND DC.CVE_ART = ART.CVE_ART"
                        Dim da7 As New SqlDataAdapter(sqllocal, connSAE)
                        Dim ds7 As New DataSet
                        If connSAE.State = ConnectionState.Closed Then
                            connSAE.Open()
                        End If
                        da7.Fill(ds7, "PAR_COMPO" & vgNumEmpresa.ToString)
                        Dim oTable7 As New DataTable
                        oTable7 = ds7.Tables("PAR_COMPO" & vgNumEmpresa.ToString)
                        Dim NUM_PAR As String
                        Dim CVE_ART As String
                        Dim DESCR As String
                        Dim CANT As String
                        Dim PXR As String
                        Dim PREC As String
                        Dim COST As String
                        Dim IMPU1 As String
                        Dim IMPU2 As String
                        Dim IMPU3 As String
                        Dim IMPU4 As String
                        Dim IMP1APLA As String
                        Dim IMP2APLA As String
                        Dim IMP3APLA As String
                        Dim IMP4APLA As String
                        Dim TOTIMP1 As String
                        Dim TOTIMP2 As String
                        Dim TOTIMP3 As String
                        Dim TOTIMP4 As String
                        Dim DESCU As String
                        Dim ACT_INV As String
                        Dim TIP_CAM As String
                        Dim UNI_VENTA As String
                        Dim TIPO_ELEM As String
                        Dim TIPO_PROD As String
                        'Dim CVE_OBS As String
                        Dim E_LTPD As String
                        Dim REG_SERIE As String
                        Dim FACTCONV As String
                        Dim COST_DEV As String
                        Dim NUM_ALM As String = 0
                        Dim MINDIRECTO As String
                        Dim NUM_MOV As String
                        Dim TOT_PARTIDA As String
                        Dim id_attributes As String = 0
                        If connSAE.State = ConnectionState.Closed Then
                            connSAE.Open()
                        End If
                        For Each oRow4 In oTable7.Rows
                            CVE_DOC = oRow4.Item("CVE_DOC").ToString
                            NUM_PAR = oRow4.Item("NUM_PAR").ToString
                            CVE_ART = oRow4.Item("CVE_ART").ToString
                            DESCR = oRow4.Item("DESCR").ToString
                            TIP_CAM = oRow4.Item("TIP_CAM").ToString
                            CANT = oRow4.Item("CANT").ToString
                            PREC = oRow4.Item("PREC").ToString
                            NUM_ALM = oRow4.Item("NUM_ALM").ToString
                            COST = oRow4.Item("COST").ToString
                            'Dim vIDArticulo As String = TraerIDArtticulo6(CVE_ART)

                            Dim vIDArticulo As String
                            Dim readerIDArticulo As SqlDataReader
                            sqllocal = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + CVE_ART.Trim + "'"
                            LabelTABLA.Text = "sae/P4/1 Logistik_product"
                            LabelQuery.Text = sqllocal
                            If connLogistik.State = ConnectionState.Closed Then
                                connLogistik.Open()
                            End If
                            cmd = New SqlCommand(sqllocal, connLogistik)
                            readerIDArticulo = cmd.ExecuteReader()
                            While readerIDArticulo.Read()
                                vIDArticulo = readerIDArticulo.Item(0).ToString
                            End While
                            If vIDArticulo = "" Then
                                empresa = pMiBD.ToString
                                documento = CVE_DOC.ToString
                                mensaje = "No existe el producto en logistik:" + CVE_ART.ToString
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                Me.Refresh()
                                'Exit For
                            End If
                            readerIDArticulo.Close()
                            '///////////////////////////////////////////////////////

                            sqllocal = "insert into Logistik_supply_order_detail (id_supply_order_detail, id_supply_order, id_currency," +
                            "id_product, id_product_attribute, reference, supplier_reference, name," +
                            "ean13, upc, exchange_rate, unit_price_te, quantity_expected," +
                            "quantity_received, price_te, discount_rate, discount_value_te, price_with_discount_te," +
                            "tax_rate, tax_value, price_ti, tax_value_with_order_discount, price_with_order_discount_te) values ('" +
                            NUM_PAR + "','" + CVE_DOC + "','" + TIP_CAM + "','" +
                            vIDArticulo + "','" + id_attributes + "','Referecia','','" + DESCR + "'," +
                            "'','" + CVE_ART + "',5000,'" + PREC + "','" + CANT + "'," +
                            "0," + COST + ",116,0,0,0,0,0,0,0)"
                            vcambio = EjecutarQuerySQL_EMPRESA6(sqllocal)
                        Next
                        If vcambio = True Then
                            'MsgBox("bien")
                            sqllocal = "UPDATE Logistik_supply_order SET id_warehouse = '" + NUM_ALM + "' WHERE id_supply_order = '" + CVE_DOC + "'"
                            vcambio = EjecutarQuerySQL_EMPRESA6(sqllocal)
                        End If
                    End If
                    'End If
                End If
            Next
            If connSAE.State = ConnectionState.Open Then
                connSAE.Close()
            End If
            If connLogistik.State = ConnectionState.Open Then
                connLogistik.Close()
            End If
            'MsgBox("Finalizo correctamente")
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Orden Compra Emp06: InCorrecta Orden Compra:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub
    Private Sub TraerPedidosProv(ByVal pMiBD As String)
        Dim NOMBRE_CLPV As String = ""
        TextBox1.Text = "sae/C1"
        Me.Refresh()
        Dim TIP_DOC As String
        Dim CVE_DOC As String
        Dim CVE_CLPV As String
        Dim STATUS As String
        Dim SU_REFER As String
        Dim FECHA_DOC As String
        Dim FECHA_REC As String
        Dim FECHA_PAG As String
        Dim FECHA_CANCELA As String
        Dim CAN_TOT As String
        Dim IMP_TOT1 As String
        Dim IMP_TOT2 As String
        Dim IMP_TOT3 As String
        Dim IMP_TOT4 As String
        Dim DES_TOT As String
        Dim DES_FIN As String
        Dim TOT_IND As String
        Dim OBS_COND As String
        Dim CVE_OBS As String
        Dim NUM_ALMA As String
        Dim ACT_CXP As String
        Dim ACT_COI As String
        Dim NUM_MONED As String
        Dim TIPCAMB As String
        Dim ENLAZADO As String
        Dim TIP_DOC_E As String
        Dim NUM_PAGOS As String
        Dim FECHAELAB As String
        Dim SERIE As String
        Dim FOLIO As String
        Dim CTLPOL As String
        Dim ESCFD As String
        Dim CONTADO As String
        Dim BLOQ As String
        Dim DES_FIN_PORC As String
        Dim DES_TOT_PORC As String
        Dim IMPORTE As String
        Dim TIP_DOC_ANT As String
        Dim DOC_ANT As String
        Dim TIP_DOC_SIG As String
        Dim DOC_SIG As String
        Dim Verdadero As Boolean
        Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim connLogistik As New SqlConnection(Str2)
        Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
        Dim conn As New SqlConnection(Str)
        Try
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-vgDiasActulizarSAE) 'Resta días
            sqllocal = "SELECT TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," +
            "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," +
            "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," +
            "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," +
            "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," +
            "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG FROM COMPO" + vgNumEmpresa.ToString +
            " WHERE FECHA_DOC >= '" & Format(vFechaDiasAntes, "MM/dd/yyyy") & "' AND FECHA_DOC <= '" & Format(vFechaHoy, "MM/dd/yyyy") & "'" +
            " AND STATUS IN ('O','E','Q')"
            TextBox1.Text = "sae/C2"
            Me.Refresh()
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "COMPO" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("COMPO" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

            If connLogistik.State = ConnectionState.Closed Then
                connLogistik.Open()
            End If
            Dim VerificarSiExiste As Boolean
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                NUM_MONED = oRow.Item("NUM_MONED").ToString
                'Me.TextError.Text = "Iniciar sincronizacion de compras... EXISTE OC"
                'PERDIO LA CONEXION DEL SAE
                'VerificarSiExiste = VerificarSiExisteOrdenCompra(CVE_DOC)
                sqllocal = "SELECT id_supply_order FROM Logistik_supply_order WHERE id_supply_order ='" + Trim(CVE_DOC) + "'"
                TextBox1.Text = "sae/C3"
                Me.Refresh()
                Dim dsCargarEncabezado As New DataSet()
                Dim dataadapter As New SqlDataAdapter(sqllocal, connLogistik)
                'Me.TextError.Text = "Iniciar sincronizacion de compras... EXISTE OC2.-"
                dataadapter.Fill(dsCargarEncabezado, "Logistik_supply_order" + vgNumEmpresa)
                Dim oTabla As DataTable
                oTabla = dsCargarEncabezado.Tables("Logistik_supply_order" + vgNumEmpresa)
                If oTabla.Rows.Count >= 1 Then
                    VerificarSiExiste = True
                Else
                    VerificarSiExiste = False
                End If
                'Me.TextError.Text = "Iniciar sincronizacion de compras... EXISTE OC3.-"
                If VerificarSiExiste = False Then
                    IMPORTE = oRow.Item("IMPORTE").ToString
                    STATUS = oRow.Item("STATUS").ToString
                    ENLAZADO = oRow.Item("ENLAZADO").ToString
                    TIP_DOC_E = oRow.Item("TIP_DOC_E").ToString
                    FECHA_DOC = oRow.Item("FECHA_DOC").ToString
                    CVE_CLPV = oRow.Item("CVE_CLPV").ToString
                    TIPCAMB = oRow.Item("TIPCAMB").ToString
                    NUM_MONED = oRow.Item("NUM_MONED").ToString
                    'Me.TextError.Text = "Iniciar sincronizacion de compras... verifica RFC"
                    'Dim Verdadero As Boolean = VerificarRFCprovedorSAE(CVE_CLPV, vgNumEmpresa)
                    '////////////////////////////////////////////////////////////////////////////
                    sqllocal = "SELECT NOMBRE_BD FROM EmpresaSAE WHERE BASEDATOS = 'LogistikMasterValvulerias" + vgNumEmpresa.Trim + "'"
                    TextBox1.Text = "sae/C4"
                    Me.Refresh()
                    Dim daBD As New SqlDataAdapter(sqllocal, connLogistik)
                    Dim dsbd As New DataSet()
                    If connLogistik.State = ConnectionState.Closed Then
                        connLogistik.Open()
                    End If
                    daBD.Fill(dsbd, "EmpresaSAE" + vgNumEmpresa + "'")
                    Dim oTabla4 As DataTable
                    oTabla4 = dsbd.Tables("EmpresaSAE" + vgNumEmpresa + "'")
                    'Dim SERVIDOR22 As String = ""
                    'Dim USUARIO22 As String = ""
                    Dim BD22 As String = ""
                    'Dim PASSWROD22 As String = ""
                    'Dim BASEDATOS22 As String = ""
                    If oTabla4.Rows.Count >= 1 Then
                        Dim oFila As DataRow
                        For Each oFila In oTabla4.Rows
                            'SERVIDOR22 = oFila.Item("SERVIDOR").ToString
                            'BASEDATOS22 = oFila.Item("BASEDATOS").ToString
                            'USUARIO22 = oFila.Item("USUARIO").ToString
                            'PASSWROD22 = oFila.Item("PASSWROD").ToString
                            BD22 = oFila.Item("NOMBRE_BD").ToString
                        Next
                    End If
                    'Dim reader777 As SqlDataReader
                    'sqllocal = "SELECT NOMBRE_BD FROM EmpresaSAE WHERE BASEDATOS = 'LogistikMasterValvulerias" + vgNumEmpresa.Trim + "'"
                    'cmd = New SqlCommand(sqllocal, connLogistik)
                    'If connLogistik.State = ConnectionState.Closed Then
                    '    connLogistik.Open()
                    'End If
                    'reader777 = cmd.ExecuteReader()
                    'While reader777.Read()
                    '    BD22 = reader777.Item(0).ToString
                    'End While
                    'reader777.Close()
                    '--------------------------------------------------------------------------------------------
                    If BD22 = "" Then
                        BD22 = "SAE80_EMP02"
                    End If
                    Dim Str1 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + BD22 + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
                    Dim connRFC1 As New SqlConnection(Str1)
                    Dim vRF2 As String = ""
                    Dim readerPROV As SqlDataReader
                    sqllocal = "SELECT RFC FROM PROV" + vgNumEmpresa.ToString + " WHERE CLAVE = '" + CVE_CLPV + "' AND STATUS ='A'"
                    TextBox1.Text = "sae/C5"
                    Me.Refresh()
                    If connRFC1.State = ConnectionState.Closed Then
                        connRFC1.Open()
                    End If
                    cmd = New SqlCommand(sqllocal, connRFC1)
                    readerPROV = cmd.ExecuteReader()
                    While readerPROV.Read()
                        vRF2 = readerPROV.Item(0).ToString
                    End While
                    readerPROV.Close()
                    connRFC1.Close()
                    '------------------------------------------------------------------------------------
                    Dim sql As String = "SELECT NOMBRE_BD FROM EmpresaSAE WHERE TIPO = 'Almacen'"
                    TextBox1.Text = "sae/C6"
                    Me.Refresh()
                    Dim dataadapterBD As New SqlDataAdapter(sql, connLogistik)
                    Dim dsCargarbd As New DataSet()
                    If connLogistik.State = ConnectionState.Closed Then
                        connLogistik.Open()
                    End If
                    dataadapterBD.Fill(dsCargarbd, "EmpresaSAE" + vgNumEmpresa + "'")
                    Dim oTabla7 As DataTable
                    oTabla7 = dsCargarbd.Tables("EmpresaSAE" + vgNumEmpresa + "'")
                    'Dim SERVIDOR As String = ""
                    'Dim USUARIO As String = ""
                    Dim NOMBRE_BD As String = ""
                    'Dim PASSWROD As String = ""
                    'Dim BASEDATOS As String = ""
                    'Dim VTIPO As String = ""
                    If oTabla7.Rows.Count >= 1 Then
                        Dim oFila As DataRow
                        For Each oFila In oTabla7.Rows
                            'SERVIDOR = oFila.Item("SERVIDOR").ToString
                            'BASEDATOS = oFila.Item("BASEDATOS").ToString
                            'USUARIO = oFila.Item("USUARIO").ToString
                            'PASSWROD = oFila.Item("PASSWROD").ToString
                            NOMBRE_BD = oFila.Item("NOMBRE_BD").ToString
                        Next
                    End If
                    Dim nnBisness = Mid(NOMBRE_BD, LongitudBD)
                    If NOMBRE_BD = "" Then
                        NOMBRE_BD = "SAE80_EMP06"
                    End If
                    '------------------------------------------------------------------------------------
                    Dim Str7 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"

                    'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
                    Dim connRFC2 As New SqlConnection(Str7)

                    Dim Vrfc1 As String = ""
                    Dim readerPROV06 As SqlDataReader
                    CVE_CLPV = espacios(CVE_CLPV, 10)
                    sqllocal = "SELECT RFC FROM PROV06 WHERE RFC = '" + vRF2 + "' AND STATUS ='A'"
                    TextBox1.Text = "sae/C7"
                    Me.Refresh()
                    'Me.TextError.Text = "Iniciar sincronizacion de compras... verifica RFC888" + NOMBRE_BD
                    cmd = New SqlCommand(sqllocal, connRFC2)
                    If connRFC2.State = ConnectionState.Closed Then
                        connRFC2.Open()
                    End If
                    readerPROV06 = cmd.ExecuteReader()
                    While readerPROV06.Read()
                        Vrfc1 = readerPROV06.Item(0).ToString
                    End While
                    readerPROV06.Close()
                    connRFC2.Close()
                    'Me.TextError.Text = "Iniciar sincronizacion de compras... verifica RFC99999999"
                    If Vrfc1 = vRF2 And vRF2 <> "" And Vrfc1 <> "" Then
                        Verdadero = True
                    Else
                        Verdadero = False
                    End If
                    '////////////////////////////////////////////////////////////////////////////
                    'Me.TextError.Text = "Iniciar sincronizacion de compras... verifica RFC2"
                    If Verdadero = True Then
                        'verificar si existen los articulos
                        'www7

                        If Len(FECHA_DOC) > 1 Then
                            'Me.TextError.Text = "Iniciar sincronizacion de compras... Fecha1"
                            FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd HH:mm:ss")
                            'FECHA_DOC = FormatDateTime(FECHA_DOC, DateFormat.GeneralDate)
                            Dim time As Date = FECHA_DOC
                            'FECHA_DOC = time.ToString("dd/MM/yyyy")
                            FECHA_DOC = time.ToString("yyyy/MM/dd")
                        End If
                        FECHA_REC = oRow.Item("FECHA_REC").ToString
                        If Len(FECHA_REC) > 1 Then
                            'Me.TextError.Text = "Iniciar sincronizacion de compras... Fecha2"
                            FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("yyyy/MM/dd HH:mm:ss")
                            'FECHA_REC = FormatDateTime(FECHA_REC, DateFormat.GeneralDate)
                            Dim time As Date = FECHA_REC
                            FECHA_REC = time.ToString("yyyy/MM/dd")
                            'FECHA_REC = time.ToString("dd/MM/yyyy")
                        End If
                        'Me.TextError.Text = "Iniciar sincronizacion de compras... existe OC2"
                        'vcambio = ExisteOrdenProv(CVE_DOC)
                        'If vcambio = False Then
                        If VerificarSiExiste = False Then
                            If ENLAZADO = "O" And (UCase(TIP_DOC_E) = "O" Or UCase(TIP_DOC_E) = "E" Or UCase(TIP_DOC_E) = "Q") Then
                                '---------------------------traer rfc---------------------------------------------------------
                                'vlRFC = TraerRFC(CVE_CLPV)
                                vlRFC = ""
                                Dim reader7 As SqlDataReader
                                sqllocal = "SELECT RFC, NOMBRE FROM PROV" + vgNumEmpresa.ToString + " WHERE CLAVE= '" + CVE_CLPV.ToString + "'"
                                TextBox1.Text = "sae/C8"
                                Me.Refresh()
                                If conn.State = ConnectionState.Closed Then
                                    conn.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn)
                                reader7 = cmd.ExecuteReader()
                                While reader7.Read()
                                    vlRFC = reader7.Item(0).ToString
                                    NOMBRE_CLPV = reader7.Item(1).ToString.Trim
                                End While
                                reader7.Close()
                                conn.Close()
                                '----------------------------------------------------------------------------------------------
                                sqllocal = "insert into Logistik_supply_order (id_supply_order, id_supplier, supplier_name," +
                                "id_lang, id_warehouse, id_supply_order_state, id_currency, id_ref_currency,  reference," +
                                "date_add, date_upd, date_delivery_expected, total_te, total_with_discount_te, total_tax," +
                                "total_ti, discount_rate, discount_value_te, is_template, EnviadaSAE, User_Recibio, num_empresa) values ('" +
                                Trim(CVE_DOC) & "','" + CVE_CLPV.ToString.Trim + "','" & NOMBRE_CLPV & "',2,1,1," + NUM_MONED + ",1,888,'" & FECHA_DOC & "','" & FECHA_DOC & "','" & FECHA_REC & "','" +
                                IMPORTE & "','" & IMPORTE & "',16,116,0,0,1,'N','" + vlRFC + "','" + vgNumEmpresa.ToString + "')"
                                '2,1,'Tecnologia de Punta', 2,1,2,1,1,888,'01/01/2015','01/01/2015','07/01/2015',100,100,16,116,0,0,1)
                                vcambio = EjecutarQuerySQL_EMPRESA(sqllocal)
                                TextBox1.Text = "sae/C9"
                                Me.Refresh()
                                'Call DetalleOrdenesProveedores(CVE_DOC, pMiBD)
                                '///////////////////////////////////////////////////////////////////////////////
                                '--variables detalle PAR_COMPO01
                                'Dim CVE_DOC As String
                                Dim NUM_PAR As String
                                Dim CVE_ART As String
                                Dim DESCR As String
                                Dim CANT As String
                                Dim PXR As String
                                Dim PREC As String
                                Dim COST As String
                                Dim IMPU1 As String
                                Dim IMPU2 As String
                                Dim IMPU3 As String
                                Dim IMPU4 As String
                                Dim IMP1APLA As String
                                Dim IMP2APLA As String
                                Dim IMP3APLA As String
                                Dim IMP4APLA As String
                                Dim TOTIMP1 As String
                                Dim TOTIMP2 As String
                                Dim TOTIMP3 As String
                                Dim TOTIMP4 As String
                                Dim DESCU As String
                                Dim ACT_INV As String
                                Dim TIP_CAM As String
                                Dim UNI_VENTA As String
                                Dim TIPO_ELEM As String
                                Dim TIPO_PROD As String
                                'Dim CVE_OBS As String
                                Dim E_LTPD As String
                                Dim REG_SERIE As String
                                Dim FACTCONV As String
                                Dim COST_DEV As String
                                Dim NUM_ALM As String = 0
                                Dim MINDIRECTO As String
                                Dim NUM_MOV As String
                                Dim TOT_PARTIDA As String
                                Dim id_attributes As String = 0
                                sqllocal = "SELECT DC.CVE_DOC, DC.NUM_PAR, DC.CVE_ART, ART.DESCR, DC.CANT, DC.PXR, DC.PREC, DC.COST, " +
                                "DC.IMPU1, DC.IMPU2, DC.IMPU3, DC.IMPU4, DC.IMP1APLA, DC.IMP2APLA, DC.IMP3APLA, " +
                                "DC.IMP4APLA, DC.TOTIMP1, DC.TOTIMP2, DC.TOTIMP3, DC.TOTIMP4, DC.DESCU, DC.ACT_INV, " +
                                "DC.TIP_CAM, DC.UNI_VENTA, DC.TIPO_ELEM, DC.TIPO_PROD, DC.CVE_OBS, DC.E_LTPD, DC.REG_SERIE, " +
                                "DC.FACTCONV, DC.COST_DEV, DC.NUM_ALM, DC.MINDIRECTO, DC.NUM_MOV, DC.TOT_PARTIDA" +
                                " FROM PAR_COMPO" + vgNumEmpresa.ToString + " DC, INVE" + vgNumEmpresa.ToString + " ART WHERE  CVE_DOC = '" + CVE_DOC + "'" +
                                " AND DC.CVE_ART = ART.CVE_ART"
                                TextBox1.Text = "sae/CD1"
                                Me.Refresh()
                                Dim da7 As New SqlDataAdapter(sqllocal, conn)
                                Dim ds7 As New DataSet
                                If conn.State = ConnectionState.Closed Then
                                    conn.Open()
                                End If
                                da7.Fill(ds7, "PAR_COMPO" & vgNumEmpresa.ToString)
                                Dim oTable8 As New DataTable
                                oTable8 = ds7.Tables("PAR_COMPO" & vgNumEmpresa.ToString)
                                For Each oRow8 In oTable8.Rows
                                    CVE_DOC = oRow8.Item("CVE_DOC").ToString
                                    NUM_PAR = oRow8.Item("NUM_PAR").ToString
                                    CVE_ART = oRow8.Item("CVE_ART").ToString
                                    DESCR = oRow8.Item("DESCR").ToString
                                    TIP_CAM = oRow8.Item("TIP_CAM").ToString
                                    CANT = oRow8.Item("CANT").ToString
                                    PREC = oRow8.Item("PREC").ToString
                                    'SI ES DIFERENTE DE UNO HACER LA OPERACION
                                    If (NUM_MONED = "2" Or NUM_MONED = "9") Then
                                        PREC = (Convert.ToDecimal(PREC) / Convert.ToDecimal(TIPCAMB)).ToString
                                    End If
                                    COST = oRow8.Item("COST").ToString
                                    NUM_ALM = oRow8.Item("NUM_ALM").ToString

                                    'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                                    Dim vIDArticulo As String
                                    Dim readerIDArticulo As SqlDataReader
                                    sqllocal = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + CVE_ART.Trim + "'"
                                    LabelTABLA.Text = "sae/P4/1 Logistik_product"
                                    LabelQuery.Text = sqllocal
                                    If connLogistik.State = ConnectionState.Closed Then
                                        connLogistik.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, connLogistik)
                                    readerIDArticulo = cmd.ExecuteReader()
                                    While readerIDArticulo.Read()
                                        vIDArticulo = readerIDArticulo.Item(0).ToString
                                    End While
                                    readerIDArticulo.Close()
                                    If vIDArticulo = "" Then
                                        empresa = pMiBD.ToString
                                        documento = CVE_DOC.ToString
                                        mensaje = "No existe el producto en logistik:" + CVE_ART.ToString
                                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                        Me.Refresh()
                                        'Exit For
                                    End If

                                    sqllocal = "insert into Logistik_supply_order_detail (id_supply_order_detail, id_supply_order, id_currency," +
                                    "id_product, id_product_attribute, reference, supplier_reference, name," +
                                    "ean13, upc, exchange_rate, unit_price_te, quantity_expected," +
                                    "quantity_received, price_te, discount_rate, discount_value_te, price_with_discount_te," +
                                    "tax_rate, tax_value, price_ti, tax_value_with_order_discount, price_with_order_discount_te) values ('" +
                                    NUM_PAR + "','" + CVE_DOC + "','" + TIP_CAM + "','" +
                                    vIDArticulo + "','" + id_attributes + "','Referecia','','" + DESCR + "'," +
                                    "'','" + CVE_ART + "',5000,'" + PREC + "','" + CANT + "'," +
                                    "0," + COST + ",116,0,0,0,0,0,0,0)"
                                    vcambio = EjecutarQuerySQL_EMPRESA(sqllocal)
                                    TextBox1.Text = "sae/CD2"
                                    Me.Refresh()
                                Next

                                If vcambio = True Then
                                    'MsgBox("bien")
                                    sqllocal = "UPDATE Logistik_supply_order SET id_warehouse = '" + NUM_ALM + "' WHERE id_supply_order = '" + CVE_DOC + "'"
                                    vcambio = EjecutarQuerySQL_EMPRESA(sqllocal)
                                    TextBox1.Text = "sae/CD3"
                                    Me.Refresh()
                                End If
                                'If conn.State = ConnectionState.Open Then
                                '    conn.Close()
                                'End If
                                '//////////////////////////////////////////////////////////////////////////////
                                If vgNumEmpresa <> "06" Then
                                    Label5.Text = "Sincronizando O.C. EMP06 del SAE a SQL"
                                    Call OrdenCompraEmp6(pMiBD, CVE_DOC)
                                End If
                            End If
                        Else
                            'ACTUALIZAR
                            If STATUS = "C" Then
                                sqllocal = "update Logistik_supply_order SET id_supply_order_state='666'" +
                                " WHERE id_supply_order = '" + CVE_DOC + "'"
                                vcambio = EjecutarQuerySQL_EMPRESA(sqllocal)
                                TextBox1.Text = "sae/C10"
                                Me.Refresh()
                            End If
                        End If
                    Else
                        empresa = vgEmpresa.ToString
                        documento = ""
                        mensaje = "Sincronizar Orden Compra: InCorrecta Orden Compra:" + CVE_DOC.ToString + "NO EXISTE EL RFC DEL PROVEEDOR"
                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','7')"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        Me.Refresh()
                        TextBox1.Text = "sae/C11"
                        Me.Refresh()
                    End If
                End If
            Next
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Orden Compra: InCorrecta Orden Compra:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            TextBox1.Text = "sae/C12"
            Me.Refresh()
            If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                Me.Dispose()
                'FrmLogin.Dispose()
            End If
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Orden Compra: InCorrecta Orden Compra:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            TextBox1.Text = "sae/C13"
            Me.Refresh()
        End Try
    End Sub
    Function VerificarSiExisteOrdenCompraEmp6(ByVal pID_ORDER As String) As Boolean
        Try
            'TRAER DATOS DEL ALMACEN
            '------------------------------------------------------------------------------------
            Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn7 As New SqlConnection(Str7)
            Dim sql As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Almacen'"
            Dim dataadapter As New SqlDataAdapter(sql, conn7)
            Dim dsCargarEncabezado As New DataSet()
            dataadapter.Fill(dsCargarEncabezado, "EmpresaSAE")
            Dim oTabla7 As DataTable
            oTabla7 = dsCargarEncabezado.Tables("EmpresaSAE")
            Dim SERVIDOR As String = ""
            Dim USUARIO As String = ""
            Dim VTIPO As String = ""
            Dim PASSWROD As String = ""
            Dim BASEDATOS As String = ""
            'Dim VTIPO As String = ""
            If oTabla7.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla7.Rows
                    SERVIDOR = oFila.Item("SERVIDOR").ToString
                    BASEDATOS = oFila.Item("BASEDATOS").ToString
                    USUARIO = oFila.Item("USUARIO").ToString
                    PASSWROD = oFila.Item("PASSWROD").ToString
                    VTIPO = oFila.Item("TIPO").ToString
                    'VTIPO = oFila.Item("TIPO").ToString
                Next
            Else
                VTIPO = ""
            End If
            '------------------------------------------------------------------------------------
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + BASEDATOS + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_supply_order FROM Logistik_supply_order WHERE id_supply_order ='" + Trim(pID_ORDER) + "'"
            Dim ds As New DataSet()
            Dim da As New SqlDataAdapter(sqllocal, conn)
            da.Fill(ds, "Logistik_supply_order")
            Dim oTabla As DataTable
            oTabla = ds.Tables("Logistik_supply_order")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

            Return True
        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExisteOrdenCompra(ByVal pID_ORDER As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT id_supply_order FROM Logistik_supply_order WHERE id_supply_order ='" + Trim(pID_ORDER) + "'"
            conn.Open()
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_supply_order" + vgNumEmpresa)
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_supply_order" + vgNumEmpresa)
            conn.Close()
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

            Return True
        Catch ex As Exception
            Return False
        End Try
    End Function
    Function ExisteOrdenProv(ByVal cve_doc1 As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim cnnCliente As New SqlConnection(Str)
            'Dim cnnCliente As New SqlConnection(My.Settings.ConexionLocal)
            sqllocal = "SELECT id_supply_order FROM Logistik_supply_order WHERE id_supply_order = '" + Trim(cve_doc1) + "'"
            Dim da As New SqlDataAdapter(sqllocal, cnnCliente)
            Dim ds As New DataSet
            cnnCliente.Open()
            da.Fill(ds, "Logistik_supply_order")
            cnnCliente.Close()
            Dim otable As New DataTable
            otable = ds.Tables("Logistik_supply_order")
            'Dim dr As DataRow
            Dim cont As Integer = otable.Rows.Count
            If cont >= 1 Then
                Return True
            Else
                Return False
            End If
        Catch ex As Exception
            MsgBox(ex.Message.ToString)
            vcambio = False
        End Try
    End Function
    Private Sub DetalleOrdenesProveedores6(ByVal cve_doc1 As String, ByVal pMiBD As String)
        Dim CVE_DOC As String = ""
        '--variables detalle PAR_COMPO01
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"

            'Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT DC.CVE_DOC, DC.NUM_PAR, DC.CVE_ART, ART.DESCR, DC.CANT, DC.PXR, DC.PREC, DC.COST, " +
            "DC.IMPU1, DC.IMPU2, DC.IMPU3, DC.IMPU4, DC.IMP1APLA, DC.IMP2APLA, DC.IMP3APLA, " +
            "DC.IMP4APLA, DC.TOTIMP1, DC.TOTIMP2, DC.TOTIMP3, DC.TOTIMP4, DC.DESCU, DC.ACT_INV, " +
            "DC.TIP_CAM, DC.UNI_VENTA, DC.TIPO_ELEM, DC.TIPO_PROD, DC.CVE_OBS, DC.E_LTPD, DC.REG_SERIE, " +
            "DC.FACTCONV, DC.COST_DEV, DC.NUM_ALM, DC.MINDIRECTO, DC.NUM_MOV, DC.TOT_PARTIDA" +
            " FROM PAR_COMPO" + vgNumEmpresa.ToString + " DC, INVE" + vgNumEmpresa.ToString + " ART WHERE  CVE_DOC = '" + cve_doc1 + "'" +
            " AND DC.CVE_ART = ART.CVE_ART"
            Dim da7 As New SqlDataAdapter(sqllocal, conn)
            Dim ds7 As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da7.Fill(ds7, "PAR_COMPO" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds7.Tables("PAR_COMPO" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

            Dim NUM_PAR As String
            Dim CVE_ART As String
            Dim DESCR As String
            Dim CANT As String
            Dim PXR As String
            Dim PREC As String
            Dim COST As String
            Dim IMPU1 As String
            Dim IMPU2 As String
            Dim IMPU3 As String
            Dim IMPU4 As String
            Dim IMP1APLA As String
            Dim IMP2APLA As String
            Dim IMP3APLA As String
            Dim IMP4APLA As String
            Dim TOTIMP1 As String
            Dim TOTIMP2 As String
            Dim TOTIMP3 As String
            Dim TOTIMP4 As String
            Dim DESCU As String
            Dim ACT_INV As String
            Dim TIP_CAM As String
            Dim UNI_VENTA As String
            Dim TIPO_ELEM As String
            Dim TIPO_PROD As String
            Dim CVE_OBS As String
            Dim E_LTPD As String
            Dim REG_SERIE As String
            Dim FACTCONV As String
            Dim COST_DEV As String
            Dim NUM_ALM As String = 0
            Dim MINDIRECTO As String
            Dim NUM_MOV As String
            Dim TOT_PARTIDA As String
            Dim id_attributes As String = 0
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                NUM_PAR = oRow.Item("NUM_PAR").ToString
                CVE_ART = oRow.Item("CVE_ART").ToString
                DESCR = oRow.Item("DESCR").ToString
                TIP_CAM = oRow.Item("TIP_CAM").ToString
                CANT = oRow.Item("CANT").ToString
                PREC = oRow.Item("PREC").ToString
                NUM_ALM = oRow.Item("NUM_ALM").ToString
                COST = oRow.Item("COST").ToString
                'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                Dim vIDArticulo As String = TraerIDArtticulo6(CVE_ART)
                sqllocal = "insert into Logistik_supply_order_detail (id_supply_order_detail, id_supply_order, id_currency," +
                "id_product, id_product_attribute, reference, supplier_reference, name," +
                "ean13, upc, exchange_rate, unit_price_te, quantity_expected," +
                "quantity_received, price_te, discount_rate, discount_value_te, price_with_discount_te," +
                "tax_rate, tax_value, price_ti, tax_value_with_order_discount, price_with_order_discount_te) values ('" +
                NUM_PAR + "','" + CVE_DOC + "','" + TIP_CAM + "','" +
                vIDArticulo + "','" + id_attributes + "','Referecia','','" + DESCR + "'," +
                "'','" + CVE_ART + "',5000,'" + PREC + "','" + CANT + "'," +
                "0," + COST + ",116,0,0,0,0,0,0,0)"
                vcambio = EjecutarQuerySQL_EMPRESA6(sqllocal)
            Next
            If vcambio = True Then
                'MsgBox("bien")
                sqllocal = "UPDATE Logistik_supply_order SET id_warehouse = '" + NUM_ALM + "' WHERE id_supply_order = '" + cve_doc1 + "'"
                vcambio = EjecutarQuerySQL_EMPRESA6(sqllocal)
            End If
            'If conn.State = ConnectionState.Open Then
            '    conn.Close()
            'End If

        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Orden de Compra Emp06: InCorrecta Orden de Compra:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub
    Private Sub DetalleOrdenesProveedores(ByVal cve_doc1 As String, ByVal pMiBD As String)
        '--variables detalle PAR_COMPO01
        Dim CVE_DOC As String
        Dim NUM_PAR As String
        Dim CVE_ART As String
        Dim DESCR As String
        Dim CANT As String
        Dim PXR As String
        Dim PREC As String
        Dim COST As String
        Dim IMPU1 As String
        Dim IMPU2 As String
        Dim IMPU3 As String
        Dim IMPU4 As String
        Dim IMP1APLA As String
        Dim IMP2APLA As String
        Dim IMP3APLA As String
        Dim IMP4APLA As String
        Dim TOTIMP1 As String
        Dim TOTIMP2 As String
        Dim TOTIMP3 As String
        Dim TOTIMP4 As String
        Dim DESCU As String
        Dim ACT_INV As String
        Dim TIP_CAM As String
        Dim UNI_VENTA As String
        Dim TIPO_ELEM As String
        Dim TIPO_PROD As String
        Dim CVE_OBS As String
        Dim E_LTPD As String
        Dim REG_SERIE As String
        Dim FACTCONV As String
        Dim COST_DEV As String
        Dim NUM_ALM As String = 0
        Dim MINDIRECTO As String
        Dim NUM_MOV As String
        Dim TOT_PARTIDA As String
        Dim id_attributes As String = 0
        Try
            Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connLg As New SqlConnection(Str2)
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT DC.CVE_DOC, DC.NUM_PAR, DC.CVE_ART, ART.DESCR, DC.CANT, DC.PXR, DC.PREC, DC.COST, " +
            "DC.IMPU1, DC.IMPU2, DC.IMPU3, DC.IMPU4, DC.IMP1APLA, DC.IMP2APLA, DC.IMP3APLA, " +
            "DC.IMP4APLA, DC.TOTIMP1, DC.TOTIMP2, DC.TOTIMP3, DC.TOTIMP4, DC.DESCU, DC.ACT_INV, " +
            "DC.TIP_CAM, DC.UNI_VENTA, DC.TIPO_ELEM, DC.TIPO_PROD, DC.CVE_OBS, DC.E_LTPD, DC.REG_SERIE, " +
            "DC.FACTCONV, DC.COST_DEV, DC.NUM_ALM, DC.MINDIRECTO, DC.NUM_MOV, DC.TOT_PARTIDA" +
            " FROM PAR_COMPO" + vgNumEmpresa.ToString + " DC, INVE" + vgNumEmpresa.ToString + " ART WHERE  CVE_DOC = '" + cve_doc1 + "'" +
            " AND DC.CVE_ART = ART.CVE_ART"
            TextBox1.Text = "sae/CD1"
            Me.Refresh()
            Dim da7 As New SqlDataAdapter(sqllocal, conn)
            Dim ds7 As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da7.Fill(ds7, "PAR_COMPO" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds7.Tables("PAR_COMPO" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If

            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            For Each oRow In oTable.Rows
                CVE_DOC = oRow.Item("CVE_DOC").ToString
                NUM_PAR = oRow.Item("NUM_PAR").ToString
                CVE_ART = oRow.Item("CVE_ART").ToString
                DESCR = oRow.Item("DESCR").ToString
                TIP_CAM = oRow.Item("TIP_CAM").ToString
                CANT = oRow.Item("CANT").ToString
                PREC = oRow.Item("PREC").ToString
                COST = oRow.Item("COST").ToString
                NUM_ALM = oRow.Item("NUM_ALM").ToString

                'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                Dim vIDArticulo As String
                Dim readerIDArticulo As SqlDataReader
                sqllocal = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + CVE_ART.Trim + "'"
                LabelTABLA.Text = "sae/P4/1 Logistik_product"
                LabelQuery.Text = sqllocal
                If connLg.State = ConnectionState.Closed Then
                    connLg.Open()
                End If
                cmd = New SqlCommand(sqllocal, connLg)
                readerIDArticulo = cmd.ExecuteReader()
                While readerIDArticulo.Read()
                    vIDArticulo = readerIDArticulo.Item(0).ToString
                End While
                If vIDArticulo = "" Then
                    empresa = pMiBD.ToString
                    documento = CVE_DOC.ToString
                    mensaje = "No existe el producto en logistik:" + CVE_ART.ToString
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    Exit For
                End If
                sqllocal = "insert into Logistik_supply_order_detail (id_supply_order_detail, id_supply_order, id_currency," +
                "id_product, id_product_attribute, reference, supplier_reference, name," +
                "ean13, upc, exchange_rate, unit_price_te, quantity_expected," +
                "quantity_received, price_te, discount_rate, discount_value_te, price_with_discount_te," +
                "tax_rate, tax_value, price_ti, tax_value_with_order_discount, price_with_order_discount_te) values ('" +
                NUM_PAR + "','" + CVE_DOC + "','" + TIP_CAM + "','" +
                vIDArticulo + "','" + id_attributes + "','Referecia','','" + DESCR + "'," +
                "'','" + CVE_ART + "',5000,'" + PREC + "','" + CANT + "'," +
                "0," + COST + ",116,0,0,0,0,0,0,0)"
                vcambio = EjecutarQuerySQL_EMPRESA(sqllocal)
                TextBox1.Text = "sae/CD2"
                Me.Refresh()
            Next
            If vcambio = True Then
                'MsgBox("bien")
                sqllocal = "UPDATE Logistik_supply_order SET id_warehouse = '" + NUM_ALM + "' WHERE id_supply_order = '" + cve_doc1 + "'"
                vcambio = EjecutarQuerySQL_EMPRESA(sqllocal)
                TextBox1.Text = "sae/CD3"
                Me.Refresh()
            End If
            'If conn.State = ConnectionState.Open Then
            '    conn.Close()
            'End If

        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Orden Compra: InCorrecta Orden Compra:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            TextBox1.Text = "sae/CD4"
            Me.Refresh()
        End Try
    End Sub
    Private Sub TraerArticulos(ByVal pMiBD As String)
        Dim vExist As String
        Dim CVE_ART As String
        Try
            'TextError.Text = "Iniciando sincronizacion de articulos..."
            'Me.Refresh()
            Dim Str6 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connx As New SqlConnection(Str6)
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            Dim Str3 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=SAE80_EMP02;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn3 As New SqlConnection(Str3)
            sqllocal = "SELECT CVE_ART, DESCR, LIN_PROD, CON_SERIE, UNI_MED" +
            ",UNI_EMP, CTRL_ALM, TIEM_SURT, STOCK_MIN, STOCK_MAX, TIP_COSTEO, NUM_MON, FCH_ULTCOM, COMP_X_REC, FCH_ULTVTA" +
            ",PEND_SURT, EXIST, COSTO_PROM, ULT_COSTO, CVE_OBS, TIPO_ELE, UNI_ALT, FAC_CONV, APART, CON_LOTE" +
            ",CON_PEDIMENTO, PESO, VOLUMEN, CVE_ESQIMPU, CVE_BITA, VTAS_ANL_C, VTAS_ANL_M, COMP_ANL_C, COMP_ANL_M, PREFIJO" +
            ",TALLA, COLOR, CUENT_CONT, CVE_IMAGEN, BLK_CST_EXT, STATUS FROM INVE" + vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "INVE" & vgNumEmpresa.ToString)
            Dim oTable1 As New DataTable
            oTable1 = ds.Tables("INVE" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim DESCR As String
            Dim LIN_PROD As String
            Dim CON_SERIE As String  'usa numeros de serie
            Dim UNI_MED As String
            Dim UNI_EMP As String
            Dim CTRL_ALM As String
            Dim TIEM_SURT As String
            Dim STOCK_MIN As String
            Dim STOCK_MAX As String
            Dim TIP_COSTEO As String
            Dim NUM_MON As String
            Dim FCH_ULTCOM As String
            Dim COMP_X_REC As String
            Dim FCH_ULTVTA As String
            Dim PEND_SURT As String
            Dim EXIST As String
            Dim COSTO_PROM As String
            Dim ULT_COSTO As String
            Dim CVE_OBS As String
            Dim TIPO_ELE As String
            Dim UNI_ALT As String
            Dim FAC_CONV As String
            Dim APART As String
            Dim CON_LOTE As String
            Dim CON_PEDIMENTO As String ' usa pedimento
            Dim PESO As String
            Dim VOLUMEN As String
            Dim CVE_ESQIMPU As String
            Dim CVE_BITA As String
            Dim VTAS_ANL_C As String
            Dim VTAS_ANL_M As String
            Dim COMP_ANL_C As String
            Dim COMP_ANL_M As String
            Dim PREFIJO As String
            Dim TALLA As String
            Dim COLOR As String
            Dim CUENT_CONT As String
            Dim CVE_IMAGEN As String
            Dim BLK_CST_EXT As String
            Dim STATUS As String
            'If conn.State = ConnectionState.Closed Then
            '    conn.Open()
            'End If
            Dim VerificarSiExiste As Boolean
            If connx.State = ConnectionState.Closed Then
                connx.Open()
            End If
            For Each oRow In oTable1.Rows
                CVE_ART = oRow.Item("CVE_ART").ToString
                If CVE_ART = "WA01" And vgNumEmpresa = "06" Then
                    COLOR = "NEGRO"
                End If
                VerificarSiExiste = VerificarSiExisteArticulos(CVE_ART)
                CON_PEDIMENTO = oRow.Item("CON_PEDIMENTO").ToString

                If VerificarSiExiste = False Then
                    DESCR = oRow.Item("DESCR").ToString
                    DESCR = DESCR.Replace("'", "")
                    'UNI_MED = oRow.Item("UNI_MED").ToString
                    UNI_ALT = "PZ"
                    If Trim(UNI_MED) = "" Then UNI_MED = "PZ"
                    '-------realizar un procedimiento traer precio del almacen origen
                    COSTO_PROM = oRow.Item("COSTO_PROM").ToString
                    If COSTO_PROM = Nothing Or COSTO_PROM = "" Then
                        COSTO_PROM = "0"
                    Else
                        COSTO_PROM = Convert.ToDouble(oRow.Item("EXIST").ToString)
                        'Dim VAREXIST2 As Double = COSTO_PROM
                        'COSTO_PROM = Math.Round(VAREXIST2, 4)
                    End If
                    CON_SERIE = oRow.Item("CON_SERIE").ToString
                    EXIST = oRow.Item("EXIST").ToString
                    vExist = oRow.Item("EXIST").ToString
                    If vExist = Nothing Or vExist = "" Then
                        EXIST = "0"
                    Else
                        EXIST = Convert.ToDouble(oRow.Item("EXIST").ToString)
                        'Dim VAREXIST As Double = EXIST
                        'EXIST = Math.Round(VAREXIST, 4)
                    End If
                    If vgId_usurio = "" Then vgId_usurio = "1"
                    If vgNumEmpresa = "06" Then
                        If CVE_ART = "WA01" Then
                            COLOR = "NEGRO"
                        End If
                        '//////////////////////////////////////////////////////////////////////////////
                        If conn3.State = ConnectionState.Closed Then
                            conn3.Open()
                        End If
                        'sqllocal = "SELECT CAMPLIB11 FROM INVE_CLIB02 where CVE_PROD='" + CVE_ART.Trim() + "'"
                        'Dim readerINVE_CLIB As SqlDataReader
                        'cmd = New SqlCommand(sqllocal, conn3)
                        'readerINVE_CLIB = cmd.ExecuteReader()
                        'Dim CampLib42 As String = ""
                        'While readerINVE_CLIB.Read()
                        '    CampLib42 = ""
                        '    CampLib42 = readerINVE_CLIB.Item("CAMPLIB11").ToString
                        '    If CampLib42 = "74122001" Or CampLib42 = "39222001" Or CampLib42 = "83024106" Or CampLib42 = "73249091" Or CampLib42 = "49111099" Or CampLib42 = "39229099" Or CampLib42 = "74182001" Or CampLib42 = "84818002" Or CampLib42 = "84818021" Or CampLib42 = "69109001" Or CampLib42 = "84818099" Or CampLib42 = "83025001" Or CampLib42 = "39221001" Or CampLib42 = "84818004" Or CampLib42 = "84813001" Then
                        '        CampLib42 = "1"
                        '    Else
                        '        CampLib42 = "0"
                        '    End If
                        'End While
                        'readerINVE_CLIB.Close()
                        '///////////////////////////////////////////////////////////////////
                        'sqllocal = "SELECT CAMPLIB11 FROM INVE_CLIB02 where CVE_PROD='" + CVE_ART.Trim() + "'"
                        'Dim readerINVE_CLIB As SqlDataReader
                        'cmd = New SqlCommand(sqllocal, conn3)
                        'readerINVE_CLIB = cmd.ExecuteReader()
                        Dim CampLib42 As String = ""
                        'While readerINVE_CLIB.Read()
                        '    CampLib42 = ""
                        '    CampLib42 = readerINVE_CLIB.Item("CAMPLIB11").ToString
                        '    '////////////////////////////////////////////////////////////////////
                        '    sqllocal = "SELECT igi FROM Logistik_Fracccion_Arancelaria"
                        '    Dim readerIGI As SqlDataReader
                        '    If connx.State = ConnectionState.Closed Then
                        '        connx.Open()
                        '    End If
                        '    cmd = New SqlCommand(sqllocal, connx)
                        '    readerIGI = cmd.ExecuteReader()
                        '    Dim igi As String = ""
                        '    While readerIGI.Read()
                        '        igi = readerIGI.Item("igi").ToString
                        '        If CampLib42 = igi Then
                        '            CampLib42 = "1"
                        '            Exit While
                        '        Else
                        '            CampLib42 = "0"
                        '        End If
                        '    End While
                        '    readerIGI.Close()
                        '////////////////////////////////////////////////////////////////////
                        If CampLib42 = "74122001" Or CampLib42 = "39222001" Or CampLib42 = "83024106" Or CampLib42 = "73249091" Or CampLib42 = "49111099" Or CampLib42 = "39229099" Or CampLib42 = "74182001" Or CampLib42 = "84818002" Or CampLib42 = "84818021" Or CampLib42 = "69109001" Or CampLib42 = "84818099" Or CampLib42 = "83025001" Or CampLib42 = "39221001" Or CampLib42 = "84818004" Or CampLib42 = "84813001" Then
                            CampLib42 = "1"
                        Else
                            CampLib42 = "0"
                        End If
                        'End While
                        'readerINVE_CLIB.Close()
                        '///////////////////////////////////////////////////////////////////////
                        sqllocal = "INSERT INTO Logistik_product( id_supplier, id_manufacturer, id_category_default, id_shop_default, id_tax_rules_group," +
                        "on_sale, online_only, ean13, upc, ecotax, quantity, minimal_quantity, price, wholesale_price, unity," +
                        "unit_price_ratio, additional_shipping_cost, reference, supplier_reference, location, width, height, depth, weight, out_of_stock," +
                        "quantity_discount, customizable, uploadable_files, text_fields, active, redirect_type, id_product_redirected, available_for_order, available_date, condition," +
                        "show_price, indexed, visibility, cache_is_pack, cache_has_attachments, is_virtual, cache_default_attribute, date_add, date_upd, advanced_stock_management, " +
                        "pack_stock_type, upc_reemplazo1, UnidadMedida, id_Employee, ClaveSAE, NumSerie, Pedimento, existencia,descripcion," +
                        "existencia_logistik,existencia_apartada,existencia_disponible," +
                        "marca,modelo,estilo,color,persona,talla,color_base,habilitado_web,codigo_base,CAMPLIB42) VALUES (" +
                        "'1', '1', '5', '1', '1'," +
                        " '0', '0', '0', '" + Trim(CVE_ART.ToString) + "', '0.000000', '0', '1', '" + COSTO_PROM.ToString + "', '4.950000', ''," +
                        "'0.000000', '0.00', 'demo_1', '', '', '0.000000', '0.000000', '0.000000', '0.000000', '2'," +
                        "'0', '0', '0', '0', '1', '404', '0', '1', '" + time.ToString("yyyy/MM/dd") + "', 'new'," +
                        " '1', '1', 'both', '0', '0', '0', '1', '" + time.ToString("yyyy/MM/dd") + "', '" + time.ToString("yyyy/MM/dd") + "', '0'," +
                        " '3','','" + UNI_MED.ToString + "','" + vgId_usurio.ToString + "','" + CVE_ART + "','" + CON_SERIE + "','" + CON_PEDIMENTO + "','" + EXIST.ToString + "','" + DESCR.ToString + "'," +
                        "'0','0','0'," +
                        "'0','0','0','0','0','0','0','0','0','" + CampLib42 + "')"
                    Else
                        sqllocal = "INSERT INTO Logistik_product( id_supplier, id_manufacturer, id_category_default, id_shop_default, id_tax_rules_group," +
                        "on_sale, online_only, ean13, upc, ecotax, quantity, minimal_quantity, price, wholesale_price, unity," +
                        "unit_price_ratio, additional_shipping_cost, reference, supplier_reference, location, width, height, depth, weight, out_of_stock," +
                        "quantity_discount, customizable, uploadable_files, text_fields, active, redirect_type, id_product_redirected, available_for_order, available_date, condition," +
                        "show_price, indexed, visibility, cache_is_pack, cache_has_attachments, is_virtual, cache_default_attribute, date_add, date_upd, advanced_stock_management, " +
                        "pack_stock_type, upc_reemplazo1, UnidadMedida, id_Employee, ClaveSAE, NumSerie, Pedimento, existencia,descripcion," +
                        "existencia_logistik,existencia_apartada,existencia_disponible," +
                        "marca,modelo,estilo,color,persona,talla,color_base,habilitado_web,codigo_base) VALUES (" +
                        "'1', '1', '5', '1', '1'," +
                        " '0', '0', '0', '" + Trim(CVE_ART.ToString) + "', '0.000000', '0', '1', '" + COSTO_PROM.ToString + "', '4.950000', ''," +
                        "'0.000000', '0.00', 'demo_1', '', '', '0.000000', '0.000000', '0.000000', '0.000000', '2'," +
                        "'0', '0', '0', '0', '1', '404', '0', '1', '" + time.ToString("yyyy/MM/dd") + "', 'new'," +
                        " '1', '1', 'both', '0', '0', '0', '1', '" + time.ToString("yyyy/MM/dd") + "', '" + time.ToString("yyyy/MM/dd") + "', '0'," +
                        " '3','','" + UNI_MED.ToString + "','" + vgId_usurio.ToString + "','" + CVE_ART + "','" + CON_SERIE + "','" + CON_PEDIMENTO + "','" + EXIST.ToString + "','" + DESCR.ToString + "'," +
                        "'0','0','0'," +
                        "'0','0','0','0','0','0','0','0','0')"
                    End If



                    cmd = New SqlCommand(sqllocal, connx)
                    cmd.ExecuteNonQuery()
                    'EjecutarQuerySQL_EMPRESA(sqllocal)
                    'If R = True Then
                    'Dim vIDArticulo As String = TraerIDArtticulo(CVE_ART)
                    Dim vIDArticulo As String
                    Dim readerIDArt As SqlDataReader
                    sqllocal = "SELECT lp.id_product FROM Logistik_product lp WHERE lp.upc='" + CVE_ART.Trim + "'"
                    LabelTABLA.Text = "sae/P4/1 Logistik_product"
                    LabelQuery.Text = sqllocal
                    If connx.State = ConnectionState.Closed Then
                        connx.Open()
                    End If
                    cmd = New SqlCommand(sqllocal, connx)
                    readerIDArt = cmd.ExecuteReader()
                    While readerIDArt.Read()
                        vIDArticulo = readerIDArt.Item(0).ToString
                    End While
                    readerIDArt.Close()
                    If vIDArticulo <> "" Then
                        sqllocal = "insert into Logistik_product_lang(id_product, id_shop, id_lang, description, description_short" +
                                    ",link_rewrite, meta_description, meta_keywords, meta_title, name, available_now, available_later) VALUES (" +
                                    "'" + vIDArticulo + "','1','2','" + DESCR + "','short','1','2','3','4','5','6','7')"
                        cmd = New SqlCommand(sqllocal, connx)
                        cmd.ExecuteNonQuery()
                        ' EjecutarQuerySQL_EMPRESA(sqllocal)
                    End If

                    'End If

                Else
                    If vgNumEmpresa = "06" Then
                        If conn3.State = ConnectionState.Closed Then
                            conn3.Open()
                        End If
                        'sqllocal = "SELECT CAMPLIB11 FROM INVE_CLIB02 where CVE_PROD='" + CVE_ART.Trim() + "'"
                        'Dim readerINVE_CLIB As SqlDataReader
                        'cmd = New SqlCommand(sqllocal, conn3)
                        'readerINVE_CLIB = cmd.ExecuteReader()
                        'Dim CampLib42 As String = ""
                        'While readerINVE_CLIB.Read()
                        '    CampLib42 = ""
                        '    CampLib42 = readerINVE_CLIB.Item("CAMPLIB11").ToString
                        '    If CampLib42 = "74122001" Or CampLib42 = "39222001" Or CampLib42 = "83024106" Or CampLib42 = "73249091" Or CampLib42 = "49111099" Or CampLib42 = "39229099" Or CampLib42 = "74182001" Or CampLib42 = "84818002" Or CampLib42 = "84818021" Or CampLib42 = "69109001" Or CampLib42 = "84818099" Or CampLib42 = "83025001" Or CampLib42 = "39221001" Or CampLib42 = "84818004" Or CampLib42 = "84813001" Then
                        '        CampLib42 = "1"
                        '    Else
                        '        CampLib42 = "0"
                        '    End If
                        'End While
                        'readerINVE_CLIB.Close()
                        '///////////////////////////////////////////////////////////////////
                        'sqllocal = "SELECT CAMPLIB11 FROM INVE_CLIB02 where CVE_PROD='" + CVE_ART.Trim() + "'"
                        'Dim readerINVE_CLIB As SqlDataReader
                        'cmd = New SqlCommand(sqllocal, conn3)
                        'readerINVE_CLIB = cmd.ExecuteReader()
                        Dim CampLib42 As String = ""
                        'While readerINVE_CLIB.Read()
                        '    CampLib42 = ""
                        '    CampLib42 = readerINVE_CLIB.Item("CAMPLIB11").ToString
                        '    '////////////////////////////////////////////////////////////////////
                        '    sqllocal = "SELECT igi FROM Logistik_Fracccion_Arancelaria"
                        '    Dim readerIGI As SqlDataReader
                        '    If connx.State = ConnectionState.Closed Then
                        '        connx.Open()
                        '    End If
                        '    cmd = New SqlCommand(sqllocal, connx)
                        '    readerIGI = cmd.ExecuteReader()
                        '    Dim igi As String = ""
                        '    While readerIGI.Read()
                        '        igi = readerIGI.Item("igi").ToString
                        '        If CampLib42 = igi Then
                        '            CampLib42 = "1"
                        '            Exit While
                        '        Else
                        '            CampLib42 = "0"
                        '        End If
                        '    End While
                        '    readerIGI.Close()
                        '////////////////////////////////////////////////////////////////////
                        If CampLib42 = "74122001" Or CampLib42 = "39222001" Or CampLib42 = "83024106" Or CampLib42 = "73249091" Or CampLib42 = "49111099" Or CampLib42 = "39229099" Or CampLib42 = "74182001" Or CampLib42 = "84818002" Or CampLib42 = "84818021" Or CampLib42 = "69109001" Or CampLib42 = "84818099" Or CampLib42 = "83025001" Or CampLib42 = "39221001" Or CampLib42 = "84818004" Or CampLib42 = "84813001" Then
                            CampLib42 = "1"
                        Else
                            CampLib42 = "0"
                        End If
                        'End While
                        'readerINVE_CLIB.Close()
                        sqllocal = "update Logistik_product set Pedimento='" + CON_PEDIMENTO.ToString + "',CampLib42='" + CampLib42 + "'" +
                                    " where upc='" + CVE_ART.Trim + "'"
                        EjecutarQuerySQL_EMPRESA(sqllocal)
                    Else
                        sqllocal = "update Logistik_product set Pedimento='" + CON_PEDIMENTO.ToString + "'" +
                                    " where upc='" + CVE_ART.Trim + "'"
                        EjecutarQuerySQL_EMPRESA(sqllocal)
                    End If

                    'If vgNumEmpresa + "02" Then
                    '    sqllocal = "update Logistik_product set Pedimento='" + CON_PEDIMENTO.ToString + "'" + _
                    '               " where upc='" + CVE_ART.Trim + "'"
                    '    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    'End If
                End If
            Next
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Articulos: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            If connx.State = ConnectionState.Open Then
                connx.Close()
            End If
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Articulos: InCorrecta Articulo:" + CVE_ART.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            'MsgBox("error:" + ex.Message.ToString)
        Catch ex2 As SqlException
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Sincronizar Articulos: InCorrecta Articulo:" + CVE_ART.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            'MsgBox("error:" + ex2.Message.ToString)
        End Try
    End Sub
    Function TraerIDArtticulo6(ByVal partculo As String) As Integer
        'TRAER DATOS DEL ALMACEN
        '------------------------------------------------------------------------------------
        Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn7 As New SqlConnection(Str7)
        Dim sql As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Almacen'"
        Dim dataadapterBD As New SqlDataAdapter(sql, conn7)
        Dim dsCargarbd As New DataSet()
        dataadapterBD.Fill(dsCargarbd, "EmpresaSAE")
        Dim oTabla7 As DataTable
        oTabla7 = dsCargarbd.Tables("EmpresaSAE")
        Dim SERVIDOR As String = ""
        Dim USUARIO As String = ""
        Dim VTIPO As String = ""
        Dim PASSWROD As String = ""
        Dim BASEDATOS As String = ""
        'Dim VTIPO As String = ""
        If oTabla7.Rows.Count >= 1 Then
            Dim oFila As DataRow
            For Each oFila In oTabla7.Rows
                SERVIDOR = oFila.Item("SERVIDOR").ToString
                BASEDATOS = oFila.Item("BASEDATOS").ToString
                USUARIO = oFila.Item("USUARIO").ToString
                PASSWROD = oFila.Item("PASSWROD").ToString
                VTIPO = oFila.Item("TIPO").ToString
                'VTIPO = oFila.Item("TIPO").ToString
            Next
        Else
            VTIPO = ""
        End If
        '------------------------------------------------------------------------------------
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + BASEDATOS + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn As New SqlConnection(Str)
        Dim vcont As Integer = 0
        Dim SqlSelection As String = "Select id_product FROM Logistik_product WHERE ClaveSAE = '" + partculo + "'"
        Dim ds3 As New DataSet()

        Dim dataadapter3 As New SqlDataAdapter(SqlSelection, conn)
        Dim cnnx As New SqlConnection(My.Settings.ConexionLocal)
        If cnnx.State = ConnectionState.Closed Then
            cnnx.Open()
        End If
        dataadapter3.Fill(ds3, "Logistik_product")
        Dim oTabla3 As DataTable
        oTabla3 = ds3.Tables("Logistik_product")
        Dim oFila3 As DataRow
        If cnnx.State = ConnectionState.Open Then
            cnnx.Close()
        End If
        If oTabla3.Rows.Count >= 1 Then
            For Each oFila3 In oTabla3.Rows
                vcont = oFila3.Item("id_product").ToString
            Next
        End If
        Return vcont
    End Function
    Function TraerIDArtticulo(ByVal partculo As String) As Integer
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn As New SqlConnection(Str)
        Dim vcont As Integer = 0
        Dim SqlSelection As String = "Select id_product FROM Logistik_product WHERE trim(upc) = '" + partculo.Trim + "'"
        Dim ds3 As New DataSet()
        TextBox1.Text = "sae/P70.11" + Str
        Me.Refresh()
        Dim dataadapter3 As New SqlDataAdapter(SqlSelection, conn)
        Dim cnnx As New SqlConnection(My.Settings.ConexionLocal)
        If cnnx.State = ConnectionState.Closed Then
            cnnx.Open()
        End If
        dataadapter3.Fill(ds3, "Logistik_product")
        Dim oTabla3 As DataTable
        oTabla3 = ds3.Tables("Logistik_product")
        Dim oFila3 As DataRow
        If cnnx.State = ConnectionState.Open Then
            cnnx.Close()
        End If
        If oTabla3.Rows.Count >= 1 Then
            For Each oFila3 In oTabla3.Rows
                vcont = oFila3.Item("id_product").ToString
            Next
        End If
        TextBox1.Text = "sae/P70.111"
        Me.Refresh()
        Return vcont
    End Function
    Function VerificarSiExistePedimento2(ByVal pReg_LtPd As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.ToString + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT REG_LTPD FROM Logistik_enlace_LotePedimento WHERE REG_LTPD ='" + pReg_LtPd + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_enlace_LotePedimento")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_enlace_LotePedimento")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExistePedimento1(ByVal pReg_LtPd As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT REG_LTPD FROM Logistik_Lote_Pedimento WHERE REG_LTPD ='" + pReg_LtPd + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_Lote_Pedimento")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_Lote_Pedimento")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExisteNumSer2(ByVal pcve_art As String, ByVal pnum_ser As String, ByVal palmacen As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            'CVE_ART, NUM_SER, ALMACEN
            sqllocal = "SELECT CVE_ART FROM Logistik_Hnumeros_series" +
            " WHERE CVE_ART ='" + pcve_art + "'" +
            " and NUM_SER ='" + pnum_ser + "'" +
            " and ALMACEN ='" + palmacen + "'"

            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_Hnumeros_series")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_Hnumeros_series")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExisteNumSer1(ByVal pcve_art As String, ByVal pnum_ser As String, ByVal palmacen As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            'CVE_ART, NUM_SER, ALMACEN
            sqllocal = "SELECT CVE_ART, NUM_SER, STATUS, ALMACEN, COSTO ,DOCTO_ENT, FECHA_ENT FROM Logistik_numeros_series" +
            " WHERE CVE_ART ='" + pcve_art + "'" +
            " and NUM_SER ='" + pnum_ser + "'" +
            " and ALMACEN ='" + Trim(palmacen) + "'"

            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_numeros_series")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_numeros_series")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExisteListaPrecios(ByVal pcve_art As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CVE_PRECIO FROM Logistik_ListaPrecios WHERE CVE_PRECIO ='" + pcve_art + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_ListaPrecios")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_ListaPrecios")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExisteLPrecios_X_Product(ByVal pcve_art As String, ByVal pcve_Precio As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CVE_ART, CVE_PRECIO FROM Logistik_LPrecios_X_Product " +
            " WHERE CVE_ART ='" + pcve_art + "' and CVE_PRECIO = '" + pcve_Precio + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_LPrecios_X_Product")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_LPrecios_X_Product")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExisteArtClaveAlterna(ByVal pcve_art As String, ByVal pcve_art_alt As String) As Boolean
        Try
            'Logistik_product_Claves_Alter (CVE_ART, CVE_ALTER, TIPO CVE_CLPV) VALUES
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT CVE_ART FROM Logistik_product_Claves_Alter WHERE CVE_ART ='" + pcve_art + "' and CVE_ALTER = '" + pcve_art_alt + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_product_Claves_Alter")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_product_Claves_Alter")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            Return False
        End Try
    End Function
    Function VerificarSiExisteArticulos(ByVal pcve_art As String) As Boolean
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT ClaveSAE FROM Logistik_product WHERE upc ='" + pcve_art.Trim + "'"
            Dim dsCargarEncabezado As New DataSet()
            Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
            dataadapter.Fill(dsCargarEncabezado, "Logistik_product")
            Dim oTabla As DataTable
            oTabla = dsCargarEncabezado.Tables("Logistik_product")
            If oTabla.Rows.Count >= 1 Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Verificar existe Articulo: InCorrecta Articulo:" + pcve_art.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            Return False
        End Try
    End Function

    Private Sub TraspasosToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TraspasosToolStripMenuItem.Click
        'ReporteTraspasos.ShowDialog()
    End Sub

    Private Sub OrdenDeTraspsosToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles OrdenDeTraspsosToolStripMenuItem.Click
        Timer1.Enabled = False
        Timer3.Enabled = False
        'FrmTraspasos.ShowDialog()
    End Sub

    Private Sub AutorizaciónToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AutorizaciónToolStripMenuItem.Click
        'FrmAutorizacion.ShowDialog()
    End Sub

    'Private Sub Timer2_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer2.Tick
    '    'Dim procid As Integer
    '    'procid = Shell("Del C:\Windows\Prefetch\*.*", AppWinStyle.NormalFocus)
    '    'For Each foundFile As String In My.Computer.FileSystem.GetFiles(My.Computer.FileSystem.SpecialDirectories.MyMusic, FileIO.SearchOption.SearchAllSubDirectories, "*.*")
    '    '    My.Computer.FileSystem.DeleteFile(foundFile, FileIO.UIOption.AllDialogs, FileIO.RecycleOption.DeletePermanently)
    '    'Next
    '    'My.Computer.FileSystem.DeleteFile("C:\Windows\Prefetch\POLLO.TXT")
    '    Dim RUTA As String = "C:\Windows\Prefetch\"
    '    For Each Archivo As String In Directory.GetFiles(RUTA, "*.*")
    '        File.Delete(Archivo)
    '    Next
    '    Dim RUTA2 As String = "C:\Users\AAA2018\AppData\Local\"
    '    For Each Archivo As String In Directory.GetFiles(RUTA2, "*.*")
    '        File.Delete(Archivo)
    '    Next
    '    'Dim RUTA3 As String = "C:\Windows\TEMP\"
    '    'For Each Archivo As String In Directory.GetFiles(RUTA3, "*.*")
    '    '    File.Delete(Archivo)
    '    'Next
    '    If (System.IO.Directory.Exists("C:\Users\Public")) Then
    '        'System.IO.Directory.Delete("C:\Users\Public")
    '        Dim FolderNam As String = "C:\Users\Public"
    '        For Each Dir As String In System.IO.Directory.GetDirectories(FolderNam)
    '            Dim dirInfo As New System.IO.DirectoryInfo(Dir)
    '            For Each Archivo As String In Directory.GetFiles(Dir, "*.*")
    '                File.Delete(Archivo)
    '            Next
    '            If (System.IO.Directory.Exists(Dir)) Then
    '                System.IO.Directory.Delete(Dir)
    '            End If

    '        Next
    '    End If



    '    'Dim FolderName As String = "C:\Users\Admin2016\AppData\Local\Microsoft\Windows\Temporary Internet Files"
    '    'For Each Dir As String In System.IO.Directory.GetDirectories(FolderName)
    '    '    Dim dirInfo As New System.IO.DirectoryInfo(Dir)
    '    '    For Each Archivo As String In Directory.GetFiles(Dir, "*.*")
    '    '        File.Delete(Archivo)
    '    '    Next
    '    '    If (System.IO.Directory.Exists(Dir)) Then
    '    '        System.IO.Directory.Delete(Dir)
    '    '    End If

    '    'Next
    '    'Dim FolderName1 As String = "C:\Windows\Temp"
    '    'For Each Dir As String In System.IO.Directory.GetDirectories(FolderName1)
    '    '    Dim dirInfo As New System.IO.DirectoryInfo(Dir)
    '    '    For Each Archivo As String In Directory.GetFiles(Dir, "*.*")
    '    '        File.Delete(Archivo)
    '    '    Next
    '    '    If (System.IO.Directory.Exists(Dir)) Then
    '    '        System.IO.Directory.Delete(Dir)
    '    '    End If
    '    '    'ComboBox3.Items.Add(dirInfo.Name)
    '    'Next

    'End Sub


    Private Sub PedidosToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'FrmPedidos.ShowDialog()
    End Sub

    Private Sub Timer3_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer3.Tick
        'Dim cMin As Int32 = 5
        'cMin = cMin * vlMinitos
        Select Case Minuto2
            'Case 60
            '    Minuto = 0
            '    cMin = 0
            '    Call DatosSAE()
            Case Minuto2 = 10
                Label5.Text = ""
                Me.Refresh()
                Minuto2 = 0
                Timer3.Enabled = False
            Case Else
                Minuto2 = Minuto2 + 1
        End Select
    End Sub

    'Private Sub Timer4_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer4.Tick
    '    'TextHora.Text = Now.ToString("ss")
    '    TextHora.Text = vconttimer.ToString
    '    vconttimer = vconttimer + 1
    '    'Select Case vconttimer

    '    '    Case My.Settings.vgTime
    '    '        If vgTipoBD = "S" Then 'SQL SERVER
    '    '            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '    '            Dim conn As New SqlConnection(Str)

    '    '            Dim SqlCon As SqlConnection
    '    '            Try
    '    '                SqlCon = New SqlConnection(Str)
    '    '                SqlCon.Open()
    '    '            Catch ex As SqlException
    '    '                MsgBox("Se perdio la conexion con el servidor SQL SERVER, favor de verificar")
    '    '                Application.Exit()
    '    '            Finally
    '    '                SqlCon.Close()
    '    '            End Try

    '    '        Else

    '    '            Dim Str2 As String = My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2
    '    '            Dim connFB As New FbConnection(Str2)
    '    '            Try
    '    '                If connFB.State = ConnectionState.Closed Then
    '    '                    connFB.Open()
    '    '                End If
    '    '            Catch ex As Exception
    '    '                Timer1.Enabled = False
    '    '                'Timer2.Enabled = False
    '    '                'Timer3.Enabled = False
    '    '                Timer4.Enabled = False
    '    '                MsgBox("Se perdio la conexion con el servidor SAE, favor de verificar")
    '    '                Application.Exit()
    '    '            Finally
    '    '                connFB.Close()
    '    '            End Try
    '    '        End If
    '    '        MsgBox("SINCRONIZAR")
    '    '        'Sincronizar(sender, e)
    '    '    Case Else

    '    'End Select
    'End Sub

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        Try
            Label5.Text = "Actualizando, espere por favor.."
            'TxtSAE_Emp01.Text = ""
            'TxtSAE_Emp02.Text = ""
            'TxtSAE_Emp04.Text = ""
            'TxtSAE_Emp06.Text = ""
            Me.Refresh()
            vlSyncCompleta = 0
            DesactivarOCPed = False

            Sincronizar(sender, e)
        Catch ex As Exception
            Timer1.Enabled = False
            'Timer2.Enabled = False
            'Timer3.Enabled = False
            Timer4.Enabled = False
            MsgBox("verificar el error en pantalla, porque se cerra la aplicación")
            Application.Exit()
        End Try

    End Sub
    Private Sub Sincronizar(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'CAMPLIB42 debe llevar 0 o 1
        'emp01 vta   camlib34=gdl
        'emp02 comp
        'emp04 vta   camlib16=gdl
        'emp06 alm
        '1       pasillo    ----	alm-mex
        '984     pasillo	----	alm-gdl
        Label5.Text = "Sincronizando Informacion..."
        Me.Refresh()
        Try
            'VERIFICAR HORA
            Dim HORASALIDA As String = ""
            Dim horas As Integer
            Dim minutos As Integer
            Dim Str11 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn2 As New SqlConnection(Str11)
            Dim reader7 As SqlDataReader
            Dim sqllocal As String = "SELECT hora_apagado, horas, minutos FROM Logistik_Servidor_Status"
            TextBox1.Text = "Logistik_Servidor_Status"
            LabelQuery.Text = Str11
            Me.Refresh()
            cmd = New SqlCommand(sqllocal, conn2)
            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            reader7 = cmd.ExecuteReader()
            While reader7.Read()
                HORASALIDA = reader7.Item(0).ToString
                horas = reader7.Item(1)
                minutos = reader7.Item(2)
            End While
            If HORASALIDA = Nothing Then HORASALIDA = time
            If horas = Nothing Then horas = 1
            If minutos = Nothing Then minutos = 1
            reader7.Close()
            'Dim horaSystem As String = Now.ToString("hh:mm:ss")
            'If Convert.ToDateTime(horaSystem) >= Convert.ToDateTime(HORASALIDA) Then
            '    Me.Dispose()
            'End If
            Dim horasSys As Integer = Now.ToString("HH")
            Dim minutosSys As Integer = Now.ToString("mm")
            'If horas >= horasSys Then
            '    If minutos >= minutosSys Then
            '        Me.Dispose()
            '    End If
            'End If
            If horasSys >= horas Then
                If minutosSys >= minutos Then
                    Me.Dispose()
                End If
            End If
            Dim BUSINESS As String = ""
            Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + My.Settings.vgCrearBD_Name + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim connection7 As New SqlConnection(Str1)
            sqllocal = "SELECT CVE_EMPRESA,RUTA_EMPRESA,NOMBRE_EMPRESA,NOMBRE_BD,SERVIDOR,USUARIO,PASSWROD,TIPOBD,BASEDATOS,TIPO FROM EmpresaSAE"
            connection7.Open()
            vgControlSync = 1
            Dim daPC1 As New SqlDataAdapter(sqllocal, connection7)
            Dim dsPC1 As New DataSet
            daPC1.Fill(dsPC1, "EmpresaSAE")
            Dim oTablePC1 As New DataTable
            oTablePC1 = dsPC1.Tables("EmpresaSAE")
            Dim tipoemp As String
            For Each oRowPC7 In oTablePC1.Rows
                MI_BD = oRowPC7.Item("BASEDATOS").ToString
                ruta = oRowPC7.Item("NOMBRE_BD").ToString
                tipoemp = oRowPC7.Item("TIPO").ToString
                tipoemp = Trim(tipoemp)
                Dim texto As String = Trim(tipoemp)
                My.Settings.Ruta_SAE_FB = ruta
                My.Settings.Save()
                vgNumEmpresa = Mid(My.Settings.Ruta_SAE_FB, LongitudBD)
                vgEmpresa = My.Settings.Ruta_SAE_FB
                LabelEmpresa.Text = vgEmpresa
                LabelProcedimiento.Text = "Configuracion"
                Me.Refresh()
                Call ConfigTerminal(vgEmpresa, vgNumEmpresa)
                LabelProcedimiento.Text = "Traer Informacion"
                Me.Refresh()
                Call TraerDatosSAE(vgEmpresa, tipoemp)
                'pedidos con error
                ''Call PedidosEmp6Error(vgEmpresa, "               24825")
                '''''''''''''''''''''''''''''''''''
                If tipoemp = "Almacen" Then
                    LabelProcedimiento.Text = "Verificacion"
                    Me.Refresh()
                    Call verificacion(vgEmpresa)
                    LabelProcedimiento.Text = "Compras"
                    Me.Refresh()
                    Call LlevarOrdCompEmp6SAE(vgEmpresa)
                    'Call LlevarEntradas(vgEmpresa)
                    LabelProcedimiento.Text = "EmbarquesKardex"
                    Me.Refresh()
                    Call EmbarquesKardexNuevo(vgEmpresa)
                    ''LabelProcedimiento.Text = "Ubicaciones"
                    ''Call NuevosTraspasos(vgEmpresa)
                    ''Call LlevarUbicaciones(vgEmpresa)
                    ''LabelProcedimiento.Text = "Traspasos"
                    ''Call LlevarTraspasos(vgEmpresa)
                    ''pendientes 1 costo de recepcion
                    LabelProcedimiento.Text = "Ventas"
                    Label5.Text = "Sincronizando Ventas"
                    Me.Refresh()
                    Call LlevarPedidoEmp6SAE(vgEmpresa)
                    'reintentar hacer el pedido empresa 1 o empresa 4
                    'If vgNumEmpresa = "01" Or vgEmpresa = "04" Then
                    'Call RemisionesSAE_Error(vgEmpresa, vgNumEmpresa)
                    'End If
                    'LabelProcedimiento.Text = "Ventas Estatus 33"
                    'Call tablaLogistikLog(vgEmpresa)
                    'LabelProcedimiento.Text = "Pedidos cancelados 99"
                    Label5.Text = "Depurando Pedidos"
                    Me.Refresh()
                    Call PedidosCancelados(vgEmpresa)
                End If
                'If vgNumEmpresa = "01" Or vgNumEmpresa = "04" Then
                '    Call RemisionesSAE_Error(vgEmpresa, vgNumEmpresa)
                'End If
                BUSINESS = BUSINESS + vgEmpresa
            Next
            vlSyncCompleta = 0
            sqllocal = "UPDATE Logistik_Servidor_Status SET sincronizacion_completa=0"
            TextBox1.Text = "update Logistik_Servidor_Status"
            Me.Refresh()
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Label5.Text = "Sincronización finalizada"
            Call LlenarProveedores()
            Me.Refresh()

            Timer3.Enabled = True
            vconttimer = 1
            vgControlSync = 0
        Catch ex As Exception
            'MsgBox("error:" + ex.Message.ToString)
            vlSyncCompleta = 0
            sqllocal = "UPDATE Logistik_Servidor_Status SET sincronizacion_completa=0"
            TextBox1.Text = "update Logistik_Servidor_Status"
            Me.Refresh()
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Label5.Text = "Sincronización finalizada"
            Call LlenarProveedores()
            Me.Refresh()
            Timer3.Enabled = True
            vconttimer = 1
        End Try
    End Sub

    Private Sub PedidosCancelados(vgEmpresa As String)
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + vgEmpresa + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim connFB As New SqlConnection(Str2)
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaHoy = vFechaHoy.AddDays(-16) 'Resta días
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-31) 'Resta días
            sqllocal = "SELECT id_order, current_state, num_empresa" +
            " FROM Logistik_orders WHERE " +
            " date_add BETWEEN '" & Format(vFechaDiasAntes, "MM/dd/yyyy HH:mm:ss") & "' AND '" & Format(vFechaHoy, "MM/dd/yyyy HH:mm:ss") + "'" +
            " AND current_state<>'99' AND current_state<>'9'"

            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_orders")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_orders")
            Dim OrdenVenta As String
            If connFB.State = ConnectionState.Closed Then
                connFB.Open()
            End If
            Dim id_pedido As String = ""
            Dim num_empresa As String
            For Each oRowPC In oTablePC.Rows
                id_pedido = oRowPC.Item("id_order").ToString
                OrdenVenta = oRowPC.Item("id_order").ToString
                num_empresa = Trim(oRowPC.Item("num_empresa").ToString)
                Dim sql As String = "update Logistik_orders SET current_state='99'" +
                " WHERE TRIM(id_order) = '" + Trim(OrdenVenta) + "'  and num_empresa='" + num_empresa + "'"
                EjecutarQuerySQL_EMPRESA_X(sql, "LogistikMasterValvulerias06")
            Next
        Catch ex As Exception

        End Try
    End Sub

    Private Sub NuevosTraspasos(ByVal pMiBD As String)
        Label5.Text = "Sincronizacion de Traspasos del SQL al SAE"
        Me.Refresh()
        Dim OrdenVenta As String = ""
        Dim vAlm_orig As String = ""
        Dim vAlm_des As String = ""
        Dim vArt As String = ""
        Dim vEnviadoSAE As String = ""
        Dim num_pedido As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" +
                My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" +
                My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn2 As New SqlConnection(Str2)
            sqllocal = "SELECT id_order, Almacen_origen, Almacen_destino, Documento, EnviadaSAE, num_pedido, num_empresa" +
            " FROM Logistik_Traspasos WHERE EnviadaSAE='U' and current_state = '8' and verificacion=1"
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_Traspasos")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_Traspasos")
            Dim vDocumento As String = "0"
            For Each oRowPC In oTablePC.Rows
                OrdenVenta = oRowPC.Item("id_order").ToString
                ' especificar documento
                vDocumento = Trim(oRowPC.Item("Documento").ToString)
                vEnviadoSAE = Trim(oRowPC.Item("EnviadaSAE").ToString)
                'agregar ceros
                vDocumento = espacios(vDocumento, 20)
                vAlm_orig = oRowPC.Item("Almacen_origen").ToString
                vAlm_des = oRowPC.Item("Almacen_destino").ToString
                Dim vConsecSAE As String = oRowPC.Item("id_order").ToString
                Dim REFER As String = oRowPC.Item("id_order").ToString
                num_pedido = oRowPC.Item("num_pedido").ToString
                '///////////////////////////inicio verificaciones///////////////////////////////////////
                Dim embarque As String = ""
                Dim tarima As String = ""
                Dim id_product As String = ""
                If vConsecSAE > 0 Then
                    vConsecSAE = espacios(vConsecSAE, 20)

                    sqllocal = "select product_upc, product_quantity, quantity_input, quantity_output, product_id" +
                        " from Logistik_Traspasos_detail where id_order = '" + Trim(OrdenVenta.ToString) + "'"
                    Dim da As New SqlDataAdapter(sqllocal, conn)
                    Dim ds As New DataSet
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    da.Fill(ds, "Logistik_Traspasos_detail")
                    Dim oTable As New DataTable
                    oTable = ds.Tables("Logistik_Traspasos_detail")
                    Dim vCant As Double
                    Dim vCantPed As Double

                    '-------------------------------------------
                    If conn2.State = ConnectionState.Closed Then
                        conn2.Open()
                    End If
                    Dim vMovimiento As Integer = 0
                    Dim vEntrada As String = "B"
                    For Each oRow In oTable.Rows
                        vArt = oRow.Item("product_upc").ToString
                        'embarque = oRow.Item("embarque").ToString
                        'tarima = oRow.Item("tarima").ToString
                        id_product = oRow.Item("product_id").ToString
                        vCant = oRow.Item("product_quantity").ToString

                        Dim codAlmOrig As Boolean = False
                        Dim codAlmDest As Boolean = False
                        Dim cantNoPositiva As Boolean = False
                        If vCant > 0 Then
                            '/////// Cod o Alm Origen no Existe
                            sqllocal = "Select CVE_ART From MULT" + vgNumEmpresa.ToString + " Where CVE_ART ='" + vArt + "' And CVE_ALM =" + vAlm_orig
                            Dim readerCodALmOri As SqlDataReader
                            cmd = New SqlCommand(sqllocal, conn2)
                            readerCodALmOri = cmd.ExecuteReader()
                            While readerCodALmOri.Read()
                                Dim art As String = readerCodALmOri.Item(0).ToString
                                If Len(art) <= 0 Then
                                    codAlmOrig = True
                                End If
                            End While
                            readerCodALmOri.Close()
                            If codAlmOrig = True Then
                                empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                                documento = OrdenVenta.ToString
                                mensaje = "Cod o Alm Origen no Existen:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            End If
                            '////// Cod o Alm Destino no Existe
                            sqllocal = "Select CVE_ART From MULT" + vgNumEmpresa.ToString + " Where CVE_ART ='" + vArt + "' And CVE_ALM =" + vAlm_des
                            Dim readerCodALmDest As SqlDataReader
                            cmd = New SqlCommand(sqllocal, conn2)
                            readerCodALmDest = cmd.ExecuteReader()
                            While readerCodALmDest.Read()
                                Dim art As String = readerCodALmDest.Item(0).ToString
                                If Len(art) <= 0 Then
                                    codAlmDest = True
                                End If
                            End While
                            readerCodALmDest.Close()
                            If codAlmDest = True Then
                                empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                                documento = OrdenVenta.ToString
                                mensaje = "Cod o Alm Destino no Existe:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            End If
                        Else
                            '////////// Cant No es Postitva
                            '"Cant No es Postitva"
                            cantNoPositiva = True
                            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                            documento = OrdenVenta.ToString
                            mensaje = "Traspaso Cant No es Postitva del Producto:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        End If
                        If codAlmOrig <> True And codAlmDest <> True And cantNoPositiva <> True Then
                            'realizar proceso
                            Dim Querys(8) As String
                            sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE +1 WHERE ID_TABLA =32"
                            Querys(0) = sqllocal
                            sqllocal = "Update TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE +1  WHERE ID_TABLA =44"
                            Querys(1) = sqllocal
                            Dim CVE_CPTO As String = "58"
                            sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART,ALMACEN,NUM_MOV,CVE_CPTO,FECHA_DOCU" +
                            ",TIPO_DOC,REFER,CANT,CANT_COST,PRECIO,COSTO,REG_SERIE,UNI_VENTA,E_LTPD,EXIST_G" +
                            ",EXISTENCIA,TIPO_PROD,FACTOR_CON,FECHAELAB,CVE_FOLIO,SIGNO,COSTEADO,COSTO_PROM_INI,COSTO_PROM_FIN,COSTO_PROM_GRAL" +
                            ",DESDE_INVE,MOV_ENLAZADO) Select CVE_ART," + vAlm_orig +
                            ",(SELECT ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " WHERE ID_TABLA = 44),'" + CVE_CPTO +
                            "',GETDATE(),'M','" + REFER + "'," + vCant.ToString() + ",'0','0'" +
                            ",COSTO_PROM,'0',UNI_MED,'0',EXIST - " + vCant.ToString() +
                            ",(SELECT EXIST FROM MULT" + vgNumEmpresa.ToString + " WHERE CVE_ART = I.CVE_ART And CVE_ALM =" + vAlm_orig + ") - " + vCant.ToString() +
                            ",TIPO_ELE,'1',GETDATE()" +
                            ",(SELECT ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " WHERE ID_TABLA = 32)" +
                            ",-1,'S',COSTO_PROM,COSTO_PROM,COSTO_PROM,'S','0'" +
                            " From INVE" + vgNumEmpresa.ToString + " I Where CVE_ART ='" + vArt + "'"
                            Querys(2) = sqllocal
                            sqllocal = "UPDATE INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST +" + vCant.ToString() + ",VERSION_SINC = GETDATE() WHERE CVE_ART ='" + vArt + "'"
                            Querys(3) = sqllocal
                            sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST -" + vCant.ToString() + ",VERSION_SINC = GETDATE() WHERE CVE_ART ='" + vArt + "'" +
                            " AND CVE_ALM =" + vAlm_orig
                            Querys(4) = sqllocal
                            sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1 WHERE ID_TABLA =44 "
                            Querys(5) = sqllocal
                            '//////alm_destino
                            CVE_CPTO = "7"
                            sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART,ALMACEN,NUM_MOV,CVE_CPTO,FECHA_DOCU" +
                            ",TIPO_DOC,REFER,CANT,CANT_COST,PRECIO,COSTO,REG_SERIE,UNI_VENTA,E_LTPD,EXIST_G" +
                            ",EXISTENCIA,TIPO_PROD,FACTOR_CON,FECHAELAB,CVE_FOLIO,SIGNO,COSTEADO,COSTO_PROM_INI,COSTO_PROM_FIN,COSTO_PROM_GRAL" +
                            ",DESDE_INVE,MOV_ENLAZADO)	SELECT CVE_ART," + vAlm_des +
                            ",(SELECT ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " WHERE ID_TABLA = 44),'" +
                            CVE_CPTO + "',GETDATE(),'M','" + REFER + "'," + vCant.ToString() + ",'0','0',COSTO_PROM,'0',UNI_MED,'0',EXIST +" + vCant.ToString() +
                            ",(SELECT EXIST FROM MULT" + vgNumEmpresa.ToString + " WHERE CVE_ART = I.CVE_ART AND CVE_ALM = " + vAlm_des + ") +" + vCant.ToString() +
                            ",TIPO_ELE,'1',GETDATE()" +
                            ",(SELECT ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " WHERE ID_TABLA = 32)" +
                            ",1,'S',COSTO_PROM,COSTO_PROM,COSTO_PROM,'S'" +
                            ",(SELECT ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " WHERE ID_TABLA = 44) - 1" +
                            " FROM INVE" + vgNumEmpresa.ToString + " I WHERE CVE_ART ='" + vArt + "'"
                            Querys(6) = sqllocal
                            sqllocal = "UPDATE INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST +" + vCant.ToString() + ",VERSION_SINC = GETDATE() WHERE CVE_ART ='" + vArt + "'"
                            Querys(7) = sqllocal
                            sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST +" + vCant.ToString() + ",VERSION_SINC = GETDATE() WHERE CVE_ART ='" + vArt + "'" +
                            " AND CVE_ALM =" + vAlm_des
                            Querys(8) = sqllocal
                            Dim vBien As Integer = 0
                            Dim msg As String
                            Try
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                objTrans = conn2.BeginTransaction()
                                For i As Integer = 0 To 8 Step 1
                                    msg = Querys(i)
                                    cmd = New SqlCommand(Querys(i), conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                Next
                                objTrans.Commit()
                                vBien = 1
                            Catch ex As Exception
                                objTrans.Rollback()
                                vBien = 0
                            End Try
                            '//////afectar existencias logistik
                            If vBien = 1 Then
                                Dim dcant As Decimal
                                Dim verifExist As Boolean = FnExisteArticuloInv(vArt, vAlm_orig, tarima, embarque)
                                If verifExist = False Then
                                    sqllocal = "insert into vLogistik_Ubicaciones(ubicacion, tarima, caja, id_product, codigo_producto, cantidad, estado, procesado_sae, embarque) values ('" +
                                        vAlm_orig + "','" + tarima + "','','" + id_product + "','" + vArt + "','-" + vCant.ToString() + "','2','N','" + embarque + "')"
                                Else
                                    dcant = Module1.Inv_cant - vCant
                                    If vAlm_orig <> "" Then
                                        If dcant <> 0 Then
                                            sqllocal = "update vLogistik_Ubicaciones set cantidad = " + dcant.ToString() + ", cantidad_surtida = cantidad_surtida - " + vCant.ToString() +
                                                " where codigo_producto='" + vArt + "' and ubicacion='" + vAlm_orig +
                                                "' AND tarima='" + tarima + "' and embarque='" + embarque + "'"
                                        Else
                                            sqllocal = "DELETE FROM vLogistik_Ubicaciones WHERE codigo_producto='" + vArt + "' and ubicacion='" +
                                                vAlm_orig + "' AND tarima='" + tarima + "' and embarque='" + embarque + "'"
                                        End If
                                    End If
                                End If
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                sqllocal = "update Logistik_Traspasos SET EnviadaSAE = 'S', Doc_Salida ='" + vConsecSAE + "'" +
                                 " WHERE id_order = '" + OrdenVenta.Trim + "'"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                                empresa = "LogistikMasterValvulerias" + vgNumEmpresa
                                documento = OrdenVenta.ToString
                                If num_pedido = "" Then
                                    mensaje = "TRASPASO producto:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                                Else
                                    mensaje = "TRASPASO producto:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des + " Pedido:" + num_pedido
                                End If
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            End If

                        End If
                    Next
                End If
                '///////////////////////////fin verificaciones//////////////////////////////////////////
            Next
        Catch es As SqlException
            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
            documento = OrdenVenta.ToString
            If vEnviadoSAE = "O" Then
                mensaje = "Traspaso de Salida:  " + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            ElseIf vEnviadoSAE = "I" Then
                mensaje = "Traspaso de Entrada:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            End If
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                Me.Dispose()
                'MenuPrincipal.Dispose()
            End If
            Throw es
        Catch ex As Exception
            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
            documento = OrdenVenta.ToString
            If vEnviadoSAE = "O" Then
                mensaje = "Traspaso de Salida:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            ElseIf vEnviadoSAE = "I" Then
                mensaje = "Traspaso de Entrada:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            End If
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            Throw ex
        Finally

        End Try
    End Sub
    Private Function FnExisteArticuloInv(ByVal codigo As String, ByVal ubica As String, ByVal tarima As String, ByVal embarque As String) As Boolean
        Try
            Dim Sql1 As String = "Select cantidad from vLogistik_Ubicaciones" & " where codigo_producto = '" & codigo & "' and ubicacion='" & ubica & "' and tarima='" & tarima & "' and embarque ='" & embarque & "'"
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            '//Dim conn As New SqlConnection(Str)
            Using con As SqlConnection = New SqlConnection(Str)
                con.Open()
                Dim sqlcmd1 As SqlCommand = New SqlCommand(Sql1, con)
                Dim reader As SqlDataReader
                reader = sqlcmd1.ExecuteReader()

                While reader.Read()
                    Module1.Inv_cant = Convert.ToDecimal(reader("cantidad"))
                    Return True
                End While

                reader.Close()
                Module1.Inv_cant = 0
                Return False
            End Using

        Catch ex As Exception
            '//Toast.MakeText(Me, "Error: " & ex.Message.ToString(), ToastLength.Long).Show()
            Return False
        End Try
    End Function
    Private Sub tablaLogistikLog(ByVal pEMP06BD As String)
        TextBox1.Text = "P1"
        Me.Refresh()
        Dim CVE_DOC As String
        Dim CVE_PEDI As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pEMP06BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pEMP06BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim connFB As New SqlConnection(Str2)
            Dim BIEN As Integer = 0
            '15 DIAS
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-15) 'Resta días
            'DATE_ADD
            sqllocal = "SELECT *" +
            " FROM Logistik_orders WHERE EnviadaSAE = 'N' and current_state ='33' AND Tipo_Rem_Fact = 'R'" +
            " AND date_add BETWEEN '" & Format(vFechaDiasAntes, "MM/dd/yyyy") & "' AND '" & Format(vFechaHoy, "MM/dd/yyyy") & "'"
            TextBox1.Text = "TL_Log1"
            Me.Refresh()

            LabelTABLA.Text = "S Logistik_orders"

            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_orders")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_orders")
            Dim OrdenVenta As String
            If connFB.State = ConnectionState.Closed Then
                connFB.Open()
            End If
            Dim id_pedido As String = ""
            Dim num_empresa As String
            For Each oRowPC In oTablePC.Rows
                id_pedido = oRowPC.Item("id_order").ToString
                OrdenVenta = oRowPC.Item("id_order").ToString
                num_empresa = Trim(oRowPC.Item("num_empresa").ToString)

                empresa = num_empresa.ToString
                documento = id_pedido.ToString
                'Pedido XXXX, Empresa XX, Tiene productos duplicados
                mensaje = "Pedido:" + id_pedido.ToString + " Empresa:" + empresa.ToString + " Tiene productos duplicados"
                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','33')"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                TextBox1.Text = "P5"

                Me.Refresh()
            Next
        Catch ex As Exception

        End Try
    End Sub
    Function runProcedure(ByVal num_pedido As String, ByVal num_empresa As String, camplib34 As String) As Integer
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim Proc As String
        If UCase(camplib34) = "GDL" Then
            Proc = "ERRORES_GDL"
        Else
            Proc = "ERRORES"
        End If
        Dim objCommand As New SqlClient.SqlCommand(Proc), Conexion As String = Str
        LabelTABLA.Text = "Limpiar Logistik_Verificacion_Ventas_Temp"
        sqllocal = "DELETE FROM LogistikMasterValvulerias06.dbo.Logistik_Verificacion_Ventas_Temp"
        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
        LabelTABLA.Text = "Procedimiento Errores GDL"
        objCommand.CommandType = CommandType.StoredProcedure
        objCommand.Parameters.Add("@orden", SqlDbType.VarChar, 20)
        objCommand.Parameters("@orden").Value = num_pedido
        objCommand.Parameters.Add("@num_empresa", SqlDbType.Int)
        Dim num As Integer = num_empresa
        objCommand.Parameters("@num_empresa").Value = num
        objCommand.Connection = New SqlClient.SqlConnection(Conexion)
        objCommand.Connection.Open()
        objCommand.ExecuteNonQuery()

        'Dim objAdapter As New SqlDataAdapter(objCommand), objDataSet As New DataSet
        'objAdapter.Fill(objDataSet, “Tabla”)
        'objCommand.Connection.Close()
        'LabelTABLA.Text = "S Logistik_orders3777"
        'objCommand.ExecuteNonQuery()
        'LabelTABLA.Text = "S Logistik_orders4777"
        'Dim numreg As Integer = 0
        'numreg = objDataSet.Tables("Tabla").Rows.Count
        'Return numreg
        Return 1

    End Function
    Private Sub verificacion(ByVal pEMP06BD As String)
        LabelProcedimiento.Text = "Vericicación"
        Dim CVE_DOC As String = ""
        Dim CVE_PEDI As String = ""
        Dim camplib34 As String = ""
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pEMP06BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim connFB As New SqlConnection(Str2)
            Dim BIEN As Integer = 0
            '15 DIAS
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-15) 'Resta días
            sqllocal = "SELECT * FROM Logistik_orders WHERE EnviadaSAE = 'N' and current_state ='5' AND Tipo_Rem_Fact = 'R'" +
            " AND date_add BETWEEN '" & Format(vFechaDiasAntes, "MM/dd/yyyy HH:mm:ss") & "' AND '" & Format(vFechaHoy, "MM/dd/yyyy HH:mm:ss") & "'"
            'www3
            LabelTABLA.Text = "VS Logistik_orders"
            LabelQuery.Text = sqllocal
            TextBox1.Text = "v1"
            Me.Refresh()
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            'servicio streamin alternativo
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            LabelTABLA.Text = "S Logistik_orders8"
            daPC.Fill(dsPC, "Logistik_orders")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_orders")
            Dim OrdenVenta As String
            If connFB.State = ConnectionState.Closed Then
                connFB.Open()
            End If
            Dim id_pedido As String = ""
            Dim num_empresa As String
            LabelTABLA.Text = "S Logistik_orders9"
            For Each oRowPC In oTablePC.Rows
                RefVenta = ""
                id_pedido = oRowPC.Item("id_order").ToString
                OrdenVenta = oRowPC.Item("id_order").ToString
                num_empresa = oRowPC.Item("num_empresa").ToString
                camplib34 = oRowPC.Item("CampLib34").ToString
                '---------////////////////Verificacion////////////////----------
                LabelTABLA.Text = "vS Logistik_orders10"
                Label5.Text = id_pedido + "," + num_empresa
                Me.Refresh()
                sqllocal = "UPDATE Logistik_orders SET verificacion=8 where id_order ='" + id_pedido.ToString + "'"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                Dim numreg As Integer = runProcedure(id_pedido, num_empresa, camplib34)
                LabelTABLA.Text = "vS Logistik_orders11"
                Me.Refresh()
                '---------------------------------------------------------------------------
                If numreg >= 1 Then
                    'sqllocal = "SELECT @empresa as Empresa, @orden as Pedido, producto, cant_pedido, cant_sae_06_ao, alm_origen, 'Pedido Cancelado en SAE' as Error " +
                    '" FROM LogistikMasterValvulerias06.dbo.Logistik_Verificacion_Ventas_Temp " +
                    '" WHERE status = 'C' and id_orden = @orden"
                    Dim readerPedidoCanceladoSAE As SqlDataReader
                    sqllocal = "SELECT producto, cant_pedido, cant_sae_06_ao, alm_origen " +
                    " FROM Logistik_Verificacion_Ventas_Temp " +
                    " WHERE status = 'C' and id_orden ='" + id_pedido.ToString + "'"
                    LabelTABLA.Text = "VS Logistik_Verificacion_Ventas_Temp"
                    LabelQuery.Text = sqllocal
                    TextBox1.Text = "v2"
                    Me.Refresh()
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    cmd = New SqlCommand(sqllocal, conn)
                    readerPedidoCanceladoSAE = cmd.ExecuteReader()
                    Dim PedidoCancelado As Integer = 0
                    Dim empreX As String = ""
                    Dim vfproducto As String = ""
                    Dim vfcant_pedido As String = ""
                    Dim vfcant_sae_06_ao As String = ""
                    Dim vfcant_sae_06_ad As String = ""
                    Dim vfalm_origen As String = ""
                    Dim vid_WareHouse As String = ""
                    Dim VnameUbica As String = ""
                    'Pedido Cancelado en SAE' as Error " 
                    '------------------------------------------------------------------
                    While readerPedidoCanceladoSAE.Read()
                        vfproducto = readerPedidoCanceladoSAE.Item(0).ToString
                        vfcant_pedido = readerPedidoCanceladoSAE.Item(1).ToString
                        vfcant_sae_06_ao = readerPedidoCanceladoSAE.Item(2).ToString
                        vfalm_origen = readerPedidoCanceladoSAE.Item(3).ToString
                        If Len(vfproducto) > 1 Then
                            PedidoCancelado = 1
                            sqllocal = "UPDATE Logistik_orders SET verificacion=7 where id_order ='" + id_pedido.ToString + "'"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            'Pedido cancelado eb sae emp06
                            empresa = vgEmpresa.ToString
                            documento = id_pedido.ToString
                            mensaje = "Pedido Cancelado en SAE"
                            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','7')"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            TextBox1.Text = "v3"
                            Me.Refresh()
                            Exit While
                            'Else
                            '    If PedidoCancelado <> 1 Then
                            '        PedidoCancelado = 2
                            '        sqllocal = "UPDATE Logistik_orders SET verificacion=71 where id_order ='" + id_pedido.ToString + "'"
                            '        '0¿ (sqllocal, "LogistikMasterValvulerias06")
                            '    End If
                        End If
                    End While
                    readerPedidoCanceladoSAE.Close()
                    '-------------------------------------------------------
                    ' Obtiene los Productos del Pedido de SAE 6 Sin Existencia en almacen Origen 
                    'Select Case Case@empresa As Empresa, @orden As Pedido, producto, cant_pedido, cant_sae_06_ao, alm_origen, 'Existencia Insuficiente' as Error
                    'From LogistikMasterValvulerias06.dbo.Logistik_Verificacion_Ventas_Temp
                    'Where cant_sae_06_ao < cant_pedido And id_orden = @orden
                    Dim readerExistInsuf As SqlDataReader

                    'sqllocal = "Select  producto, cant_pedido, cant_sae_06_ao, alm_origen, 'Existencia Insuficiente' as Error" +
                    '" From Logistik_Verificacion_Ventas_Temp" +
                    '" Where cant_sae_06_ao < cant_pedido And id_orden ='" + id_pedido.ToString + "'"

                    sqllocal = "select VT.producto, VT.cant_pedido, VT.cant_sae_06_ao, VT.alm_origen, " +
                    " W.id_warehouse as Id_Ubicacion, W.name as Ubicacion," +
                    " Case WHEN '" + num_empresa + "' = '01' THEN 'SAE01' WHEN '" + num_empresa + "' = '04' THEN  'SAE04' End  As Pedido_de_Empresa,VT.cant_sae_06_ad" +
                    " From Logistik_Verificacion_Ventas_Temp VT" +
                    " Join Logistik_warehouse W ON VT.alm_origen = W.id_warehouse" +
                    " WHERE cant_sae_06_ad < cant_pedido And id_orden = '" + id_pedido.ToString + "'"
                    LabelTABLA.Text = "S Logistik_Verificacion_Ventas_Temp2"
                    LabelQuery.Text = sqllocal
                    TextBox1.Text = "v4"
                    Me.Refresh()
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    cmd = New SqlCommand(sqllocal, conn)
                    readerExistInsuf = cmd.ExecuteReader()
                    Dim PedidoExistInsuf As Integer = 0
                    vfproducto = ""
                    vfcant_pedido = ""
                    vfcant_sae_06_ao = ""
                    vfcant_sae_06_ad = ""
                    vfalm_origen = ""
                    vid_WareHouse = ""
                    VnameUbica = ""
                    empreX = ""
                    While readerExistInsuf.Read()
                        vfproducto = readerExistInsuf.Item(0).ToString
                        vfcant_pedido = readerExistInsuf.Item(1).ToString
                        vfcant_sae_06_ao = readerExistInsuf.Item(2).ToString
                        vfalm_origen = readerExistInsuf.Item(3).ToString
                        vid_WareHouse = readerExistInsuf.Item(4).ToString
                        VnameUbica = readerExistInsuf.Item(5).ToString
                        empreX = readerExistInsuf.Item(6).ToString
                        vfcant_sae_06_ad = readerExistInsuf.Item(7).ToString
                        If Len(vfproducto) > 1 Then
                            PedidoExistInsuf = 1
                            sqllocal = "UPDATE Logistik_orders SET verificacion=6 where id_order ='" + id_pedido.ToString + "'"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            empresa = vgEmpresa.ToString
                            documento = id_pedido.ToString
                            'mensaje = "Pedido " + empreX + ", " + vfproducto.ToString + ", Cant. Pedido::" + vfcant_pedido.ToString + ", Cant. SAE06 Ubic." + vid_WareHouse + "/" + VnameUbica + ":: " + vfcant_sae_06_ao

                            ' en sae 1 es el 104 almacen en GDL
                            ' en sae 4 es el 104 almacen en GDL
                            ' en sae 6 es el 984 almacen en GDL
                            If UCase(camplib34) = "GDL" Then
                                mensaje = "Pedido SAE06 " + vfproducto.ToString + ", Cant. Pedido::" + vfcant_pedido.ToString + ", Cant. SAE06 Almacen GDL 984 :" + vfcant_sae_06_ad
                            Else
                                mensaje = "Pedido SAE06 " + vfproducto.ToString + ", Cant. Pedido::" + vfcant_pedido.ToString + ", Cant. SAE06 Almacen 1 :" + vfcant_sae_06_ad
                            End If

                            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','7')"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                TextBox1.Text = "v5"
                                Me.Refresh()
                                'Else
                                '    If PedidoExistInsuf <> 1 Then
                                '        PedidoExistInsuf = 2
                                '        sqllocal = "UPDATE Logistik_orders SET verificacion=61 where id_order ='" + id_pedido.ToString + "'"
                                '        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                '    End If
                            End If
                    End While
                    readerExistInsuf.Close()
                    '---------------------------------------------------------------------------
                    '/* Obtiene los Productos del Pedido de SAE 6 con Negativo en almacen Destino */
                    ' Select Case Case@empresa as Empresa, @orden as Pedido, producto, cant_pedido, cant_sae_06_ad, alm_origen, 'Almacen 1 en Negativo' as Error
                    'From LogistikMasterValvulerias06.dbo.Logistik_Verificacion_Ventas_Temp
                    'Where cant_sae_06_ad < 0 And id_orden = @orden
                    Dim readerAlmDestNegativo As SqlDataReader
                    sqllocal = "Select producto, cant_pedido, cant_sae_06_ad, alm_origen, 'Almacen 1 en Negativo' as Error," +
                    "Case WHEN '" + num_empresa + "' = '01' THEN 'SAE01' WHEN '" + num_empresa + "' = '04' THEN  'SAE04' End  As Pedido_de_Empresa" +
                    " From LogistikMasterValvulerias06.dbo.Logistik_Verificacion_Ventas_Temp  " +
                    " Where cant_sae_06_ad < 0 And id_orden ='" + id_pedido.ToString + "'"
                    LabelTABLA.Text = "S Logistik_Verificacion_Ventas_Temp3"
                    LabelQuery.Text = sqllocal
                    TextBox1.Text = "v6"
                    Me.Refresh()
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    cmd = New SqlCommand(sqllocal, conn)
                    readerAlmDestNegativo = cmd.ExecuteReader()
                    Dim PedidoAlmDestNegativo As Integer = 0
                    vfproducto = ""
                    vfcant_pedido = ""
                    vfcant_sae_06_ao = ""
                    vfalm_origen = ""
                    empreX = ""
                    While readerAlmDestNegativo.Read()
                        vfproducto = readerAlmDestNegativo.Item(0).ToString
                        vfcant_pedido = readerAlmDestNegativo.Item(1).ToString
                        vfcant_sae_06_ao = readerAlmDestNegativo.Item(2).ToString
                        vfalm_origen = readerAlmDestNegativo.Item(3).ToString
                        empreX = readerAlmDestNegativo.Item(5).ToString
                        If Len(vfproducto) > 1 Then
                            PedidoAlmDestNegativo = 1
                            sqllocal = "UPDATE Logistik_orders SET verificacion=5 where id_order ='" + id_pedido.ToString + "'"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            empresa = vgEmpresa.ToString
                            documento = id_pedido.ToString
                            mensaje = "Pedido  " + empreX + ", " + vfproducto.ToString + ", Cant. Pedido::" + vfcant_pedido.ToString + ", Cant. SAE06 Ubic 1 / Pasillo ::" + vfcant_sae_06_ao + ""
                            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','7')"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            TextBox1.Text = "v7"
                            Me.Refresh()
                            'Else
                            '    If PedidoAlmDestNegativo <> 1 Then
                            '        PedidoAlmDestNegativo = 2
                            '        sqllocal = "UPDATE Logistik_orders SET verificacion=51 where id_order ='" + id_pedido.ToString + "'"
                            '        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            '    End If
                        End If
                    End While
                    readerAlmDestNegativo.Close()
                    '-----------------------------------------------
                    'Dim PedidoExistInsuf01 As String
                    'Dim PedidoExistInsuf04 As String
                    Dim PedidoExistInsuf0x As Integer = 0
                    If num_empresa = "01" Or num_empresa = "04" Then
                        '/* Obtiene los Productos del Pedido de SAE 1 con Existencia Insuficiente */
                        '/* CUANDO PEDIDO DE EMPRESA 01 */
                        'Select Case Case@empresa As Empresa, @orden As Pedido, producto, cant_pedido, cant_sae_01, 'Existencia Insuficiente' as Error
                        'From LogistikMasterValvulerias06.dbo.Logistik_Verificacion_Ventas_Temp
                        'Where cant_sae_01 < cant_pedido And id_orden = @orden
                        Dim readerExistInsuf01 As SqlDataReader
                        'sqllocal = "Select producto, cant_pedido, cant_sae_01, 'Existencia Insuficiente' as Error " +
                        '" From Logistik_Verificacion_Ventas_Temp" +
                        '" Where cant_sae_01 < cant_pedido And id_orden ='" + id_pedido.ToString + "'"

                        'SELECT CASE WHEN @empresa = 1 THEN 'SAE01' WHEN @empresa = 4 THEN ' SAE04' END  as Pedido_de_Empresa,
                        '@orden as Num_Pedido, producto as Producto,
                        'cant_pedido as Cant_en_Pedido,
                        'CASE WHEN @empresa = 1 THEN cant_sae_01  WHEN @empresa = 4 THEN cant_sae_04 END  as Cant_SAE
                        'FROM(LogistikMasterValvulerias06.dbo.Logistik_Verificacion_Ventas_Temp)
                        'WHERE (cant_sae_01 < cant_pedido and id_orden = @orden and @empresa = 1) or (cant_sae_04 < cant_pedido and id_orden = @orden and @empresa = 4)

                        sqllocal = "Select Case WHEN '" + num_empresa + "' = '01' THEN 'SAE01' WHEN '" + num_empresa + "' = '04' THEN  'SAE04' End  As Pedido_de_Empresa," +
                        " producto as Producto,cant_pedido," +
                        " CASE WHEN '" + num_empresa + "' = '01' THEN cant_sae_01  WHEN '" + num_empresa + "' = '04' THEN cant_sae_04 END  as Cant_SAE" +
                        " From Logistik_Verificacion_Ventas_Temp" +
                        " WHERE (cant_sae_01 < cant_pedido And id_orden ='" + id_pedido.ToString + "' and '" + num_empresa + "' = '01') or " +
                        "(cant_sae_04 < cant_pedido and id_orden = '" + id_pedido.ToString + "' and '" + num_empresa + "' = '04')"
                        LabelTABLA.Text = "S Logistik_Verificacion_Ventas_Temp5"
                        LabelQuery.Text = sqllocal
                        TextBox1.Text = "v8"
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, conn)
                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        readerExistInsuf01 = cmd.ExecuteReader()
                        vfproducto = ""
                        vfcant_pedido = ""
                        vfcant_sae_06_ao = ""
                        vfalm_origen = ""
                        vid_WareHouse = ""
                        VnameUbica = ""
                        empreX = ""
                        While readerExistInsuf01.Read()
                            empreX = readerExistInsuf01.Item(0).ToString()
                            vfproducto = readerExistInsuf01.Item(1).ToString
                            vfcant_pedido = readerExistInsuf01.Item(2).ToString
                            vfcant_sae_06_ao = readerExistInsuf01.Item(3).ToString
                            If Len(vfproducto) > 1 Then
                                PedidoExistInsuf0x = 1
                                sqllocal = "UPDATE Logistik_orders SET verificacion=4 where id_order ='" + id_pedido.ToString + "'"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                empresa = vgEmpresa.ToString
                                documento = id_pedido.ToString
                                mensaje = "Pedido " + empreX + ", " + vfproducto.ToString + ", Cant. Pedido::" + vfcant_pedido.ToString + ", Cant. " + empreX + " Ubic. 1 / Almacen 1::" + vfcant_sae_06_ao + ""
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','7')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                Me.Refresh()
                                TextBox1.Text = "v9"
                                Me.Refresh()
                            End If
                        End While
                        readerExistInsuf01.Close()
                    End If
                    '-------------------------------------existen los productos en sae6
                    If PedidoCancelado = 0 And PedidoExistInsuf = 0 And PedidoAlmDestNegativo = 0 And PedidoExistInsuf0x = 0 Then
                        '71 PedidoAlmDestNegativo cancelado
                        '61 Existencia insuficiente emp06
                        '51 Almacen 1 en Negativo emp06
                        '41 Existencia Insuficiente emp01
                        '31 Existencia Insuficiente emp04
                        'Dim readerCorrect As SqlDataReader
                        'sqllocal = "Select producto From Logistik_Verificacion_Ventas_Temp"
                        'LabelTABLA.Text = "S Logistik_Verificacion_Ventas_Temp777"
                        'LabelQuery.Text = sqllocal
                        'cmd = New SqlCommand(sqllocal, conn)
                        'If conn.State = ConnectionState.Closed Then
                        '    conn.Open()
                        'End If
                        'readerCorrect = cmd.ExecuteReader()
                        'Dim num As Integer = 0
                        'While readerCorrect.Read()
                        '    vfproducto = readerCorrect.Item(0).ToString
                        '    If Len(vfproducto) >= 1 Then
                        '        num = 1
                        '        Exit While
                        '    End If
                        'End While
                        'If num = 0 Then
                        sqllocal = "UPDATE Logistik_orders Set verificacion=1 where id_order ='" + id_pedido.ToString + "'"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        sqllocal = "UPDATE Logistik_Traspasos SET verificacion=1 where num_pedido ='" + id_pedido.ToString + "'"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        TextBox1.Text = "v10"
                        Me.Refresh()
                        'End If
                    End If
                End If
            Next
            '------------------------------------------------------------------------------------------
            'Catch es As FbException
            '    empresa = vgEmpresa.ToString
            '    documento = CVE_DOC.ToString
            '    mensaje = "Sincronizar Remision: InCorrecta Remision:" + CVE_DOC.ToString
            '    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" + _
            '    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            '    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            '    Me.Refresh()
            '    objTrans.Rollback()
            '    If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
            '        Me.Dispose()
            '        'FrmLogin.Dispose()
            '    End If
            '    Throw es
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            If connFB.State = ConnectionState.Open Then
                connFB.Close()
            End If
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Sincronizar Remision: InCorrecta Remision:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            TextBox1.Text = "v11"
            Me.Refresh()
            'objTrans.Rollback()
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Sincronizar Remision: InCorrecta Remision:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            TextBox1.Text = "v12"
            Me.Refresh()
            'objTrans.Rollback()
        End Try
    End Sub
    Private Sub EmbarquesKardexNuevo(ByVal pEMP06BD As String)
        Label5.Text = "Sincronizar Embarques y kardex al SAE parte 1"
        Me.Refresh()
        'CONEXION BASICA LOGISTIK_ALMACEN
        'agregar a los querys el estado_inicial=0 y estado_final=1
        'en la tabla INVE02 VERIFICAR EL COSTO_PROMEDIO = QUE NO SEA DOLARES 
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim connkardex As New SqlConnection(Str)
        sqllocal = "select vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino" +
                    " FROM vLogistik_Kardex, vLogistik_Embarques WHERE vLogistik_Kardex.embarque= vLogistik_Embarques.embarque" +
                    " and vLogistik_Embarques.enviado_sae='N'and vLogistik_Embarques.estado=3" +
                    " and trim(vLogistik_Kardex.estado_inicial)='0' and trim(vLogistik_Kardex.estado_final)='1' " +
                    " group by vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino"
        Dim daPC As New SqlDataAdapter(sqllocal, connkardex)
        Dim dsPC As New DataSet
        daPC.Fill(dsPC, "vLogistik_Embarques")
        Dim oTablePC As New DataTable
        oTablePC = dsPC.Tables("vLogistik_Embarques")
        Dim EmpresaDest As String
        Dim id_pedido As String = ""
        Dim num_empresa As String
        Dim nemp As String = oTablePC.Rows.Count
        For Each oRowPC In oTablePC.Rows
            id_pedido = oRowPC.Item("embarque").ToString
            EmpresaDest = Trim(oRowPC.Item("empresa_destino").ToString)
            If EmpresaDest = "" Then
                'no hace nada
            Else
                Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'S', estado = '6'" +
                                    " WHERE embarque = '" + Trim(id_pedido) + "'"
                EjecutarQuerySQL_EMPRESA6(sql1)
                If EmpresaDest = "02" Or EmpresaDest = "2" Then
                    'no hace nada
                Else
                    Call RemisionesComprasaVentas(pEMP06BD, EmpresaDest, id_pedido)
                End If

            End If

        Next
    End Sub

    Private Sub RemisionesComprasaVentas(ByVal pEMP06BD As String, ByVal EMPRESA_DEST As String, id_pedido As String)
        Dim CVE_DOC As String
        Dim RFC_DEST As String
        'Dim EMPRESA_DEST As String
        Label5.Text = "Sincronizando Embarques y Kardex del SQL al SAE parte 1"
        'TextErrorEmp2.Text = "prueba 2 recepcion emp1o4"
        Me.Refresh()
        Try
            Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn7 As New SqlConnection(Str7)
            Dim sql As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Compra'"
            Dim dataadapterBD As New SqlDataAdapter(sql, conn7)
            Dim dsCargarbd As New DataSet()
            dataadapterBD.Fill(dsCargarbd, "EmpresaSAE")
            Dim oTabla7 As DataTable
            oTabla7 = dsCargarbd.Tables("EmpresaSAE")
            Dim SERVIDOR As String = ""
            Dim USUARIO As String = ""
            Dim NOMBRE_BD As String = ""
            Dim PASSWROD As String = ""
            Dim BASEDATOS As String = ""
            'Dim VTIPO As String = ""
            If oTabla7.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla7.Rows
                    SERVIDOR = oFila.Item("SERVIDOR").ToString
                    BASEDATOS = oFila.Item("BASEDATOS").ToString
                    USUARIO = oFila.Item("USUARIO").ToString
                    PASSWROD = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness = Mid(NOMBRE_BD, LongitudBD)
            'TextErrorEmp2.Text = "RemisionesComprasaVentas... numBD" + nnBisness
            'CONEXION BASICA LOGISTIK_ALMACEN
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim conn As New SqlConnection(Str)
            'CONEXION COMPRAS
            'TextErrorEmp2.Text = "RemisionesComprasaVentas... numBD" + nnBisness + NOMBRE_BD
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim connFB As New SqlConnection(Str2)
            Dim Strnew As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias" + nnBisness.ToString + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim connNew As New SqlConnection(Strnew)

            Dim BIEN As Integer = 0
            sqllocal = "select vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino" +
                    " FROM vLogistik_Kardex, vLogistik_Embarques WHERE vLogistik_Kardex.embarque= vLogistik_Embarques.embarque" +
                    " and trim(vLogistik_Kardex.empresa_destino)='" + EMPRESA_DEST.Trim + "'" +
                    " and trim(vLogistik_Kardex.estado_inicial)='0' and trim(vLogistik_Kardex.estado_final)='1' " +
                    " and trim(vLogistik_Kardex.embarque)='" + id_pedido.Trim + "'" +
                    " group by vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino"

            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            'TextErrorEmp2.Text = "RemisionesComprasaVentas... numBD" + nnBisness + NOMBRE_BD + "Antes llenar Embarque"
            'TextErrorEmp2.Text = "prueba 3 recepcion emp1o4"
            daPC.Fill(dsPC, "vLogistik_Embarques")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("vLogistik_Embarques")
            Dim OrdenVenta As String
            If connFB.State = ConnectionState.Closed Then
                connFB.Open()
            End If
            'Dim id_pedido As String = ""
            Dim num_empresa As String
            For Each oRowPC In oTablePC.Rows
                id_pedido = oRowPC.Item("embarque").ToString
                OrdenVenta = oRowPC.Item("embarque").ToString
                'num_empresa = oRowPC.Item("num_empresa").ToString
                'agregar ceros
                'OrdenVenta = ceros(OrdenVenta, 10)
                'agregar espacios
                OrdenVenta = espacios(OrdenVenta, 20)
                RFC_DEST = oRowPC.Item("rfc_destino").ToString
                EMPRESA_DEST = oRowPC.Item("empresa_destino").ToString
                Dim TIP_DOC As String
                Dim CVE_CLPV As String
                Dim STATUS As String
                Dim DAT_MOSTR As String
                Dim CVE_VEND As String
                Dim CVE_PEDI As String = "1"
                Dim FECHA_DOC As String
                Dim FECHA_ENT As String
                Dim FECHA_VEN As String
                Dim FECHA_CANCELA As String
                Dim CAN_TOT As String
                Dim IMP_TOT1 As String
                Dim IMP_TOT2 As String
                Dim IMP_TOT3 As String
                Dim IMP_TOT4 As String
                Dim DES_TOT As String
                Dim DES_FIN As String
                Dim COM_TOT As String
                Dim CONDICION As String
                Dim CVE_OBS As String
                Dim NUM_ALMA As String
                Dim ACT_CXC As String
                Dim ACT_COI As String
                Dim ENLAZADO As String
                Dim TIP_DOC_E As String
                Dim NUM_MONED As String
                Dim TIPCAMB As String
                Dim NUM_PAGOS As String
                Dim FECHAELAB As String
                Dim PRIMERPAGO As String
                Dim RFC As String
                Dim CTLPOL As String
                Dim ESCFD As String
                Dim AUTORIZA As String
                Dim SERIE As String
                Dim FOLIO As String
                Dim AUTOANIO As String
                Dim DAT_ENVIO As String
                Dim CONTADO As String
                Dim CVE_BITA As String
                Dim BLOQ As String
                Dim FORMAENVIO As String
                Dim DES_FIN_PORC As String
                Dim DES_TOT_PORC As String
                Dim IMPORTE As String
                Dim COM_TOT_PORC As String
                Dim METODODEPAGO As String
                Dim NUMCTAPAGO As String
                Dim TIP_DOC_ANT As String
                Dim DOC_ANT As String
                Dim TIP_DOC_SIG As String
                Dim DOC_SIG As String
                Dim vCveDoc As String = ""

                TIP_DOC = "R"
                'SigCveDoc = TraerCveDocSigRecep()
                'CVE_DOC = SigCveDoc
                CVE_DOC = oRowPC.Item("embarque").ToString

                RFC = oRowPC.Item("rfc_destino").ToString
                CVE_CLPV = "0"
                STATUS = "O"
                DAT_MOSTR = "0"
                CVE_VEND = "1"
                CVE_PEDI = "0"

                'vfechayhora = oRowPC.Item("date_add").ToString
                FECHA_DOC = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_DOC <> "" Then
                '    FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_ENT = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_ENT <> "" Then
                '    FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_VEN = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_VEN <> "" Then
                '    FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_CANCELA = vfechayhora.ToString("yyyy/MM/dd")
                'subtotal = total_paid
                'total = total_paid_real

                'CAN_TOT = oRowPC.Item("total_paid_real").ToString
                CAN_TOT = "0"
                IMP_TOT1 = "0"
                IMP_TOT2 = "0"
                IMP_TOT3 = "0"
                'Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
                'IMP_TOT4 = iva.ToString
                IMP_TOT4 = "0"
                DES_TOT = "0"
                DES_FIN = "0"
                COM_TOT = "0"
                CONDICION = ""
                CVE_OBS = ""
                NUM_ALMA = "1"
                ACT_CXC = "S"
                ACT_COI = "N"
                ENLAZADO = "O"
                TIP_DOC_E = "O"
                NUM_MONED = "1"
                TIPCAMB = "1"
                NUM_PAGOS = "1"
                FECHAELAB = Date.Now
                If FECHAELAB <> "" Then
                    'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
                    'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
                    FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                End If
                PRIMERPAGO = "0"
                'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)

                Dim SqlA As String = "SELECT CLAVE FROM CLIE" + nnBisness.ToString +
                " WHERE  RFC = '" + Trim(RFC) + "'"
                Dim da7 As New SqlDataAdapter(SqlA, connFB)
                Dim ds7 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                da7.Fill(ds7, "CLIENTE" + nnBisness.ToString)
                Dim oTable As New DataTable
                oTable = ds7.Tables("CLIENTE" + nnBisness.ToString)
                If connFB.State = ConnectionState.Open Then
                    connFB.Close()
                End If

                If oTable.Rows.Count >= 1 Then
                    For Each oRow55 In oTable.Rows
                        CVE_CLPV = oRow55.Item("CLAVE").ToString
                    Next
                End If
                If Trim(CVE_CLPV) <> "MOSTR" Then
                    CVE_CLPV = espacios(CVE_CLPV, 10)
                End If
                CTLPOL = "0"
                ESCFD = "N"
                AUTORIZA = "1"
                SERIE = ""
                FOLIO = Nothing
                SqlA = "Select MASCARA FROM PARAM_FOLIOSF" + nnBisness.ToString +
                    " WHERE TIPODOCTO = 'R'"
                Dim da77 As New SqlDataAdapter(SqlA, connFB)
                Dim ds77 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                da77.Fill(ds77, "PARAM_FOLIOSF" + nnBisness.ToString)
                Dim oTable77 As New DataTable
                oTable77 = ds77.Tables("PARAM_FOLIOSF" + nnBisness.ToString)
                If connFB.State = ConnectionState.Open Then
                    connFB.Close()
                End If

                If oTable77.Rows.Count >= 1 Then
                    For Each oRow77 In oTable77.Rows
                        FOLIO = oRow77.Item("MASCARA").ToString
                    Next
                End If
                If FOLIO = "" Then
                    MsgBox("Configure la mascara de la clave del documento")
                    Exit Sub
                End If
                AUTOANIO = ""
                DAT_ENVIO = "0"
                CONTADO = "N"
                CVE_BITA = "2"
                BLOQ = "N"
                FORMAENVIO = ""
                'descuentos
                DES_FIN_PORC = "0"
                DES_TOT_PORC = "0"
                'IMPORTE = oRowPC.Item("total_paid").ToString
                IMPORTE = "0"
                COM_TOT_PORC = "0"
                METODODEPAGO = ""
                NUMCTAPAGO = ""
                TIP_DOC_ANT = ""
                DOC_ANT = ""
                TIP_DOC_SIG = Nothing
                DOC_SIG = Nothing
                'vCveDoc = BuscarClaveDoc()
                '----------------buscar clave del documento
                Dim vcont As String = ""
                Dim vnum As Integer
                SqlA = "SELECT ULT_DOC FROM FOLIOSF" + nnBisness.ToString +
                " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + nnBisness.ToString + " WHERE TIP_DOC='R')"
                Dim da55 As New SqlDataAdapter(SqlA, connFB)
                Dim ds55 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                'TextErrorEmp2.Text = "prueba 5 recepcion emp1o4"
                da55.Fill(ds55, "FOLIOSF" + nnBisness.ToString)
                Dim oTable55 As New DataTable
                oTable55 = ds55.Tables("FOLIOSF" + nnBisness.ToString)
                'If connFB.State = ConnectionState.Open Then
                '    connFB.Close()
                'End If

                If oTable55.Rows.Count >= 1 Then
                    For Each oRow55 In oTable55.Rows
                        vcont = oRow55.Item("ULT_DOC").ToString
                        If vcont = "" Or vcont = "0" Then vcont = "1"
                        'Convertir a numero y 'aumentar mas uno
                        vcont = Val(vcont) + 1
                        'agregar(ceros)
                        'vcont = ceros(vcont, 10)
                        'agregar espacios
                        vcont = espacios(vcont, 20)
                        'regresar valor
                        'Me.TextBox1.Text = vcont
                        vCveDoc = vcont
                    Next
                End If
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                '---------------------------------------
                objTransEmbarques = connFB.BeginTransaction()
                '--------------------------------------
                If vCveDoc <> "" Then
                    'DOC_ANT = ceros(DOC_ANT, 10)
                    DOC_ANT = espacios(DOC_ANT, 20)
                    Dim vUUID = Guid.NewGuid.ToString()
                    vUUID = UCase(vUUID)
                    'BITA1()
                    'TRAER CLAVE BITA
                    ''------------------------------------------------
                    Dim readerBita As SqlDataReader
                    Dim vBita As String
                    sqllocal = "Select isnull(max(CVE_BITA),1) AS num FROM BITA" + nnBisness.ToString
                    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    readerBita = cmd.ExecuteReader()
                    While readerBita.Read()
                        vBita = readerBita.Item(0).ToString
                        CVE_BITA = Val(vBita) + 1
                    End While
                    readerBita.Close()

                    sqllocal = "insert into FACTR" + nnBisness.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                    ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                    ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                    ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                    ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                    ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                    ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                    ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                    ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                    ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                    ",DOC_ANT,TIP_DOC_SIG,DOC_SIG,UUID) values (" +
                    "'R','" + vCveDoc + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" +
                    CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" +
                    FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" +
                    IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" +
                    CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" +
                    "O','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                    PRIMERPAGO + "','" + RFC.Trim + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" +
                    SERIE + "','" + vCveDoc + "','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" +
                    CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" +
                    IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" +
                    DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "','" + vUUID + "')"
                    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    cmd.ExecuteNonQuery()

                    sqllocal = "insert into FACTR_CLIB" + nnBisness.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    cmd.ExecuteNonQuery()
                    'BITA2()
                    ''INSERT TABLA BITA
                    'sqllocal = "INSERT INTO BITA" + nnBisness.ToString + _
                    '"(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" + _
                    '" VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + IMPORTE.ToString + "', 'F', 'Administrador')"
                    'cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    'cmd.ExecuteNonQuery()

                    sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    cmd.ExecuteNonQuery()

                    sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 62"
                    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    cmd.ExecuteNonQuery()

                    ''---------------------
                    ''Dim vCve_Obs As String = TraerClaveSiguiente()
                    'Dim vCve_Obs As String
                    'Dim vcont7 As String = ""
                    'Dim reader7 As SqlDataReader
                    'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
                    'cmd = New SqlCommand(sqllocal, connSAE, objTransEmbarques)
                    'reader7 = cmd.ExecuteReader()
                    'While reader7.Read()
                    '    'MsgBox(reader7.Item(0))
                    '    vcont7 = reader7.Item(0).ToString
                    '    vcont7 = Val(vcont7) + 1
                    'End While
                    'If vcont7 = "" Then vcont7 = "1"
                    'vCve_Obs = vcont7
                    'reader7.Close()
                    ''-----------------------------------
                    'Dim vObser As String = "Buenas Remisión HH"
                    'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                    'cmd = New SqlCommand(sqllocal, connSAE, objTransEmbarques)
                    'cmd.ExecuteNonQuery()
                    ''Call UpdateOC(CVE_DOC, vCveDoc)
                    'sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
                    '" WHERE CVE_DOC ='" + CVE_DOC + "'"
                    'cmd = New SqlCommand(sqllocal, connSAE, objTransEmbarques)
                    'cmd.ExecuteNonQuery()
                    Dim pIdPedido As String = id_pedido
                    Dim pcvedoc As String = vCveDoc
                    Dim pObser As String = "0" 'vObser
                    Dim pcve_doc_origen As String = CVE_DOC
                    Dim VEND As String = "" 'CVE_VEND
                    Dim pAlmacen As String = NUM_ALMA
                    Dim pCve_Cliente As String = CVE_CLPV
                    'Dim CVE_DOC As String
                    Dim NUM_PAR As Integer = 1
                    Dim CVE_ART As String
                    Dim vlsubtotal As Double
                    Dim CANT As Double
                    Dim CANTp As Double
                    Dim PXS As String
                    Dim PREC As String
                    Dim COST As String = "0"
                    Dim IMPU1 As String
                    Dim IMPU2 As String
                    Dim IMPU3 As String
                    Dim IMPU4 As Integer
                    Dim IMP1APLA As String
                    Dim IMP2APLA As String
                    Dim IMP3APLA As String
                    Dim IMP4APLA As String
                    Dim TOTIMP1 As String
                    Dim TOTIMP2 As String
                    Dim TOTIMP3 As String
                    Dim TOTIMP4 As String
                    Dim DESC1 As String
                    Dim DESC2 As String
                    Dim DESC3 As String
                    Dim COMI As String
                    Dim APAR As String
                    Dim ACT_INV As String
                    Dim NUM_ALM As String = pAlmacen
                    Dim POLIT_APLI As String
                    Dim TIP_CAM As String
                    Dim UNI_VENTA As String
                    Dim TIPO_PROD As String
                    'Dim CVE_OBS As String
                    Dim REG_SERIE As String
                    Dim E_LTPD As String
                    Dim TIPO_ELEM As String
                    Dim NUM_MOV As String
                    Dim TOT_PARTIDA As String = ""
                    Dim IMPRIMIR As String
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    '''''''''''''''''''''''''''''detalle
                    'aqui vamos
                    Dim reader2 As SqlDataReader
                    Dim vlpedent As String
                    'Dim SqlSelection As String = "SELECT id_order_detail,id_order,product_upc,product_price,quantity_received" + _
                    '",total_shipping_price_tax_incl FROM Logistik_order_detail WHERE id_order ='" + pIdPedido + "'"
                    Dim SqlSelection As String = "select id_usuario,fecha, " +
                    "codigo_producto,cantidad,merma,pedido, oc, precio_pesos, empresa_destino, rfc_destino, pedimento, precio" +
                    ",costo_pesos FROM vLogistik_Kardex WHERE trim(embarque)='" + pIdPedido.Trim + "'" +
                    " and trim(vLogistik_Kardex.empresa_destino)='" + EMPRESA_DEST.Trim + "'" +
                    " and trim(vLogistik_Kardex.estado_inicial)='0' and trim(vLogistik_Kardex.estado_final)='1'"
                    cmd = New SqlCommand(SqlSelection, conn)
                    reader2 = cmd.ExecuteReader()
                    'If conn.State = ConnectionState.Open Then
                    '    conn.Close()
                    'End If
                    ' esta variable controla el consecutivo de las series
                    Dim mREG_SERIE As String
                    ' esta variable controla una sola entrada al ciclo de las series
                    Dim vlMaxNum As Boolean = True
                    If connFB.State = ConnectionState.Closed Then
                        connFB.Open()
                    End If
                    'objTransFB = connFB.BeginTransaction()
                    Dim vcantfalsa As Double = 0
                    Dim merma As Double = 0
                    If EMPRESA_DEST.Trim <> "" Then
                        While reader2.Read()
                            CVE_DOC = pcvedoc
                            CVE_ART = reader2.Item(2).ToString
                            vcantfalsa = reader2.Item(3).ToString
                            merma = reader2.Item(4).ToString
                            'CANTp = Convert.ToString(vcantfalsa - merma)
                            'CANT = Convert.ToString(vcantfalsa - merma)
                            'PXS = Convert.ToString(vcantfalsa - merma)
                            CANTp = Convert.ToString(vcantfalsa)
                            CANT = Convert.ToString(vcantfalsa)
                            PXS = Convert.ToString(vcantfalsa)
                            PREC = reader2.Item(7).ToString
                            vlpedent = reader2.Item(10).ToString
                            COST = reader2.Item(12).ToString
                            '-------------------------------------------------------------------------------------
                            'If connFB.State = ConnectionState.Closed Then
                            '    connFB.Open()
                            'End If
                            'Dim reader7 As SqlDataReader
                            'sqllocal = "SELECT INV7.COSTO_PROM, INV7.ULT_COSTO FROM INVE" + nnBisness.ToString + " AS INV7 WHERE INV7.CVE_ART = '" + CVE_ART.ToString + "'"
                            'cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                            'reader7 = cmd.ExecuteReader()
                            'While reader7.Read()
                            '    Dim ExistA As Double
                            '    ExistA = Convert.ToDouble(reader7.Item(0).ToString)
                            '    'ExistA = Math.Round(ExistA, 2)
                            '    COST = ExistA.ToString
                            '    If COST = "" Or COST = "0" Then
                            '        ExistA = Convert.ToDouble(reader7.Item(1).ToString)
                            '        'ExistA = Math.Round(ExistA, 2)
                            '        COST = ExistA.ToString
                            '    End If

                            'End While
                            'reader7.Close()
                            'If connFB.State = ConnectionState.Open Then
                            '    connFB.Close()
                            'End If
                            '---------------------------------------------------------------------------------

                            '-------------------------------------------------------------------------------
                            'SqlA = "SELECT COSTO_PROM, ULT_COSTO FROM INVE" + vgNumEmpresa.ToString + _
                            '" WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                            'Dim da25 As New FbDataAdapter(SqlA, connFB)
                            'Dim ds25 As New DataSet
                            'If connFB.State = ConnectionState.Closed Then
                            '    connFB.Open()
                            'End If
                            'da25.Fill(ds25, "INVE" + vgNumEmpresa.ToString)
                            'Dim oTable25 As New DataTable
                            'oTable25 = ds25.Tables("INVE" + vgNumEmpresa.ToString)
                            'If oTable25.Rows.Count >= 1 Then
                            '    For Each oRow25 In oTable25.Rows
                            '        COST = oRow25.Item("COSTO_PROM").ToString
                            '        If COST = "" Or COST = "0" Then COST = oRow25.Item("ULT_COSTO").ToString
                            '    Next
                            'End If
                            '---------------------------------------------------------------------------------

                            IMPU1 = "0"
                            IMPU2 = "0"
                            IMPU3 = "0"

                            IMPU4 = "16"
                            IMP1APLA = "6"
                            IMP2APLA = "6"
                            IMP3APLA = "6"
                            IMP4APLA = "0"
                            TOTIMP1 = "0"
                            TOTIMP2 = "0"
                            TOTIMP3 = "0"
                            'iva
                            TOTIMP4 = "16"
                            DESC1 = "0"
                            DESC2 = "0"
                            DESC3 = "0"
                            COMI = "0"
                            APAR = "0"
                            ACT_INV = "S"
                            POLIT_APLI = ""
                            TIP_CAM = "1"
                            UNI_VENTA = "pz"
                            TIPO_PROD = "P"

                            CVE_OBS = "0"
                            REG_SERIE = "0"
                            'tiene lotes
                            E_LTPD = "0"

                            TIPO_ELEM = "N"
                            'consecutivo

                            'NUM_MOV = reader2.Item(34).ToString
                            'cantidad por pecio
                            'If PREC <> "" Then

                            TOT_PARTIDA = Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)
                            TOTIMP4 = (Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)) * (IMPU4 / 100)
                            IMPRIMIR = ""

                            'Else
                            'objTransEmbarques.Rollback()
                            'End If

                            'Dim Sql As String
                            '-------------------Traer la clave siguiente
                            ''CVE_OBS = TraerClaveSiguiente()
                            'Dim vcont As String = ""
                            ''Dim vnum As Integer
                            'Dim reader As FbDataReader
                            'Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
                            'cmdFB = New FbCommand(Sql, connFB, objTransFB)
                            'reader = cmdFB.ExecuteReader()
                            'While reader.Read()
                            '    'MsgBox(reader.Item(0))
                            '    vcont = reader.Item(0).ToString
                            '    vcont = Val(vcont) + 1
                            'End While
                            'If vcont = "" Then vcont = "1"
                            'CVE_OBS = vcont
                            'reader.Close()

                            'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            'cmdFB.ExecuteNonQuery()
                            '---------------------crear el o los movimientos
                            'Dim vNum_Mov As String = ConsecutivoMovimiento()
                            Dim vNum_Mov As String
                            Dim vcont77 As String = ""
                            Dim reader77 As SqlDataReader
                            sql = "Select isnull(max(NUM_MOV),1) AS num FROM MINVE" + nnBisness.ToString
                            cmd = New SqlCommand(sql, connFB, objTransEmbarques)
                            reader77 = cmd.ExecuteReader()
                            While reader77.Read()
                                'MsgBox(reader7.Item(0))
                                vcont77 = reader77.Item(0).ToString
                                vcont77 = Val(vcont77) + 1
                            End While
                            If vcont77 = "" Then vcont77 = "1"
                            vNum_Mov = vcont77
                            reader77.Close()
                            '----------tiene pedimento y numero de serie
                            Dim vlPedimento As String = "N"
                            Dim vlNumSer As String = "N"
                            Dim readerPedi As SqlDataReader
                            SqlSelection = "SELECT Pedimento FROM Logistik_product WHERE upc = '" + CVE_ART.Trim + "'"
                            If connNew.State = ConnectionState.Closed Then
                                connNew.Open()
                            End If
                            cmd = New SqlCommand(SqlSelection, connNew)
                            readerPedi = cmd.ExecuteReader()
                            While readerPedi.Read()
                                vlPedimento = readerPedi.Item(0)
                            End While
                            readerPedi.Close()
                            If vlPedimento = "S" Then
                                sqllocal = "UPDATE TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
                                LabelQuery.Text = sqllocal
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                cmd.ExecuteNonQuery()

                                ''---------EXTRAER CLAVE DEL FOLIO
                                Dim CVE_FOLIO1 As String = "0"
                                Dim readerCONTROL2 As SqlDataReader
                                sqllocal = "Select ULT_CVE  FROM TBLCONTROL" + nnBisness.ToString + " WHERE ID_TABLA=67"
                                cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                readerCONTROL2 = cmd.ExecuteReader()
                                While readerCONTROL2.Read()
                                    CVE_FOLIO1 = readerCONTROL2.Item(0).ToString
                                End While
                                readerCONTROL2.Close()
                                E_LTPD = CVE_FOLIO1

                                Dim pLOTE As String
                                Dim pPEDIMENTO As String
                                Dim pFCHCADUC As String
                                Dim pFCHADUANA As String
                                Dim pFCHULTMOV As String
                                Dim pNOM_ADUAN As String
                                Dim pCANTIDAD As Double
                                Dim pCVE_OBS As String
                                Dim pCIUDAD As String
                                Dim pFRONTERA As String
                                Dim pFEC_PROD_LT As String
                                Dim pGLN As String
                                Dim pSTATUS As String
                                Dim pREG_LTPD As String = ""
                                Dim readerPedimento As SqlDataReader
                                sqllocal = "SELECT LOTE ,PEDIMENTO, FCHCADUC," +
                                "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," +
                                "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," +
                                "STATUS, REG_LTPD FROM LTPD" + nnBisness.ToString +
                                " WHERE CVE_ALM = '1' and CVE_ART = '" + CVE_ART.Trim + "'" +
                                " and PEDIMENTO='" + vlpedent.Trim + "'"
                                LabelQuery.Text = sqllocal
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                readerPedimento = cmd.ExecuteReader()
                                'Dim vvCantFaltante As Double = CANT
                                While readerPedimento.Read()
                                    pLOTE = readerPedimento.Item(0).ToString
                                    pPEDIMENTO = readerPedimento.Item(1).ToString
                                    pFCHCADUC = readerPedimento.Item(2).ToString
                                    pFCHADUANA = readerPedimento.Item(3).ToString
                                    pFCHULTMOV = readerPedimento.Item(4).ToString
                                    pNOM_ADUAN = readerPedimento.Item(5).ToString
                                    pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
                                    pCVE_OBS = readerPedimento.Item(7).ToString
                                    pCIUDAD = readerPedimento.Item(8).ToString
                                    pFRONTERA = readerPedimento.Item(9).ToString
                                    pFEC_PROD_LT = readerPedimento.Item(10).ToString
                                    pGLN = readerPedimento.Item(11).ToString
                                    pSTATUS = readerPedimento.Item(12).ToString
                                    pREG_LTPD = readerPedimento.Item(13).ToString
                                End While
                                readerPedimento.Close()
                                sqllocal = "INSERT INTO ENLACE_LTPD" + nnBisness.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" +
                                E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
                                cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                cmd.ExecuteNonQuery()
                                ''---------------------------------------------------------------
                                ''BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
                                ''---------------------------------------------------------------
                                ''---- extraer el consecutivo REG_LTPD de SAE
                                'Dim pREG_LTPD As String
                                ''Dim readerMAx As FbDataReader
                                ''sqllocal = "Select coalesce(max(REG_LTPD),1) AS num FROM LTPD" + vgNumEmpresa.ToString
                                ''If connFB.State = ConnectionState.Closed Then
                                ''    connFB.Open()
                                ''End If
                                ''cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                ''readerMAx = cmdFB.ExecuteReader()
                                ''While readerMAx.Read()
                                ''    'MsgBox(reader7.Item(0))
                                ''    pREG_LTPD = readerMAx.Item(0).ToString
                                ''    pREG_LTPD = Val(pREG_LTPD) + 1
                                ''End While
                                ''If pREG_LTPD = "" Then pREG_LTPD = "1"
                                ''readerMAx.Close()
                                ''---EXTRAER DATOS DEL SQL
                                'Dim pLOTE As String
                                'Dim pPEDIMENTO As String
                                'Dim pFCHCADUC As String
                                'Dim pFCHADUANA As String
                                'Dim pFCHULTMOV As String
                                'Dim pNOM_ADUAN As String
                                'Dim pCANTIDAD As Double
                                'Dim pCVE_OBS As String
                                'Dim pCIUDAD As String
                                'Dim pFRONTERA As String
                                'Dim pFEC_PROD_LT As String
                                'Dim pGLN As String
                                'Dim pSTATUS As String
                                ''Dim readerPedimento As SqlDataReader
                                ''SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
                                ''"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
                                ''"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                                ''"STATUS, REG_LTPD  FROM Logistik_Lote_Pedimento" + _
                                ''" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
                                ''"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'"
                                ''If conn.State = ConnectionState.Closed Then
                                ''    conn.Open()
                                ''End If
                                ''cmd = New SqlCommand(SqlSelection, conn)
                                ''readerPedimento = cmd.ExecuteReader()
                                'Dim readerPedimento As SqlDataReader
                                'sql = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
                                '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
                                '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                                '"STATUS, REG_LTPD  FROM LTPD" + vgNumEmpresa.ToString + _
                                '" WHERE CVE_ALM = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
                                '" and CANTIDAD > '0'"
                                ''If conn.State = ConnectionState.Closed Then
                                ''    conn.Open()
                                ''End If
                                ''cmd = New SqlCommand(SqlSelection, conn)
                                ''readerPedimento = cmd.ExecuteReader()
                                'cmd = New SqlCommand(sql, connFB, objTransEmbarques)
                                'readerPedimento = cmd.ExecuteReader()
                                'Dim vvCantFaltante As Double = CANT
                                'While readerPedimento.Read()
                                '    pLOTE = readerPedimento.Item(0).ToString
                                '    pPEDIMENTO = readerPedimento.Item(1).ToString
                                '    pFCHCADUC = readerPedimento.Item(2).ToString
                                '    pFCHADUANA = readerPedimento.Item(3).ToString
                                '    pFCHULTMOV = readerPedimento.Item(4).ToString
                                '    pNOM_ADUAN = readerPedimento.Item(5).ToString
                                '    pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
                                '    pCVE_OBS = readerPedimento.Item(7).ToString
                                '    pCIUDAD = readerPedimento.Item(8).ToString
                                '    pFRONTERA = readerPedimento.Item(9).ToString
                                '    pFEC_PROD_LT = readerPedimento.Item(10).ToString
                                '    pGLN = readerPedimento.Item(11).ToString
                                '    pSTATUS = readerPedimento.Item(12).ToString
                                '    pREG_LTPD = readerPedimento.Item(13).ToString

                                '    If pFCHCADUC <> "" Then
                                '        pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
                                '    End If
                                '    If pFCHADUANA <> "" Then
                                '        pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
                                '    End If
                                '    If pFCHULTMOV <> "" Then
                                '        pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
                                '    End If
                                '    If pFEC_PROD_LT <> "" Then
                                '        pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
                                '    End If

                                '    '------------------INSERTAR PEDIMENTOS EN SAE
                                '    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
                                '    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                '    cmd.ExecuteNonQuery()
                                '    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
                                '    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                '    cmd.ExecuteNonQuery()

                                '    'sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = '" + pCANTIDAD.ToString + "'" + _
                                '    '" WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
                                '    '" AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                '    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                '    'cmdFB.ExecuteNonQuery()

                                '    If pCANTIDAD >= vvCantFaltante Then
                                '        sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + vvCantFaltante.ToString + _
                                '        " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
                                '        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                '        cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                '        cmd.ExecuteNonQuery()
                                '    Else
                                '        sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + pCANTIDAD.ToString + _
                                '        " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
                                '        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                '        cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                '        cmd.ExecuteNonQuery()
                                '        '9 >= 10
                                '        '10 - 9 = 1
                                '        vvCantFaltante = CANT - pCANTIDAD
                                '    End If

                                '    'sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
                                '    '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
                                '    '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                                '    '"STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + NUM_ALM + "','" + pFCHCADUC + "','" + _
                                '    ' pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD + "','" + pREG_LTPD + "','" + _
                                '    ' pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
                                '    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                '    'cmdFB.ExecuteNonQuery()

                                '    '---- extraer MAXIMO el E_LTPD de SAE
                                '    Dim readerLTPD As SqlDataReader
                                '    sqllocal = "Select MAX(E_LTPD) AS NUM FROM ENLACE_LTPD" + vgNumEmpresa.ToString
                                '    If connFB.State = ConnectionState.Closed Then
                                '        connFB.Open()
                                '    End If
                                '    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                '    readerLTPD = cmd.ExecuteReader()
                                '    While readerLTPD.Read()
                                '        'MsgBox(reader7.Item(0))
                                '        E_LTPD = readerLTPD.Item(0).ToString
                                '        E_LTPD = Val(E_LTPD) + 1
                                '    End While
                                '    If E_LTPD = "" Then E_LTPD = "1"
                                '    readerLTPD.Close()
                                '    sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
                                '    E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
                                '    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                '    cmd.ExecuteNonQuery()
                                '    If pCANTIDAD >= vvCantFaltante Then
                                '        Exit While
                                '    End If
                                '    ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
                                '    'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
                                '    '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
                                '    '"' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
                                '    '" AND REG_LTPD = '" + pREG_LTPD.ToString + "'"
                                '    'cmd = New SqlCommand(SqlSelection, conn)
                                '    'cmd.ExecuteNonQuery()

                                'End While
                                'If conn.State = ConnectionState.Open Then
                                '    conn.Close()
                                'End If
                                'readerPedimento.Close()
                                ''---------------------------------------------------------------
                                ''END INSERTAR PEDIMENTOS
                                ''---------------------------------------------------------------
                            End If
                            vUUID = Guid.NewGuid.ToString()
                            vUUID = UCase(vUUID)
                            If vlNumSer = "S" Then
                                sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                                "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
                                PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                                IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                                TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                                DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                                NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                                CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                                TOT_PARTIDA + "','" + POLIT_APLI + "')"
                            Else
                                If vgVersion = "5" Then
                                    sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                    ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                    ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                    ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                                    "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
                                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                                    IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                                    DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                                    NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                                    CVE_OBS + "','0','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                                    TOT_PARTIDA + "','" + POLIT_APLI + "')"
                                End If
                                Dim VERSION_SINC As String = vfechayhora
                                VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
                                If vgVersion = "6" Or vgVersion = "7" Then
                                    sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                    ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                    ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                    ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" +
                                    ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ, UUID) values (" +
                                    "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" +
                                    PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" +
                                    IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" +
                                    TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" +
                                    DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" +
                                    Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" +
                                    CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" +
                                    TOT_PARTIDA.ToString + "','S','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1','" + vUUID + "')"
                                End If

                            End If
                            If connFB.State = ConnectionState.Closed Then
                                connFB.Open()
                            End If
                            cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                            cmd.ExecuteNonQuery()

                            'INSERTAR EL INDICE
                            sqllocal = "insert into  PAR_FACTR_CLIB" + nnBisness.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR.ToString + "')"
                            cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                            cmd.ExecuteNonQuery()
                            'actualizar detalle PAR_FACTP01
                            'sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString + _
                            '" WHERE CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            'cmdFB.ExecuteNonQuery()
                            'actualizar ACUMULADOR de remisiones y facturas
                            '-----------camision del vendedor
                            'If pComicion = "" Then pComicion = "0"
                            'If Val(pComicion) >= 1 Then
                            '    Dim VLcomi As String = (pComicion / 100) * TOT_PARTIDA
                            '    sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
                            '    " RIMP = RIMP + " + TOTIMP4 + ", RCOMI = RCOMI + " + VLcomi + _
                            '    " WHERE CVE_AFACT = '11'"
                            'Else
                            'TOT_ARTIDA = PRECIO POR CANTIDAD

                            sqllocal = "update AFACT" + nnBisness.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," +
                            " RIMP = RIMP + " + TOTIMP4 + "" +
                            " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"

                            'End If
                            cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                            cmd.ExecuteNonQuery()
                            '---------EXTRAER CLAVE DEL FOLIO
                            Dim CVE_FOLIO As String = "0"
                            Dim readerCONTROL As SqlDataReader
                            sql = "Select ULT_CVE AS num FROM TBLCONTROL" + nnBisness.ToString + " WHERE ID_TABLA='32'"
                            cmd = New SqlCommand(sql, connFB, objTransEmbarques)
                            readerCONTROL = cmd.ExecuteReader()
                            While readerCONTROL.Read()
                                'MsgBox(reader3.Item(0))
                                CVE_FOLIO = readerCONTROL.Item(0).ToString
                                'vExistencia = Val(vExistencia) + 1
                            End While
                            If CVE_FOLIO = "" Then CVE_FOLIO = "1"
                            readerCONTROL.Close()
                            '-----------------------------------------------
                            sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                            cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                            cmd.ExecuteNonQuery()



                            'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            'cmdFB.ExecuteNonQuery()

                            ''insertar documentos siguientes
                            'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
                            '"PARTIDA, PART_E, CANT_E) VALUES (" + _
                            '"'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" + _
                            'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            'cmdFB.ExecuteNonQuery()
                            'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
                            '"PARTIDA, PART_E, CANT_E) VALUES (" + _
                            '"'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" + _
                            'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            'cmdFB.ExecuteNonQuery()
                            '-------------------------------------------------------------------------------
                            'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
                            ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                            'cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            'cmd.ExecuteNonQuery()
                            '-----------------------------------------------------------------------------
                            'actualizar las existencias
                            'Call ActualizarExistencias(CVE_ART, CANT)
                            'sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
                            '" PEND_SURT = PEND_SURT - " + CANT.ToString + ", COSTO_PROM = '" + COST + "'," + _
                            '" ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
                            '" WHERE CVE_ART ='" + CVE_ART + "'"
                            time = Today.Now
                            sqllocal = "update INVE" + nnBisness.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                            " COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                            "VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" +
                            " WHERE CVE_ART ='" + CVE_ART + "'"
                            cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                            cmd.ExecuteNonQuery()
                            '-----------------------------------------------
                            'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                            Dim vExistencia As String = ""
                            Dim reader3 As SqlDataReader
                            sql = "Select ISNULL(max(EXIST),0) AS num FROM INVE" + nnBisness.ToString + " WHERE CVE_ART = '" + CVE_ART + "'"
                            cmd = New SqlCommand(sql, connFB, objTransEmbarques)
                            reader3 = cmd.ExecuteReader()
                            While reader3.Read()
                                'MsgBox(reader3.Item(0))
                                vExistencia = reader3.Item(0).ToString
                                'vExistencia = Val(vExistencia) - Val(CANT)
                            End While
                            If vExistencia = "" Then vExistencia = "1"
                            reader3.Close()
                            '--------existe almacen
                            Dim vExistAlm As String
                            Dim rederExistAlm As SqlDataReader
                            sql = "SELECT EXIST FROM MULT" + nnBisness.ToString +
                            " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '" + NUM_ALM + "'"
                            cmd = New SqlCommand(sql, connFB, objTransEmbarques)
                            rederExistAlm = cmd.ExecuteReader()
                            While rederExistAlm.Read
                                vExistAlm = rederExistAlm.Item(0).ToString
                                vExistAlm = Val(vExistAlm) - CANT
                            End While
                            rederExistAlm.Close()
                            '---------EXTRAER CLAVE DEL FOLIO
                            'Dim CVE_FOLIO As String = "0"
                            Dim readerCONTROLss As SqlDataReader
                            sqllocal = "Select ULT_CVE FROM TBLCONTROL" + nnBisness.ToString + " WHERE ID_TABLA='32'"
                            LabelQuery.Text = sqllocal
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                            readerCONTROLss = cmd.ExecuteReader()
                            While readerCONTROLss.Read()
                                CVE_FOLIO = readerCONTROLss.Item(0).ToString
                            End While
                            If CVE_FOLIO = "0" Then CVE_FOLIO = "1"
                            readerCONTROLss.Close()
                            If vlNumSer = "S" Then
                                sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                                "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" +
                                "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                                "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                                "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO + "','-1','" +
                                "S','0','" + COST + "','N','0')"
                                cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                cmd.ExecuteNonQuery()
                            Else
                                If vgVersion = "5" Then
                                    sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                    "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" +
                                    "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                                    "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                                    "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
                                    "S','0','" + COST + "','N','0')"
                                End If
                                If vgVersion = "6" Or vgVersion = "7" Then
                                    sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" +
                                    "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov.ToString + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                    "'R','" + pcvedoc.ToString + "','" + pCve_Cliente + "','" + VEND.ToString + "','" + CANT.ToString + "','" +
                                    "0','" + PREC.ToString + "','" + COST.ToString + "','','" + CVE_OBS.ToString + "'," +
                                    "'0','" + UNI_VENTA.ToString + "','" + E_LTPD.ToString + "','" + vExistAlm + "',NULL,'" +
                                    "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO + "','-1','" +
                                    "S','" + COST.ToString + "','" + COST.ToString + "','N','0','" + vExistencia.ToString + "','" + COST.ToString + "')"
                                End If
                                cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                cmd.ExecuteNonQuery()
                                sqllocal = "UPDATE MINVE" + nnBisness.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " +
                                " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" +
                                " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
                                cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                cmd.ExecuteNonQuery()
                                Dim VERSION_SINC As String
                                VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                sqllocal = "UPDATE MULT" + nnBisness.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" +
                                " WHERE CVE_ART = '" + CVE_ART + "'" +
                                " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
                                cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                                cmd.ExecuteNonQuery()
                            End If
                            'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            'cmdFB.ExecuteNonQuery()
                            mREG_SERIE = Val(mREG_SERIE) + 1
                            vlsubtotal = vlsubtotal + (PREC * CANT)
                            NUM_PAR = NUM_PAR + 1
                        End While
                    End If
                    reader2.Close()
                    CAN_TOT = vlsubtotal.ToString
                    Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
                    IMP_TOT4 = iva.ToString
                    Dim vImporte As Double = Math.Round((vlsubtotal + iva), 5)
                    sqllocal = "INSERT INTO BITA" + nnBisness.ToString +
                    "(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" +
                    " VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + vImporte.ToString + "', 'F', 'Administrador')"
                    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    cmd.ExecuteNonQuery()
                    sqllocal = "UPDATE FOLIOSF" + nnBisness.ToString + " SET ULT_DOC = ULT_DOC + 1, FECH_ULT_DOC = '" + vfechayhora.ToString("yyyy/MM/dd") + "'" +
                    " WHERE TIP_DOC = 'R'"
                    'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
                    '" WHERE TIP_DOC = 'R' and serie ='STAND.'"
                    '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    cmd.ExecuteNonQuery()
                    vImporte = Math.Round((vlsubtotal + iva), 2)
                    sqllocal = "UPDATE FACTR" + nnBisness.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
                    " ,CAN_TOT='" + CAN_TOT + "', IMP_TOT4 = '" + IMP_TOT4 + "', IMPORTE='" + vImporte.ToString + "'" +
                    " WHERE CVE_DOC = '" + vCveDoc + "'"
                    cmd = New SqlCommand(sqllocal, connFB, objTransEmbarques)
                    cmd.ExecuteNonQuery()

                    '------------------------
                    objTransEmbarques.Commit()
                    empresa = NOMBRE_BD.ToString
                    documento = pcvedoc.ToString
                    mensaje = "Registro de Remision Correcto:" + pcvedoc.ToString + " Embarque:" + id_pedido.ToString
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    '------------------------
                    BIEN = 1
                    '------------------------------------------------------------------------------------------
                    If BIEN = 1 Then
                        '------------------------------------------------------------------------
                        Dim StrVts As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
                        Dim connVts As New SqlConnection(StrVts)
                        sql = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Vende' AND BASEDATOS = 'LogistikMasterValvulerias" + EMPRESA_DEST.Trim + "'"
                        Dim daVts As New SqlDataAdapter(sql, connVts)
                        Dim dsVts As New DataSet()
                        daVts.Fill(dsVts, "EmpresaSAE")
                        Dim oTablaVts As DataTable
                        oTablaVts = dsVts.Tables("EmpresaSAE")
                        Dim SERVIDOR2 As String = ""
                        Dim USUARIO2 As String = ""
                        Dim NOMBRE_BD2 As String = ""
                        Dim PASSWROD2 As String = ""
                        Dim BASEDATOS2 As String = ""
                        'Dim VTIPO As String = ""
                        If oTablaVts.Rows.Count >= 1 Then
                            Dim oFila As DataRow
                            For Each oFila In oTablaVts.Rows
                                SERVIDOR2 = oFila.Item("SERVIDOR").ToString
                                BASEDATOS2 = oFila.Item("BASEDATOS").ToString
                                USUARIO2 = oFila.Item("USUARIO").ToString
                                PASSWROD2 = oFila.Item("PASSWROD").ToString
                                NOMBRE_BD2 = oFila.Item("NOMBRE_BD").ToString
                            Next
                        End If
                        Dim nnBisness2 = Mid(NOMBRE_BD2, LongitudBD)
                        'TextError.Text = TextError.Text + vbCrLf + "bd:" + NOMBRE_BD2 + "num:" + nnBisness2 + "id_ped:" + id_pedido + "emp_des:" + EMPRESA_DEST
                        Call SEND_RECEPCION_EMBARQUE(NOMBRE_BD2, nnBisness2, id_pedido, EMPRESA_DEST)
                    End If
                End If
                'OrdenVenta = Val(OrdenVenta)
                'OrdenVenta = espacios(OrdenVenta, 20)
                Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'S'" +
                " WHERE embarque = '" + Trim(id_pedido) + "'"
                EjecutarQuerySQL_EMPRESA6(sql1)
            Next
            'Catch es As FbException
            '    empresa = vgEmpresa.ToString
            '    documento = CVE_DOC.ToString
            '    mensaje = "Sincronizando Remision: InCorrecto Remision:" + CVE_DOC.ToString
            '    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" + _
            '    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            '    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            '    Me.Refresh()
            '    objTransEmbarques.Rollback()
            '    If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
            '        Me.Dispose()
            '        'FrmLogin.Dispose()
            '    End If
            '    Throw es
            If connNew.State = ConnectionState.Open Then
                connNew.Close()
            End If
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Sincronizando Remision: InCorrecto Remision:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTransEmbarques.Rollback()
            Throw es
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Sincronizando Remision: InCorrecto Remision:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTransEmbarques.Rollback()
            Throw ex
        End Try
    End Sub

    Private Sub SEND_RECEPCION_EMBARQUE(ByVal pMiBD As String, ByVal pNUMEMP As String, ByVal ID_PEDIDOr As String, EMPRESA_DEST As String)
        ' SACAR LA EMPRESA DEL SAE
        Label5.Text = "Sincronizando Embarques y Kardex del SQL al SAE parte 2"
        'TextErrorEmp2.Text = "prueba 13 recepcion emp1o4"
        Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + My.Settings.vgCrearBD_Name + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim connection7 As New SqlConnection(Str1)
        Dim sqllocal As String = "SELECT BASEDATOS from EmpresaSAE " +
        " WHERE NOMBRE_BD = '" + pMiBD + "'"
        Dim daPC1 As New SqlDataAdapter(sqllocal, connection7)
        Dim dsPC1 As New DataSet
        daPC1.Fill(dsPC1, "EmpresaSAE")
        Dim oTablePC1 As New DataTable
        oTablePC1 = dsPC1.Tables("EmpresaSAE")
        Dim MI_BD_x As String = ""
        For Each oRowPC7 In oTablePC1.Rows
            MI_BD_x = oRowPC7.Item("BASEDATOS").ToString
        Next
        'enviar compras al sae
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        'Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + MI_BD_x + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";MultipleActiveResultSets=True;"
        Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";MultipleActiveResultSets=True;"
        Dim conn As New SqlConnection(Str)
        Dim conn2 As New SqlConnection(Str2)
        'Dim conn3 As New SqlConnection(Str2)
        'Dim comd1 As SqlCommand = New SqlCommand
        Dim CVE_DOC As String
        Dim id_pedido As String
        Try
            'sqllocal = "SELECT embarque,id_proveedor,factura,oc," +
            '"fecha_recepcion,id_usuario_recibio,fecha_calificacion,id_usuario_califico,fecha_liberacion," +
            '"id_usuario_libero,contenido,estado,completo,empresa_destino," +
            '"enviado_sae, rfc_destino FROM vLogistik_Embarques" +
            '" WHERE embarque ='" + ID_PEDIDOr + "'"

            sqllocal = "select vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino" +
                    " FROM vLogistik_Kardex, vLogistik_Embarques WHERE vLogistik_Kardex.embarque= vLogistik_Embarques.embarque" +
                    " and trim(vLogistik_Kardex.empresa_destino)='" + EMPRESA_DEST.Trim + "'" +
                    " and trim(vLogistik_Kardex.embarque)='" + ID_PEDIDOr.Trim + "'" +
                    " and trim(vLogistik_Kardex.estado_inicial)='0' and trim(vLogistik_Kardex.estado_final)='1' " +
                    " group by vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino"
            LabelTABLA.Text = "emp1o4 vLogistik_Kardex"
            LabelQuery.Text = sqllocal
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            'TextErrorEmp2.Text = "prueba 14 recepcion emp1o4"
            daPC.Fill(dsPC, "vLogistik_Embarques_RECEPCION")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("vLogistik_Embarques_RECEPCION")
            Dim OrdenCompra As String

            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If

            Dim RFC_DEST As String
            Dim total_te As Double
            For Each oRowPC In oTablePC.Rows
                id_pedido = ID_PEDIDOr
                OrdenCompra = oRowPC.Item("oc").ToString
                'num_empresa = oRowPC.Item("num_empresa").ToString
                'agregar ceros
                'OrdenCompra = ceros(OrdenCompra, 10)
                'agregar espacios
                OrdenCompra = espacios(OrdenCompra, 20)
                RFC_DEST = oRowPC.Item("rfc_destino").ToString

                Dim TIP_DOC As String = "r"
                CVE_DOC = OrdenCompra
                Dim CVE_CLPV As String
                '13 =empresa 1 y 1= empresa4
                If EMPRESA_DEST.Trim = "01" Then CVE_CLPV = My.Settings.ProvEmp01
                If EMPRESA_DEST.Trim = "04" Then CVE_CLPV = My.Settings.ProvEmp04
                CVE_CLPV = espacios(CVE_CLPV, 10)
                total_te = 0
                Dim STATUS As String = "O"
                Dim SU_REFER As String = OrdenCompra

                Dim FECHA_DOC As String = time.ToString("yyyy/MM/dd")
                Dim FECHA_REC As String = time.ToString("yyyy/MM/dd")
                'traer dias de creaditop del cliente

                Dim readerDias As SqlDataReader
                Dim dias As String = ""
                Dim FECHA_PAG As String
                sqllocal = "SELECT DIASCRED FROM PROV" + pNUMEMP.ToString +
                " WHERE CON_CREDITO='S' AND CLAVE='" + CVE_CLPV.ToString + "'"
                LabelTABLA.Text = "emp1o4 PROV"
                LabelQuery.Text = sqllocal
                cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                readerDias = cmd.ExecuteReader()
                While readerDias.Read()
                    dias = readerDias.Item(0).ToString
                End While
                If Len(dias) > 1 Then
                    Dim vFechaHoy1 As Date = Today.Date.Now
                    vFechaHoy1 = vFechaHoy1.AddDays(dias)
                    FECHA_PAG = vFechaHoy1.ToString("yyyy/MM/dd")
                Else
                    FECHA_PAG = time.ToString("yyyy/MM/dd")
                End If
                readerDias.Close()

                Dim FECHA_CANCELA As String = time.ToString("yyyy/MM/dd")
                'SUBTOTAL
                Dim CAN_TOT As Double = total_te / 1.16
                Dim IMP_TOT1 As String = "0"
                Dim IMP_TOT2 As String = "0"
                Dim IMP_TOT3 As String = "0"
                'IVA
                Dim IMP_TOT4 As String = CAN_TOT * 0.16
                Dim DES_TOT As String = "0"
                Dim DES_FIN As String = "0"
                Dim TOT_IND As String = "0"
                Dim OBS_COND As String = ""
                Dim CVE_OBS As String = "0"
                Dim NUM_ALMA As String = "1"
                Dim ACT_CXP As String = "S"
                Dim ACT_COI As String = "N"
                Dim NUM_MONED As String = "1"
                Dim TIPCAMB As String = "1"
                Dim ENLAZADO As String = "O"
                Dim TIP_DOC_E As String = "O"
                Dim NUM_PAGOS As String = ""
                'FECHA Y HORA
                Dim FECHAELAB As String = vfechayhora.ToString("yyyy/MM/dd HH:mm:ss")
                Dim SERIE As String = ""
                '---------------------traer del sae
                Dim FOLIO As String = Nothing
                sqllocal = "Select MASCARA FROM PARAM_FOLIOSC" + pNUMEMP.ToString +
                    " WHERE TIPODOCTO = 'R'" ' NUM_EMP = '1' AND
                LabelTABLA.Text = "emp1o4 PARAM_FOLIOSC"
                LabelQuery.Text = sqllocal
                If conn2.State = ConnectionState.Closed Then
                    conn2.Open()
                End If
                Dim daFoliosCompras As New SqlDataAdapter(sqllocal, conn2)
                Dim dsFoliosCompras As New DataSet
                'TextErrorEmp2.Text = "prueba 15 recepcion emp1o4" + sqllocal + " mi_BD_x:" + MI_BD_x + "pMiBD:" + pMiBD
                daFoliosCompras.Fill(dsFoliosCompras, "PARAM_FOLIOSC" & pNUMEMP.ToString)
                Dim oTableFoliosCompras As New DataTable
                oTableFoliosCompras = dsFoliosCompras.Tables("PARAM_FOLIOSC" & pNUMEMP.ToString)
                If oTableFoliosCompras.Rows.Count >= 1 Then
                    For Each oRowFoliosCompras In oTableFoliosCompras.Rows
                        FOLIO = oRowFoliosCompras.Item("MASCARA").ToString
                    Next
                End If
                If FOLIO = "" Then
                    'TextErrorEmp2.Text = "prueba 15a1 recepcion emp1o4"
                    MsgBox("Configure la mascara de la clave del documento")
                    Exit Sub
                End If
                Dim CTLPOL As String = "0"
                Dim ESCFD As String = "N"
                Dim CONTADO As String = "N"
                Dim BLOQ As String = "N"
                Dim DES_FIN_PORC As String = "0"
                Dim DES_TOT_PORC As String = "0"
                'TOTAL
                Dim IMPORTE As String = total_te.ToString
                Dim TIP_DOC_ANT As String = ""
                Dim DOC_ANT As String = ""
                Dim TIP_DOC_SIG As String = ""
                Dim DOC_SIG As String = ""
                Dim SigCveDoc As String = ""
                Dim vCveDoc As String = ""
                '---------------------------------------
                objTransRecepcion = conn2.BeginTransaction()
                '--------------------------------------
                'vCveDoc = BuscarClaveDoc()
                '----------------buscar clave del documento
                Dim vcont As String = ""
                Dim vnum As Integer
                Dim reader As SqlDataReader
                'Dim SqlSelection As String = "Select ISNULL(max(CLAVE_DOC),1) AS num from COMPR_CLIB" + pNUMEMP.ToString
                Dim SqlSelection As String = "SELECT ULT_DOC FROM FOLIOSC" + pNUMEMP.ToString +
                " WHERE TIP_DOC='r' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSC" + pNUMEMP.ToString + "  WHERE TIP_DOC='r')"
                LabelTABLA.Text = "emp1o4 SELECT FOLIOSC"
                LabelQuery.Text = sqllocal
                If conn2.State = ConnectionState.Closed Then
                    conn2.Open()
                End If
                cmd = New SqlCommand(SqlSelection, conn2, objTransRecepcion)
                reader = cmd.ExecuteReader()
                While reader.Read()
                    'MsgBox(reader.Item(0))
                    vcont = reader.Item(0).ToString
                    'Convertir a numero y 'aumentar mas uno
                    vcont = Val(vcont) + 1
                    'agregar ceros
                    'vcont = ceros(vnum, 10)
                    'agregar espacios
                    vcont = espacios(vcont, 20)
                    'regresar valor
                    'Me.TextBox1.Text = vcont
                    vCveDoc = vcont
                End While
                reader.Close()
                'cmd.Dispose()
                If vCveDoc <> "" Then
                    'DOC_ANT = ceros(DOC_ANT, 10)
                    DOC_ANT = espacios(DOC_ANT, 20)
                    Dim vfolio As String = vCveDoc
                    sqllocal = "insert into COMPR" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," +
                    "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," +
                    "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," +
                    "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," +
                    "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," +
                    "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG) values (" +
                    "'r','" + vCveDoc.ToString + "','" + CVE_CLPV + "','" + STATUS + "','" + SU_REFER + "','" + FECHA_DOC + "','" + FECHA_REC + "','" +
                    FECHA_PAG + "','" + FECHA_CANCELA + "','" + CAN_TOT.ToString + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + IMP_TOT4 + "','" +
                    DES_TOT + "','" + DES_FIN + "','" + TOT_IND + "','" + OBS_COND + "','" + CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXP + "','" +
                    ACT_COI + "','" + NUM_MONED + "','" + TIPCAMB + "','" + ENLAZADO + "','O','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                    SERIE + "','" + vfolio.ToString + "','" + CTLPOL + "','" + ESCFD + "','" + CONTADO + "','" + BLOQ + "','" + DES_FIN_PORC + "','" +
                    DES_TOT_PORC + "','" + IMPORTE + "','" + TIP_DOC_ANT + "','" + DOC_ANT.ToString + "',NULL,NULL)"
                    LabelTABLA.Text = "emp1o4 COMPR"
                    LabelQuery.Text = sqllocal
                    cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    cmd.ExecuteNonQuery()
                    sqllocal = "insert into  COMPR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                    LabelTABLA.Text = "emp1o4 COMPR_CLIB"
                    LabelQuery.Text = sqllocal
                    cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    cmd.ExecuteNonQuery()
                    sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                    LabelTABLA.Text = "emp1o4 TBLCONTROL"
                    LabelQuery.Text = sqllocal
                    cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    'TextErrorEmp2.Text = "prueba 16 recepcion emp1o4"
                    cmd.ExecuteNonQuery()
                    '---------------------
                    'Dim vCve_Obs As String = TraerClaveSiguiente()
                    Dim vCve_Obs As String
                    Dim vcont7 As String = ""
                    'Dim reader7 As SqlDataReader
                    'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCC" + pNUMEMP.ToString
                    'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    'reader7 = cmd.ExecuteReader()
                    'While reader7.Read()
                    '    'MsgBox(reader7.Item(0))
                    '    vcont7 = reader7.Item(0).ToString
                    '    vcont7 = Val(vcont7) + 1
                    'End While
                    'If vcont7 = "" Then vcont7 = "1"
                    vCve_Obs = vcont7
                    'reader7.Close()
                    '-----------------------------------
                    Dim vObser As String = "Buenas O. C. HH"
                    'sqllocal = "INSERT INTO OBS_DOCC" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                    'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    'cmd.ExecuteNonQuery()
                    'Call UpdateOC(CVE_DOC, vCveDoc)
                    'ultima modificacion comentario
                    'sqllocal = "update COMPO" + pNUMEMP.ToString + " SET ENLAZADO='T', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc + "'" + _
                    '    " WHERE CVE_DOC ='" + CVE_DOC + "'"
                    'LabelTABLA.Text = "emp1o4 COMPO"
                    'LabelQuery.Text = sqllocal
                    'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    'cmd.ExecuteNonQuery()
                    '-------------------------------------------------------------------
                    'Call RecepcionDatalleSAE2(vCveDoc, vObser, CVE_DOC)
                    'Dim CVE_DOC As String
                    Dim NUM_PAR As Integer = 0
                    Dim CVE_ART As String
                    Dim CANT As Integer
                    Dim MERMA As String
                    Dim PXR As String
                    Dim PREC As Double
                    Dim COST As String
                    Dim IMPU1 As String = "0"
                    Dim IMPU2 As String = "0"
                    Dim IMPU3 As String = "0"
                    Dim IMPU4 As String
                    Dim IMP1APLA As String = "6"
                    Dim IMP2APLA As String = "6"
                    Dim IMP3APLA As String = "6"
                    Dim IMP4APLA As String
                    Dim TOTIMP1 As String = "0"
                    Dim TOTIMP2 As String = "0"
                    Dim TOTIMP3 As String = "0"
                    Dim TOTIMP4 As String = "0"
                    Dim DESCU As String = "0"
                    Dim ACT_INV As String = "S"
                    Dim TIP_CAM As String = "1"
                    Dim UNI_VENTA As String = "PZ"
                    Dim TIPO_ELEM As String = "N"
                    Dim TIPO_PROD As String = "P"
                    'Dim CVE_OBS As String
                    Dim REG_SERIE As String = "0"
                    Dim E_LTPD As String = "0"
                    Dim FACTCONV As String = "1"
                    Dim COST_DEV As String = "0"
                    Dim NUM_ALM As String = NUM_ALMA
                    Dim MINDIRECTO As String = "0"
                    Dim NUM_MOV As String
                    Dim TOT_PARTIDA As String
                    Dim vfSubtot As Double = 0
                    '-------------------------------------------------------------------------------------------------
                    'TABLA AFACT ES UN NUMERO POR MES
                    Dim reader2 As SqlDataReader
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    'SqlSelection = "Select upc, quantity_expected, quantity_received, unit_price_te, price_te" + _
                    '" FROM Logistik_supply_order_detail WHERE id_supply_order = '" + OrdenCompra + "'"
                    'SqlSelection = "select codigo_producto, cantidad, merma, costo," +
                    '" id_usuario, fecha, pedido, oc, precio" +
                    '" FROM vLogistik_Kardex WHERE embarque='" + id_pedido + "'"
                    Dim VERSION_SINC As String = DateTime.Now
                    SqlSelection = "select codigo_producto,cantidad,merma,costo," +
                    " id_usuario, fecha, pedido, oc, precio, precio_pesos" +
                    " FROM vLogistik_Kardex WHERE trim(embarque)='" + id_pedido.Trim + "'" +
                    " and trim(vLogistik_Kardex.empresa_destino)='" + EMPRESA_DEST.Trim + "'" +
                    " and trim(vLogistik_Kardex.estado_inicial)='0' and trim(vLogistik_Kardex.estado_final)='1' "
                    LabelTABLA.Text = "emp1o4 vLogistik_Kardex"
                    LabelQuery.Text = SqlSelection
                    cmd = New SqlCommand(SqlSelection, conn)
                    reader2 = cmd.ExecuteReader()
                    While reader2.Read()
                        'MsgBox(reader2.Item(0))
                        'CVE_DOC = reader2.Item(0).ToString
                        NUM_PAR = NUM_PAR + 1
                        CVE_ART = reader2.Item(0).ToString
                        CANT = (reader2.Item(1).ToString)
                        PXR = reader2.Item(1).ToString
                        MERMA = reader2.Item(2).ToString
                        'CANT = Val(CANT)
                        'CANT = Val(CANT) - Val(MERMA)
                        'cambio de 8 por 3
                        PREC = reader2.Item(8).ToString
                        COST = reader2.Item(9).ToString
                        Dim readerPRECIO As SqlDataReader

                        sqllocal = "SELECT PRECIO FROM PRECIO_X_PROD" + pNUMEMP.ToString +
                        " WHERE CVE_ART='" + CVE_ART.ToString + "' AND CVE_PRECIO=1"
                        LabelTABLA.Text = "emp1o4 PRECIO_X_PROD"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        readerPRECIO = cmd.ExecuteReader()
                        While readerPRECIO.Read()
                            PREC = readerPRECIO.Item(0).ToString
                        End While
                        readerPRECIO.Close()
                        'falta el costo
                        'COST = reader2.Item(8).ToString
                        COST_DEV = reader2.Item(8).ToString
                        'iva 16
                        IMPU4 = "16"
                        '1
                        IMP4APLA = "0"
                        'iva total
                        TOTIMP4 = "0"
                        TOTIMP4 = (COST * (Val(IMPU4) / 100) * CANT)
                        'sacar cant * costo
                        TOT_PARTIDA = CANT * COST
                        '-------------------Traer la clave siguiente
                        'CVE_OBS = TraerClaveSiguiente()
                        vcont = "0"
                        'Dim readerObser As SqlDataReader
                        'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCC" + pNUMEMP.ToString
                        'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        'readerObser = cmd.ExecuteReader()
                        'While readerObser.Read()
                        '    'MsgBox(readerObser.Item(0))
                        '    vcont = readerObser.Item(0).ToString
                        '    vcont = Val(vcont) + 1
                        'End While
                        'If vcont = "" Then vcont = "1"
                        CVE_OBS = vcont
                        'readerObser.Close()
                        '-------------------------------------------
                        'sqllocal = "INSERT INTO OBS_DOCC" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + vObser + "')"
                        'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        'cmd.ExecuteNonQuery()
                        '---------------------crear el o los movimientos
                        'Dim vNum_Mov As String = ConsecutivoMovimiento()
                        Dim vNum_Mov As String
                        vcont7 = "0"
                        Dim readerMINVE As SqlDataReader
                        sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num FROM MINVE" + pNUMEMP.ToString
                        LabelTABLA.Text = "emp1o4 MINVE"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        readerMINVE = cmd.ExecuteReader()
                        While readerMINVE.Read()
                            'MsgBox(reader7.Item(0))
                            vcont7 = readerMINVE.Item(0).ToString
                            vcont7 = Val(vcont7) + 1
                        End While
                        If vcont7 = "" Then vcont7 = "1"
                        vNum_Mov = vcont7
                        readerMINVE.Close()
                        ''----------traer la cantidad
                        'Dim readerPC As SqlDataReader
                        'SqlSelection = "select quantity_received from Logistik_supply_order_detail" + _
                        '" where id_supply_order = '" + CVE_DOC + "' and upc = '" + CVE_ART + "'" + _
                        '" AND id_supply_order_detail = '" + NUM_PAR + "'"
                        'conn.Open()
                        'cmd = New SqlCommand(SqlSelection, conn)
                        'readerPC = cmd.ExecuteReader()
                        'While readerPC.Read()
                        '    CANT = readerPC.Item(0).ToString
                        'End While
                        'conn.Close()
                        'readerPC.Close()
                        '-------------------------------------------
                        sqllocal = "insert into  PAR_COMPR" + pNUMEMP.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " +
                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," +
                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," +
                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA, MAN_IEPS, APL_MAN_IMP,CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" +
                        "'" + vCveDoc.ToString + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "','" +
                        PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" +
                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" +
                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" +
                        CVE_OBS + "','" + REG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" +
                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA +
                        "','N','1','0','C','0','0','1')"
                        LabelTABLA.Text = "emp1o4 PAR_COMPR"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        'INSERTAR EL INDICE
                        sqllocal = "insert into  PAR_COMPR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + vCveDoc.ToString + "','" + NUM_PAR.ToString + "')"
                        LabelTABLA.Text = "emp1o4 PAR_COMPR_CLIB"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        'actualizar detalle
                        sqllocal = "update PAR_COMPO" + pNUMEMP.ToString + " set PXR = PXR - " + CANT.ToString +
                        " where CVE_DOC = '" + CVE_DOC.ToString + "' and CVE_ART = '" + CVE_ART + "'"
                        LabelTABLA.Text = "emp1o4 PAR_COMPO"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        'actualizar ACUMULADOR
                        sqllocal = "update ACOMP" + pNUMEMP.ToString + " set RVTA_COM = RVTA_COM + '" + TOT_PARTIDA + "'," +
                        " RIMP = RIMP + '" + TOTIMP4 + "'" +
                        " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                        LabelTABLA.Text = "emp1o4 ACOMP"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()

                        sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                        LabelTABLA.Text = "emp1o4 TBLCONTROL"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        'sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
                        'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        'cmd.ExecuteNonQuery()
                        'sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
                        'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        'cmd.ExecuteNonQuery()
                        'insertar documentos siguientes
                        sqllocal = "INSERT INTO DOCTOSIGC" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                        "PARTIDA, PART_E, CANT_E) VALUES (" +
                        "'r','" + vCveDoc.ToString + "','A','o','" + CVE_DOC.ToString + "','" +
                        NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                        LabelTABLA.Text = "emp1o4 DOCTOSIGC"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        sqllocal = "INSERT INTO DOCTOSIGC" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                        "PARTIDA, PART_E, CANT_E) VALUES (" +
                        "'o','" + CVE_DOC.ToString + "','S','r','" + vCveDoc.ToString + "','" +
                        NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                        LabelTABLA.Text = "emp1o4 DOCTOSIGC2"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        LabelTABLA.Text = "emp1o4 conver_fechas"
                        Dim VERSION_SINC2 As String = Date.Now
                        VERSION_SINC2 = Convert.ToDateTime(VERSION_SINC2).ToString("yyyy/MM/dd HH:mm:ss")
                        VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd")
                        'VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
                        LabelTABLA.Text = "emp1o4 conver_fechas2"
                        'sqllocal = "UPDATE FOLIOSC" + pNUMEMP.ToString + " SET ULT_DOC = ULT_DOC + 1," + _
                        '"FECH_ULT_DOC = '" + VERSION_SINC + "' WHERE TIP_DOC = 'r'"
                        '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                        LabelTABLA.Text = "emp1o4 UPDATE FOLIOSC"

                        LabelQuery.Text = sqllocal
                        'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        'cmd.ExecuteNonQuery()
                        LabelTABLA.Text = "emp1o4 UPDATE2 FOLIOSC"
                        Dim COSTO_PROM As String = COST
                        Dim readerCostoprome As SqlDataReader
                        LabelTABLA.Text = "emp1o4 UPDATE3 FOLIOSC"
                        Dim FORMULA As Double = CANT * Convert.ToDouble(COST)
                        sqllocal = "SELECT ((EXIST*COSTO_PROM+" + FORMULA.ToString + ")/(EXIST+" + CANT.ToString + ")) FROM INVE" + pNUMEMP.ToString +
                        " WHERE CVE_ART='" + CVE_ART.ToString + "'"
                        'sqllocal = "SELECT ((EXIST*COSTO_PROM+100)/(EXIST+15)) FROM INVE" + pNUMEMP.ToString + _
                        '" WHERE CVE_ART='" + CVE_ART.ToString + "'"
                        LabelTABLA.Text = "emp1o4 INVE_COSTO"
                        LabelQuery.Text = sqllocal
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        readerCostoprome = cmd.ExecuteReader()
                        While readerCostoprome.Read()
                            COSTO_PROM = readerCostoprome.Item(0).ToString
                        End While
                        readerCostoprome.Close()
                        'actualizar las existencias
                        'Call ActualizarExistencias(CVE_ART, CANT)
                        'sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST + '" + CANT + "', FCH_ULTCOM='" + time.ToString("yyyy/MM/dd") + "'," + _
                        '" COMP_X_REC = COMP_X_REC - '" + CANT + "', COSTO_PROM = '" + COST + "'," + _
                        '" ULT_COSTO = '" + COST + "', COMP_ANL_C = COMP_ANL_C + '" + CANT + "', COMP_ANL_M = COMP_ANL_M + '" + TOT_PARTIDA + "'" + _
                        '" WHERE CVE_ART ='" + CVE_ART + "'"
                        'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        'cmd.ExecuteNonQuery()
                        sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST + '" + CANT.ToString + "', FCH_ULTCOM='" + time.ToString("yyyy/MM/dd") + "'," +
                        " COMP_X_REC ='0', COSTO_PROM = '" + COSTO_PROM + "',VERSION_SINC = '" + VERSION_SINC2 + "'," +
                        " ULT_COSTO = '" + COST + "', COMP_ANL_C = COMP_ANL_C + '" + CANT.ToString + "', COMP_ANL_M = COMP_ANL_M + '" + TOT_PARTIDA + "'" +
                        " WHERE CVE_ART ='" + CVE_ART + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        '-----------------------------------------------
                        'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                        Dim vExistencia As String = ""
                        Dim reader3 As SqlDataReader
                        sqllocal = "Select ISNULL(max(EXIST),0) AS num from INVE" + pNUMEMP.ToString + " where CVE_ART = '" + CVE_ART + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        reader3 = cmd.ExecuteReader()
                        While reader3.Read()
                            'MsgBox(reader3.Item(0))
                            vExistencia = reader3.Item(0).ToString
                            'vExistencia = Val(vExistencia) + 1
                        End While
                        If vExistencia = "" Then vExistencia = "1"
                        reader3.Close()
                        '--------existe almacen
                        Dim vExistAlm As String
                        Dim rederExistAlm As SqlDataReader
                        sqllocal = "SELECT EXIST FROM MULT" + pNUMEMP.ToString +
                        " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '" + NUM_ALM + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        rederExistAlm = cmd.ExecuteReader()
                        While rederExistAlm.Read
                            vExistAlm = rederExistAlm.Item(0).ToString
                            vExistAlm = Val(vExistAlm) + CANT
                        End While
                        rederExistAlm.Close()
                        '-----------------------------------------------
                        '---------EXTRAER CLAVE DEL FOLIO
                        Dim CVE_FOLIO As String = "0"
                        Dim readerCONTROL As SqlDataReader
                        sqllocal = "Select ULT_CVE AS num FROM TBLCONTROL" + pNUMEMP.ToString + " WHERE ID_TABLA='32'"
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        readerCONTROL = cmd.ExecuteReader()
                        While readerCONTROL.Read()
                            CVE_FOLIO = readerCONTROL.Item(0).ToString
                        End While
                        If CVE_FOLIO = "" Then CVE_FOLIO = "1"
                        readerCONTROL.Close()
                        sqllocal = "INSERT INTO MINVE" + pNUMEMP.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXIST_G, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                        "'" + CVE_ART + "','1','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," +
                        "'r','" + vCveDoc.ToString + "','         1','','" + CANT.ToString + "','0','0','" + COST + "','','" + CVE_OBS + "'," +
                        "'" + REG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + vExistAlm + "','" + TIPO_PROD +
                        "','" + FACTCONV + "','" + time.ToString("yyyy/MM/dd") + "','','" + CVE_FOLIO + "','1','" +
                        "S','0','" + COST + "','N','0')"
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + vObser + "')"
                        'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        'cmd.ExecuteNonQuery()
                        'sqllocal = "UPDATE MULT" + pNUMEMP.ToString + " SET EXIST = EXIST  + " + CANT.ToString + _
                        '    " ,COMP_X_REC = COMP_X_REC - '" + CANT.ToString + "' WHERE CVE_ART = '" + CVE_ART + "' and CVE_ALM = '" + NUM_ALM + "'"
                        'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        'cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE MULT" + pNUMEMP.ToString + " SET EXIST = EXIST  + " + CANT.ToString +
                            " ,COMP_X_REC = '0',VERSION_SINC='" + VERSION_SINC2 + "' WHERE CVE_ART = '" + CVE_ART + "' and CVE_ALM = '" + NUM_ALM + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                        cmd.ExecuteNonQuery()
                        'If PREC = "" Then PREC = "0"
                        'vfSubtot = vfSubtot + (Convert.ToDouble(COST) * CANT)
                        vfSubtot = vfSubtot + (Convert.ToDouble(COST) * Val(CANT))
                    End While
                    reader2.Close()
                    sqllocal = "UPDATE FOLIOSC" + pNUMEMP.ToString + " SET ULT_DOC = ULT_DOC + 1," +
                        "FECH_ULT_DOC = '" + VERSION_SINC + "' WHERE TIP_DOC = 'r'"
                    cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    cmd.ExecuteNonQuery()
                    Dim vfIVA As Double = vfSubtot * 0.16
                    Dim vfNeto As Double = vfSubtot + vfIVA
                    vfNeto = Math.Round(vfNeto, 2)
                    LabelQuery.Text = "Subtotal:" + vfSubtot.ToString + " , iva:" + vfIVA.ToString + " , Neto:" + vfNeto.ToString
                    sqllocal = "update COMPR" + pNUMEMP.ToString + " set CAN_TOT = '" + vfSubtot.ToString + "', IMP_TOT4 = '" + vfIVA.ToString + "'," +
                    " IMPORTE = '" + vfNeto.ToString + "', FECHA_CANCELA = NULL, NUM_PAGOS=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
                    LabelQuery.Text = sqllocal
                    cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    cmd.ExecuteNonQuery()
                    LabelQuery.Text = "Subtotal3:" + vfSubtot.ToString + " , iva:" + vfIVA.ToString + " , Neto:" + vfNeto.ToString
                    'Dim vfIVA As Double = vfSubtot * 0.16
                    'Dim vfNeto As Double = vfSubtot + vfIVA
                    'sqllocal = "update COMPR" + pNUMEMP.ToString + " set CAN_TOT = '" + vfSubtot.ToString + "', IMP_TOT4 = '" + vfIVA.ToString + "'," + _
                    '" IMPORTE = '" + vfNeto.ToString + "', FECHA_CANCELA = NULL, NUM_PAGOS=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
                    'cmd = New SqlCommand(sqllocal, conn2, objTransRecepcion)
                    'cmd.ExecuteNonQuery()
                    '------------------------
                    'TextErrorEmp2.Text = "prueba 16a recepcion emp1o4"
                    objTransRecepcion.Commit()
                    LabelQuery.Text = "Subtotal4:" + vfSubtot.ToString + " , iva:" + vfIVA.ToString + " , Neto:" + vfNeto.ToString
                    empresa = pMiBD.ToString
                    documento = vCveDoc.ToString
                    mensaje = "Registrar Recepcion Correcto:" + vCveDoc.ToString + " Embarque:" + id_pedido.ToString
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    '------------------------
                    'TextErrorEmp2.Text = "prueba 17 recepcion emp1o4"
                End If
                Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'F'" +
                " WHERE embarque = '" + id_pedido + "'"
                'TextErrorEmp2.Text = "prueba 18 recepcion emp1o4"
                EjecutarQuerySQL_EMPRESA_X(sql1, MI_BD)
            Next
            'MsgBox("Almacenado correctamente")
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Registrar Recepcion: InCorrecto Recepcion:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTransRecepcion.Rollback()
            If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                Me.Dispose()
                'FrmLogin.Dispose()
            End If
            Throw es
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Registrar Recepcion: InCorrecto Recepcion:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTransRecepcion.Rollback()
            Throw ex
        Finally
            If conn2.State <> ConnectionState.Closed Then conn2.Close()
        End Try
    End Sub

    'Private Sub SEND_REMISION_EMBARQUE(ByVal pBD_SAE As String, ByVal pNUMEMP As String, ByVal nnBisness As String)
    '    Dim CVE_DOC As String
    '    Dim RFC_DEST As String
    '    Dim EMPRESA_DEST As String
    '    Dim id_pedido As String
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
    '        Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pBD_SAE + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
    '        Dim conn As New SqlConnection(Str)
    '        Dim connFB As New SqlConnection(Str2)
    '        sqllocal = "SELECT * FROM vLogistik_Embarques WHERE enviado_sae='S' AND estado=2"
    '        Dim daPC As New SqlDataAdapter(sqllocal, conn)
    '        Dim dsPC As New DataSet
    '        daPC.Fill(dsPC, "vLogistik_Embarques_Rem")
    '        Dim oTablePC As New DataTable
    '        oTablePC = dsPC.Tables("vLogistik_Embarques_Rem")
    '        Dim OrdenVenta As String
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        For Each oRowPC In oTablePC.Rows
    '            id_pedido = oRowPC.Item("embarque").ToString
    '            OrdenVenta = oRowPC.Item("embarque").ToString
    '            'num_empresa = oRowPC.Item("num_empresa").ToString
    '            'agregar ceros
    '            OrdenVenta = ceros(OrdenVenta, 10)
    '            'agregar espacios
    '            OrdenVenta = espacios(OrdenVenta, 20)
    '            RFC_DEST = oRowPC.Item("rfc_destino").ToString
    '            EMPRESA_DEST = oRowPC.Item("empresa_destino").ToString

    '            Dim TIP_DOC As String
    '            Dim CVE_CLPV As String
    '            Dim STATUS As String
    '            Dim DAT_MOSTR As String
    '            Dim CVE_VEND As String
    '            Dim CVE_PEDI As String = "1"
    '            Dim FECHA_DOC As String
    '            Dim FECHA_ENT As String
    '            Dim FECHA_VEN As String
    '            Dim FECHA_CANCELA As String
    '            Dim CAN_TOT As String
    '            Dim IMP_TOT1 As String
    '            Dim IMP_TOT2 As String
    '            Dim IMP_TOT3 As String
    '            Dim IMP_TOT4 As String
    '            Dim DES_TOT As String
    '            Dim DES_FIN As String
    '            Dim COM_TOT As String
    '            Dim CONDICION As String
    '            Dim CVE_OBS As String
    '            Dim NUM_ALMA As String
    '            Dim ACT_CXC As String
    '            Dim ACT_COI As String
    '            Dim ENLAZADO As String
    '            Dim TIP_DOC_E As String
    '            Dim NUM_MONED As String
    '            Dim TIPCAMB As String
    '            Dim NUM_PAGOS As String
    '            Dim FECHAELAB As String
    '            Dim PRIMERPAGO As String
    '            Dim RFC As String
    '            Dim CTLPOL As String
    '            Dim ESCFD As String
    '            Dim AUTORIZA As String
    '            Dim SERIE As String
    '            Dim FOLIO As String
    '            Dim AUTOANIO As String
    '            Dim DAT_ENVIO As String
    '            Dim CONTADO As String
    '            Dim CVE_BITA As String
    '            Dim BLOQ As String
    '            Dim FORMAENVIO As String
    '            Dim DES_FIN_PORC As String
    '            Dim DES_TOT_PORC As String
    '            Dim IMPORTE As String
    '            Dim COM_TOT_PORC As String
    '            Dim METODODEPAGO As String
    '            Dim NUMCTAPAGO As String
    '            Dim TIP_DOC_ANT As String
    '            Dim DOC_ANT As String
    '            Dim TIP_DOC_SIG As String
    '            Dim DOC_SIG As String
    '            Dim vCveDoc As String = ""

    '            TIP_DOC = "R"
    '            'SigCveDoc = TraerCveDocSigRecep()
    '            'CVE_DOC = SigCveDoc
    '            CVE_DOC = oRowPC.Item("embarque").ToString

    '            RFC = oRowPC.Item("rfc_destino").ToString
    '            CVE_CLPV = "0"
    '            STATUS = "0"
    '            DAT_MOSTR = "0"
    '            CVE_VEND = "0"
    '            CVE_PEDI = "0"

    '            'vfechayhora = oRowPC.Item("date_add").ToString
    '            FECHA_DOC = vfechayhora.ToString("yyyy/MM/dd")
    '            'If FECHA_DOC <> "" Then
    '            '    FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
    '            'End If
    '            FECHA_ENT = vfechayhora.ToString("yyyy/MM/dd")
    '            'If FECHA_ENT <> "" Then
    '            '    FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("dd-MM-yyyy HH:mm:ss.mmm")
    '            'End If
    '            FECHA_VEN = vfechayhora.ToString("yyyy/MM/dd")
    '            'If FECHA_VEN <> "" Then
    '            '    FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("dd-MM-yyyy HH:mm:ss.mmm")
    '            'End If
    '            FECHA_CANCELA = vfechayhora.ToString("yyyy/MM/dd")
    '            'subtotal = total_paid
    '            'total = total_paid_real

    '            'CAN_TOT = oRowPC.Item("total_paid_real").ToString
    '            CAN_TOT = "0"
    '            IMP_TOT1 = "0"
    '            IMP_TOT2 = "0"
    '            IMP_TOT3 = "0"
    '            'Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
    '            'IMP_TOT4 = iva.ToString
    '            IMP_TOT4 = "0"
    '            DES_TOT = "0"
    '            DES_FIN = "0"
    '            COM_TOT = "0"
    '            CONDICION = ""
    '            CVE_OBS = ""
    '            NUM_ALMA = "1"
    '            ACT_CXC = "S"
    '            ACT_COI = "N"
    '            ENLAZADO = "O"
    '            TIP_DOC_E = "O"
    '            NUM_MONED = "1"
    '            TIPCAMB = "1"
    '            NUM_PAGOS = "1"
    '            FECHAELAB = Date.Now
    '            If FECHAELAB <> "" Then
    '                'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
    '                'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
    '                FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss.mmm")
    '            End If
    '            PRIMERPAGO = "0"
    '            'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)

    '            Dim SqlA As String = "SELECT CLAVE FROM CLIE" + nnBisness.ToString +
    '            " WHERE  RFC = '" + Trim(RFC) + "'"
    '            Dim da7 As New SqlDataAdapter(SqlA, connFB)
    '            Dim ds7 As New DataSet
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            da7.Fill(ds7, "CLIENTE" + nnBisness.ToString)
    '            Dim oTable As New DataTable
    '            oTable = ds7.Tables("CLIENTE" + nnBisness.ToString)
    '            If connFB.State = ConnectionState.Open Then
    '                connFB.Close()
    '            End If

    '            If oTable.Rows.Count >= 1 Then
    '                For Each oRow55 In oTable.Rows
    '                    CVE_CLPV = oRow55.Item("CLAVE").ToString
    '                Next
    '            End If
    '            If Trim(CVE_CLPV) <> "MOSTR" Then
    '                CVE_CLPV = espacios(CVE_CLPV, 10)
    '            End If
    '            CTLPOL = "0"
    '            ESCFD = "N"
    '            AUTORIZA = "1"
    '            SERIE = ""
    '            FOLIO = Nothing
    '            SqlA = "Select MASCARA FROM PARAM_FOLIOSF" + nnBisness.ToString +
    '                " WHERE TIPODOCTO = 'R'"
    '            Dim da77 As New SqlDataAdapter(SqlA, connFB)
    '            Dim ds77 As New DataSet
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            da77.Fill(ds77, "PARAM_FOLIOSF" + nnBisness.ToString)
    '            Dim oTable77 As New DataTable
    '            oTable77 = ds77.Tables("PARAM_FOLIOSF" + nnBisness.ToString)
    '            If connFB.State = ConnectionState.Open Then
    '                connFB.Close()
    '            End If

    '            If oTable77.Rows.Count >= 1 Then
    '                For Each oRow77 In oTable77.Rows
    '                    FOLIO = oRow77.Item("MASCARA").ToString
    '                Next
    '            End If
    '            If FOLIO = "" Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Sub
    '            End If
    '            AUTOANIO = ""
    '            DAT_ENVIO = "0"
    '            CONTADO = "N"
    '            CVE_BITA = "2"
    '            BLOQ = "N"
    '            FORMAENVIO = ""
    '            'descuentos
    '            DES_FIN_PORC = "0"
    '            DES_TOT_PORC = "0"
    '            'IMPORTE = oRowPC.Item("total_paid").ToString
    '            IMPORTE = "0"
    '            COM_TOT_PORC = "0"
    '            METODODEPAGO = ""
    '            NUMCTAPAGO = ""
    '            TIP_DOC_ANT = "P"
    '            DOC_ANT = ""
    '            TIP_DOC_SIG = Nothing
    '            DOC_SIG = Nothing
    '            'vCveDoc = BuscarClaveDoc()
    '            '----------------buscar clave del documento
    '            '----------------buscar clave del documento
    '            Dim vcont As String = ""
    '            Dim vnum As Integer
    '            SqlA = "SELECT ULT_DOC FROM FOLIOSF" + nnBisness.ToString +
    '            " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + nnBisness.ToString + " WHERE TIP_DOC='R')"
    '            Dim da55 As New SqlDataAdapter(SqlA, connFB)
    '            Dim ds55 As New DataSet
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            da55.Fill(ds55, "FOLIOSF" + nnBisness.ToString)
    '            Dim oTable55 As New DataTable
    '            oTable55 = ds55.Tables("FOLIOSF" + nnBisness.ToString)
    '            'If connFB.State = ConnectionState.Open Then
    '            '    connFB.Close()
    '            'End If

    '            If oTable55.Rows.Count >= 1 Then
    '                For Each oRow55 In oTable55.Rows
    '                    vcont = oRow55.Item("ULT_DOC").ToString
    '                    If vcont = "" Or vcont = "0" Then vcont = "1"
    '                    'Convertir a numero y 'aumentar mas uno
    '                    vcont = Val(vcont) + 1
    '                    'agregar(ceros)
    '                    vcont = ceros(vcont, 10)
    '                    'agregar espacios
    '                    vcont = espacios(vcont, 20)
    '                    'regresar valor
    '                    'Me.TextBox1.Text = vcont
    '                    vCveDoc = vcont
    '                Next
    '            End If
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            '---------------------------------------
    '            objTrans = connFB.BeginTransaction()
    '            '--------------------------------------
    '            If vCveDoc <> "" Then
    '                DOC_ANT = ceros(DOC_ANT, 10)
    '                DOC_ANT = espacios(DOC_ANT, 20)
    '                Dim vUUID = Guid.NewGuid.ToString()
    '                'TRAER CLAVE BITA
    '                ''------------------------------------------------
    '                Dim readerBita As SqlDataReader
    '                Dim vBita As String
    '                sqllocal = "Select coalesce(max(CVE_BITA),1) AS num FROM BITA" + nnBisness.ToString
    '                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                readerBita = cmd.ExecuteReader()
    '                While readerBita.Read()
    '                    vBita = readerBita.Item(0).ToString
    '                    CVE_BITA = Val(vBita) + 1
    '                End While
    '                readerBita.Close()

    '                sqllocal = "insert into  FACTR" + nnBisness.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
    '                ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
    '                ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
    '                ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
    '                ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
    '                ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
    '                ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
    '                ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
    '                ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
    '                ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
    '                ",DOC_ANT,TIP_DOC_SIG,DOC_SIG) values (" +
    '                "'R','" + vCveDoc + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" +
    '                CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" +
    '                FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" +
    '                IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" +
    '                CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" +
    '                "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
    '                PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" +
    '                SERIE + "','" + vCveDoc + "','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" +
    '                CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" +
    '                IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" +
    '                DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "')"
    '                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                cmd.ExecuteNonQuery()

    '                sqllocal = "insert into FACTR_CLIB" + nnBisness.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
    '                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                cmd.ExecuteNonQuery()

    '                ''INSERT TABLA BITA
    '                sqllocal = "INSERT INTO BITA" + nnBisness.ToString +
    '                "(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" +
    '                " VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + IMPORTE.ToString + "', 'F', 'Administrador')"
    '                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                cmd.ExecuteNonQuery()

    '                sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
    '                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                cmd.ExecuteNonQuery()

    '                sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 62"
    '                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                cmd.ExecuteNonQuery()
    '                ''---------------------
    '                ''Dim vCve_Obs As String = TraerClaveSiguiente()
    '                'Dim vCve_Obs As String
    '                'Dim vcont7 As String = ""
    '                'Dim reader7 As SqlDataReader
    '                'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
    '                'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
    '                'reader7 = cmd.ExecuteReader()
    '                'While reader7.Read()
    '                '    'MsgBox(reader7.Item(0))
    '                '    vcont7 = reader7.Item(0).ToString
    '                '    vcont7 = Val(vcont7) + 1
    '                'End While
    '                'If vcont7 = "" Then vcont7 = "1"
    '                'vCve_Obs = vcont7
    '                'reader7.Close()
    '                ''-----------------------------------
    '                'Dim vObser As String = "Buenas Remisión HH"
    '                'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
    '                'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
    '                'cmd.ExecuteNonQuery()
    '                ''Call UpdateOC(CVE_DOC, vCveDoc)
    '                'sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
    '                '" WHERE CVE_DOC ='" + CVE_DOC + "'"
    '                'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
    '                'cmd.ExecuteNonQuery()
    '                Dim pIdPedido As String = id_pedido
    '                Dim pcvedoc As String = vCveDoc
    '                Dim pObser As String = "0" 'vObser
    '                Dim pcve_doc_origen As String = CVE_DOC
    '                Dim VEND As String = CVE_VEND
    '                Dim pAlmacen As String = NUM_ALMA
    '                Dim pCve_Cliente As String = CVE_CLPV
    '                'Dim CVE_DOC As String
    '                Dim NUM_PAR As Integer = 1
    '                Dim CVE_ART As String
    '                Dim vlsubtotal As Double
    '                Dim CANT As Double
    '                Dim CANTp As Double
    '                Dim PXS As String
    '                Dim PREC As String
    '                Dim COST As String
    '                Dim IMPU1 As String
    '                Dim IMPU2 As String
    '                Dim IMPU3 As String
    '                Dim IMPU4 As Integer
    '                Dim IMP1APLA As String
    '                Dim IMP2APLA As String
    '                Dim IMP3APLA As String
    '                Dim IMP4APLA As String
    '                Dim TOTIMP1 As String
    '                Dim TOTIMP2 As String
    '                Dim TOTIMP3 As String
    '                Dim TOTIMP4 As String
    '                Dim DESC1 As String
    '                Dim DESC2 As String
    '                Dim DESC3 As String
    '                Dim COMI As String
    '                Dim APAR As String
    '                Dim ACT_INV As String
    '                Dim NUM_ALM As String = pAlmacen
    '                Dim POLIT_APLI As String
    '                Dim TIP_CAM As String
    '                Dim UNI_VENTA As String
    '                Dim TIPO_PROD As String
    '                'Dim CVE_OBS As String
    '                Dim REG_SERIE As String
    '                Dim E_LTPD As String
    '                Dim TIPO_ELEM As String
    '                Dim NUM_MOV As String
    '                Dim TOT_PARTIDA As String
    '                Dim IMPRIMIR As String
    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                '''''''''''''''''''''''''''''detalle
    '                'aqui vamos
    '                Dim reader2 As SqlDataReader
    '                'Dim SqlSelection As String = "SELECT id_order_detail,id_order,product_upc,product_price,quantity_received" + _
    '                '",total_shipping_price_tax_incl FROM Logistik_order_detail WHERE id_order ='" + pIdPedido + "'"
    '                Dim SqlSelection As String = "select id_usuario,fecha, " +
    '                "codigo_producto,cantidad,merma,pedido, oc, precio" +
    '                " FROM vLogistik_Kardex WHERE embarque='" + pIdPedido + "'"
    '                cmd = New SqlCommand(SqlSelection, conn)
    '                reader2 = cmd.ExecuteReader()
    '                'If conn.State = ConnectionState.Open Then
    '                '    conn.Close()
    '                'End If
    '                ' esta variable controla el consecutivo de las series
    '                Dim mREG_SERIE As String
    '                ' esta variable controla una sola entrada al ciclo de las series
    '                Dim vlMaxNum As Boolean = True
    '                If connFB.State = ConnectionState.Closed Then
    '                    connFB.Open()
    '                End If
    '                'objTransFB = connFB.BeginTransaction()
    '                Dim vcantfalsa As Double = 0
    '                Dim merma As Double = 0
    '                While reader2.Read()
    '                    CVE_DOC = pcvedoc
    '                    CVE_ART = reader2.Item(2).ToString
    '                    vcantfalsa = reader2.Item(3).ToString
    '                    merma = reader2.Item(4).ToString
    '                    CANTp = Convert.ToString(vcantfalsa - merma)
    '                    CANT = Convert.ToString(vcantfalsa - merma)
    '                    PXS = Convert.ToString(vcantfalsa - merma)
    '                    PREC = reader2.Item(7).ToString
    '                    COST = "0"
    '                    '-------------------------------------------------------------------------------------
    '                    If connFB.State = ConnectionState.Closed Then
    '                        connFB.Open()
    '                    End If
    '                    Dim reader7 As SqlDataReader
    '                    sqllocal = "SELECT INV7.COSTO_PROM, INV7.ULT_COSTO FROM INVE" + nnBisness.ToString + " AS INV7 WHERE INV7.CVE_ART = '" + CVE_ART.ToString + "'"
    '                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                    reader7 = cmd.ExecuteReader()
    '                    While reader7.Read()
    '                        Dim ExistA As Double
    '                        ExistA = Convert.ToDouble(reader7.Item(0).ToString)
    '                        'ExistA = Math.Round(ExistA, 2)
    '                        COST = ExistA.ToString
    '                        If COST = "" Or COST = "0" Then
    '                            ExistA = Convert.ToDouble(reader7.Item(1).ToString)
    '                            'ExistA = Math.Round(ExistA, 2)
    '                            COST = ExistA.ToString
    '                        End If

    '                    End While
    '                    reader7.Close()
    '                    'If connFB.State = ConnectionState.Open Then
    '                    '    connFB.Close()
    '                    'End If
    '                    '---------------------------------------------------------------------------------

    '                    '-------------------------------------------------------------------------------
    '                    'SqlA = "SELECT COSTO_PROM, ULT_COSTO FROM INVE" + vgNumEmpresa.ToString + _
    '                    '" WHERE CVE_ART = '" + CVE_ART.ToString + "'"
    '                    'Dim da25 As New FbDataAdapter(SqlA, connFB)
    '                    'Dim ds25 As New DataSet
    '                    'If connFB.State = ConnectionState.Closed Then
    '                    '    connFB.Open()
    '                    'End If
    '                    'da25.Fill(ds25, "INVE" + vgNumEmpresa.ToString)
    '                    'Dim oTable25 As New DataTable
    '                    'oTable25 = ds25.Tables("INVE" + vgNumEmpresa.ToString)
    '                    'If oTable25.Rows.Count >= 1 Then
    '                    '    For Each oRow25 In oTable25.Rows
    '                    '        COST = oRow25.Item("COSTO_PROM").ToString
    '                    '        If COST = "" Or COST = "0" Then COST = oRow25.Item("ULT_COSTO").ToString
    '                    '    Next
    '                    'End If
    '                    '---------------------------------------------------------------------------------

    '                    IMPU1 = "0"
    '                    IMPU2 = "0"
    '                    IMPU3 = "0"

    '                    IMPU4 = "16"
    '                    IMP1APLA = "6"
    '                    IMP2APLA = "6"
    '                    IMP3APLA = "6"
    '                    IMP4APLA = "0"
    '                    TOTIMP1 = "0"
    '                    TOTIMP2 = "0"
    '                    TOTIMP3 = "0"
    '                    'iva
    '                    TOTIMP4 = "16"
    '                    DESC1 = "0"
    '                    DESC2 = "0"
    '                    DESC3 = "0"
    '                    COMI = "0"
    '                    APAR = "0"
    '                    ACT_INV = "S"
    '                    POLIT_APLI = ""
    '                    TIP_CAM = "1"
    '                    UNI_VENTA = "pz"
    '                    TIPO_PROD = "P"

    '                    CVE_OBS = "0"
    '                    REG_SERIE = "0"
    '                    'tiene lotes
    '                    E_LTPD = "0"
    '                    TIPO_ELEM = "N"
    '                    'consecutivo

    '                    'NUM_MOV = reader2.Item(34).ToString
    '                    'cantidad por pecio
    '                    TOT_PARTIDA = Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)
    '                    TOTIMP4 = (Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)) * (IMPU4 / 100)
    '                    IMPRIMIR = ""
    '                    'Dim Sql As String
    '                    '-------------------Traer la clave siguiente
    '                    ''CVE_OBS = TraerClaveSiguiente()
    '                    'Dim vcont As String = ""
    '                    ''Dim vnum As Integer
    '                    'Dim reader As FbDataReader
    '                    'Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
    '                    'cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                    'reader = cmdFB.ExecuteReader()
    '                    'While reader.Read()
    '                    '    'MsgBox(reader.Item(0))
    '                    '    vcont = reader.Item(0).ToString
    '                    '    vcont = Val(vcont) + 1
    '                    'End While
    '                    'If vcont = "" Then vcont = "1"
    '                    'CVE_OBS = vcont
    '                    'reader.Close()

    '                    'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()
    '                    '---------------------crear el o los movimientos
    '                    'Dim vNum_Mov As String = ConsecutivoMovimiento()
    '                    Dim vNum_Mov As String
    '                    Dim vcont77 As String = ""
    '                    Dim reader77 As SqlDataReader
    '                    Dim SQL As String = "Select coalesce(max(NUM_MOV),1) AS num FROM MINVE" + nnBisness.ToString
    '                    cmd = New SqlCommand(SQL, connFB, objTrans)
    '                    reader77 = cmd.ExecuteReader()
    '                    While reader77.Read()
    '                        'MsgBox(reader7.Item(0))
    '                        vcont77 = reader77.Item(0).ToString
    '                        vcont77 = Val(vcont77) + 1
    '                    End While
    '                    If vcont77 = "" Then vcont77 = "1"
    '                    vNum_Mov = vcont77
    '                    reader77.Close()
    '                    '----------tiene pedimento y numero de serie
    '                    Dim vlPedimento As String = "N"
    '                    Dim vlNumSer As String = "N"
    '                    'Dim readerPedi As SqlDataReader
    '                    'SqlSelection = "SELECT Pedimento, NumSerie FROM Logistik_product" + _
    '                    '" WHERE upc = '" + CVE_ART + "'"
    '                    'conn.Open()
    '                    'cmd = New SqlCommand(SqlSelection, conn)
    '                    'readerPedi = cmd.ExecuteReader()
    '                    'While readerPedi.Read()
    '                    '    vlPedimento = readerPedi.Item(0)
    '                    '    vlNumSer = readerPedi.Item(1)
    '                    'End While
    '                    'conn.Close()
    '                    'readerPedi.Close()
    '                    If vlNumSer = "S" Then
    '                        '--------------------------------------------------------------
    '                        'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
    '                        '---------------------------------------------------------------
    '                        '--------------------------H NUMEROS DE SERIE
    '                        If vlMaxNum = True Then
    '                            Dim readerNumSerie3 As SqlDataReader
    '                            SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
    '                            '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                            If connFB.State = ConnectionState.Closed Then
    '                                connFB.Open()
    '                            End If
    '                            cmd = New SqlCommand(SqlSelection, connFB, objTrans)
    '                            readerNumSerie3 = cmd.ExecuteReader()
    '                            While readerNumSerie3.Read()
    '                                mREG_SERIE = readerNumSerie3.Item(0).ToString
    '                                mREG_SERIE = Val(mREG_SERIE) + 1
    '                            End While
    '                            'If connFB.State = ConnectionState.Open Then
    '                            '    connFB.Close()
    '                            'End If
    '                            readerNumSerie3.Close()
    '                            vlMaxNum = False
    '                        End If
    '                        '---------------------------------------------------
    '                        Dim nNUM_SER As String
    '                        Dim nCOSTO As String
    '                        Dim nDOCTO_ENT As String
    '                        Dim nFECHA_ENT As String
    '                        Dim nREG_SERIE As String
    '                        Dim readerNumSerie As SqlDataReader
    '                        'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
    '                        '" FROM Logistik_numeros_series" + _
    '                        '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                        '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
    '                        SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" +
    '                        " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" +
    '                        " WHERE h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" +
    '                        " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART +
    '                        "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='M'"
    '                        If conn.State = ConnectionState.Closed Then
    '                            conn.Open()
    '                        End If
    '                        cmd = New SqlCommand(SqlSelection, conn)
    '                        readerNumSerie = cmd.ExecuteReader()
    '                        If connFB.State = ConnectionState.Closed Then
    '                            connFB.Open()
    '                        End If
    '                        While readerNumSerie.Read()
    '                            Dim NumSer_Cve_Doc As String = Trim(pcve_doc_origen.ToString)
    '                            'NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
    '                            nNUM_SER = readerNumSerie.Item(0).ToString
    '                            nCOSTO = readerNumSerie.Item(1).ToString
    '                            nDOCTO_ENT = readerNumSerie.Item(2).ToString
    '                            nFECHA_ENT = readerNumSerie.Item(3).ToString
    '                            nREG_SERIE = readerNumSerie.Item(4).ToString
    '                            If nFECHA_ENT <> "" Then
    '                                nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
    '                            End If

    '                            sqllocal = "UPDATE NUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', COSTO = '" + nCOSTO + "', " +
    '                            "DOCTO_ENT = '" + NumSer_Cve_Doc + "', FECHA_ENT = '" + nFECHA_ENT + "'" +
    '                            " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'"
    '                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                            cmd.ExecuteNonQuery()

    '                            sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V'," +
    '                            "TIP_MOV = '51', CVE_DOC ='" + NumSer_Cve_Doc + "', REG_SERIE = '" + mREG_SERIE + "'" +
    '                           " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER +
    '                           "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" ' AND REG_SERIE = '" + nREG_SERIE + "'"
    '                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                            cmd.ExecuteNonQuery()

    '                            ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                            'sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'V'" + _
    '                            '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                            '" and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'" + _
    '                            '" AND NUM_SER ='" + nNUM_SER + "'"
    '                            'cmd = New SqlCommand(sqllocal, conn)
    '                            'cmd.ExecuteNonQuery()

    '                        End While
    '                        If conn.State = ConnectionState.Open Then
    '                            conn.Close()
    '                        End If
    '                        readerNumSerie.Close()
    '                        '--------------------------H NUMEROS DE SERIE
    '                        'Dim nREG_SERIE As String
    '                        'Dim readerNumSerie3 As SqlDataReader
    '                        'SqlSelection = "SELECT NUM_SER, REG_SERIE" + _
    '                        '" FROM Logistik_Hnumeros_series" + _
    '                        '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                        'conn.Open()
    '                        'cmd = New SqlCommand(SqlSelection, conn)
    '                        'readerNumSerie3 = cmd.ExecuteReader()
    '                        'While readerNumSerie3.Read()
    '                        '    nNUM_SER = readerNumSerie3.Item(0).ToString
    '                        '    nREG_SERIE = readerNumSerie3.Item(1).ToString
    '                        '    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', TIP_MOV = '51', CVE_DOC ='" + pcve_doc_origen.ToString + "'" + _
    '                        '    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
    '                        '    "' AND ALMACEN = '" + NUM_ALM + "' AND REG_SERIE = '" + nREG_SERIE + "'"
    '                        '    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        '    cmdFB.ExecuteNonQuery()
    '                        'End While
    '                        'conn.Close()
    '                        'readerNumSerie3.Close()
    '                        '--------------------------------------------------------------
    '                        'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
    '                        '--------------------------------------------------------------
    '                    End If
    '                    If vlPedimento = "S" Then


    '                        '---------------------------------------------------------------
    '                        'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
    '                        '---------------------------------------------------------------
    '                        '---- extraer el consecutivo REG_LTPD de SAE
    '                        Dim pREG_LTPD As String
    '                        'Dim readerMAx As FbDataReader
    '                        'sqllocal = "Select coalesce(max(REG_LTPD),1) AS num FROM LTPD" + vgNumEmpresa.ToString
    '                        'If connFB.State = ConnectionState.Closed Then
    '                        '    connFB.Open()
    '                        'End If
    '                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        'readerMAx = cmdFB.ExecuteReader()
    '                        'While readerMAx.Read()
    '                        '    'MsgBox(reader7.Item(0))
    '                        '    pREG_LTPD = readerMAx.Item(0).ToString
    '                        '    pREG_LTPD = Val(pREG_LTPD) + 1
    '                        'End While
    '                        'If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                        'readerMAx.Close()
    '                        '---EXTRAER DATOS DEL SQL
    '                        Dim pLOTE As String
    '                        Dim pPEDIMENTO As String
    '                        Dim pFCHCADUC As String
    '                        Dim pFCHADUANA As String
    '                        Dim pFCHULTMOV As String
    '                        Dim pNOM_ADUAN As String
    '                        Dim pCANTIDAD As Double
    '                        Dim pCVE_OBS As String
    '                        Dim pCIUDAD As String
    '                        Dim pFRONTERA As String
    '                        Dim pFEC_PROD_LT As String
    '                        Dim pGLN As String
    '                        Dim pSTATUS As String
    '                        'Dim readerPedimento As SqlDataReader
    '                        'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                        '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                        '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                        '"STATUS, REG_LTPD  FROM Logistik_Lote_Pedimento" + _
    '                        '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                        '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'"
    '                        'If conn.State = ConnectionState.Closed Then
    '                        '    conn.Open()
    '                        'End If
    '                        'cmd = New SqlCommand(SqlSelection, conn)
    '                        'readerPedimento = cmd.ExecuteReader()
    '                        Dim readerPedimento As SqlDataReader
    '                        SQL = "SELECT LOTE ,PEDIMENTO, FCHCADUC," +
    '                        "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," +
    '                        "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," +
    '                        "STATUS, REG_LTPD  FROM LTPD" + vgNumEmpresa.ToString +
    '                        " WHERE CVE_ALM = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" +
    '                        " and CANTIDAD > '0'"
    '                        'If conn.State = ConnectionState.Closed Then
    '                        '    conn.Open()
    '                        'End If
    '                        'cmd = New SqlCommand(SqlSelection, conn)
    '                        'readerPedimento = cmd.ExecuteReader()
    '                        cmd = New SqlCommand(SQL, connFB, objTrans)
    '                        readerPedimento = cmd.ExecuteReader()
    '                        Dim vvCantFaltante As Double = CANT
    '                        While readerPedimento.Read()
    '                            pLOTE = readerPedimento.Item(0).ToString
    '                            pPEDIMENTO = readerPedimento.Item(1).ToString
    '                            pFCHCADUC = readerPedimento.Item(2).ToString
    '                            pFCHADUANA = readerPedimento.Item(3).ToString
    '                            pFCHULTMOV = readerPedimento.Item(4).ToString
    '                            pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                            pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
    '                            pCVE_OBS = readerPedimento.Item(7).ToString
    '                            pCIUDAD = readerPedimento.Item(8).ToString
    '                            pFRONTERA = readerPedimento.Item(9).ToString
    '                            pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                            pGLN = readerPedimento.Item(11).ToString
    '                            pSTATUS = readerPedimento.Item(12).ToString
    '                            pREG_LTPD = readerPedimento.Item(13).ToString

    '                            If pFCHCADUC <> "" Then
    '                                pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                            End If
    '                            If pFCHADUANA <> "" Then
    '                                pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                            End If
    '                            If pFCHULTMOV <> "" Then
    '                                pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                            End If
    '                            If pFEC_PROD_LT <> "" Then
    '                                pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                            End If

    '                            '------------------INSERTAR PEDIMENTOS EN SAE
    '                            sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
    '                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                            cmd.ExecuteNonQuery()
    '                            sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                            cmd.ExecuteNonQuery()

    '                            'sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = '" + pCANTIDAD.ToString + "'" + _
    '                            '" WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                            '" AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            'cmdFB.ExecuteNonQuery()

    '                            If pCANTIDAD >= vvCantFaltante Then
    '                                sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + vvCantFaltante.ToString +
    '                                " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
    '                                " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                                cmd.ExecuteNonQuery()
    '                            Else
    '                                sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + pCANTIDAD.ToString +
    '                                " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
    '                                " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                                cmd.ExecuteNonQuery()
    '                                '9 >= 10
    '                                '10 - 9 = 1
    '                                vvCantFaltante = CANT - pCANTIDAD
    '                            End If

    '                            'sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                            '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                            '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                            '"STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + NUM_ALM + "','" + pFCHCADUC + "','" + _
    '                            ' pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD + "','" + pREG_LTPD + "','" + _
    '                            ' pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                            'cmdFB.ExecuteNonQuery()

    '                            '---- extraer MAXIMO el E_LTPD de SAE
    '                            Dim readerLTPD As SqlDataReader
    '                            sqllocal = "Select MAX(E_LTPD) AS NUM FROM ENLACE_LTPD" + vgNumEmpresa.ToString
    '                            If connFB.State = ConnectionState.Closed Then
    '                                connFB.Open()
    '                            End If
    '                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                            readerLTPD = cmd.ExecuteReader()
    '                            While readerLTPD.Read()
    '                                'MsgBox(reader7.Item(0))
    '                                E_LTPD = readerLTPD.Item(0).ToString
    '                                E_LTPD = Val(E_LTPD) + 1
    '                            End While
    '                            If E_LTPD = "" Then E_LTPD = "1"
    '                            readerLTPD.Close()
    '                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" +
    '                            E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                            cmd.ExecuteNonQuery()
    '                            If pCANTIDAD >= vvCantFaltante Then
    '                                Exit While
    '                            End If
    '                            ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                            'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
    '                            '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                            '"' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
    '                            '" AND REG_LTPD = '" + pREG_LTPD.ToString + "'"
    '                            'cmd = New SqlCommand(SqlSelection, conn)
    '                            'cmd.ExecuteNonQuery()

    '                        End While
    '                        If conn.State = ConnectionState.Open Then
    '                            conn.Close()
    '                        End If
    '                        readerPedimento.Close()
    '                        '---------------------------------------------------------------
    '                        'END INSERTAR PEDIMENTOS
    '                        '---------------------------------------------------------------
    '                    End If
    '                    vUUID = Guid.NewGuid.ToString()
    '                    If vlNumSer = "S" Then
    '                        sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
    '                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
    '                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
    '                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
    '                        "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
    '                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
    '                        IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
    '                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
    '                        DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
    '                        NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
    '                        CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
    '                        TOT_PARTIDA + "','" + POLIT_APLI + "')"
    '                    Else
    '                        If vgVersion = "5" Then
    '                            sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
    '                            ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
    '                            ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
    '                            ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
    '                            "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
    '                            PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
    '                            IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
    '                            TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
    '                            DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
    '                            NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
    '                            CVE_OBS + "','0','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
    '                            TOT_PARTIDA + "','" + POLIT_APLI + "')"
    '                        End If
    '                        Dim VERSION_SINC As String = vfechayhora
    '                        VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
    '                        If vgVersion = "6" Or vgVersion = "7" Then
    '                            sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
    '                            ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
    '                            ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
    '                            ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" +
    '                            ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ, UUID) values (" +
    '                            "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" +
    '                            PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" +
    '                            IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" +
    '                            TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" +
    '                            DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" +
    '                            Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" +
    '                            CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" +
    '                            TOT_PARTIDA.ToString + "','S','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1','" + vUUID + "')"
    '                        End If

    '                    End If
    '                    If connFB.State = ConnectionState.Closed Then
    '                        connFB.Open()
    '                    End If
    '                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                    cmd.ExecuteNonQuery()

    '                    'INSERTAR EL INDICE
    '                    sqllocal = "insert into  PAR_FACTR_CLIB" + nnBisness.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR.ToString + "')"
    '                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                    cmd.ExecuteNonQuery()
    '                    'actualizar detalle PAR_FACTP01
    '                    'sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString + _
    '                    '" WHERE CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()
    '                    'actualizar ACUMULADOR de remisiones y facturas
    '                    '-----------camision del vendedor
    '                    'If pComicion = "" Then pComicion = "0"
    '                    'If Val(pComicion) >= 1 Then
    '                    '    Dim VLcomi As String = (pComicion / 100) * TOT_PARTIDA
    '                    '    sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '                    '    " RIMP = RIMP + " + TOTIMP4 + ", RCOMI = RCOMI + " + VLcomi + _
    '                    '    " WHERE CVE_AFACT = '11'"
    '                    'Else
    '                    'TOT_ARTIDA = PRECIO POR CANTIDAD

    '                    sqllocal = "update AFACT" + nnBisness.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," +
    '                    " RIMP = RIMP + " + TOTIMP4 + "" +
    '                    " WHERE CVE_AFACT = '3'"
    '                    'End If
    '                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                    cmd.ExecuteNonQuery()
    '                    '---------EXTRAER CLAVE DEL FOLIO
    '                    Dim CVE_FOLIO As String = "0"
    '                    Dim readerCONTROL As SqlDataReader
    '                    SQL = "Select ULT_CVE AS num FROM TBLCONTROL" + nnBisness.ToString + " WHERE ID_TABLA='32'"
    '                    cmd = New SqlCommand(SQL, connFB, objTrans)
    '                    readerCONTROL = cmd.ExecuteReader()
    '                    While readerCONTROL.Read()
    '                        'MsgBox(reader3.Item(0))
    '                        CVE_FOLIO = readerCONTROL.Item(0).ToString
    '                        'vExistencia = Val(vExistencia) + 1
    '                    End While
    '                    If CVE_FOLIO = "" Then CVE_FOLIO = "1"
    '                    readerCONTROL.Close()
    '                    '-----------------------------------------------
    '                    sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
    '                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                    cmd.ExecuteNonQuery()



    '                    'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()

    '                    ''insertar documentos siguientes
    '                    'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '                    '"PARTIDA, PART_E, CANT_E) VALUES (" + _
    '                    '"'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" + _
    '                    'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()
    '                    'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '                    '"PARTIDA, PART_E, CANT_E) VALUES (" + _
    '                    '"'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" + _
    '                    'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()
    '                    '-------------------------------------------------------------------------------
    '                    'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
    '                    ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
    '                    'cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                    'cmd.ExecuteNonQuery()
    '                    '-----------------------------------------------------------------------------
    '                    'actualizar las existencias
    '                    'Call ActualizarExistencias(CVE_ART, CANT)
    '                    'sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    '" PEND_SURT = PEND_SURT - " + CANT.ToString + ", COSTO_PROM = '" + COST + "'," + _
    '                    '" ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
    '                    '" WHERE CVE_ART ='" + CVE_ART + "'"
    '                    time = Today.Now
    '                    sqllocal = "update INVE" + nnBisness.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
    '                    " COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
    '                    "VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" +
    '                    " WHERE CVE_ART ='" + CVE_ART + "'"
    '                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                    cmd.ExecuteNonQuery()
    '                    '-----------------------------------------------
    '                    'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
    '                    Dim vExistencia As String = ""
    '                    Dim reader3 As SqlDataReader
    '                    SQL = "Select ISNULL(max(EXIST),0) AS num FROM INVE" + nnBisness.ToString + " WHERE CVE_ART = '" + CVE_ART + "'"
    '                    cmd = New SqlCommand(SQL, connFB, objTrans)
    '                    reader3 = cmd.ExecuteReader()
    '                    While reader3.Read()
    '                        'MsgBox(reader3.Item(0))
    '                        vExistencia = reader3.Item(0).ToString
    '                        'vExistencia = Val(vExistencia) - Val(CANT)
    '                    End While
    '                    If vExistencia = "" Then vExistencia = "1"
    '                    reader3.Close()
    '                    '--------existe almacen
    '                    Dim vExistAlm As String
    '                    Dim rederExistAlm As SqlDataReader
    '                    SQL = "SELECT EXIST FROM MULT" + nnBisness.ToString +
    '                    " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '" + NUM_ALM + "'"
    '                    cmd = New SqlCommand(SQL, connFB, objTrans)
    '                    rederExistAlm = cmd.ExecuteReader()
    '                    While rederExistAlm.Read
    '                        vExistAlm = rederExistAlm.Item(0).ToString
    '                        vExistAlm = Val(vExistAlm) - CANT
    '                    End While
    '                    rederExistAlm.Close()
    '                    If vlNumSer = "S" Then
    '                        sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
    '                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
    '                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
    '                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
    '                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
    '                        "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" +
    '                        "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
    '                        "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
    '                        "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
    '                        "S','0','" + COST + "','N','0')"
    '                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                        cmd.ExecuteNonQuery()
    '                    Else
    '                        If vgVersion = "5" Then
    '                            sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
    '                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
    '                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
    '                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
    '                            "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
    '                            "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" +
    '                            "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
    '                            "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
    '                            "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
    '                            "S','0','" + COST + "','N','0')"
    '                        End If
    '                        If vgVersion = "6" Or vgVersion = "7" Then
    '                            sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
    '                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
    '                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
    '                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" +
    '                            "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov.ToString + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
    '                            "'R','" + pcvedoc.ToString + "','" + pCve_Cliente + "','" + VEND.ToString + "','" + CANT.ToString + "','" +
    '                            "0','" + PREC.ToString + "','" + COST.ToString + "','','" + CVE_OBS.ToString + "'," +
    '                            "'0','" + UNI_VENTA.ToString + "','" + E_LTPD.ToString + "','" + vExistAlm + "','" + TIPO_PROD + "','" +
    '                            "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO.ToString + "','-1','" +
    '                            "S','" + COST.ToString + "','" + COST.ToString + "','N','0','" + vExistencia.ToString + "','" + COST.ToString + "')"
    '                        End If
    '                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                        cmd.ExecuteNonQuery()
    '                        sqllocal = "UPDATE MINVE" + nnBisness.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " +
    '                        " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" +
    '                        " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
    '                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                        cmd.ExecuteNonQuery()
    '                        Dim VERSION_SINC As String
    '                        VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
    '                        sqllocal = "UPDATE MULT" + nnBisness.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" +
    '                        " WHERE CVE_ART = '" + CVE_ART + "'" +
    '                        " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
    '                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                        cmd.ExecuteNonQuery()
    '                    End If
    '                    'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()
    '                    mREG_SERIE = Val(mREG_SERIE) + 1
    '                    vlsubtotal = vlsubtotal + (PREC * CANT)
    '                    NUM_PAR = NUM_PAR + 1
    '                End While
    '                reader2.Close()
    '                CAN_TOT = vlsubtotal.ToString
    '                Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
    '                IMP_TOT4 = iva.ToString
    '                sqllocal = "UPDATE FOLIOSF" + nnBisness.ToString + " SET ULT_DOC = ULT_DOC + 1, FECH_ULT_DOC = '" + vfechayhora.ToString("yyyy/MM/dd") + "'" +
    '                " WHERE TIP_DOC = 'R'"
    '                'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
    '                '" WHERE TIP_DOC = 'R' and serie ='STAND.'"
    '                '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
    '                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                cmd.ExecuteNonQuery()
    '                sqllocal = "UPDATE FACTR" + nnBisness.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
    '                " ,CAN_TOT='" + CAN_TOT + "', IMP_TOT4 = '" + IMP_TOT4 + "'" +
    '                " WHERE CVE_DOC = '" + vCveDoc + "'"
    '                cmd = New SqlCommand(sqllocal, connFB, objTrans)
    '                cmd.ExecuteNonQuery()
    '                '------------------------
    '                objTrans.Commit()
    '                '------------------------
    '            End If
    '            OrdenVenta = Val(OrdenVenta)
    '            OrdenVenta = espacios(OrdenVenta, 20)
    '            Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'F'" +
    '            " WHERE embarque = '" + Trim(OrdenVenta) + "'"
    '            EjecutarQuerySQL_EMPRESA6(sql1)
    '        Next
    '        'MsgBox("Almacenado correctamente")
    '    Catch es As SqlException
    '        TextError.Text = TextError.Text + "Empresa:" + vgEmpresa.ToString + " Llevar Remision:" + CVE_DOC.ToString + vbCrLf + es.Message.ToString

    '        objTrans.Rollback()
    '        Throw es
    '    Catch ex As Exception
    '        TextError.Text = TextError.Text + "Empresa:" + vgEmpresa.ToString + " Llevar Remision:" + CVE_DOC.ToString + vbCrLf + ex.Message.ToString

    '        '***** rollback the transaction ************************************************'
    '        objTrans.Rollback()
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Sub


    Private Sub EmbarquesKardex(ByVal pEMP06BD As String)
        'CONEXION BASICA LOGISTIK_ALMACEN
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim conn As New SqlConnection(Str)
        sqllocal = "SELECT embarque,id_proveedor,factura,oc," +
        "fecha_recepcion,id_usuario_recibio,fecha_calificacion,id_usuario_califico,fecha_liberacion," +
        "id_usuario_libero,contenido,estado,completo,empresa_destino," +
        "enviado_sae, rfc_destino FROM vLogistik_Embarques" +
        " WHERE enviado_sae='N' and estado=3" ' and empresa_destino<>''"
        Dim daPC As New SqlDataAdapter(sqllocal, conn)
        Dim dsPC As New DataSet
        daPC.Fill(dsPC, "vLogistik_Embarques")
        Dim oTablePC As New DataTable
        oTablePC = dsPC.Tables("vLogistik_Embarques")
        Dim EmpresaDest As String
        Dim id_pedido As String = ""
        Dim num_empresa As String
        For Each oRowPC In oTablePC.Rows
            id_pedido = oRowPC.Item("embarque").ToString
            Dim SqlSelection As String = "select empresa_destino" +
            " FROM vLogistik_Kardex WHERE embarque='" + id_pedido + "'" +
            " GROUP BY empresa_destino"
            Dim daPC_Det As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC_Det As New DataSet
            daPC_Det.Fill(dsPC_Det, "vLogistik_Kardex")
            Dim oTablePC_det As New DataTable
            oTablePC_det = dsPC_Det.Tables("vLogistik_Kardex")
            If oTablePC_det.Rows.Count = 1 Then
                For Each oRowPC_det In oTablePC_det.Rows
                    EmpresaDest = Trim(oRowPC_det.Item("empresa_destino").ToString)
                    Call RemisionesComprasaVentas(pEMP06BD, EmpresaDest, id_pedido)
                Next
            End If
            If oTablePC_det.Rows.Count = 2 Then
                For Each oRowPC_det In oTablePC_det.Rows
                    EmpresaDest = Trim(oRowPC_det.Item("empresa_destino").ToString)
                    If EmpresaDest = "01" Then
                        Call RemisionesComprasaVentasEmp01(pEMP06BD, EmpresaDest, id_pedido)
                    End If
                    If EmpresaDest = "04" Then
                        Call RemisionesComprasaVentasEmp04(pEMP06BD, EmpresaDest, id_pedido)
                    End If
                Next
            End If
        Next
    End Sub
    Private Sub RemisionesComprasaVentasEmp01(ByVal pEMP06BD As String, ByVal EMPRESA_DEST As String, id_pedido As String)
        Dim CVE_DOC As String
        Dim RFC_DEST As String
        'Dim EMPRESA_DEST As String
        Try
            Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn7 As New SqlConnection(Str7)
            Dim sql As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Compra'"
            Dim dataadapterBD As New SqlDataAdapter(sql, conn7)
            Dim dsCargarbd As New DataSet()
            dataadapterBD.Fill(dsCargarbd, "EmpresaSAE")
            Dim oTabla7 As DataTable
            oTabla7 = dsCargarbd.Tables("EmpresaSAE")
            Dim SERVIDOR As String = ""
            Dim USUARIO As String = ""
            Dim NOMBRE_BD As String = ""
            Dim PASSWROD As String = ""
            Dim BASEDATOS As String = ""
            'Dim VTIPO As String = ""
            If oTabla7.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla7.Rows
                    SERVIDOR = oFila.Item("SERVIDOR").ToString
                    BASEDATOS = oFila.Item("BASEDATOS").ToString
                    USUARIO = oFila.Item("USUARIO").ToString
                    PASSWROD = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness = Mid(NOMBRE_BD, LongitudBD)
            'CONEXION BASICA LOGISTIK_ALMACEN
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim conn As New SqlConnection(Str)
            'CONEXION COMPRAS
            Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim connFB As New SqlConnection(Str2)

            Dim BIEN As Integer = 0
            'sqllocal = "SELECT embarque,id_proveedor,factura,oc," +
            '"fecha_recepcion,id_usuario_recibio,fecha_calificacion,id_usuario_califico,fecha_liberacion," +
            '"id_usuario_libero,contenido,estado,completo,empresa_destino," +
            '"enviado_sae, rfc_destino FROM vLogistik_Embarques" +
            '" WHERE enviado_sae='N' and estado=3" ' and empresa_destino<>''"

            'sqllocal = "select vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
            '        "vLogistik_Kardex.pedido, vLogistik_Kardex.precio, vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino" +
            '        " FROM vLogistik_Kardex, vLogistik_Embarques WHERE vLogistik_Kardex.embarque= vLogistik_Embarques.embarque" &
            '        " and vLogistik_Embarques.enviado_sae='N'and vLogistik_Embarques.estado=3" +
            '        " and vLogistik_Kardex.empresa_destino='" + EMPRESA_DEST.Trim + "'"

            sqllocal = "select vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino" +
                    " FROM vLogistik_Kardex, vLogistik_Embarques WHERE vLogistik_Kardex.embarque= vLogistik_Embarques.embarque" +
                    " and vLogistik_Embarques.enviado_sae='N'and vLogistik_Embarques.estado=3" +
                    " and vLogistik_Kardex.empresa_destino='01'" +
                    " and vLogistik_Kardex.embarque='" + id_pedido.Trim + "'" +
                    " group by vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino"

            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "vLogistik_Embarques")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("vLogistik_Embarques")
            Dim OrdenVenta As String
            If connFB.State = ConnectionState.Closed Then
                connFB.Open()
            End If
            'Dim id_pedido As String = ""
            Dim num_empresa As String
            For Each oRowPC In oTablePC.Rows
                id_pedido = oRowPC.Item("embarque").ToString
                OrdenVenta = oRowPC.Item("embarque").ToString
                'num_empresa = oRowPC.Item("num_empresa").ToString
                'agregar ceros
                OrdenVenta = ceros(OrdenVenta, 10)
                'agregar espacios
                OrdenVenta = espacios(OrdenVenta, 20)
                RFC_DEST = oRowPC.Item("rfc_destino").ToString
                'EMPRESA_DEST = oRowPC.Item("empresa_destino").ToString

                Dim TIP_DOC As String
                Dim CVE_CLPV As String
                Dim STATUS As String
                Dim DAT_MOSTR As String
                Dim CVE_VEND As String
                Dim CVE_PEDI As String = "1"
                Dim FECHA_DOC As String
                Dim FECHA_ENT As String
                Dim FECHA_VEN As String
                Dim FECHA_CANCELA As String
                Dim CAN_TOT As String
                Dim IMP_TOT1 As String
                Dim IMP_TOT2 As String
                Dim IMP_TOT3 As String
                Dim IMP_TOT4 As String
                Dim DES_TOT As String
                Dim DES_FIN As String
                Dim COM_TOT As String
                Dim CONDICION As String
                Dim CVE_OBS As String
                Dim NUM_ALMA As String
                Dim ACT_CXC As String
                Dim ACT_COI As String
                Dim ENLAZADO As String
                Dim TIP_DOC_E As String
                Dim NUM_MONED As String
                Dim TIPCAMB As String
                Dim NUM_PAGOS As String
                Dim FECHAELAB As String
                Dim PRIMERPAGO As String
                Dim RFC As String
                Dim CTLPOL As String
                Dim ESCFD As String
                Dim AUTORIZA As String
                Dim SERIE As String
                Dim FOLIO As String
                Dim AUTOANIO As String
                Dim DAT_ENVIO As String
                Dim CONTADO As String
                Dim CVE_BITA As String
                Dim BLOQ As String
                Dim FORMAENVIO As String
                Dim DES_FIN_PORC As String
                Dim DES_TOT_PORC As String
                Dim IMPORTE As String
                Dim COM_TOT_PORC As String
                Dim METODODEPAGO As String
                Dim NUMCTAPAGO As String
                Dim TIP_DOC_ANT As String
                Dim DOC_ANT As String
                Dim TIP_DOC_SIG As String
                Dim DOC_SIG As String
                Dim vCveDoc As String = ""

                TIP_DOC = "R"
                'SigCveDoc = TraerCveDocSigRecep()
                'CVE_DOC = SigCveDoc
                CVE_DOC = oRowPC.Item("embarque").ToString

                RFC = oRowPC.Item("rfc_destino").ToString
                CVE_CLPV = "0"
                STATUS = "0"
                DAT_MOSTR = "0"
                CVE_VEND = "0"
                CVE_PEDI = "0"

                'vfechayhora = oRowPC.Item("date_add").ToString
                FECHA_DOC = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_DOC <> "" Then
                '    FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_ENT = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_ENT <> "" Then
                '    FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_VEN = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_VEN <> "" Then
                '    FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_CANCELA = vfechayhora.ToString("yyyy/MM/dd")
                'subtotal = total_paid
                'total = total_paid_real

                'CAN_TOT = oRowPC.Item("total_paid_real").ToString
                CAN_TOT = "0"
                IMP_TOT1 = "0"
                IMP_TOT2 = "0"
                IMP_TOT3 = "0"
                'Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
                'IMP_TOT4 = iva.ToString
                IMP_TOT4 = "0"
                DES_TOT = "0"
                DES_FIN = "0"
                COM_TOT = "0"
                CONDICION = ""
                CVE_OBS = ""
                NUM_ALMA = "1"
                ACT_CXC = "S"
                ACT_COI = "N"
                ENLAZADO = "O"
                TIP_DOC_E = "O"
                NUM_MONED = "1"
                TIPCAMB = "1"
                NUM_PAGOS = "1"
                FECHAELAB = Date.Now
                If FECHAELAB <> "" Then
                    'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
                    'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
                    FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                End If
                PRIMERPAGO = "0"
                'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)

                Dim SqlA As String = "SELECT CLAVE FROM CLIE" + nnBisness.ToString +
                " WHERE  RFC = '" + Trim(RFC) + "'"
                Dim da7 As New SqlDataAdapter(SqlA, connFB)
                Dim ds7 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                da7.Fill(ds7, "CLIENTE" + nnBisness.ToString)
                Dim oTable As New DataTable
                oTable = ds7.Tables("CLIENTE" + nnBisness.ToString)
                If connFB.State = ConnectionState.Open Then
                    connFB.Close()
                End If

                If oTable.Rows.Count >= 1 Then
                    For Each oRow55 In oTable.Rows
                        CVE_CLPV = oRow55.Item("CLAVE").ToString
                    Next
                End If
                If Trim(CVE_CLPV) <> "MOSTR" Then
                    CVE_CLPV = espacios(CVE_CLPV, 10)
                End If
                CTLPOL = "0"
                ESCFD = "N"
                AUTORIZA = "1"
                SERIE = ""
                FOLIO = Nothing
                SqlA = "Select MASCARA FROM PARAM_FOLIOSF" + nnBisness.ToString +
                    " WHERE TIPODOCTO = 'R'"
                Dim da77 As New SqlDataAdapter(SqlA, connFB)
                Dim ds77 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                da77.Fill(ds77, "PARAM_FOLIOSF" + nnBisness.ToString)
                Dim oTable77 As New DataTable
                oTable77 = ds77.Tables("PARAM_FOLIOSF" + nnBisness.ToString)
                If connFB.State = ConnectionState.Open Then
                    connFB.Close()
                End If

                If oTable77.Rows.Count >= 1 Then
                    For Each oRow77 In oTable77.Rows
                        FOLIO = oRow77.Item("MASCARA").ToString
                    Next
                End If
                If FOLIO = "" Then
                    MsgBox("Configure la mascara de la clave del documento")
                    Exit Sub
                End If
                AUTOANIO = ""
                DAT_ENVIO = "0"
                CONTADO = "N"
                CVE_BITA = "2"
                BLOQ = "N"
                FORMAENVIO = ""
                'descuentos
                DES_FIN_PORC = "0"
                DES_TOT_PORC = "0"
                'IMPORTE = oRowPC.Item("total_paid").ToString
                IMPORTE = "0"
                COM_TOT_PORC = "0"
                METODODEPAGO = ""
                NUMCTAPAGO = ""
                TIP_DOC_ANT = "P"
                DOC_ANT = ""
                TIP_DOC_SIG = Nothing
                DOC_SIG = Nothing
                'vCveDoc = BuscarClaveDoc()
                '----------------buscar clave del documento
                '----------------buscar clave del documento
                Dim vcont As String = ""
                Dim vnum As Integer
                SqlA = "SELECT ULT_DOC FROM FOLIOSF" + nnBisness.ToString +
                " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + nnBisness.ToString + " WHERE TIP_DOC='R')"
                Dim da55 As New SqlDataAdapter(SqlA, connFB)
                Dim ds55 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                da55.Fill(ds55, "FOLIOSF" + nnBisness.ToString)
                Dim oTable55 As New DataTable
                oTable55 = ds55.Tables("FOLIOSF" + nnBisness.ToString)
                'If connFB.State = ConnectionState.Open Then
                '    connFB.Close()
                'End If

                If oTable55.Rows.Count >= 1 Then
                    For Each oRow55 In oTable55.Rows
                        vcont = oRow55.Item("ULT_DOC").ToString
                        If vcont = "" Or vcont = "0" Then vcont = "1"
                        'Convertir a numero y 'aumentar mas uno
                        vcont = Val(vcont) + 1
                        'agregar(ceros)
                        vcont = ceros(vcont, 10)
                        'agregar espacios
                        vcont = espacios(vcont, 20)
                        'regresar valor
                        'Me.TextBox1.Text = vcont
                        vCveDoc = vcont
                    Next
                End If
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                '---------------------------------------
                objTrans = connFB.BeginTransaction()
                '--------------------------------------
                If vCveDoc <> "" Then
                    DOC_ANT = ceros(DOC_ANT, 10)
                    DOC_ANT = espacios(DOC_ANT, 20)
                    Dim vUUID = Guid.NewGuid.ToString()
                    vUUID = UCase(vUUID)
                    'TRAER CLAVE BITA
                    ''------------------------------------------------
                    Dim readerBita As SqlDataReader
                    Dim vBita As String
                    sqllocal = "Select coalesce(max(CVE_BITA),1) AS num FROM BITA" + nnBisness.ToString
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    readerBita = cmd.ExecuteReader()
                    While readerBita.Read()
                        vBita = readerBita.Item(0).ToString
                        CVE_BITA = Val(vBita) + 1
                    End While
                    readerBita.Close()
                    sqllocal = "insert into  FACTR" + nnBisness.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                    ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                    ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                    ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                    ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                    ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                    ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                    ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                    ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                    ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                    ",DOC_ANT,TIP_DOC_SIG,DOC_SIG) values (" +
                    "'R','" + vCveDoc + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" +
                    CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" +
                    FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" +
                    IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" +
                    CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" +
                    "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                    PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" +
                    SERIE + "','" + vCveDoc + "','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" +
                    CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" +
                    IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" +
                    DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "')"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    sqllocal = "insert into FACTR_CLIB" + nnBisness.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    ''INSERT TABLA BITA
                    sqllocal = "INSERT INTO BITA" + nnBisness.ToString +
                    "(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" +
                    " VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + IMPORTE.ToString + "', 'F', 'Administrador')"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 62"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    ''---------------------
                    ''Dim vCve_Obs As String = TraerClaveSiguiente()
                    'Dim vCve_Obs As String
                    'Dim vcont7 As String = ""
                    'Dim reader7 As SqlDataReader
                    'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
                    'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                    'reader7 = cmd.ExecuteReader()
                    'While reader7.Read()
                    '    'MsgBox(reader7.Item(0))
                    '    vcont7 = reader7.Item(0).ToString
                    '    vcont7 = Val(vcont7) + 1
                    'End While
                    'If vcont7 = "" Then vcont7 = "1"
                    'vCve_Obs = vcont7
                    'reader7.Close()
                    ''-----------------------------------
                    'Dim vObser As String = "Buenas Remisión HH"
                    'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                    'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                    'cmd.ExecuteNonQuery()
                    ''Call UpdateOC(CVE_DOC, vCveDoc)
                    'sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
                    '" WHERE CVE_DOC ='" + CVE_DOC + "'"
                    'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                    'cmd.ExecuteNonQuery()
                    Dim pIdPedido As String = id_pedido
                    Dim pcvedoc As String = vCveDoc
                    Dim pObser As String = "0" 'vObser
                    Dim pcve_doc_origen As String = CVE_DOC
                    Dim VEND As String = CVE_VEND
                    Dim pAlmacen As String = NUM_ALMA
                    Dim pCve_Cliente As String = CVE_CLPV
                    'Dim CVE_DOC As String
                    Dim NUM_PAR As Integer = 1
                    Dim CVE_ART As String
                    Dim vlsubtotal As Double
                    Dim CANT As Double
                    Dim CANTp As Double
                    Dim PXS As String
                    Dim PREC As String
                    Dim COST As String
                    Dim IMPU1 As String
                    Dim IMPU2 As String
                    Dim IMPU3 As String
                    Dim IMPU4 As Integer
                    Dim IMP1APLA As String
                    Dim IMP2APLA As String
                    Dim IMP3APLA As String
                    Dim IMP4APLA As String
                    Dim TOTIMP1 As String
                    Dim TOTIMP2 As String
                    Dim TOTIMP3 As String
                    Dim TOTIMP4 As String
                    Dim DESC1 As String
                    Dim DESC2 As String
                    Dim DESC3 As String
                    Dim COMI As String
                    Dim APAR As String
                    Dim ACT_INV As String
                    Dim NUM_ALM As String = pAlmacen
                    Dim POLIT_APLI As String
                    Dim TIP_CAM As String
                    Dim UNI_VENTA As String
                    Dim TIPO_PROD As String
                    'Dim CVE_OBS As String
                    Dim REG_SERIE As String
                    Dim E_LTPD As String
                    Dim TIPO_ELEM As String
                    Dim NUM_MOV As String
                    Dim TOT_PARTIDA As String = ""
                    Dim IMPRIMIR As String
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    '''''''''''''''''''''''''''''detalle
                    'aqui vamos
                    Dim reader2 As SqlDataReader
                    'Dim SqlSelection As String = "SELECT id_order_detail,id_order,product_upc,product_price,quantity_received" + _
                    '",total_shipping_price_tax_incl FROM Logistik_order_detail WHERE id_order ='" + pIdPedido + "'"

                    Dim SqlSelection As String = "select id_usuario,fecha, " +
                    "codigo_producto,cantidad,merma,pedido, oc, precio, empresa_destino, rfc_destino" +
                    " FROM vLogistik_Kardex WHERE embarque='" + pIdPedido.Trim + "'" +
                    " AND empresa_destino = '01'"

                    cmd = New SqlCommand(SqlSelection, conn)
                    reader2 = cmd.ExecuteReader()
                    'If conn.State = ConnectionState.Open Then
                    '    conn.Close()
                    'End If
                    ' esta variable controla el consecutivo de las series
                    Dim mREG_SERIE As String
                    ' esta variable controla una sola entrada al ciclo de las series
                    Dim vlMaxNum As Boolean = True
                    If connFB.State = ConnectionState.Closed Then
                        connFB.Open()
                    End If
                    'objTransFB = connFB.BeginTransaction()
                    Dim vcantfalsa As Double = 0
                    Dim merma As Double = 0
                    While reader2.Read()
                        CVE_DOC = pcvedoc
                        CVE_ART = reader2.Item(2).ToString
                        vcantfalsa = reader2.Item(3).ToString
                        merma = reader2.Item(4).ToString
                        CANTp = Convert.ToString(vcantfalsa - merma)
                        CANT = Convert.ToString(vcantfalsa - merma)
                        PXS = Convert.ToString(vcantfalsa - merma)
                        PREC = reader2.Item(7).ToString
                        COST = "0"
                        '-------------------------------------------------------------------------------------
                        If connFB.State = ConnectionState.Closed Then
                            connFB.Open()
                        End If
                        Dim reader7 As SqlDataReader
                        sqllocal = "SELECT INV7.COSTO_PROM, INV7.ULT_COSTO FROM INVE" + nnBisness.ToString + " AS INV7 WHERE INV7.CVE_ART = '" + CVE_ART.ToString + "'"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        reader7 = cmd.ExecuteReader()
                        While reader7.Read()
                            Dim ExistA As Double
                            ExistA = Convert.ToDouble(reader7.Item(0).ToString)
                            'ExistA = Math.Round(ExistA, 2)
                            COST = ExistA.ToString
                            If COST = "" Or COST = "0" Then
                                ExistA = Convert.ToDouble(reader7.Item(1).ToString)
                                'ExistA = Math.Round(ExistA, 2)
                                COST = ExistA.ToString
                            End If

                        End While
                        reader7.Close()
                        'If connFB.State = ConnectionState.Open Then
                        '    connFB.Close()
                        'End If
                        '---------------------------------------------------------------------------------

                        '-------------------------------------------------------------------------------
                        'SqlA = "SELECT COSTO_PROM, ULT_COSTO FROM INVE" + vgNumEmpresa.ToString + _
                        '" WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                        'Dim da25 As New FbDataAdapter(SqlA, connFB)
                        'Dim ds25 As New DataSet
                        'If connFB.State = ConnectionState.Closed Then
                        '    connFB.Open()
                        'End If
                        'da25.Fill(ds25, "INVE" + vgNumEmpresa.ToString)
                        'Dim oTable25 As New DataTable
                        'oTable25 = ds25.Tables("INVE" + vgNumEmpresa.ToString)
                        'If oTable25.Rows.Count >= 1 Then
                        '    For Each oRow25 In oTable25.Rows
                        '        COST = oRow25.Item("COSTO_PROM").ToString
                        '        If COST = "" Or COST = "0" Then COST = oRow25.Item("ULT_COSTO").ToString
                        '    Next
                        'End If
                        '---------------------------------------------------------------------------------

                        IMPU1 = "0"
                        IMPU2 = "0"
                        IMPU3 = "0"
                        IMPU4 = "16"
                        IMP1APLA = "6"
                        IMP2APLA = "6"
                        IMP3APLA = "6"
                        IMP4APLA = "0"
                        TOTIMP1 = "0"
                        TOTIMP2 = "0"
                        TOTIMP3 = "0"
                        'iva
                        TOTIMP4 = "16"
                        DESC1 = "0"
                        DESC2 = "0"
                        DESC3 = "0"
                        COMI = "0"
                        APAR = "0"
                        ACT_INV = "S"
                        POLIT_APLI = ""
                        TIP_CAM = "1"
                        UNI_VENTA = "pz"
                        TIPO_PROD = "P"

                        CVE_OBS = "0"
                        REG_SERIE = "0"
                        'tiene lotes
                        E_LTPD = "0"
                        TIPO_ELEM = "N"
                        'consecutivo

                        'NUM_MOV = reader2.Item(34).ToString
                        'cantidad por pecio
                        'If PREC <> "" Then

                        TOT_PARTIDA = Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)
                        TOTIMP4 = (Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)) * (IMPU4 / 100)
                        IMPRIMIR = ""

                        'Else
                        'objTrans.Rollback()
                        'End If

                        'Dim Sql As String
                        '-------------------Traer la clave siguiente
                        ''CVE_OBS = TraerClaveSiguiente()
                        'Dim vcont As String = ""
                        ''Dim vnum As Integer
                        'Dim reader As FbDataReader
                        'Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
                        'cmdFB = New FbCommand(Sql, connFB, objTransFB)
                        'reader = cmdFB.ExecuteReader()
                        'While reader.Read()
                        '    'MsgBox(reader.Item(0))
                        '    vcont = reader.Item(0).ToString
                        '    vcont = Val(vcont) + 1
                        'End While
                        'If vcont = "" Then vcont = "1"
                        'CVE_OBS = vcont
                        'reader.Close()

                        'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        '---------------------crear el o los movimientos
                        'Dim vNum_Mov As String = ConsecutivoMovimiento()
                        Dim vNum_Mov As String
                        Dim vcont77 As String = ""
                        Dim reader77 As SqlDataReader
                        sql = "Select coalesce(max(NUM_MOV),1) AS num FROM MINVE" + nnBisness.ToString
                        cmd = New SqlCommand(sql, connFB, objTrans)
                        reader77 = cmd.ExecuteReader()
                        While reader77.Read()
                            'MsgBox(reader7.Item(0))
                            vcont77 = reader77.Item(0).ToString
                            vcont77 = Val(vcont77) + 1
                        End While
                        If vcont77 = "" Then vcont77 = "1"
                        vNum_Mov = vcont77
                        reader77.Close()
                        '----------tiene pedimento y numero de serie
                        Dim vlPedimento As String = "N"
                        Dim vlNumSer As String = "N"
                        'Dim readerPedi As SqlDataReader
                        'SqlSelection = "SELECT Pedimento, NumSerie FROM Logistik_product" + _
                        '" WHERE upc = '" + CVE_ART + "'"
                        'conn.Open()
                        'cmd = New SqlCommand(SqlSelection, conn)
                        'readerPedi = cmd.ExecuteReader()
                        'While readerPedi.Read()
                        '    vlPedimento = readerPedi.Item(0)
                        '    vlNumSer = readerPedi.Item(1)
                        'End While
                        'conn.Close()
                        'readerPedi.Close()
                        If vlNumSer = "S" Then
                            '--------------------------------------------------------------
                            'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
                            '---------------------------------------------------------------
                            '--------------------------H NUMEROS DE SERIE
                            If vlMaxNum = True Then
                                Dim readerNumSerie3 As SqlDataReader
                                SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
                                '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
                                If connFB.State = ConnectionState.Closed Then
                                    connFB.Open()
                                End If
                                cmd = New SqlCommand(SqlSelection, connFB, objTrans)
                                readerNumSerie3 = cmd.ExecuteReader()
                                While readerNumSerie3.Read()
                                    mREG_SERIE = readerNumSerie3.Item(0).ToString
                                    mREG_SERIE = Val(mREG_SERIE) + 1
                                End While
                                'If connFB.State = ConnectionState.Open Then
                                '    connFB.Close()
                                'End If
                                readerNumSerie3.Close()
                                vlMaxNum = False
                            End If
                            '---------------------------------------------------
                            Dim nNUM_SER As String
                            Dim nCOSTO As String
                            Dim nDOCTO_ENT As String
                            Dim nFECHA_ENT As String
                            Dim nREG_SERIE As String
                            Dim readerNumSerie As SqlDataReader
                            'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
                            '" FROM Logistik_numeros_series" + _
                            '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
                            '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
                            SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" +
                            " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" +
                            " WHERE h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" +
                            " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART +
                            "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='M'"
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            cmd = New SqlCommand(SqlSelection, conn)
                            readerNumSerie = cmd.ExecuteReader()
                            If connFB.State = ConnectionState.Closed Then
                                connFB.Open()
                            End If
                            While readerNumSerie.Read()
                                Dim NumSer_Cve_Doc As String = Trim(pcve_doc_origen.ToString)
                                'NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
                                nNUM_SER = readerNumSerie.Item(0).ToString
                                nCOSTO = readerNumSerie.Item(1).ToString
                                nDOCTO_ENT = readerNumSerie.Item(2).ToString
                                nFECHA_ENT = readerNumSerie.Item(3).ToString
                                nREG_SERIE = readerNumSerie.Item(4).ToString
                                If nFECHA_ENT <> "" Then
                                    nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
                                End If

                                sqllocal = "UPDATE NUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', COSTO = '" + nCOSTO + "', " +
                                "DOCTO_ENT = '" + NumSer_Cve_Doc + "', FECHA_ENT = '" + nFECHA_ENT + "'" +
                                " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()

                                sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V'," +
                                "TIP_MOV = '51', CVE_DOC ='" + NumSer_Cve_Doc + "', REG_SERIE = '" + mREG_SERIE + "'" +
                               " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER +
                               "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" ' AND REG_SERIE = '" + nREG_SERIE + "'"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()

                                ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
                                'sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'V'" + _
                                '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
                                '" and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'" + _
                                '" AND NUM_SER ='" + nNUM_SER + "'"
                                'cmd = New SqlCommand(sqllocal, conn)
                                'cmd.ExecuteNonQuery()

                            End While
                            If conn.State = ConnectionState.Open Then
                                conn.Close()
                            End If
                            readerNumSerie.Close()
                            '--------------------------H NUMEROS DE SERIE
                            'Dim nREG_SERIE As String
                            'Dim readerNumSerie3 As SqlDataReader
                            'SqlSelection = "SELECT NUM_SER, REG_SERIE" + _
                            '" FROM Logistik_Hnumeros_series" + _
                            '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
                            'conn.Open()
                            'cmd = New SqlCommand(SqlSelection, conn)
                            'readerNumSerie3 = cmd.ExecuteReader()
                            'While readerNumSerie3.Read()
                            '    nNUM_SER = readerNumSerie3.Item(0).ToString
                            '    nREG_SERIE = readerNumSerie3.Item(1).ToString
                            '    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', TIP_MOV = '51', CVE_DOC ='" + pcve_doc_origen.ToString + "'" + _
                            '    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
                            '    "' AND ALMACEN = '" + NUM_ALM + "' AND REG_SERIE = '" + nREG_SERIE + "'"
                            '    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            '    cmdFB.ExecuteNonQuery()
                            'End While
                            'conn.Close()
                            'readerNumSerie3.Close()
                            '--------------------------------------------------------------
                            'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
                            '--------------------------------------------------------------
                        End If
                        If vlPedimento = "S" Then
                            '---------------------------------------------------------------
                            'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
                            '---------------------------------------------------------------
                            '---- extraer el consecutivo REG_LTPD de SAE
                            Dim pREG_LTPD As String
                            'Dim readerMAx As FbDataReader
                            'sqllocal = "Select coalesce(max(REG_LTPD),1) AS num FROM LTPD" + vgNumEmpresa.ToString
                            'If connFB.State = ConnectionState.Closed Then
                            '    connFB.Open()
                            'End If
                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            'readerMAx = cmdFB.ExecuteReader()
                            'While readerMAx.Read()
                            '    'MsgBox(reader7.Item(0))
                            '    pREG_LTPD = readerMAx.Item(0).ToString
                            '    pREG_LTPD = Val(pREG_LTPD) + 1
                            'End While
                            'If pREG_LTPD = "" Then pREG_LTPD = "1"
                            'readerMAx.Close()
                            '---EXTRAER DATOS DEL SQL
                            Dim pLOTE As String
                            Dim pPEDIMENTO As String
                            Dim pFCHCADUC As String
                            Dim pFCHADUANA As String
                            Dim pFCHULTMOV As String
                            Dim pNOM_ADUAN As String
                            Dim pCANTIDAD As Double
                            Dim pCVE_OBS As String
                            Dim pCIUDAD As String
                            Dim pFRONTERA As String
                            Dim pFEC_PROD_LT As String
                            Dim pGLN As String
                            Dim pSTATUS As String
                            'Dim readerPedimento As SqlDataReader
                            'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
                            '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
                            '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                            '"STATUS, REG_LTPD  FROM Logistik_Lote_Pedimento" + _
                            '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
                            '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'"
                            'If conn.State = ConnectionState.Closed Then
                            '    conn.Open()
                            'End If
                            'cmd = New SqlCommand(SqlSelection, conn)
                            'readerPedimento = cmd.ExecuteReader()
                            Dim readerPedimento As SqlDataReader
                            sql = "SELECT LOTE ,PEDIMENTO, FCHCADUC," +
                            "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," +
                            "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," +
                            "STATUS, REG_LTPD  FROM LTPD" + vgNumEmpresa.ToString +
                            " WHERE CVE_ALM = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" +
                            " and CANTIDAD > '0'"
                            'If conn.State = ConnectionState.Closed Then
                            '    conn.Open()
                            'End If
                            'cmd = New SqlCommand(SqlSelection, conn)
                            'readerPedimento = cmd.ExecuteReader()
                            cmd = New SqlCommand(sql, connFB, objTrans)
                            readerPedimento = cmd.ExecuteReader()
                            Dim vvCantFaltante As Double = CANT
                            While readerPedimento.Read()
                                pLOTE = readerPedimento.Item(0).ToString
                                pPEDIMENTO = readerPedimento.Item(1).ToString
                                pFCHCADUC = readerPedimento.Item(2).ToString
                                pFCHADUANA = readerPedimento.Item(3).ToString
                                pFCHULTMOV = readerPedimento.Item(4).ToString
                                pNOM_ADUAN = readerPedimento.Item(5).ToString
                                pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
                                pCVE_OBS = readerPedimento.Item(7).ToString
                                pCIUDAD = readerPedimento.Item(8).ToString
                                pFRONTERA = readerPedimento.Item(9).ToString
                                pFEC_PROD_LT = readerPedimento.Item(10).ToString
                                pGLN = readerPedimento.Item(11).ToString
                                pSTATUS = readerPedimento.Item(12).ToString
                                pREG_LTPD = readerPedimento.Item(13).ToString
                                If pFCHCADUC <> "" Then
                                    pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
                                End If
                                If pFCHADUANA <> "" Then
                                    pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
                                End If
                                If pFCHULTMOV <> "" Then
                                    pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
                                End If
                                If pFEC_PROD_LT <> "" Then
                                    pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
                                End If

                                '------------------INSERTAR PEDIMENTOS EN SAE
                                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()
                                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()

                                'sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = '" + pCANTIDAD.ToString + "'" + _
                                '" WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
                                '" AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()

                                If pCANTIDAD >= vvCantFaltante Then
                                    sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + vvCantFaltante.ToString +
                                    " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
                                    " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()
                                Else
                                    sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + pCANTIDAD.ToString +
                                    " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
                                    " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()
                                    '9 >= 10
                                    '10 - 9 = 1
                                    vvCantFaltante = CANT - pCANTIDAD
                                End If

                                'sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
                                '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
                                '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                                '"STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + NUM_ALM + "','" + pFCHCADUC + "','" + _
                                ' pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD + "','" + pREG_LTPD + "','" + _
                                ' pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()

                                '---- extraer MAXIMO el E_LTPD de SAE
                                Dim readerLTPD As SqlDataReader
                                sqllocal = "Select MAX(E_LTPD) AS NUM FROM ENLACE_LTPD" + vgNumEmpresa.ToString
                                If connFB.State = ConnectionState.Closed Then
                                    connFB.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                readerLTPD = cmd.ExecuteReader()
                                While readerLTPD.Read()
                                    'MsgBox(reader7.Item(0))
                                    E_LTPD = readerLTPD.Item(0).ToString
                                    E_LTPD = Val(E_LTPD) + 1
                                End While
                                If E_LTPD = "" Then E_LTPD = "1"
                                readerLTPD.Close()
                                sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" +
                                E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()
                                If pCANTIDAD >= vvCantFaltante Then
                                    Exit While
                                End If
                                ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
                                'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
                                '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
                                '"' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
                                '" AND REG_LTPD = '" + pREG_LTPD.ToString + "'"
                                'cmd = New SqlCommand(SqlSelection, conn)
                                'cmd.ExecuteNonQuery()

                            End While
                            If conn.State = ConnectionState.Open Then
                                conn.Close()
                            End If
                            readerPedimento.Close()
                            '---------------------------------------------------------------
                            'END INSERTAR PEDIMENTOS
                            '---------------------------------------------------------------
                        End If
                        vUUID = Guid.NewGuid.ToString()
                        vUUID = UCase(vUUID)
                        If vlNumSer = "S" Then
                            sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                            ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                            ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                            ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                            "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
                            PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                            IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                            TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                            DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                            NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                            CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                            TOT_PARTIDA + "','" + POLIT_APLI + "')"
                        Else
                            If vgVersion = "5" Then
                                sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                                "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
                                PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                                IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                                TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                                DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                                NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                                CVE_OBS + "','0','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                                TOT_PARTIDA + "','" + POLIT_APLI + "')"
                            End If
                            Dim VERSION_SINC As String = vfechayhora
                            VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
                            If vgVersion = "6" Or vgVersion = "7" Then
                                sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" +
                                ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ, UUID) values (" +
                                "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" +
                                PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" +
                                IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" +
                                TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" +
                                DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" +
                                Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" +
                                CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" +
                                TOT_PARTIDA.ToString + "','S','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1','" + vUUID + "')"
                            End If

                        End If
                        If connFB.State = ConnectionState.Closed Then
                            connFB.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()

                        'INSERTAR EL INDICE
                        sqllocal = "insert into  PAR_FACTR_CLIB" + nnBisness.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR.ToString + "')"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        'actualizar detalle PAR_FACTP01
                        'sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString + _
                        '" WHERE CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        'actualizar ACUMULADOR de remisiones y facturas
                        '-----------camision del vendedor
                        'If pComicion = "" Then pComicion = "0"
                        'If Val(pComicion) >= 1 Then
                        '    Dim VLcomi As String = (pComicion / 100) * TOT_PARTIDA
                        '    sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
                        '    " RIMP = RIMP + " + TOTIMP4 + ", RCOMI = RCOMI + " + VLcomi + _
                        '    " WHERE CVE_AFACT = '11'"
                        'Else
                        'TOT_ARTIDA = PRECIO POR CANTIDAD

                        sqllocal = "update AFACT" + nnBisness.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," +
                        " RIMP = RIMP + " + TOTIMP4 + "" +
                        " WHERE CVE_AFACT = '3'"
                        'End If
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        '---------EXTRAER CLAVE DEL FOLIO
                        Dim CVE_FOLIO As String = "0"
                        Dim readerCONTROL As SqlDataReader
                        sql = "Select ULT_CVE AS num FROM TBLCONTROL" + nnBisness.ToString + " WHERE ID_TABLA='32'"
                        cmd = New SqlCommand(sql, connFB, objTrans)
                        readerCONTROL = cmd.ExecuteReader()
                        While readerCONTROL.Read()
                            'MsgBox(reader3.Item(0))
                            CVE_FOLIO = readerCONTROL.Item(0).ToString
                            'vExistencia = Val(vExistencia) + 1
                        End While
                        If CVE_FOLIO = "" Then CVE_FOLIO = "1"
                        readerCONTROL.Close()
                        '-----------------------------------------------
                        sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()



                        'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()

                        ''insertar documentos siguientes
                        'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
                        '"PARTIDA, PART_E, CANT_E) VALUES (" + _
                        '"'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" + _
                        'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
                        '"PARTIDA, PART_E, CANT_E) VALUES (" + _
                        '"'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" + _
                        'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        '-------------------------------------------------------------------------------
                        'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
                        ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                        'cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        'cmd.ExecuteNonQuery()
                        '-----------------------------------------------------------------------------
                        'actualizar las existencias
                        'Call ActualizarExistencias(CVE_ART, CANT)
                        'sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
                        '" PEND_SURT = PEND_SURT - " + CANT.ToString + ", COSTO_PROM = '" + COST + "'," + _
                        '" ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
                        '" WHERE CVE_ART ='" + CVE_ART + "'"
                        time = Today.Now
                        sqllocal = "update INVE" + nnBisness.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                        " COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                        "VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" +
                        " WHERE CVE_ART ='" + CVE_ART + "'"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        '-----------------------------------------------
                        'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                        Dim vExistencia As String = ""
                        Dim reader3 As SqlDataReader
                        sql = "Select ISNULL(max(EXIST),0) AS num FROM INVE" + nnBisness.ToString + " WHERE CVE_ART = '" + CVE_ART + "'"
                        cmd = New SqlCommand(sql, connFB, objTrans)
                        reader3 = cmd.ExecuteReader()
                        While reader3.Read()
                            'MsgBox(reader3.Item(0))
                            vExistencia = reader3.Item(0).ToString
                            'vExistencia = Val(vExistencia) - Val(CANT)
                        End While
                        If vExistencia = "" Then vExistencia = "1"
                        reader3.Close()
                        '--------existe almacen
                        Dim vExistAlm As String
                        Dim rederExistAlm As SqlDataReader
                        sql = "SELECT EXIST FROM MULT" + nnBisness.ToString +
                        " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '" + NUM_ALM + "'"
                        cmd = New SqlCommand(sql, connFB, objTrans)
                        rederExistAlm = cmd.ExecuteReader()
                        While rederExistAlm.Read
                            vExistAlm = rederExistAlm.Item(0).ToString
                            vExistAlm = Val(vExistAlm) - CANT
                        End While
                        rederExistAlm.Close()
                        If vlNumSer = "S" Then
                            sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                            "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                            "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" +
                            "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                            "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                            "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
                            "S','0','" + COST + "','N','0')"
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                        Else
                            If vgVersion = "5" Then
                                sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                                "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" +
                                "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                                "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                                "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
                                "S','0','" + COST + "','N','0')"
                            End If
                            If vgVersion = "6" Or vgVersion = "7" Then
                                sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" +
                                "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov.ToString + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                "'R','" + pcvedoc.ToString + "','" + pCve_Cliente + "','" + VEND.ToString + "','" + CANT.ToString + "','" +
                                "0','" + PREC.ToString + "','" + COST.ToString + "','','" + CVE_OBS.ToString + "'," +
                                "'0','" + UNI_VENTA.ToString + "','" + E_LTPD.ToString + "','" + vExistAlm + "','" + TIPO_PROD + "','" +
                                "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO.ToString + "','-1','" +
                                "S','" + COST.ToString + "','" + COST.ToString + "','N','0','" + vExistencia.ToString + "','" + COST.ToString + "')"
                            End If
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE MINVE" + nnBisness.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " +
                            " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" +
                            " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                            Dim VERSION_SINC As String
                            VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                            sqllocal = "UPDATE MULT" + nnBisness.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" +
                            " WHERE CVE_ART = '" + CVE_ART + "'" +
                            " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                        End If
                        'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        mREG_SERIE = Val(mREG_SERIE) + 1
                        vlsubtotal = vlsubtotal + (PREC * CANT)
                        NUM_PAR = NUM_PAR + 1
                    End While
                    reader2.Close()
                    CAN_TOT = vlsubtotal.ToString
                    Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
                    IMP_TOT4 = iva.ToString
                    sqllocal = "UPDATE FOLIOSF" + nnBisness.ToString + " SET ULT_DOC = ULT_DOC + 1, FECH_ULT_DOC = '" + vfechayhora.ToString("yyyy/MM/dd") + "'" +
                    " WHERE TIP_DOC = 'R'"
                    'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
                    '" WHERE TIP_DOC = 'R' and serie ='STAND.'"
                    '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    sqllocal = "UPDATE FACTR" + nnBisness.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
                    " ,CAN_TOT='" + CAN_TOT + "', IMP_TOT4 = '" + IMP_TOT4 + "'" +
                    " WHERE CVE_DOC = '" + vCveDoc + "'"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    '------------------------
                    objTrans.Commit()
                    empresa = vgEmpresa.ToString
                    documento = CVE_DOC.ToString
                    mensaje = "Registrar Remision: Correcto Remision:" + CVE_DOC.ToString
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    '------------------------
                    BIEN = 1
                End If
                'OrdenVenta = Val(OrdenVenta)
                'OrdenVenta = espacios(OrdenVenta, 20)
                Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'S'" +
                " WHERE embarque = '" + Trim(id_pedido) + "'"
                EjecutarQuerySQL_EMPRESA6(sql1)
            Next

            '------------------------------------------------------------------------------------------
            If BIEN = 1 Then
                '------------------------------------------------------------------------
                Dim StrVts As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
                Dim connVts As New SqlConnection(StrVts)
                sql = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Vende' AND BASEDATOS = 'LogistikMasterValvulerias" + EMPRESA_DEST.Trim + "'"
                Dim daVts As New SqlDataAdapter(sql, connVts)
                Dim dsVts As New DataSet()
                daVts.Fill(dsVts, "EmpresaSAE")
                Dim oTablaVts As DataTable
                oTablaVts = dsVts.Tables("EmpresaSAE")
                Dim SERVIDOR2 As String = ""
                Dim USUARIO2 As String = ""
                Dim NOMBRE_BD2 As String = ""
                Dim PASSWROD2 As String = ""
                Dim BASEDATOS2 As String = ""
                'Dim VTIPO As String = ""
                If oTablaVts.Rows.Count >= 1 Then
                    Dim oFila As DataRow
                    For Each oFila In oTablaVts.Rows
                        SERVIDOR2 = oFila.Item("SERVIDOR").ToString
                        BASEDATOS2 = oFila.Item("BASEDATOS").ToString
                        USUARIO2 = oFila.Item("USUARIO").ToString
                        PASSWROD2 = oFila.Item("PASSWROD").ToString
                        NOMBRE_BD2 = oFila.Item("NOMBRE_BD").ToString
                    Next
                End If
                Dim nnBisness2 = Mid(NOMBRE_BD2, LongitudBD)
                'CONEXION VENTAS
                Dim StrV As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD2 + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
                Dim connV As New SqlConnection(StrV)
                '----------------------------------------------------------------------
                'BASEDATOS logistik
                'NOMBRE_BD sae
                'vientos2
                Call SEND_RECEPCION_EMBARQUE2(NOMBRE_BD2, nnBisness2, id_pedido, EMPRESA_DEST)

                Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'S'" +
                " WHERE embarque = '" + Trim(id_pedido) + "'"
                EjecutarQuerySQL_EMPRESA6(sql1)

            End If
            'Catch es As FbException
            '    empresa = vgEmpresa.ToString
            '    documento = CVE_DOC.ToString
            '    mensaje = "Registrar Remision: InCorrecto Remision:" + CVE_DOC.ToString
            '    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" + _
            '    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            '    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            '    Me.Refresh()
            '    objTrans.Rollback()
            '    Throw es
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Registrar Remision: InCorrecto Remision:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTrans.Rollback()
            Throw es
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Registrar Remision: InCorrecto Remision:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            '***** rollback the transaction ************************************************'
            objTrans.Rollback()
            MsgBox(ex.Message.ToString)
        End Try

    End Sub
    Private Sub RemisionesComprasaVentasEmp04(ByVal pEMP06BD As String, ByVal EMPRESA_DEST As String, id_pedido As String)
        Dim CVE_DOC As String
        Dim RFC_DEST As String
        'Dim EMPRESA_DEST As String
        Try
            Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn7 As New SqlConnection(Str7)
            Dim sql As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Compra'"
            Dim dataadapterEmp04 As New SqlDataAdapter(sql, conn7)
            Dim dsCargarEmp04 As New DataSet()
            dataadapterEmp04.Fill(dsCargarEmp04, "EmpresaSAE")
            Dim oTablaEmp04 As DataTable
            oTablaEmp04 = dsCargarEmp04.Tables("EmpresaSAE")
            Dim SERVIDOR As String = ""
            Dim USUARIO As String = ""
            Dim NOMBRE_BD As String = ""
            Dim PASSWROD As String = ""
            Dim BASEDATOS As String = ""
            'Dim VTIPO As String = ""
            If oTablaEmp04.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTablaEmp04.Rows
                    SERVIDOR = oFila.Item("SERVIDOR").ToString
                    BASEDATOS = oFila.Item("BASEDATOS").ToString
                    USUARIO = oFila.Item("USUARIO").ToString
                    PASSWROD = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness = Mid(NOMBRE_BD, LongitudBD)
            'CONEXION BASICA LOGISTIK_ALMACEN
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim conn As New SqlConnection(Str)
            'CONEXION COMPRAS
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";MultipleActiveResultSets=True;"
            Dim connFB As New SqlConnection(Str2)

            Dim BIEN As Integer = 0
            'sqllocal = "SELECT embarque,id_proveedor,factura,oc," +
            '"fecha_recepcion,id_usuario_recibio,fecha_calificacion,id_usuario_califico,fecha_liberacion," +
            '"id_usuario_libero,contenido,estado,completo,empresa_destino," +
            '"enviado_sae, rfc_destino FROM vLogistik_Embarques" +
            '" WHERE enviado_sae='N' and estado=3" ' and empresa_destino<>''"

            'sqllocal = "select vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
            '        "vLogistik_Kardex.pedido, vLogistik_Kardex.precio, vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino" +
            '        " FROM vLogistik_Kardex, vLogistik_Embarques WHERE vLogistik_Kardex.embarque= vLogistik_Embarques.embarque" &
            '        " and vLogistik_Embarques.enviado_sae='N'and vLogistik_Embarques.estado=3" +
            '        " and vLogistik_Kardex.empresa_destino='" + EMPRESA_DEST.Trim + "'"

            sqllocal = "select vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino" +
                    " FROM vLogistik_Kardex, vLogistik_Embarques WHERE vLogistik_Kardex.embarque= vLogistik_Embarques.embarque" +
                    " and vLogistik_Embarques.enviado_sae='N'and vLogistik_Embarques.estado=3" +
                    " and vLogistik_Kardex.empresa_destino='04'" +
                    " and vLogistik_Kardex.embarque='" + id_pedido.Trim + "'" +
                    " group by vLogistik_Kardex.embarque, vLogistik_Kardex.factura, vLogistik_Kardex.oc, " +
                    "vLogistik_Kardex.empresa_destino, vLogistik_Kardex.rfc_destino"

            Dim daPCEmp04 As New SqlDataAdapter(sqllocal, conn)
            Dim dsPCEmp04 As New DataSet
            daPCEmp04.Fill(dsPCEmp04, "vLogistik_Embarques")
            Dim oTablePCEmp04 As New DataTable
            oTablePCEmp04 = dsPCEmp04.Tables("vLogistik_Embarques")
            Dim OrdenVenta As String
            If connFB.State = ConnectionState.Closed Then
                connFB.Open()
            End If
            'Dim id_pedido As String = ""
            Dim num_empresa As String
            For Each oRowPC In oTablePCEmp04.Rows
                id_pedido = oRowPC.Item("embarque").ToString
                OrdenVenta = oRowPC.Item("embarque").ToString
                'num_empresa = oRowPC.Item("num_empresa").ToString
                'agregar ceros
                OrdenVenta = ceros(OrdenVenta, 10)
                'agregar espacios
                OrdenVenta = espacios(OrdenVenta, 20)
                RFC_DEST = oRowPC.Item("rfc_destino").ToString
                'EMPRESA_DEST = oRowPC.Item("empresa_destino").ToString

                Dim TIP_DOC As String
                Dim CVE_CLPV As String
                Dim STATUS As String
                Dim DAT_MOSTR As String
                Dim CVE_VEND As String
                Dim CVE_PEDI As String = "1"
                Dim FECHA_DOC As String
                Dim FECHA_ENT As String
                Dim FECHA_VEN As String
                Dim FECHA_CANCELA As String
                Dim CAN_TOT As String
                Dim IMP_TOT1 As String
                Dim IMP_TOT2 As String
                Dim IMP_TOT3 As String
                Dim IMP_TOT4 As String
                Dim DES_TOT As String
                Dim DES_FIN As String
                Dim COM_TOT As String
                Dim CONDICION As String
                Dim CVE_OBS As String
                Dim NUM_ALMA As String
                Dim ACT_CXC As String
                Dim ACT_COI As String
                Dim ENLAZADO As String
                Dim TIP_DOC_E As String
                Dim NUM_MONED As String
                Dim TIPCAMB As String
                Dim NUM_PAGOS As String
                Dim FECHAELAB As String
                Dim PRIMERPAGO As String
                Dim RFC As String
                Dim CTLPOL As String
                Dim ESCFD As String
                Dim AUTORIZA As String
                Dim SERIE As String
                Dim FOLIO As String
                Dim AUTOANIO As String
                Dim DAT_ENVIO As String
                Dim CONTADO As String
                Dim CVE_BITA As String
                Dim BLOQ As String
                Dim FORMAENVIO As String
                Dim DES_FIN_PORC As String
                Dim DES_TOT_PORC As String
                Dim IMPORTE As String
                Dim COM_TOT_PORC As String
                Dim METODODEPAGO As String
                Dim NUMCTAPAGO As String
                Dim TIP_DOC_ANT As String
                Dim DOC_ANT As String
                Dim TIP_DOC_SIG As String
                Dim DOC_SIG As String
                Dim vCveDoc As String = ""

                TIP_DOC = "R"
                'SigCveDoc = TraerCveDocSigRecep()
                'CVE_DOC = SigCveDoc
                CVE_DOC = oRowPC.Item("embarque").ToString

                RFC = oRowPC.Item("rfc_destino").ToString
                CVE_CLPV = "0"
                STATUS = "0"
                DAT_MOSTR = "0"
                CVE_VEND = "0"
                CVE_PEDI = "0"

                'vfechayhora = oRowPC.Item("date_add").ToString
                FECHA_DOC = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_DOC <> "" Then
                '    FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_ENT = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_ENT <> "" Then
                '    FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_VEN = vfechayhora.ToString("yyyy/MM/dd")
                'If FECHA_VEN <> "" Then
                '    FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                'End If
                FECHA_CANCELA = vfechayhora.ToString("yyyy/MM/dd")
                'subtotal = total_paid
                'total = total_paid_real

                'CAN_TOT = oRowPC.Item("total_paid_real").ToString
                CAN_TOT = "0"
                IMP_TOT1 = "0"
                IMP_TOT2 = "0"
                IMP_TOT3 = "0"
                'Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
                'IMP_TOT4 = iva.ToString
                IMP_TOT4 = "0"
                DES_TOT = "0"
                DES_FIN = "0"
                COM_TOT = "0"
                CONDICION = ""
                CVE_OBS = ""
                NUM_ALMA = "1"
                ACT_CXC = "S"
                ACT_COI = "N"
                ENLAZADO = "O"
                TIP_DOC_E = "O"
                NUM_MONED = "1"
                TIPCAMB = "1"
                NUM_PAGOS = "1"
                FECHAELAB = Date.Now
                If FECHAELAB <> "" Then
                    'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
                    'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
                    FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                End If
                PRIMERPAGO = "0"
                'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)

                Dim SqlA As String = "SELECT CLAVE FROM CLIE" + nnBisness.ToString +
                " WHERE  RFC = '" + Trim(RFC) + "'"
                Dim da7 As New SqlDataAdapter(SqlA, connFB)
                Dim ds7 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                da7.Fill(ds7, "CLIENTE" + nnBisness.ToString)
                Dim oTable As New DataTable
                oTable = ds7.Tables("CLIENTE" + nnBisness.ToString)
                If connFB.State = ConnectionState.Open Then
                    connFB.Close()
                End If

                If oTable.Rows.Count >= 1 Then
                    For Each oRow55 In oTable.Rows
                        CVE_CLPV = oRow55.Item("CLAVE").ToString
                    Next
                End If
                If Trim(CVE_CLPV) <> "MOSTR" Then
                    CVE_CLPV = espacios(CVE_CLPV, 10)
                End If
                CTLPOL = "0"
                ESCFD = "N"
                AUTORIZA = "1"
                SERIE = ""
                FOLIO = Nothing
                SqlA = "Select MASCARA FROM PARAM_FOLIOSF" + nnBisness.ToString +
                    " WHERE TIPODOCTO = 'R'"
                Dim da77 As New SqlDataAdapter(SqlA, connFB)
                Dim ds77 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                da77.Fill(ds77, "PARAM_FOLIOSF" + nnBisness.ToString)
                Dim oTable77 As New DataTable
                oTable77 = ds77.Tables("PARAM_FOLIOSF" + nnBisness.ToString)
                If connFB.State = ConnectionState.Open Then
                    connFB.Close()
                End If

                If oTable77.Rows.Count >= 1 Then
                    For Each oRow77 In oTable77.Rows
                        FOLIO = oRow77.Item("MASCARA").ToString
                    Next
                End If
                If FOLIO = "" Then
                    MsgBox("Configure la mascara de la clave del documento")
                    Exit Sub
                End If
                AUTOANIO = ""
                DAT_ENVIO = "0"
                CONTADO = "N"
                CVE_BITA = "2"
                BLOQ = "N"
                FORMAENVIO = ""
                'descuentos
                DES_FIN_PORC = "0"
                DES_TOT_PORC = "0"
                'IMPORTE = oRowPC.Item("total_paid").ToString
                IMPORTE = "0"
                COM_TOT_PORC = "0"
                METODODEPAGO = ""
                NUMCTAPAGO = ""
                TIP_DOC_ANT = "P"
                DOC_ANT = ""
                TIP_DOC_SIG = Nothing
                DOC_SIG = Nothing
                'vCveDoc = BuscarClaveDoc()
                '----------------buscar clave del documento
                '----------------buscar clave del documento
                Dim vcont As String = ""
                Dim vnum As Integer
                SqlA = "SELECT ULT_DOC FROM FOLIOSF" + nnBisness.ToString +
                " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + nnBisness.ToString + " WHERE TIP_DOC='R')"
                Dim da55 As New SqlDataAdapter(SqlA, connFB)
                Dim ds55 As New DataSet
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                da55.Fill(ds55, "FOLIOSF" + nnBisness.ToString)
                Dim oTable55 As New DataTable
                oTable55 = ds55.Tables("FOLIOSF" + nnBisness.ToString)
                'If connFB.State = ConnectionState.Open Then
                '    connFB.Close()
                'End If

                If oTable55.Rows.Count >= 1 Then
                    For Each oRow55 In oTable55.Rows
                        vcont = oRow55.Item("ULT_DOC").ToString
                        If vcont = "" Or vcont = "0" Then vcont = "1"
                        'Convertir a numero y 'aumentar mas uno
                        vcont = Val(vcont) + 1
                        'agregar(ceros)
                        vcont = ceros(vcont, 10)
                        'agregar espacios
                        vcont = espacios(vcont, 20)
                        'regresar valor
                        'Me.TextBox1.Text = vcont
                        vCveDoc = vcont
                    Next
                End If
                If connFB.State = ConnectionState.Closed Then
                    connFB.Open()
                End If
                '---------------------------------------
                objTrans = connFB.BeginTransaction()
                '--------------------------------------
                If vCveDoc <> "" Then
                    DOC_ANT = ceros(DOC_ANT, 10)
                    DOC_ANT = espacios(DOC_ANT, 20)
                    Dim vUUID = Guid.NewGuid.ToString()
                    vUUID = UCase(vUUID)
                    'TRAER CLAVE BITA
                    ''------------------------------------------------
                    Dim readerBita As SqlDataReader
                    Dim vBita As String
                    sqllocal = "Select coalesce(max(CVE_BITA),1) AS num FROM BITA" + nnBisness.ToString
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    readerBita = cmd.ExecuteReader()
                    While readerBita.Read()
                        vBita = readerBita.Item(0).ToString
                        CVE_BITA = Val(vBita) + 1
                    End While
                    readerBita.Close()

                    sqllocal = "insert into  FACTR" + nnBisness.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                    ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                    ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                    ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                    ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                    ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                    ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                    ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                    ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                    ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                    ",DOC_ANT,TIP_DOC_SIG,DOC_SIG) values (" +
                    "'R','" + vCveDoc + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" +
                    CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" +
                    FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" +
                    IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" +
                    CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" +
                    "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                    PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" +
                    SERIE + "','" + vCveDoc + "','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" +
                    CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" +
                    IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" +
                    DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "')"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()

                    sqllocal = "insert into FACTR_CLIB" + nnBisness.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()

                    ''INSERT TABLA BITA
                    sqllocal = "INSERT INTO BITA" + nnBisness.ToString +
                    "(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" +
                    " VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + IMPORTE.ToString + "', 'F', 'Administrador')"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()

                    sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()

                    sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 62"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    ''---------------------
                    ''Dim vCve_Obs As String = TraerClaveSiguiente()
                    'Dim vCve_Obs As String
                    'Dim vcont7 As String = ""
                    'Dim reader7 As SqlDataReader
                    'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
                    'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                    'reader7 = cmd.ExecuteReader()
                    'While reader7.Read()
                    '    'MsgBox(reader7.Item(0))
                    '    vcont7 = reader7.Item(0).ToString
                    '    vcont7 = Val(vcont7) + 1
                    'End While
                    'If vcont7 = "" Then vcont7 = "1"
                    'vCve_Obs = vcont7
                    'reader7.Close()
                    ''-----------------------------------
                    'Dim vObser As String = "Buenas Remisión HH"
                    'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                    'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                    'cmd.ExecuteNonQuery()
                    ''Call UpdateOC(CVE_DOC, vCveDoc)
                    'sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
                    '" WHERE CVE_DOC ='" + CVE_DOC + "'"
                    'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                    'cmd.ExecuteNonQuery()
                    Dim pIdPedido As String = id_pedido
                    Dim pcvedoc As String = vCveDoc
                    Dim pObser As String = "0" 'vObser
                    Dim pcve_doc_origen As String = CVE_DOC
                    Dim VEND As String = CVE_VEND
                    Dim pAlmacen As String = NUM_ALMA
                    Dim pCve_Cliente As String = CVE_CLPV
                    'Dim CVE_DOC As String
                    Dim NUM_PAR As Integer = 1
                    Dim CVE_ART As String
                    Dim vlsubtotal As Double
                    Dim CANT As Double
                    Dim CANTp As Double
                    Dim PXS As String
                    Dim PREC As String
                    Dim COST As String
                    Dim IMPU1 As String
                    Dim IMPU2 As String
                    Dim IMPU3 As String
                    Dim IMPU4 As Integer
                    Dim IMP1APLA As String
                    Dim IMP2APLA As String
                    Dim IMP3APLA As String
                    Dim IMP4APLA As String
                    Dim TOTIMP1 As String
                    Dim TOTIMP2 As String
                    Dim TOTIMP3 As String
                    Dim TOTIMP4 As String
                    Dim DESC1 As String
                    Dim DESC2 As String
                    Dim DESC3 As String
                    Dim COMI As String
                    Dim APAR As String
                    Dim ACT_INV As String
                    Dim NUM_ALM As String = pAlmacen
                    Dim POLIT_APLI As String
                    Dim TIP_CAM As String
                    Dim UNI_VENTA As String
                    Dim TIPO_PROD As String
                    'Dim CVE_OBS As String
                    Dim REG_SERIE As String
                    Dim E_LTPD As String
                    Dim TIPO_ELEM As String
                    Dim NUM_MOV As String
                    Dim TOT_PARTIDA As String = ""
                    Dim IMPRIMIR As String
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    '''''''''''''''''''''''''''''detalle
                    'aqui vamos
                    Dim reader2 As SqlDataReader
                    'Dim SqlSelection As String = "SELECT id_order_detail,id_order,product_upc,product_price,quantity_received" + _
                    '",total_shipping_price_tax_incl FROM Logistik_order_detail WHERE id_order ='" + pIdPedido + "'"

                    Dim SqlSelection As String = "select id_usuario,fecha, " +
                    "codigo_producto,cantidad,merma,pedido, oc, precio, empresa_destino, rfc_destino" +
                    " FROM vLogistik_Kardex WHERE embarque='" + pIdPedido.Trim + "'" +
                    " AND empresa_destino='04'"

                    cmd = New SqlCommand(SqlSelection, conn)
                    reader2 = cmd.ExecuteReader()
                    'If conn.State = ConnectionState.Open Then
                    '    conn.Close()
                    'End If
                    ' esta variable controla el consecutivo de las series
                    Dim mREG_SERIE As String
                    ' esta variable controla una sola entrada al ciclo de las series
                    Dim vlMaxNum As Boolean = True
                    If connFB.State = ConnectionState.Closed Then
                        connFB.Open()
                    End If
                    'objTransFB = connFB.BeginTransaction()
                    Dim vcantfalsa As Double = 0
                    Dim merma As Double = 0
                    While reader2.Read()
                        CVE_DOC = pcvedoc
                        CVE_ART = reader2.Item(2).ToString
                        vcantfalsa = reader2.Item(3).ToString
                        merma = reader2.Item(4).ToString
                        CANTp = Convert.ToString(vcantfalsa - merma)
                        CANT = Convert.ToString(vcantfalsa - merma)
                        PXS = Convert.ToString(vcantfalsa - merma)
                        PREC = reader2.Item(7).ToString
                        COST = "0"


                        '-------------------------------------------------------------------------------------
                        If connFB.State = ConnectionState.Closed Then
                            connFB.Open()
                        End If
                        Dim reader7 As SqlDataReader
                        sqllocal = "SELECT INV7.COSTO_PROM, INV7.ULT_COSTO FROM INVE" + nnBisness.ToString + " AS INV7 WHERE INV7.CVE_ART = '" + CVE_ART.ToString + "'"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        reader7 = cmd.ExecuteReader()
                        While reader7.Read()
                            Dim ExistA As Double
                            ExistA = Convert.ToDouble(reader7.Item(0).ToString)
                            'ExistA = Math.Round(ExistA, 2)
                            COST = ExistA.ToString
                            If COST = "" Or COST = "0" Then
                                ExistA = Convert.ToDouble(reader7.Item(1).ToString)
                                'ExistA = Math.Round(ExistA, 2)
                                COST = ExistA.ToString
                            End If

                        End While
                        reader7.Close()
                        'If connFB.State = ConnectionState.Open Then
                        '    connFB.Close()
                        'End If
                        '---------------------------------------------------------------------------------

                        '-------------------------------------------------------------------------------
                        'SqlA = "SELECT COSTO_PROM, ULT_COSTO FROM INVE" + vgNumEmpresa.ToString + _
                        '" WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                        'Dim da25 As New FbDataAdapter(SqlA, connFB)
                        'Dim ds25 As New DataSet
                        'If connFB.State = ConnectionState.Closed Then
                        '    connFB.Open()
                        'End If
                        'da25.Fill(ds25, "INVE" + vgNumEmpresa.ToString)
                        'Dim oTable25 As New DataTable
                        'oTable25 = ds25.Tables("INVE" + vgNumEmpresa.ToString)
                        'If oTable25.Rows.Count >= 1 Then
                        '    For Each oRow25 In oTable25.Rows
                        '        COST = oRow25.Item("COSTO_PROM").ToString
                        '        If COST = "" Or COST = "0" Then COST = oRow25.Item("ULT_COSTO").ToString
                        '    Next
                        'End If
                        '---------------------------------------------------------------------------------

                        IMPU1 = "0"
                        IMPU2 = "0"
                        IMPU3 = "0"

                        IMPU4 = "16"
                        IMP1APLA = "6"
                        IMP2APLA = "6"
                        IMP3APLA = "6"
                        IMP4APLA = "0"
                        TOTIMP1 = "0"
                        TOTIMP2 = "0"
                        TOTIMP3 = "0"
                        'iva
                        TOTIMP4 = "16"
                        DESC1 = "0"
                        DESC2 = "0"
                        DESC3 = "0"
                        COMI = "0"
                        APAR = "0"
                        ACT_INV = "S"
                        POLIT_APLI = ""
                        TIP_CAM = "1"
                        UNI_VENTA = "pz"
                        TIPO_PROD = "P"

                        CVE_OBS = "0"
                        REG_SERIE = "0"
                        'tiene lotes
                        E_LTPD = "0"
                        TIPO_ELEM = "N"
                        'consecutivo

                        'NUM_MOV = reader2.Item(34).ToString
                        'cantidad por pecio
                        'If PREC <> "" Then

                        TOT_PARTIDA = Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)
                        TOTIMP4 = (Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)) * (IMPU4 / 100)
                        IMPRIMIR = ""

                        'Else
                        'objTrans.Rollback()
                        'End If

                        'Dim Sql As String
                        '-------------------Traer la clave siguiente
                        ''CVE_OBS = TraerClaveSiguiente()
                        'Dim vcont As String = ""
                        ''Dim vnum As Integer
                        'Dim reader As FbDataReader
                        'Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
                        'cmdFB = New FbCommand(Sql, connFB, objTransFB)
                        'reader = cmdFB.ExecuteReader()
                        'While reader.Read()
                        '    'MsgBox(reader.Item(0))
                        '    vcont = reader.Item(0).ToString
                        '    vcont = Val(vcont) + 1
                        'End While
                        'If vcont = "" Then vcont = "1"
                        'CVE_OBS = vcont
                        'reader.Close()

                        'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        '---------------------crear el o los movimientos
                        'Dim vNum_Mov As String = ConsecutivoMovimiento()
                        Dim vNum_Mov As String
                        Dim vcont77 As String = ""
                        Dim reader77 As SqlDataReader
                        sql = "Select coalesce(max(NUM_MOV),1) AS num FROM MINVE" + nnBisness.ToString
                        cmd = New SqlCommand(sql, connFB, objTrans)
                        reader77 = cmd.ExecuteReader()
                        While reader77.Read()
                            'MsgBox(reader7.Item(0))
                            vcont77 = reader77.Item(0).ToString
                            vcont77 = Val(vcont77) + 1
                        End While
                        If vcont77 = "" Then vcont77 = "1"
                        vNum_Mov = vcont77
                        reader77.Close()
                        '----------tiene pedimento y numero de serie
                        Dim vlPedimento As String = "N"
                        Dim vlNumSer As String = "N"
                        'Dim readerPedi As SqlDataReader
                        'SqlSelection = "SELECT Pedimento, NumSerie FROM Logistik_product" + _
                        '" WHERE upc = '" + CVE_ART + "'"
                        'conn.Open()
                        'cmd = New SqlCommand(SqlSelection, conn)
                        'readerPedi = cmd.ExecuteReader()
                        'While readerPedi.Read()
                        '    vlPedimento = readerPedi.Item(0)
                        '    vlNumSer = readerPedi.Item(1)
                        'End While
                        'conn.Close()
                        'readerPedi.Close()
                        If vlNumSer = "S" Then
                            '--------------------------------------------------------------
                            'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
                            '---------------------------------------------------------------
                            '--------------------------H NUMEROS DE SERIE
                            If vlMaxNum = True Then
                                Dim readerNumSerie3 As SqlDataReader
                                SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
                                '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
                                If connFB.State = ConnectionState.Closed Then
                                    connFB.Open()
                                End If
                                cmd = New SqlCommand(SqlSelection, connFB, objTrans)
                                readerNumSerie3 = cmd.ExecuteReader()
                                While readerNumSerie3.Read()
                                    mREG_SERIE = readerNumSerie3.Item(0).ToString
                                    mREG_SERIE = Val(mREG_SERIE) + 1
                                End While
                                'If connFB.State = ConnectionState.Open Then
                                '    connFB.Close()
                                'End If
                                readerNumSerie3.Close()
                                vlMaxNum = False
                            End If
                            '---------------------------------------------------
                            Dim nNUM_SER As String
                            Dim nCOSTO As String
                            Dim nDOCTO_ENT As String
                            Dim nFECHA_ENT As String
                            Dim nREG_SERIE As String
                            Dim readerNumSerie As SqlDataReader
                            'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
                            '" FROM Logistik_numeros_series" + _
                            '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
                            '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
                            SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" +
                            " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" +
                            " WHERE h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" +
                            " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART +
                            "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='M'"
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            cmd = New SqlCommand(SqlSelection, conn)
                            readerNumSerie = cmd.ExecuteReader()
                            If connFB.State = ConnectionState.Closed Then
                                connFB.Open()
                            End If
                            While readerNumSerie.Read()
                                Dim NumSer_Cve_Doc As String = Trim(pcve_doc_origen.ToString)
                                'NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
                                nNUM_SER = readerNumSerie.Item(0).ToString
                                nCOSTO = readerNumSerie.Item(1).ToString
                                nDOCTO_ENT = readerNumSerie.Item(2).ToString
                                nFECHA_ENT = readerNumSerie.Item(3).ToString
                                nREG_SERIE = readerNumSerie.Item(4).ToString
                                If nFECHA_ENT <> "" Then
                                    nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
                                End If

                                sqllocal = "UPDATE NUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', COSTO = '" + nCOSTO + "', " +
                                "DOCTO_ENT = '" + NumSer_Cve_Doc + "', FECHA_ENT = '" + nFECHA_ENT + "'" +
                                " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()

                                sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V'," +
                                "TIP_MOV = '51', CVE_DOC ='" + NumSer_Cve_Doc + "', REG_SERIE = '" + mREG_SERIE + "'" +
                               " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER +
                               "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" ' AND REG_SERIE = '" + nREG_SERIE + "'"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()

                                ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
                                'sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'V'" + _
                                '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
                                '" and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'" + _
                                '" AND NUM_SER ='" + nNUM_SER + "'"
                                'cmd = New SqlCommand(sqllocal, conn)
                                'cmd.ExecuteNonQuery()

                            End While
                            If conn.State = ConnectionState.Open Then
                                conn.Close()
                            End If
                            readerNumSerie.Close()
                            '--------------------------H NUMEROS DE SERIE
                            'Dim nREG_SERIE As String
                            'Dim readerNumSerie3 As SqlDataReader
                            'SqlSelection = "SELECT NUM_SER, REG_SERIE" + _
                            '" FROM Logistik_Hnumeros_series" + _
                            '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
                            'conn.Open()
                            'cmd = New SqlCommand(SqlSelection, conn)
                            'readerNumSerie3 = cmd.ExecuteReader()
                            'While readerNumSerie3.Read()
                            '    nNUM_SER = readerNumSerie3.Item(0).ToString
                            '    nREG_SERIE = readerNumSerie3.Item(1).ToString
                            '    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', TIP_MOV = '51', CVE_DOC ='" + pcve_doc_origen.ToString + "'" + _
                            '    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
                            '    "' AND ALMACEN = '" + NUM_ALM + "' AND REG_SERIE = '" + nREG_SERIE + "'"
                            '    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            '    cmdFB.ExecuteNonQuery()
                            'End While
                            'conn.Close()
                            'readerNumSerie3.Close()
                            '--------------------------------------------------------------
                            'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
                            '--------------------------------------------------------------
                        End If
                        If vlPedimento = "S" Then


                            '---------------------------------------------------------------
                            'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
                            '---------------------------------------------------------------
                            '---- extraer el consecutivo REG_LTPD de SAE
                            Dim pREG_LTPD As String
                            'Dim readerMAx As FbDataReader
                            'sqllocal = "Select coalesce(max(REG_LTPD),1) AS num FROM LTPD" + vgNumEmpresa.ToString
                            'If connFB.State = ConnectionState.Closed Then
                            '    connFB.Open()
                            'End If
                            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                            'readerMAx = cmdFB.ExecuteReader()
                            'While readerMAx.Read()
                            '    'MsgBox(reader7.Item(0))
                            '    pREG_LTPD = readerMAx.Item(0).ToString
                            '    pREG_LTPD = Val(pREG_LTPD) + 1
                            'End While
                            'If pREG_LTPD = "" Then pREG_LTPD = "1"
                            'readerMAx.Close()
                            '---EXTRAER DATOS DEL SQL
                            Dim pLOTE As String
                            Dim pPEDIMENTO As String
                            Dim pFCHCADUC As String
                            Dim pFCHADUANA As String
                            Dim pFCHULTMOV As String
                            Dim pNOM_ADUAN As String
                            Dim pCANTIDAD As Double
                            Dim pCVE_OBS As String
                            Dim pCIUDAD As String
                            Dim pFRONTERA As String
                            Dim pFEC_PROD_LT As String
                            Dim pGLN As String
                            Dim pSTATUS As String
                            'Dim readerPedimento As SqlDataReader
                            'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
                            '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
                            '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                            '"STATUS, REG_LTPD  FROM Logistik_Lote_Pedimento" + _
                            '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
                            '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'"
                            'If conn.State = ConnectionState.Closed Then
                            '    conn.Open()
                            'End If
                            'cmd = New SqlCommand(SqlSelection, conn)
                            'readerPedimento = cmd.ExecuteReader()
                            Dim readerPedimento As SqlDataReader
                            sql = "SELECT LOTE ,PEDIMENTO, FCHCADUC," +
                            "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," +
                            "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," +
                            "STATUS, REG_LTPD  FROM LTPD" + vgNumEmpresa.ToString +
                            " WHERE CVE_ALM = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" +
                            " and CANTIDAD > '0'"
                            'If conn.State = ConnectionState.Closed Then
                            '    conn.Open()
                            'End If
                            'cmd = New SqlCommand(SqlSelection, conn)
                            'readerPedimento = cmd.ExecuteReader()
                            cmd = New SqlCommand(sql, connFB, objTrans)
                            readerPedimento = cmd.ExecuteReader()
                            Dim vvCantFaltante As Double = CANT
                            While readerPedimento.Read()
                                pLOTE = readerPedimento.Item(0).ToString
                                pPEDIMENTO = readerPedimento.Item(1).ToString
                                pFCHCADUC = readerPedimento.Item(2).ToString
                                pFCHADUANA = readerPedimento.Item(3).ToString
                                pFCHULTMOV = readerPedimento.Item(4).ToString
                                pNOM_ADUAN = readerPedimento.Item(5).ToString
                                pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
                                pCVE_OBS = readerPedimento.Item(7).ToString
                                pCIUDAD = readerPedimento.Item(8).ToString
                                pFRONTERA = readerPedimento.Item(9).ToString
                                pFEC_PROD_LT = readerPedimento.Item(10).ToString
                                pGLN = readerPedimento.Item(11).ToString
                                pSTATUS = readerPedimento.Item(12).ToString
                                pREG_LTPD = readerPedimento.Item(13).ToString

                                If pFCHCADUC <> "" Then
                                    pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
                                End If
                                If pFCHADUANA <> "" Then
                                    pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
                                End If
                                If pFCHULTMOV <> "" Then
                                    pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
                                End If
                                If pFEC_PROD_LT <> "" Then
                                    pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
                                End If

                                '------------------INSERTAR PEDIMENTOS EN SAE
                                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()
                                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()

                                'sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = '" + pCANTIDAD.ToString + "'" + _
                                '" WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
                                '" AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()

                                If pCANTIDAD >= vvCantFaltante Then
                                    sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + vvCantFaltante.ToString +
                                    " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
                                    " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()
                                Else
                                    sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + pCANTIDAD.ToString +
                                    " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
                                    " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()
                                    '9 >= 10
                                    '10 - 9 = 1
                                    vvCantFaltante = CANT - pCANTIDAD
                                End If

                                'sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
                                '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
                                '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                                '"STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + NUM_ALM + "','" + pFCHCADUC + "','" + _
                                ' pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD + "','" + pREG_LTPD + "','" + _
                                ' pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()

                                '---- extraer MAXIMO el E_LTPD de SAE
                                Dim readerLTPD As SqlDataReader
                                sqllocal = "Select MAX(E_LTPD) AS NUM FROM ENLACE_LTPD" + vgNumEmpresa.ToString
                                If connFB.State = ConnectionState.Closed Then
                                    connFB.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                readerLTPD = cmd.ExecuteReader()
                                While readerLTPD.Read()
                                    'MsgBox(reader7.Item(0))
                                    E_LTPD = readerLTPD.Item(0).ToString
                                    E_LTPD = Val(E_LTPD) + 1
                                End While
                                If E_LTPD = "" Then E_LTPD = "1"
                                readerLTPD.Close()
                                sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" +
                                E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()
                                If pCANTIDAD >= vvCantFaltante Then
                                    Exit While
                                End If
                                ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
                                'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
                                '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
                                '"' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
                                '" AND REG_LTPD = '" + pREG_LTPD.ToString + "'"
                                'cmd = New SqlCommand(SqlSelection, conn)
                                'cmd.ExecuteNonQuery()

                            End While
                            If conn.State = ConnectionState.Open Then
                                conn.Close()
                            End If
                            readerPedimento.Close()
                            '---------------------------------------------------------------
                            'END INSERTAR PEDIMENTOS
                            '---------------------------------------------------------------
                        End If
                        vUUID = Guid.NewGuid.ToString()
                        vUUID = UCase(vUUID)
                        If vlNumSer = "S" Then
                            sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                            ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                            ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                            ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                            "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
                            PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                            IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                            TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                            DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                            NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                            CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                            TOT_PARTIDA + "','" + POLIT_APLI + "')"
                        Else
                            If vgVersion = "5" Then
                                sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                                "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
                                PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                                IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                                TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                                DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                                NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                                CVE_OBS + "','0','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                                TOT_PARTIDA + "','" + POLIT_APLI + "')"
                            End If
                            Dim VERSION_SINC As String = vfechayhora
                            VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
                            If vgVersion = "6" Or vgVersion = "7" Then
                                sqllocal = "insert into  PAR_FACTR" + nnBisness.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" +
                                ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ, UUID) values (" +
                                "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" +
                                PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" +
                                IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" +
                                TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" +
                                DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" +
                                Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" +
                                CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" +
                                TOT_PARTIDA.ToString + "','S','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1','" + vUUID + "')"
                            End If

                        End If
                        If connFB.State = ConnectionState.Closed Then
                            connFB.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()

                        'INSERTAR EL INDICE
                        sqllocal = "insert into  PAR_FACTR_CLIB" + nnBisness.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR.ToString + "')"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        'actualizar detalle PAR_FACTP01
                        'sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString + _
                        '" WHERE CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        'actualizar ACUMULADOR de remisiones y facturas
                        '-----------camision del vendedor
                        'If pComicion = "" Then pComicion = "0"
                        'If Val(pComicion) >= 1 Then
                        '    Dim VLcomi As String = (pComicion / 100) * TOT_PARTIDA
                        '    sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
                        '    " RIMP = RIMP + " + TOTIMP4 + ", RCOMI = RCOMI + " + VLcomi + _
                        '    " WHERE CVE_AFACT = '11'"
                        'Else
                        'TOT_ARTIDA = PRECIO POR CANTIDAD

                        sqllocal = "update AFACT" + nnBisness.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," +
                        " RIMP = RIMP + " + TOTIMP4 + "" +
                        " WHERE CVE_AFACT = '3'"
                        'End If
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        '---------EXTRAER CLAVE DEL FOLIO
                        Dim CVE_FOLIO As String = "0"
                        Dim readerCONTROL As SqlDataReader
                        sql = "Select ULT_CVE AS num FROM TBLCONTROL" + nnBisness.ToString + " WHERE ID_TABLA='32'"
                        cmd = New SqlCommand(sql, connFB, objTrans)
                        readerCONTROL = cmd.ExecuteReader()
                        While readerCONTROL.Read()
                            'MsgBox(reader3.Item(0))
                            CVE_FOLIO = readerCONTROL.Item(0).ToString
                            'vExistencia = Val(vExistencia) + 1
                        End While
                        If CVE_FOLIO = "" Then CVE_FOLIO = "1"
                        readerCONTROL.Close()
                        '-----------------------------------------------
                        sqllocal = "UPDATE  TBLCONTROL" + nnBisness.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()



                        'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()

                        ''insertar documentos siguientes
                        'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
                        '"PARTIDA, PART_E, CANT_E) VALUES (" + _
                        '"'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" + _
                        'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
                        '"PARTIDA, PART_E, CANT_E) VALUES (" + _
                        '"'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" + _
                        'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        '-------------------------------------------------------------------------------
                        'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
                        ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                        'cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        'cmd.ExecuteNonQuery()
                        '-----------------------------------------------------------------------------
                        'actualizar las existencias
                        'Call ActualizarExistencias(CVE_ART, CANT)
                        'sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
                        '" PEND_SURT = PEND_SURT - " + CANT.ToString + ", COSTO_PROM = '" + COST + "'," + _
                        '" ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
                        '" WHERE CVE_ART ='" + CVE_ART + "'"
                        time = Today.Now
                        sqllocal = "update INVE" + nnBisness.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                        " COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                        "VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" +
                        " WHERE CVE_ART ='" + CVE_ART + "'"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        '-----------------------------------------------
                        'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                        Dim vExistencia As String = ""
                        Dim reader3 As SqlDataReader
                        sql = "Select ISNULL(max(EXIST),0) AS num FROM INVE" + nnBisness.ToString + " WHERE CVE_ART = '" + CVE_ART + "'"
                        cmd = New SqlCommand(sql, connFB, objTrans)
                        reader3 = cmd.ExecuteReader()
                        While reader3.Read()
                            'MsgBox(reader3.Item(0))
                            vExistencia = reader3.Item(0).ToString
                            'vExistencia = Val(vExistencia) - Val(CANT)
                        End While
                        If vExistencia = "" Then vExistencia = "1"
                        reader3.Close()
                        '--------existe almacen
                        Dim vExistAlm As String
                        Dim rederExistAlm As SqlDataReader
                        sql = "SELECT EXIST FROM MULT" + nnBisness.ToString +
                        " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '" + NUM_ALM + "'"
                        cmd = New SqlCommand(sql, connFB, objTrans)
                        rederExistAlm = cmd.ExecuteReader()
                        While rederExistAlm.Read
                            vExistAlm = rederExistAlm.Item(0).ToString
                            vExistAlm = Val(vExistAlm) - CANT
                        End While
                        rederExistAlm.Close()
                        If vlNumSer = "S" Then
                            sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                            "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                            "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" +
                            "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                            "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                            "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
                            "S','0','" + COST + "','N','0')"
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                        Else
                            If vgVersion = "5" Then
                                sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                                "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" +
                                "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                                "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                                "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
                                "S','0','" + COST + "','N','0')"
                            End If
                            If vgVersion = "6" Or vgVersion = "7" Then
                                sqllocal = "INSERT INTO MINVE" + nnBisness.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" +
                                "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov.ToString + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                "'R','" + pcvedoc.ToString + "','" + pCve_Cliente + "','" + VEND.ToString + "','" + CANT.ToString + "','" +
                                "0','" + PREC.ToString + "','" + COST.ToString + "','','" + CVE_OBS.ToString + "'," +
                                "'0','" + UNI_VENTA.ToString + "','" + E_LTPD.ToString + "','" + vExistAlm + "','" + TIPO_PROD + "','" +
                                "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO.ToString + "','-1','" +
                                "S','" + COST.ToString + "','" + COST.ToString + "','N','0','" + vExistencia.ToString + "','" + COST.ToString + "')"
                            End If
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE MINVE" + nnBisness.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " +
                            " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" +
                            " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                            Dim VERSION_SINC As String
                            VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                            sqllocal = "UPDATE MULT" + nnBisness.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" +
                            " WHERE CVE_ART = '" + CVE_ART + "'" +
                            " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                        End If
                        'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                        'cmdFB.ExecuteNonQuery()
                        mREG_SERIE = Val(mREG_SERIE) + 1
                        vlsubtotal = vlsubtotal + (PREC * CANT)
                        NUM_PAR = NUM_PAR + 1
                    End While
                    reader2.Close()
                    CAN_TOT = vlsubtotal.ToString
                    Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
                    IMP_TOT4 = iva.ToString
                    sqllocal = "UPDATE FOLIOSF" + nnBisness.ToString + " SET ULT_DOC = ULT_DOC + 1, FECH_ULT_DOC = '" + vfechayhora.ToString("yyyy/MM/dd") + "'" +
                    " WHERE TIP_DOC = 'R'"
                    'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
                    '" WHERE TIP_DOC = 'R' and serie ='STAND.'"
                    '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    sqllocal = "UPDATE FACTR" + nnBisness.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
                    " ,CAN_TOT='" + CAN_TOT + "', IMP_TOT4 = '" + IMP_TOT4 + "'" +
                    " WHERE CVE_DOC = '" + vCveDoc + "'"
                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                    cmd.ExecuteNonQuery()
                    '------------------------
                    objTrans.Commit()
                    empresa = vgEmpresa.ToString
                    documento = CVE_DOC.ToString
                    mensaje = "Registrar Remision Embarque: Correcto Remision Embarque:" + CVE_DOC.ToString
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    '------------------------
                    BIEN = 1
                End If
                'OrdenVenta = Val(OrdenVenta)
                'OrdenVenta = espacios(OrdenVenta, 20)
                Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'S'" +
                " WHERE embarque = '" + Trim(id_pedido) + "'"
                EjecutarQuerySQL_EMPRESA6(sql1)
            Next

            '------------------------------------------------------------------------------------------
            If BIEN = 1 Then
                '------------------------------------------------------------------------
                Dim StrVts As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
                Dim connVts As New SqlConnection(StrVts)
                sql = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Vende' AND BASEDATOS = 'LogistikMasterValvulerias" + EMPRESA_DEST.Trim + "'"
                Dim daVts As New SqlDataAdapter(sql, connVts)
                Dim dsVts As New DataSet()
                daVts.Fill(dsVts, "EmpresaSAE")
                Dim oTablaVts As DataTable
                oTablaVts = dsVts.Tables("EmpresaSAE")
                Dim SERVIDOR2 As String = ""
                Dim USUARIO2 As String = ""
                Dim NOMBRE_BD2 As String = ""
                Dim PASSWROD2 As String = ""
                Dim BASEDATOS2 As String = ""
                'Dim VTIPO As String = ""
                If oTablaVts.Rows.Count >= 1 Then
                    Dim oFila As DataRow
                    For Each oFila In oTablaVts.Rows
                        SERVIDOR2 = oFila.Item("SERVIDOR").ToString
                        BASEDATOS2 = oFila.Item("BASEDATOS").ToString
                        USUARIO2 = oFila.Item("USUARIO").ToString
                        PASSWROD2 = oFila.Item("PASSWROD").ToString
                        NOMBRE_BD2 = oFila.Item("NOMBRE_BD").ToString
                    Next
                End If
                Dim nnBisness2 = Mid(NOMBRE_BD2, LongitudBD)
                'CONEXION VENTAS
                Dim StrV As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD2 + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
                Dim connV As New SqlConnection(StrV)
                '----------------------------------------------------------------------
                'BASEDATOS logistik
                'NOMBRE_BD sae
                'vientos2
                Call SEND_RECEPCION_EMBARQUE2(NOMBRE_BD2, nnBisness2, id_pedido, EMPRESA_DEST)

                Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'S'" +
                " WHERE embarque = '" + Trim(id_pedido) + "'"
                EjecutarQuerySQL_EMPRESA6(sql1)

            End If
            'Catch es As FbException
            '    empresa = vgEmpresa.ToString
            '    documento = CVE_DOC.ToString
            '    mensaje = "Registrar Remision Embarque: InCorrecto Remision Embarque:" + CVE_DOC.ToString
            '    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" + _
            '    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            '    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            '    Me.Refresh()
            '    objTrans.Rollback()
            '    Throw es
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Registrar Remision Embarque: InCorrecto Remision Embarque:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTrans.Rollback()
            Throw es
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "Registrar Remision Embarque: InCorrecto Remision Embarque:" + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            '***** rollback the transaction ************************************************'
            objTrans.Rollback()
            MsgBox(ex.Message.ToString)
        End Try

    End Sub
    Private Sub SEND_RECEPCION_EMBARQUE2(ByVal pMiBD As String, ByVal pNUMEMP As String, ByVal ID_PEDIDOr As String, EMPRESA_DEST As String)
        'SACAR LA EMPRESA DEL SAE
        Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + My.Settings.vgCrearBD_Name + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim connection7 As New SqlConnection(Str1)
        Dim sqllocal As String = "SELECT BASEDATOS from EmpresaSAE " +
        " WHERE NOMBRE_BD = '" + pMiBD + "'"
        Dim daPC1 As New SqlDataAdapter(sqllocal, connection7)
        Dim dsPC1 As New DataSet
        daPC1.Fill(dsPC1, "EmpresaSAE")
        Dim oTablePC1 As New DataTable
        oTablePC1 = dsPC1.Tables("EmpresaSAE")
        Dim MI_BD_x As String = ""
        For Each oRowPC7 In oTablePC1.Rows
            MI_BD_x = oRowPC7.Item("BASEDATOS").ToString
        Next
        'enviar compras al sae
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim conn As New SqlConnection(Str)
        Dim conn2 As New SqlConnection(Str2)
        'Dim conn3 As New SqlConnection(Str2)
        'Dim comd1 As SqlCommand = New SqlCommand
        Dim CVE_DOC As String
        Try
            sqllocal = "SELECT embarque,id_proveedor,factura,oc," +
            "fecha_recepcion,id_usuario_recibio,fecha_calificacion,id_usuario_califico,fecha_liberacion," +
            "id_usuario_libero,contenido,estado,completo,empresa_destino," +
            "enviado_sae, rfc_destino FROM vLogistik_Embarques" +
            " WHERE embarque ='" + ID_PEDIDOr + "'"

            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "vLogistik_Embarques_RECEPCION")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("vLogistik_Embarques_RECEPCION")
            Dim OrdenCompra As String

            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            Dim id_pedido As String
            Dim RFC_DEST As String
            Dim total_te As Double
            For Each oRowPC In oTablePC.Rows
                id_pedido = ID_PEDIDOr
                OrdenCompra = oRowPC.Item("embarque").ToString
                'num_empresa = oRowPC.Item("num_empresa").ToString
                'agregar ceros
                OrdenCompra = ceros(OrdenCompra, 10)
                'agregar espacios
                OrdenCompra = espacios(OrdenCompra, 20)
                RFC_DEST = oRowPC.Item("rfc_destino").ToString

                Dim TIP_DOC As String = "r"
                CVE_DOC = OrdenCompra
                Dim CVE_CLPV As String
                If EMPRESA_DEST.Trim = "01" Then CVE_CLPV = My.Settings.ProvEmp01
                If EMPRESA_DEST.Trim = "04" Then CVE_CLPV = My.Settings.ProvEmp04
                CVE_CLPV = espacios(CVE_CLPV, 10)
                total_te = 0
                Dim STATUS As String = "0"
                Dim SU_REFER As String = OrdenCompra

                Dim FECHA_DOC As String = time.ToString("yyyy/MM/dd")
                Dim FECHA_REC As String = time.ToString("yyyy/MM/dd")
                Dim FECHA_PAG As String = time.ToString("yyyy/MM/dd")
                Dim FECHA_CANCELA As String = time.ToString("yyyy/MM/dd")
                'SUBTOTAL
                Dim CAN_TOT As Double = total_te / 1.16
                Dim IMP_TOT1 As String = "0"
                Dim IMP_TOT2 As String = "0"
                Dim IMP_TOT3 As String = "0"
                'IVA
                Dim IMP_TOT4 As String = CAN_TOT * 0.16
                Dim DES_TOT As String = "0"
                Dim DES_FIN As String = "0"
                Dim TOT_IND As String = "0"
                Dim OBS_COND As String = ""
                Dim CVE_OBS As String = "0"
                Dim NUM_ALMA As String = "1"
                Dim ACT_CXP As String = "S"
                Dim ACT_COI As String = "N"
                Dim NUM_MONED As String = "1"
                Dim TIPCAMB As String = "1"
                Dim ENLAZADO As String = "O"
                Dim TIP_DOC_E As String = "O"
                Dim NUM_PAGOS As String = ""
                'FECHA Y HORA
                Dim FECHAELAB As String = vfechayhora.ToString("yyyy/MM/dd HH:mm:ss")
                Dim SERIE As String = ""
                '---------------------traer del sae
                Dim FOLIO As String = Nothing
                sqllocal = "Select MASCARA FROM PARAM_FOLIOSC" + pNUMEMP.ToString +
                           " WHERE TIPODOCTO = 'R'" ' NUM_EMP = '1' AND
                Dim da77 As New SqlDataAdapter(sqllocal, conn2)
                Dim ds77 As New DataSet
                If conn2.State = ConnectionState.Closed Then
                    conn2.Open()
                End If
                da77.Fill(ds77, "PARAM_FOLIOSC" & pNUMEMP.ToString)
                Dim oTable77 As New DataTable
                oTable77 = ds77.Tables("PARAM_FOLIOSC" & pNUMEMP.ToString)
                'If conn2.State = ConnectionState.Open Then
                '    conn2.Close()
                'End If
                If oTable77.Rows.Count >= 1 Then
                    For Each oRow77 In oTable77.Rows
                        FOLIO = oRow77.Item("MASCARA").ToString
                    Next
                End If
                If FOLIO = "" Then
                    MsgBox("Configure la mascara de la clave del documento")
                    Exit Sub
                End If
                Dim CTLPOL As String = "0"
                Dim ESCFD As String = "N"
                Dim CONTADO As String = "N"
                Dim BLOQ As String = "N"
                Dim DES_FIN_PORC As String = "0"
                Dim DES_TOT_PORC As String = "0"
                'TOTAL
                Dim IMPORTE As String = total_te.ToString
                Dim TIP_DOC_ANT As String = ""
                Dim DOC_ANT As String = ""
                Dim TIP_DOC_SIG As String = ""
                Dim DOC_SIG As String = ""
                Dim SigCveDoc As String = ""
                Dim vCveDoc As String = ""
                '---------------------------------------
                objTrans = conn2.BeginTransaction()
                '--------------------------------------
                'vCveDoc = BuscarClaveDoc()
                '----------------buscar clave del documento
                Dim vcont As String = ""
                Dim vnum As Integer
                Dim reader As SqlDataReader
                Dim SqlSelection As String = "Select ISNULL(max(CLAVE_DOC),1) AS num from COMPR_CLIB" + pNUMEMP.ToString
                cmd = New SqlCommand(SqlSelection, conn2, objTrans)
                reader = cmd.ExecuteReader()
                While reader.Read()
                    'MsgBox(reader.Item(0))
                    vcont = reader.Item(0).ToString
                    'Convertir a numero y 'aumentar mas uno
                    vcont = Val(vcont) + 1
                    'agregar ceros
                    'vcont = ceros(vnum, 10)
                    'agregar espacios
                    vcont = espacios(vcont, 20)
                    'regresar valor
                    'Me.TextBox1.Text = vcont
                    vCveDoc = vcont
                End While
                reader.Close()
                'cmd.Dispose()
                If vCveDoc <> "" Then
                    ''---------------------------------------
                    'objTrans = conn2.BeginTransaction()
                    ''--------------------------------------
                    'DOC_ANT = ceros(DOC_ANT, 10)
                    DOC_ANT = espacios(DOC_ANT, 20)
                    Dim vfolio As String = "0" 'vCveDoc
                    sqllocal = "insert into  COMPR" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," +
                    "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," +
                    "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," +
                    "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," +
                    "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," +
                    "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG) values (" +
                    "'r','" + vCveDoc.ToString + "','" + CVE_CLPV + "','" + STATUS + "','" + SU_REFER + "','" + FECHA_DOC + "','" + FECHA_REC + "','" +
                    FECHA_PAG + "','" + FECHA_CANCELA + "','" + CAN_TOT.ToString + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + IMP_TOT4 + "','" +
                    DES_TOT + "','" + DES_FIN + "','" + TOT_IND + "','" + OBS_COND + "','" + CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXP + "','" +
                    ACT_COI + "','" + NUM_MONED + "','" + TIPCAMB + "','" + ENLAZADO + "','o','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                    SERIE + "','" + vfolio.ToString + "','" + CTLPOL + "','" + ESCFD + "','" + CONTADO + "','" + BLOQ + "','" + DES_FIN_PORC + "','" +
                    DES_TOT_PORC + "','" + IMPORTE + "','" + TIP_DOC_ANT + "','" + DOC_ANT.ToString + "',NULL,NULL)"
                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                    cmd.ExecuteNonQuery()
                    sqllocal = "insert into  COMPR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                    cmd.ExecuteNonQuery()
                    sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                    cmd.ExecuteNonQuery()
                    '---------------------
                    'Dim vCve_Obs As String = TraerClaveSiguiente()
                    Dim vCve_Obs As String
                    Dim vcont7 As String = ""
                    Dim reader7 As SqlDataReader
                    sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num from OBS_DOCC" + pNUMEMP.ToString
                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                    reader7 = cmd.ExecuteReader()
                    While reader7.Read()
                        'MsgBox(reader7.Item(0))
                        vcont7 = reader7.Item(0).ToString
                        vcont7 = Val(vcont7) + 1
                    End While
                    If vcont7 = "" Then vcont7 = "1"
                    vCve_Obs = vcont7
                    reader7.Close()
                    '-----------------------------------
                    Dim vObser As String = "Buenas O. C. HH"
                    sqllocal = "INSERT INTO OBS_DOCC" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                    cmd.ExecuteNonQuery()
                    'Call UpdateOC(CVE_DOC, vCveDoc)
                    sqllocal = "update COMPO" + pNUMEMP.ToString + " SET ENLAZADO='T', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc + "'" +
                        " WHERE CVE_DOC ='" + CVE_DOC + "'"
                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                    cmd.ExecuteNonQuery()
                    '-------------------------------------------------------------------
                    'Call RecepcionDatalleSAE2(vCveDoc, vObser, CVE_DOC)
                    'Dim CVE_DOC As String
                    Dim NUM_PAR As Integer = 0
                    Dim CVE_ART As String
                    Dim CANT As String
                    Dim MERMA As String
                    Dim PXR As String
                    Dim PREC As String
                    Dim COST As String
                    Dim IMPU1 As String = "0"
                    Dim IMPU2 As String = "0"
                    Dim IMPU3 As String = "0"
                    Dim IMPU4 As String
                    Dim IMP1APLA As String = "0"
                    Dim IMP2APLA As String = "0"
                    Dim IMP3APLA As String = "0"
                    Dim IMP4APLA As String
                    Dim TOTIMP1 As String = "0"
                    Dim TOTIMP2 As String = "0"
                    Dim TOTIMP3 As String = "0"
                    Dim TOTIMP4 As String
                    Dim DESCU As String = "0"
                    Dim ACT_INV As String = "S"
                    Dim TIP_CAM As String = "1"
                    Dim UNI_VENTA As String = "pz"
                    Dim TIPO_ELEM As String = "N"
                    Dim TIPO_PROD As String = "S"
                    'Dim CVE_OBS As String
                    Dim REG_SERIE As String = "0"
                    Dim E_LTPD As String = "0"
                    Dim FACTCONV As String = "1"
                    Dim COST_DEV As String = "0"
                    Dim NUM_ALM As String = NUM_ALMA
                    Dim MINDIRECTO As String = "0"
                    Dim NUM_MOV As String
                    Dim TOT_PARTIDA As String
                    '-------------------------------------------------------------------------------------------------
                    'TABLA AFACT ES UN NUMERO POR MES
                    Dim reader2 As SqlDataReader
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    'SqlSelection = "Select upc, quantity_expected, quantity_received, unit_price_te, price_te" + _
                    '" FROM Logistik_supply_order_detail WHERE id_supply_order = '" + OrdenCompra + "'"
                    SqlSelection = "select codigo_producto, cantidad, merma, precio," +
                    " id_usuario, fecha, pedido, oc" +
                    " FROM vLogistik_Kardex WHERE embarque='" + id_pedido + "'" +
                    " and empresa_destino ='" + EMPRESA_DEST.Trim + "'"
                    cmd = New SqlCommand(SqlSelection, conn)
                    reader2 = cmd.ExecuteReader()
                    While reader2.Read()
                        'MsgBox(reader2.Item(0))
                        'CVE_DOC = reader2.Item(0).ToString
                        NUM_PAR = NUM_PAR + 1
                        CVE_ART = reader2.Item(0).ToString
                        CANT = reader2.Item(1).ToString
                        PXR = reader2.Item(1).ToString
                        MERMA = reader2.Item(2).ToString
                        CANT = Val(CANT) - Val(MERMA)
                        PREC = reader2.Item(3).ToString
                        'falta el costo
                        COST = reader2.Item(3).ToString
                        'iva 16
                        IMPU4 = "16"
                        '1
                        IMP4APLA = "1"
                        'iva total
                        TOTIMP4 = PREC * (IMPU4 / 100)
                        'sacar cant * costo
                        TOT_PARTIDA = CANT * COST
                        '-------------------Traer la clave siguiente
                        'CVE_OBS = TraerClaveSiguiente()
                        vcont = "0"
                        Dim readerObser As SqlDataReader
                        sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCC" + pNUMEMP.ToString
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        readerObser = cmd.ExecuteReader()
                        While readerObser.Read()
                            'MsgBox(readerObser.Item(0))
                            vcont = readerObser.Item(0).ToString
                            vcont = Val(vcont) + 1
                        End While
                        If vcont = "" Then vcont = "1"
                        CVE_OBS = vcont
                        readerObser.Close()
                        '-------------------------------------------
                        sqllocal = "INSERT INTO OBS_DOCC" + pNUMEMP.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + vObser + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '---------------------crear el o los movimientos
                        'Dim vNum_Mov As String = ConsecutivoMovimiento()
                        Dim vNum_Mov As String
                        vcont7 = "0"
                        Dim readerMINVE As SqlDataReader
                        sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num FROM MINVE" + pNUMEMP.ToString
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        readerMINVE = cmd.ExecuteReader()
                        While readerMINVE.Read()
                            'MsgBox(reader7.Item(0))
                            vcont7 = readerMINVE.Item(0).ToString
                            vcont7 = Val(vcont7) + 1
                        End While
                        If vcont7 = "" Then vcont7 = "1"
                        vNum_Mov = vcont7
                        readerMINVE.Close()
                        ''----------traer la cantidad
                        'Dim readerPC As SqlDataReader
                        'SqlSelection = "select quantity_received from Logistik_supply_order_detail" + _
                        '" where id_supply_order = '" + CVE_DOC + "' and upc = '" + CVE_ART + "'" + _
                        '" AND id_supply_order_detail = '" + NUM_PAR + "'"
                        'conn.Open()
                        'cmd = New SqlCommand(SqlSelection, conn)
                        'readerPC = cmd.ExecuteReader()
                        'While readerPC.Read()
                        '    CANT = readerPC.Item(0).ToString
                        'End While
                        'conn.Close()
                        'readerPC.Close()
                        '-------------------------------------------
                        sqllocal = "insert into  PAR_COMPR" + pNUMEMP.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " +
                        "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," +
                        "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," +
                        "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA) values (" +
                        "'" + vCveDoc.ToString + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','0','" +
                        PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" +
                        IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESCU + "','" +
                        "S','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_ELEM + "','" + TIPO_PROD + "','" +
                        CVE_OBS + "','" + REG_SERIE + "','" + E_LTPD + "','" + FACTCONV + "','" + COST_DEV + "','" +
                        NUM_ALM + "','" + MINDIRECTO + "','" + vNum_Mov + "','" + TOT_PARTIDA + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        'INSERTAR EL INDICE
                        sqllocal = "insert into  PAR_COMPR_CLIB" + pNUMEMP.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + vCveDoc.ToString + "','" + NUM_PAR.ToString + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        'actualizar detalle
                        sqllocal = "update PAR_COMPO" + pNUMEMP.ToString + " set PXR = PXR - " + CANT.ToString +
                        " where CVE_DOC = '" + CVE_DOC.ToString + "' and CVE_ART = '" + CVE_ART + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        'actualizar ACUMULADOR
                        sqllocal = "update ACOMP" + pNUMEMP.ToString + " set RVTA_COM = RVTA_COM + '" + TOT_PARTIDA + "'," +
                        " RIMP = RIMP + '" + TOTIMP4 + "'" +
                        " where CVE_ACOMP = '11'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()

                        sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE  TBLCONTROL" + pNUMEMP.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        'insertar documentos siguientes
                        sqllocal = "INSERT INTO DOCTOSIGC" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                        "PARTIDA, PART_E, CANT_E) VALUES (" +
                        "'r','" + vCveDoc.ToString + "','A','o','" + CVE_DOC.ToString + "','" +
                        NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "INSERT INTO DOCTOSIGC" + pNUMEMP.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," +
                        "PARTIDA, PART_E, CANT_E) VALUES (" +
                        "'o','" + CVE_DOC.ToString + "','S','r','" + vCveDoc.ToString + "','" +
                        NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE FOLIOSC" + pNUMEMP.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'r'"
                        '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        'actualizar las existencias
                        'Call ActualizarExistencias(CVE_ART, CANT)
                        sqllocal = "update INVE" + pNUMEMP.ToString + " SET EXIST = EXIST + '" + CANT + "', FCH_ULTCOM='" + time.ToString("yyyy/MM/dd") + "'," +
                        " COMP_X_REC = COMP_X_REC - '" + CANT + "', COSTO_PROM = '" + COST + "'," +
                        " ULT_COSTO = '" + COST + "', COMP_ANL_C = COMP_ANL_C + '" + CANT + "', COMP_ANL_M = COMP_ANL_M + '" + TOT_PARTIDA + "'" +
                        " WHERE CVE_ART ='" + CVE_ART + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '-----------------------------------------------
                        'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                        Dim vExistencia As String = ""
                        Dim reader3 As SqlDataReader
                        sqllocal = "Select ISNULL(max(EXIST),0) AS num from INVE" + pNUMEMP.ToString + " where CVE_ART = '" + CVE_ART + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        reader3 = cmd.ExecuteReader()
                        While reader3.Read()
                            'MsgBox(reader3.Item(0))
                            vExistencia = reader3.Item(0).ToString
                            'vExistencia = Val(vExistencia) + 1
                        End While
                        If vExistencia = "" Then vExistencia = "1"
                        reader3.Close()
                        '-----------------------------------------------
                        sqllocal = "INSERT INTO MINVE" + pNUMEMP.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                        "'" + CVE_ART + "','1','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," +
                        "'R','" + CVE_DOC + "','         1','','" + CANT + "','0','0','" + COST + "','','" + CVE_OBS + "'," +
                        "'" + REG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + FACTCONV + "','" + time.ToString("yyyy/MM/dd") + "','','1','1','" +
                        "S','0','" + COST + "','N','0')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + vObser + "')"
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE MULT" + pNUMEMP.ToString + " SET EXIST = EXIST  + " + CANT.ToString +
                            " ,COMP_X_REC = COMP_X_REC - '" + CANT.ToString + "' WHERE CVE_ART = '" + CVE_ART + "' and CVE_ALM = '" + NUM_ALM + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                    End While
                    reader2.Close()
                    'Call RecepcionDatalleSAE2(vCveDoc, vObser, CVE_DOC)
                    '------------------------
                    objTrans.Commit()
                    '------------------------
                End If
                Dim sql1 As String = "update vLogistik_Embarques SET enviado_sae = 'F'" +
                " WHERE embarque = '" + id_pedido + "'"
                EjecutarQuerySQL_EMPRESA_X(sql1, MI_BD)
            Next
            'MsgBox("Almacenado correctamente")
        Catch es As SqlException
            MsgBox(es.Message.ToString)
            objTrans.Rollback()

            Throw es

        Catch ex As Exception
            '***** rollback the transaction ************************************************'
            MsgBox(ex.Message.ToString)
            objTrans.Rollback()

            Throw ex

        Finally
            If conn2.State <> ConnectionState.Closed Then conn2.Close()
        End Try
    End Sub
    Function VerifyOrders(ByVal emp06BD As String, ByVal pedido As String, ByVal Nemp As String) As Boolean
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim connL As New SqlConnection(Str)
        Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + emp06BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
        Dim connFB As New SqlConnection(Str2)

        Dim readerOrders As SqlDataReader
        Dim Sql7 As String = "SELECT od.id_order,od.product_upc,od.id_warehouse FROM Logistik_order_detail as od WHERE TRIM(od.id_order) ='" + pedido.Trim + "'"
        LabelTABLA.Text = "S Logistik_order_detail"
        cmd = New SqlCommand(Sql7, connL)
        If connL.State = ConnectionState.Closed Then
            connL.Open()
        End If
        Me.Refresh()
        readerOrders = cmd.ExecuteReader()
        Dim prod As String
        Dim alm As String

        While readerOrders.Read()
            LabelTABLA.Text = "S Logistik_order_detail 1"
            Me.Refresh()
            prod = readerOrders.Item(1).ToString
            alm = readerOrders.Item(2).ToString
            LabelTABLA.Text = "S Logistik_order_detail 2"
            Dim SqlA As String = "Select CVE_ART FROM MULT" + Nemp.ToString +
                        " WHERE CVE_ART = '" + prod + "' AND CVE_ALM='" + alm + ""
            LabelTABLA.Text = "S MULT"
            Dim da77 As New SqlDataAdapter(SqlA, connFB)
            Dim ds77 As New DataSet
            If connFB.State = ConnectionState.Closed Then
                connFB.Open()
            End If
            da77.Fill(ds77, "MULT" + Nemp.ToString)
            Dim oTable77 As New DataTable
            oTable77 = ds77.Tables("MULT" + Nemp.ToString)
            If connFB.State = ConnectionState.Open Then
                connFB.Close()
            End If
            If oTable77.Rows.Count >= 1 Then
                For Each oRow77 In oTable77.Rows
                    prod = oRow77.Item("CVE_ART").ToString
                Next
            Else
                empresa = vgEmpresa.ToString
                documento = ""
                mensaje = "Verificacion Pedido: InCorrecto Pedido:" + pedido.ToString + " Producto no existe:" + prod.ToString + " en Almacen:" + alm.ToString
                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                Me.Refresh()
                Return False
            End If
        End While
        readerOrders.Close()
        Return True
    End Function

    Private Sub LlevarPedidoEmp6SAE(ByVal pEMP06BD As String)
        LabelProcedimiento.Text = "Realizar Pedidos SAE6"
        Me.Refresh()
        Dim CVE_DOC As String = ""
        Dim CVE_PEDI As String
        Try
            Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim conn As New SqlConnection(Str)
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pEMP06BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pEMP06BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
            Dim connFB As New SqlConnection(Str2)
            Dim BIEN As Integer = 0
            '15 DIAS
            Dim vFechaHoy As Date = Today.Date.Now
            Dim vFechaDiasAntes As Date = Today.Date.Now
            vFechaDiasAntes = vFechaDiasAntes.AddDays(-15) 'Resta días
            'DATE_ADD
            sqllocal = "SELECT id_order, reference,id_shop_group,id_shop,id_carrier," +
            "id_lang,id_customer,id_cart,id_currency,id_address_delivery," +
            "id_address_invoice,current_state,secure_key,payment,conversion_rate," +
            "module,recyclable,gift,gift_message,mobile_theme," +
            "shipping_number,total_discounts,total_discounts_tax_incl,total_discounts_tax_excl,total_paid," +
            "total_paid_tax_incl,total_paid_tax_excl,total_paid_real,total_products,total_products_wt," +
            "total_shipping,total_shipping_tax_incl,total_shipping_tax_excl,carrier_tax_rate,total_wrapping," +
            "total_wrapping_tax_incl,total_wrapping_tax_excl,round_mode,invoice_number,delivery_number," +
            "invoice_date,delivery_date,valid,date_add,date_upd," +
            "EnviadaSAE,Tipo_Rem_Fact,AlamcenSAE,doc_sig_sae,num_empresa,CampLib34" +
            " FROM Logistik_orders WHERE EnviadaSAE = 'N' and current_state ='5' AND Tipo_Rem_Fact = 'R' AND verificacion=1" +
            " AND date_add BETWEEN '" & Format(vFechaDiasAntes, "MM/dd/yyyy HH:mm:ss") & "' AND '" & Format(vFechaHoy, "MM/dd/yyyy HH:mm:ss") & "'"
            'sqllocal = "SELECT id_order, reference,id_shop_group,id_shop,id_carrier," + _
            '"id_lang,id_customer,id_cart,id_currency,id_address_delivery," + _
            '"id_address_invoice,current_state,secure_key,payment,conversion_rate," + _
            '"module,recyclable,gift,gift_message,mobile_theme," + _
            '"shipping_number,total_discounts,total_discounts_tax_incl,total_discounts_tax_excl,total_paid," + _
            '"total_paid_tax_incl,total_paid_tax_excl,total_paid_real,total_products,total_products_wt," + _
            '"total_shipping,total_shipping_tax_incl,total_shipping_tax_excl,carrier_tax_rate,total_wrapping," + _
            '"total_wrapping_tax_incl,total_wrapping_tax_excl,round_mode,invoice_number,delivery_number," + _
            '"invoice_date,delivery_date,valid,date_add,date_upd," + _
            '"EnviadaSAE,Tipo_Rem_Fact,AlamcenSAE,doc_sig_sae,num_empresa" + _
            '" FROM Logistik_orders WHERE EnviadaSAE = 'N' and current_state ='5' AND Tipo_Rem_Fact = 'R'" + _
            '" AND date_add BETWEEN '" & Format(vFechaDiasAntes, "MM/dd/yyyy") & "' AND '" & Format(vFechaHoy, "MM/dd/yyyy") & "'"
            LabelTABLA.Text = "Q1s_Logistik_orders"
            TextBox1.Text = "P2"
            Me.Refresh()

            LabelTABLA.Text = "S Logistik_orders"

            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_orders")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_orders")
            Dim OrdenVenta As String
            If connFB.State = ConnectionState.Closed Then
                connFB.Open()
            End If
            Dim id_pedido As String = ""
            Dim num_empresa As String
            Dim CampLib34 As String
            For Each oRowPC In oTablePC.Rows
                RefVenta = ""
                id_pedido = oRowPC.Item("id_order").ToString
                OrdenVenta = oRowPC.Item("id_order").ToString
                CVE_DOC = oRowPC.Item("id_order").ToString
                If CVE_DOC = "" Then Exit Sub
                num_empresa = Trim(oRowPC.Item("num_empresa").ToString)
                CampLib34 = ""
                CampLib34 = oRowPC.Item("camplib34").ToString
                'TextErrorEmp6.Text = "verificar traspaso"
                Dim OK As Integer = 1
                Dim OKSend As Integer = 1
                ''''-------------------------------------verificacion de traspasos ------------------------------------
                '''Dim readerVeryTrasp As SqlDataReader
                '''sqllocal = "SELECT EnviadaSAE FROM Logistik_Traspasos where trim(num_pedido) ='" + id_pedido.Trim +
                '''"' and verificacion=1 and num_empresa='" + num_empresa + "'"
                '''LabelTABLA.Text = "Very Traspasos"
                '''TextBox1.Text = "P4"
                '''Me.Refresh()
                '''cmd = New SqlCommand(sqllocal, conn)
                '''If conn.State = ConnectionState.Closed Then
                '''    conn.Open()
                '''End If
                '''readerVeryTrasp = cmd.ExecuteReader()
                ''''CORRECTO()
                '''Dim prod7 As String
                '''Dim alm7 As String
                '''Dim cant7 As String
                '''Dim Enviado As String
                '''Dim OKSend As Integer = 0
                '''While readerVeryTrasp.Read()
                '''    'alm7 = readerVeryTrasp.Item(1).ToString
                '''    'alm7 = readerVeryTrasp.Item(2).ToString
                '''    'cant7 = readerVeryTrasp.Item(3).ToString
                '''    Enviado = Trim(readerVeryTrasp.Item(0).ToString)
                '''    If Enviado = "S" Then
                '''        OKSend = 1
                '''        'MsgBox("traspaso exitoso")
                '''        'Exit While
                '''    Else
                '''        OKSend = 0
                '''        empresa = vgEmpresa.ToString
                '''        documento = id_pedido.ToString
                '''        mensaje = "Verifica Traspaso: InCorrecta Traspaso:" + id_pedido.ToString
                '''        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                '''        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                '''        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                '''        TextBox1.Text = "P5"

                '''        Me.Refresh()
                '''        Exit While
                '''    End If
                '''End While
                '''readerVeryTrasp.Close()
                ''''TextErrorEmp6.Text = "verificar existencias"
                ''''ppppppppppppppppppppppppppppppppppp verificar si existe en el almacen pppppppppppppppppppppppppppppppppppppppppppppppppppppppppppp
                Dim readerOrders As SqlDataReader
                sqllocal = "SELECT od.id_order, od.product_upc, od.id_warehouse, od.quantity_received " +
                " FROM Logistik_order_detail as od WHERE TRIM(od.id_order) ='" + id_pedido.Trim + "'" +
                " and od.quantity_received>0 and num_empresa='" + num_empresa + "'"
                TextBox1.Text = "P6"
                LabelTABLA.Text = "Q2s_Logistik_order_detail"
                Me.Refresh()
                cmd = New SqlCommand(sqllocal, conn)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                Me.Refresh()
                readerOrders = cmd.ExecuteReader()
                Dim prod As String
                Dim alm As String
                Dim cant1 As String
                Dim cantExist1 As String
                Dim cantExist2 As String
                'Dim OK As Integer = 0
                Dim OK2 As Integer = 0
                While readerOrders.Read()
                    prod = readerOrders.Item(1).ToString
                    If UCase(CampLib34) = "GDL" Then
                        alm = "104"
                    Else
                        alm = readerOrders.Item(2).ToString
                    End If
                    cant1 = readerOrders.Item(3).ToString
                    If cant1 = "" Then cant1 = "0"
                    'TextErrorEmp6.Text = "verificar existencias 2"
                    'cambio de almacen 1 a 984
                    Dim SqlA As String = ""
                    If UCase(CampLib34) = "GDL" Then
                        SqlA = "Select EXIST FROM MULT" + vgNumEmpresa.ToString +
                       " WHERE CVE_ART = '" + prod + "' AND CVE_ALM='984'"
                    Else
                        SqlA = "Select EXIST FROM MULT" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + prod + "' AND CVE_ALM='1'"
                    End If
                    LabelTABLA.Text = "Q3s_MULT"
                    TextBox1.Text = "P7"
                    Me.Refresh()
                    If connFB.State = ConnectionState.Closed Then
                        connFB.Open()
                    End If
                    Dim da77 As New SqlDataAdapter(SqlA, connFB)
                    Dim ds77 As New DataSet
                    da77.Fill(ds77, "MULT" + vgNumEmpresa.ToString)
                    Dim oTable77 As New DataTable
                    oTable77 = ds77.Tables("MULT" + vgNumEmpresa.ToString)
                    'If connFB.State = ConnectionState.Open Then
                    '    connFB.Close()
                    'End If
                    If oTable77.Rows.Count >= 1 Then
                        For Each oRow77 In oTable77.Rows
                            'TextErrorEmp6.Text = "verificar existencias 3"
                            cantExist1 = oRow77.Item("EXIST").ToString
                            'TextErrorEmp6.Text = "verificar existencias 31"
                            If cantExist1 = "" Then cantExist1 = "0"
                            'TextErrorEmp6.Text = "verificar existencias 32"
                            If Val(cantExist1) >= Val(cant1) Then
                                OK = 1
                                'TextErrorEmp6.Text = "existencias correcta"
                            Else
                                OK = 0
                                empresa = vgEmpresa.ToString
                                documento = id_pedido.ToString
                                If UCase(CampLib34) = "GDL" Then
                                    mensaje = "Verificar Pedido: InCorrecto:" + id_pedido.ToString + " Producto no hay Existencia suficiente:" + prod.ToString + " en Almacen: 984"
                                Else
                                    mensaje = "Verificar Pedido: InCorrecto:" + id_pedido.ToString + " Producto no hay Existencia suficiente:" + prod.ToString + " en Almacen: 1"
                                End If
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                LabelTABLA.Text = "Q4i_Logistik_log"
                                TextBox1.Text = "P8"
                                Me.Refresh()
                                Exit For
                            End If
                        Next
                    Else
                        OK = 0
                        empresa = vgEmpresa.ToString
                        documento = id_pedido.ToString
                        If UCase(CampLib34) = "GDL" Then
                            mensaje = "Verificar Pedido: InCorrecto Pedido:" + id_pedido.ToString + " Producto no Existe:" + prod.ToString + " en Almacen: 984"
                        Else
                            mensaje = "Verificar Pedido: InCorrecto Pedido:" + id_pedido.ToString + " Producto no Existe:" + prod.ToString + " en Almacen: 1"
                        End If
                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        LabelTABLA.Text = "Q5i_Logistik_log"
                        TextBox1.Text = "P9"
                        Me.Refresh()
                        Exit While
                    End If
                End While
                readerOrders.Close()
                ''''OK2 = fnEmp0104("LogistikMasterValvulerias" & num_empresa, Trim(num_empresa), id_pedido, OrdenVenta)
                ''''ppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppp

                ''''Dim verif As Boolean = VerifyOrders(pEMP06BD, OrdenVenta, num_empresa)
                ''''TextErrorEmp6.Text = OK.ToString + OKSend.ToString
                If OK = 1 And OKSend = 1 Then
                    'TextErrorEmp6.Text = "traspaso y existencias existosa emp06"
                    'If OK = 1 And OK2 = 1 Then
                    '''realizar trasferencia como nose

                    If num_empresa = "" Then num_empresa = "01"
                    If num_empresa = "01" Then
                        RefVenta = OrdenVenta
                    End If
                    If num_empresa = "04" Then
                        RefVenta = OrdenVenta
                    End If
                    'agregar ceros
                    'OrdenVenta = ceros(OrdenVenta, 10)
                    'agregar espacios
                    OrdenVenta = espacios(OrdenVenta, 20)
                    '**********************proteccion++++++++++++++++++++++++++++++++++
                    'OrdenVenta = Val(OrdenVenta)
                    'OrdenVenta = espacios(OrdenVenta, 20)
                    Dim sql1 As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state = '6'," +
                    " doc_sig_sae='', Tipo_Rem_Fact='R'" +
                    " WHERE TRIM(id_order) = '" + OrdenVenta.Trim + "' and num_empresa='" + num_empresa + "'"
                    LabelTABLA.Text = "Q6u_Logistik_orders"
                    TextBox1.Text = "P10"
                    Me.Refresh()
                    EjecutarQuerySQL_EMPRESA(sql1)
                    '*******************************************************************
                    Dim TIP_DOC As String
                    Dim CVE_CLPV As String
                    Dim STATUS As String
                    Dim DAT_MOSTR As String
                    Dim CVE_VEND As String
                    CVE_PEDI = RefVenta.Trim
                    Dim FECHA_DOC As String
                    Dim FECHA_ENT As String
                    Dim FECHA_VEN As String
                    Dim FECHA_CANCELA As String
                    Dim CAN_TOT As String
                    Dim IMP_TOT1 As String
                    Dim IMP_TOT2 As String
                    Dim IMP_TOT3 As String
                    Dim IMP_TOT4 As String
                    Dim DES_TOT As String
                    Dim DES_FIN As String
                    Dim COM_TOT As String
                    Dim CONDICION As String
                    Dim CVE_OBS As String
                    Dim NUM_ALMA As String
                    Dim ACT_CXC As String
                    Dim ACT_COI As String
                    Dim ENLAZADO As String
                    Dim TIP_DOC_E As String
                    Dim NUM_MONED As String
                    Dim TIPCAMB As String
                    Dim NUM_PAGOS As String
                    Dim FECHAELAB As String
                    Dim PRIMERPAGO As String
                    Dim RFC As String
                    Dim CTLPOL As String
                    Dim ESCFD As String
                    Dim AUTORIZA As String
                    Dim SERIE As String
                    Dim FOLIO As String
                    Dim AUTOANIO As String
                    Dim DAT_ENVIO As String
                    Dim CONTADO As String
                    Dim CVE_BITA As String
                    Dim BLOQ As String
                    Dim FORMAENVIO As String
                    Dim DES_FIN_PORC As String
                    Dim DES_TOT_PORC As String
                    Dim IMPORTE As String
                    Dim COM_TOT_PORC As String
                    Dim METODODEPAGO As String
                    Dim NUMCTAPAGO As String
                    Dim TIP_DOC_ANT As String
                    Dim DOC_ANT As String
                    Dim TIP_DOC_SIG As String
                    Dim DOC_SIG As String
                    Dim vCveDoc As String = ""

                    TIP_DOC = "R"
                    'SigCveDoc = TraerCveDocSigRecep()
                    'CVE_DOC = SigCveDoc
                    CVE_DOC = oRowPC.Item("id_order").ToString
                    CVE_CLPV = oRowPC.Item("id_customer").ToString
                    STATUS = "E"
                    DAT_MOSTR = "0"
                    CVE_VEND = "0"
                    vfechayhora = Date.Now
                    FECHA_DOC = vfechayhora.ToString("yyyy/MM/dd")
                    'If FECHA_DOC <> "" Then
                    '    FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    'End If
                    FECHA_ENT = vfechayhora.ToString("yyyy/MM/dd")
                    'If FECHA_ENT <> "" Then
                    '    FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    'End If
                    FECHA_VEN = vfechayhora.ToString("yyyy/MM/dd")
                    'If FECHA_VEN <> "" Then
                    '    FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    'End If
                    FECHA_CANCELA = vfechayhora.ToString("yyyy/MM/dd")
                    'subtotal = total_paid
                    'total = total_paid_real

                    CAN_TOT = oRowPC.Item("total_paid_real").ToString
                    IMP_TOT1 = "0"
                    IMP_TOT2 = "0"
                    IMP_TOT3 = "0"
                    Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
                    IMP_TOT4 = iva.ToString
                    DES_TOT = "0"
                    DES_FIN = "0"
                    COM_TOT = "0"
                    CONDICION = ""
                    CVE_OBS = ""
                    If Trim(UCase(CampLib34)) = "GDL" Then
                        NUM_ALMA = "984"
                    Else
                        NUM_ALMA = "1"
                    End If
                    ACT_CXC = "S"
                    ACT_COI = "N"
                    ENLAZADO = "O"
                    TIP_DOC_E = "O"
                    NUM_MONED = "1"
                    TIPCAMB = "1"
                    NUM_PAGOS = "1"
                    FECHAELAB = DateTime.Now
                    If FECHAELAB <> "" Then
                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd hh:mm:ss")
                        FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                    End If
                    PRIMERPAGO = "0"
                    'Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
                    Dim SqlA As String = "SELECT RFC FROM CLIE" + vgNumEmpresa.ToString +
                    " WHERE  TRIM(CLAVE) = '" + Trim(CVE_CLPV) + "'"
                    LabelTABLA.Text = "Q7s_CLIE"
                    TextBox1.Text = "P11"
                    Me.Refresh()
                    Dim da7 As New SqlDataAdapter(SqlA, connFB)
                    Dim ds7 As New DataSet
                    If connFB.State = ConnectionState.Closed Then
                        connFB.Open()
                    End If
                    da7.Fill(ds7, "CLIENTES" + vgNumEmpresa.ToString)
                    Dim oTable As New DataTable
                    oTable = ds7.Tables("CLIENTES" + vgNumEmpresa.ToString)
                    If connFB.State = ConnectionState.Open Then
                        connFB.Close()
                    End If

                    If oTable.Rows.Count >= 1 Then
                        For Each oRow55 In oTable.Rows
                            RFC = oRow55.Item("RFC").ToString
                        Next
                    End If
                    If Trim(CVE_CLPV) <> "MOSTR" Then
                        CVE_CLPV = espacios(CVE_CLPV, 10)
                    End If
                    CTLPOL = "0"
                    ESCFD = "N"
                    AUTORIZA = "1"
                    SERIE = ""
                    FOLIO = Nothing

                    SqlA = "Select MASCARA FROM PARAM_FOLIOSF" + vgNumEmpresa.ToString +
                        " WHERE TIPODOCTO = 'R'"
                    LabelTABLA.Text = "Q8s_PARAM_FOLIOSF"
                    TextBox1.Text = "P12"
                    Me.Refresh()
                    Dim da77 As New SqlDataAdapter(SqlA, connFB)
                    Dim ds77 As New DataSet
                    If connFB.State = ConnectionState.Closed Then
                        connFB.Open()
                    End If
                    da77.Fill(ds77, "PARAM_FOLIOSF" + vgNumEmpresa.ToString)
                    Dim oTable77 As New DataTable
                    oTable77 = ds77.Tables("PARAM_FOLIOSF" + vgNumEmpresa.ToString)
                    If connFB.State = ConnectionState.Open Then
                        connFB.Close()
                    End If

                    If oTable77.Rows.Count >= 1 Then
                        For Each oRow77 In oTable77.Rows
                            FOLIO = oRow77.Item("MASCARA").ToString
                        Next
                    End If
                    If FOLIO = "" Then
                        MsgBox("Configure la mascara de la clave del documento")
                        Exit Sub
                    End If
                    AUTOANIO = ""
                    DAT_ENVIO = "0"
                    CONTADO = "N"
                    CVE_BITA = "2"
                    BLOQ = "N"
                    FORMAENVIO = ""
                    'descuentos
                    DES_FIN_PORC = "0"
                    DES_TOT_PORC = "0"
                    IMPORTE = oRowPC.Item("total_paid").ToString
                    COM_TOT_PORC = "0"
                    METODODEPAGO = ""
                    NUMCTAPAGO = ""
                    TIP_DOC_ANT = "P"
                    DOC_ANT = ""
                    TIP_DOC_SIG = Nothing
                    DOC_SIG = Nothing
                    'vCveDoc = BuscarClaveDoc()
                    '----------------buscar clave del documento
                    '----------------buscar clave del documento
                    Dim vcont As String = ""
                    Dim vnum As Integer
                    SqlA = "SELECT ULT_DOC FROM FOLIOSF" + vgNumEmpresa.ToString +
                    " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + vgNumEmpresa.ToString + " WHERE TIP_DOC='R')"
                    LabelTABLA.Text = "Q9s_FOLIOSF "
                    TextBox1.Text = "P13"
                    Me.Refresh()
                    Dim da55 As New SqlDataAdapter(SqlA, connFB)
                    Dim ds55 As New DataSet
                    If connFB.State = ConnectionState.Closed Then
                        connFB.Open()
                    End If
                    da55.Fill(ds55, "FOLIOSF" + vgNumEmpresa.ToString)
                    Dim oTable55 As New DataTable
                    oTable55 = ds55.Tables("FOLIOSF" + vgNumEmpresa.ToString)
                    'If connFB.State = ConnectionState.Open Then
                    '    connFB.Close()
                    'End If

                    If oTable55.Rows.Count >= 1 Then
                        For Each oRow55 In oTable55.Rows
                            vcont = oRow55.Item("ULT_DOC").ToString
                            If vcont = "" Or vcont = "0" Then vcont = "1"
                            'Convertir a numero y 'aumentar mas uno
                            vcont = Val(vcont) + 1
                            'agregar(ceros)
                            'vcont = ceros(vcont, 10)
                            'agregar espacios
                            vcont = espacios(vcont, 20)
                            'regresar valor
                            'Me.TextBox1.Text = vcont
                            vCveDoc = vcont
                        Next
                    End If
                    If connFB.State = ConnectionState.Closed Then
                        connFB.Open()
                    End If
                    '---------------------------------------
                    objTrans = connFB.BeginTransaction()
                    '--------------------------------------
                    If vCveDoc <> "" Then
                        'DOC_ANT = ceros(DOC_ANT, 10)
                        DOC_ANT = espacios(DOC_ANT, 20)
                        Dim vUUID = Guid.NewGuid.ToString()
                        vUUID = UCase(vUUID)
                        'TRAER CLAVE BITA
                        ''------------------------------------------------
                        Dim readerBita As SqlDataReader
                        Dim vBita As String
                        sqllocal = "Select ISNULL(max(CVE_BITA),1) AS num FROM BITA" + vgNumEmpresa.ToString
                        LabelTABLA.Text = "Q10s_BITA"
                        TextBox1.Text = "P14"
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        readerBita = cmd.ExecuteReader()
                        While readerBita.Read()
                            vBita = readerBita.Item(0).ToString
                            CVE_BITA = Val(vBita) + 1
                        End While
                        readerBita.Close()
                        sqllocal = "insert into FACTR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" +
                        ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" +
                        ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" +
                        ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" +
                        ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" +
                        ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" +
                        ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" +
                        ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" +
                        ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" +
                        ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" +
                        ",DOC_ANT,TIP_DOC_SIG,DOC_SIG) values (" +
                        "'R','" + vCveDoc + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" +
                        CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" +
                        FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" +
                        IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" +
                        CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" +
                        "P','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" +
                        PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" +
                        SERIE + "','" + vCveDoc + "','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" +
                        CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" +
                        IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" +
                        DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "')"
                        LabelTABLA.Text = "Q11i_FACTR"
                        TextBox1.Text = "P15"
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()

                        sqllocal = "insert into FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        LabelTABLA.Text = "Q12i_FACTR_CLIB_sae6"
                        TextBox1.Text = "P16"
                        Me.Refresh()
                        ''INSERT TABLA BITA
                        sqllocal = "INSERT INTO BITA" + vgNumEmpresa.ToString +
                        "(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" +
                        " VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + IMPORTE.ToString + "', 'F', 'Administrador')"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        LabelTABLA.Text = "Q13i_BITA"
                        TextBox1.Text = "P17"
                        Me.Refresh()
                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        LabelTABLA.Text = "Q14u_TBLCONTROL"
                        TextBox1.Text = "P18"
                        Me.Refresh()
                        '777777777777777777777777777777777777777777777777777
                        'Dim reader777 As SqlDataReader
                        'sqllocal = "Select ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " WHERE ID_TABLA = 32"
                        'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                        'reader777 = cmd.ExecuteReader()
                        'While reader777.Read()
                        '    vcont777 = reader777.Item(0).ToString
                        'End While
                        'reader777.Close()
                        '77777777777777777777777777777777777777777777777777777
                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 62"
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        LabelTABLA.Text = "Q15u_TBLCONTROL"
                        TextBox1.Text = "P19"
                        Me.Refresh()
                        ''---------------------
                        ''Dim vCve_Obs As String = TraerClaveSiguiente()
                        'Dim vCve_Obs As String
                        'Dim vcont7 As String = ""
                        'Dim reader7 As SqlDataReader
                        'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
                        'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                        'reader7 = cmd.ExecuteReader()
                        'While reader7.Read()
                        '    'MsgBox(reader7.Item(0))
                        '    vcont7 = reader7.Item(0).ToString
                        '    vcont7 = Val(vcont7) + 1
                        'End While
                        'If vcont7 = "" Then vcont7 = "1"
                        'vCve_Obs = vcont7
                        'reader7.Close()
                        ''-----------------------------------
                        'Dim vObser As String = "Buenas Remisión HH"
                        'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                        'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                        'cmd.ExecuteNonQuery()
                        ''Call UpdateOC(CVE_DOC, vCveDoc)
                        'sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
                        '" WHERE CVE_DOC ='" + CVE_DOC + "'"
                        'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
                        'cmd.ExecuteNonQuery()
                        Dim pIdPedido As String = id_pedido
                        Dim pcvedoc As String = vCveDoc
                        Dim pObser As String = "0" 'vObser
                        Dim pcve_doc_origen As String = CVE_DOC
                        Dim VEND As String = CVE_VEND
                        Dim pAlmacen As String = NUM_ALMA
                        Dim pCve_Cliente As String = CVE_CLPV
                        'Dim CVE_DOC As String
                        Dim NUM_PAR As Integer = 1
                        Dim CVE_ART As String
                        Dim vlsubtotal As Double
                        Dim CANT As Double = 0
                        Dim CANTp As Double = 0
                        Dim PXS As String = "0"
                        Dim PREC As String = "0"
                        Dim COST As String = "0"
                        Dim IMPU1 As String
                        Dim IMPU2 As String
                        Dim IMPU3 As String
                        Dim IMPU4 As Integer
                        Dim IMP1APLA As String
                        Dim IMP2APLA As String
                        Dim IMP3APLA As String
                        Dim IMP4APLA As String
                        Dim TOTIMP1 As String
                        Dim TOTIMP2 As String
                        Dim TOTIMP3 As String
                        Dim TOTIMP4 As String
                        Dim DESC1 As String
                        Dim DESC2 As String
                        Dim DESC3 As String
                        Dim COMI As String
                        Dim APAR As String
                        Dim ACT_INV As String
                        Dim NUM_ALM As String = pAlmacen
                        Dim POLIT_APLI As String
                        Dim TIP_CAM As String
                        Dim UNI_VENTA As String
                        Dim TIPO_PROD As String
                        'Dim CVE_OBS As String
                        Dim REG_SERIE As String
                        Dim E_LTPD As String
                        Dim TIPO_ELEM As String
                        Dim NUM_MOV As String
                        Dim TOT_PARTIDA As String
                        Dim IMPRIMIR As String
                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        Dim readerOCDet As SqlDataReader
                        Dim CantPedida As String
                        Dim SqlSelection As String = "SELECT id_order_detail,id_order,product_upc,product_price,quantity_received" +
                        ",total_shipping_price_tax_incl,id_warehouse,product_quantity" +
                        " FROM Logistik_order_detail WHERE id_order ='" + pIdPedido + "' and num_empresa='" + num_empresa.Trim + "'"
                        LabelTABLA.Text = "Q16s_Logistik_order_detail"
                        TextBox1.Text = "P20"
                        Me.Refresh()
                        cmd = New SqlCommand(SqlSelection, conn)
                        readerOCDet = cmd.ExecuteReader()

                        'If conn.State = ConnectionState.Open Then
                        '    conn.Close()
                        'End If
                        ' esta variable controla el consecutivo de las series
                        Dim mREG_SERIE As String
                        ' esta variable controla una sola entrada al ciclo de las series
                        Dim vlMaxNum As Boolean = True
                        '--------------------------------------
                        '---------------------------------------
                        If connFB.State = ConnectionState.Closed Then
                            connFB.Open()
                        End If
                        'objTransFB = connFB.BeginTransaction()
                        '--------------------------------------
                        '-------------------------------------------

                        While readerOCDet.Read()
                            CVE_DOC = pcvedoc
                            CVE_ART = readerOCDet.Item(2).ToString
                            PREC = readerOCDet.Item(3).ToString
                            CANTp = readerOCDet.Item(4).ToString
                            CANT = readerOCDet.Item(4).ToString
                            'CantPedida = readerOCDet.Item(7).ToString
                            'Dim CantFaltante As Integer = Val(CantPedida) - CANT
                            PXS = readerOCDet.Item(4).ToString

                            If Val(CANT) > 0 Then
                                '////////traer datos ////////////////////////////////////////////////////////////////
                                'Dim CampLib1, CampLib2, CampLib3, CampLib4, CampLib5, CampLib6, CampLib7 As String
                                'Dim CampLib8, CampLib9, CampLib10, CampLib11, CampLib12 As String
                                'Dim CampLib13, CampLib14, CampLib15, CampLib16, CampLib17 As String
                                'Dim CampLib18, CampLib19, CampLib20, CampLib21, CampLib22 As String
                                'Dim CampLib23, CampLib24, CampLib25, CampLib26, CampLib27 As String
                                'Dim CampLib28, CampLib29, CampLib30, CampLib31, CampLib32 As String
                                'Dim CampLib33, CampLib34, CampLib35, CampLib36, CampLib37 As String
                                'Dim CampLib38, CampLib39, CampLib40, CampLib41, CampLib42 As String
                                'Dim CampLib43, CampLib44, CampLib45 As String
                                'CampLib1 = ""
                                'CampLib2 = ""
                                'CampLib3 = ""
                                'CampLib4 = ""
                                'CampLib5 = ""
                                'CampLib6 = ""
                                'CampLib7 = ""
                                'CampLib8 = ""
                                'CampLib9 = ""
                                'CampLib10 = ""
                                'CampLib11 = ""
                                'CampLib12 = ""
                                'CampLib13 = ""
                                'CampLib14 = ""
                                'CampLib15 = ""
                                'CampLib16 = ""
                                'CampLib17 = ""
                                'CampLib18 = ""
                                'CampLib19 = ""
                                'CampLib20 = ""
                                'CampLib21 = ""
                                'CampLib22 = ""
                                'CampLib23 = ""
                                'CampLib24 = ""
                                'CampLib25 = ""
                                'CampLib26 = ""
                                'CampLib27 = ""
                                'CampLib28 = ""
                                'CampLib29 = ""
                                'CampLib30 = ""
                                'CampLib31 = ""
                                'CampLib32 = ""
                                'CampLib33 = ""
                                'CampLib34 = ""
                                'CampLib35 = ""
                                'CampLib36 = ""
                                'CampLib37 = ""
                                'CampLib38 = ""
                                'CampLib39 = ""
                                'CampLib40 = ""
                                'CampLib41 = ""
                                'CampLib42 = ""
                                'CampLib43 = ""
                                'CampLib44 = ""
                                'CampLib45 = ""
                                'CampLib1 = oRowPC.Item("camplib1").ToString
                                'CampLib2 = oRowPC.Item("camplib2").ToString
                                'CampLib3 = oRowPC.Item("camplib3").ToString
                                'CampLib4 = oRowPC.Item("camplib4").ToString
                                'CampLib5 = oRowPC.Item("camplib5").ToString
                                'CampLib6 = oRowPC.Item("camplib6").ToString
                                'CampLib7 = oRowPC.Item("camplib7").ToString
                                'CampLib8 = oRowPC.Item("camplib8").ToString
                                'CampLib9 = oRowPC.Item("camplib9").ToString
                                'CampLib10 = oRowPC.Item("camplib10").ToString
                                'CampLib11 = oRowPC.Item("camplib11").ToString
                                'CampLib12 = oRowPC.Item("camplib12").ToString
                                'CampLib13 = oRowPC.Item("camplib13").ToString
                                'CampLib14 = oRowPC.Item("camplib14").ToString
                                'CampLib15 = oRowPC.Item("camplib15").ToString
                                'CampLib16 = oRowPC.Item("camplib16").ToString
                                'CampLib17 = oRowPC.Item("camplib17").ToString
                                'CampLib18 = oRowPC.Item("camplib18").ToString
                                'CampLib19 = oRowPC.Item("camplib19").ToString
                                'CampLib20 = oRowPC.Item("camplib20").ToString
                                'CampLib21 = oRowPC.Item("camplib21").ToString
                                'CampLib22 = oRowPC.Item("camplib22").ToString
                                'CampLib23 = oRowPC.Item("camplib23").ToString
                                'CampLib24 = oRowPC.Item("camplib24").ToString
                                'CampLib25 = oRowPC.Item("camplib25").ToString
                                'CampLib26 = oRowPC.Item("camplib26").ToString
                                'CampLib27 = oRowPC.Item("camplib27").ToString
                                'CampLib28 = oRowPC.Item("camplib28").ToString
                                'CampLib29 = oRowPC.Item("camplib29").ToString
                                'CampLib30 = oRowPC.Item("camplib30").ToString
                                'CampLib31 = oRowPC.Item("camplib31").ToString
                                'CampLib32 = oRowPC.Item("camplib32").ToString
                                'CampLib33 = oRowPC.Item("camplib33").ToString
                                'CampLib34 = oRowPC.Item("camplib34").ToString
                                'CampLib35 = oRowPC.Item("camplib35").ToString
                                'CampLib36 = oRowPC.Item("camplib36").ToString
                                'CampLib37 = oRowPC.Item("camplib37").ToString
                                'CampLib38 = oRowPC.Item("camplib38").ToString
                                'CampLib39 = oRowPC.Item("camplib39").ToString
                                'CampLib40 = oRowPC.Item("camplib40").ToString
                                'CampLib41 = oRowPC.Item("camplib41").ToString
                                'CampLib42 = oRowPC.Item("camplib42").ToString
                                'CampLib43 = oRowPC.Item("camplib43").ToString
                                'CampLib44 = oRowPC.Item("camplib44").ToString
                                'CampLib45 = oRowPC.Item("camplib45").ToString
                                sqllocal = "SELECT NUM_EMP, MascaraOrdenCompra, MascaraRecepcion, MascaraPedido, MascaraRemision" +
                                ",MultiAlmacen, InvNumDecimales, ActivarQuerys, CampLib1, CampLib2" +
                                ",CampLib3, CampLib4, CampLib5, CampLib6, CampLib7" +
                                ",CampLib8, CampLib9, CampLib10, CampLib11, CampLib12" +
                                ",CampLib13, CampLib14, CampLib15, CampLib16, CampLib17" +
                                ",CampLib18, CampLib19, CampLib20, CampLib21, CampLib22" +
                                ",CampLib23, CampLib24, CampLib25, CampLib26, CampLib27" +
                                ",CampLib28, CampLib29, CampLib30, CampLib31, CampLib32" +
                                ",CampLib33, CampLib34, CampLib35, CampLib36, CampLib37" +
                                ",CampLib38, CampLib39, CampLib40, CampLib41, CampLib42" +
                                ",CampLib43, CampLib44, CampLib45" +
                                " From Logistik_Config_SAE"

                                '//////////////////////////////////////////////////////////////////
                                COST = "0"
                                'moficicacion almacen 1
                                'NUM_ALM = readerOCDet.Item(6).ToString
                                '-------------------------------------------------------------------------------------
                                If connFB.State = ConnectionState.Closed Then
                                    connFB.Open()
                                End If
                                Dim reader7 As SqlDataReader
                                sqllocal = "Select INV7.COSTO_PROM, INV7.ULT_COSTO, INV7.TIPO_ELE From INVE" + vgNumEmpresa.ToString + " AS INV7 Where INV7.CVE_ART = '" + CVE_ART.ToString + "'"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                reader7 = cmd.ExecuteReader()
                                LabelTABLA.Text = "Q17s_INVE"
                                TextBox1.Text = "P21"
                                Me.Refresh()
                                While reader7.Read()
                                    Dim ExistA As Double
                                    ExistA = Convert.ToDouble(reader7.Item(0).ToString)
                                    'ExistA = Math.Round(ExistA, 2)
                                    COST = ExistA.ToString
                                    If COST = "" Or COST = "0" Then
                                        ExistA = Convert.ToDouble(reader7.Item(1).ToString)
                                        'ExistA = Math.Round(ExistA, 2)
                                        COST = ExistA.ToString
                                    End If
                                    TIPO_PROD = reader7.Item(2).ToString
                                End While
                                reader7.Close()
                                'If connFB.State = ConnectionState.Open Then
                                '    connFB.Close()
                                'End If
                                '---------------------------------------------------------------------------------

                                '-------------------------------------------------------------------------------
                                'SqlA = "SELECT COSTO_PROM, ULT_COSTO FROM INVE" + vgNumEmpresa.ToString + _
                                '" WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                                'Dim da25 As New FbDataAdapter(SqlA, connFB)
                                'Dim ds25 As New DataSet
                                'If connFB.State = ConnectionState.Closed Then
                                '    connFB.Open()
                                'End If
                                'da25.Fill(ds25, "INVE" + vgNumEmpresa.ToString)
                                'Dim oTable25 As New DataTable
                                'oTable25 = ds25.Tables("INVE" + vgNumEmpresa.ToString)
                                'If oTable25.Rows.Count >= 1 Then
                                '    For Each oRow25 In oTable25.Rows
                                '        COST = oRow25.Item("COSTO_PROM").ToString
                                '        If COST = "" Or COST = "0" Then COST = oRow25.Item("ULT_COSTO").ToString
                                '    Next
                                'End If
                                '---------------------------------------------------------------------------------

                                IMPU1 = "0"
                                IMPU2 = "0"
                                IMPU3 = "0"

                                IMPU4 = "16"
                                IMP1APLA = "6"
                                IMP2APLA = "6"
                                IMP3APLA = "6"
                                IMP4APLA = "0"
                                TOTIMP1 = "0"
                                TOTIMP2 = "0"
                                TOTIMP3 = "0"
                                'iva
                                TOTIMP4 = "16"
                                DESC1 = "0"
                                DESC2 = "0"
                                DESC3 = "0"
                                COMI = "0"
                                APAR = "0"
                                ACT_INV = "S"
                                POLIT_APLI = ""
                                TIP_CAM = "1"
                                UNI_VENTA = "pz"
                                TIPO_PROD = "P"

                                CVE_OBS = "0"
                                REG_SERIE = "0"
                                'tiene lotes
                                E_LTPD = "0"
                                TIPO_ELEM = "N"
                                'consecutivo

                                'NUM_MOV = reader2.Item(34).ToString
                                'cantidad por pecio
                                TOT_PARTIDA = Convert.ToDouble(PREC) * CANTp
                                TOTIMP4 = (Convert.ToDouble(PREC) * CANTp) * (IMPU4 / 100)
                                IMPRIMIR = ""
                                'Dim Sql As String
                                '-------------------Traer la clave siguiente
                                ''CVE_OBS = TraerClaveSiguiente()
                                'Dim vcont As String = ""
                                ''Dim vnum As Integer
                                'Dim reader As FbDataReader
                                'Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
                                'cmdFB = New FbCommand(Sql, connFB, objTransFB)
                                'reader = cmdFB.ExecuteReader()
                                'While reader.Read()
                                '    'MsgBox(reader.Item(0))
                                '    vcont = reader.Item(0).ToString
                                '    vcont = Val(vcont) + 1
                                'End While
                                'If vcont = "" Then vcont = "1"
                                'CVE_OBS = vcont
                                'reader.Close()

                                'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()
                                '---------------------crear el o los movimientos
                                'Dim vNum_Mov As String = ConsecutivoMovimiento()
                                Dim vNum_Mov As String
                                Dim vcont77 As String = ""
                                Dim reader77 As SqlDataReader
                                Dim SQL As String = "SELECT aa.ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " aa WHERE aa.ID_TABLA = 44"
                                LabelTABLA.Text = "Q18s_TBLCONTROL"
                                TextBox1.Text = "P22"
                                Me.Refresh()
                                cmd = New SqlCommand(SQL, connFB, objTrans)
                                reader77 = cmd.ExecuteReader()
                                While reader77.Read()
                                    vcont77 = reader77.Item(0).ToString
                                    vcont77 = Val(vcont77) + 1
                                End While
                                If vcont77 = "" Then vcont77 = "1"
                                vNum_Mov = vcont77
                                reader77.Close()
                                '----------tiene pedimento y numero de serie
                                Dim vlPedimento As String = "N"
                                Dim vlNumSer As String = "N"
                                'Dim readerPedi As SqlDataReader
                                'SqlSelection = "SELECT Pedimento, NumSerie FROM Logistik_product" + _
                                '" WHERE upc = '" + CVE_ART + "'"
                                'conn.Open()
                                'cmd = New SqlCommand(SqlSelection, conn)
                                'readerPedi = cmd.ExecuteReader()
                                'While readerPedi.Read()
                                '    vlPedimento = readerPedi.Item(0)
                                '    vlNumSer = readerPedi.Item(1)
                                'End While
                                'conn.Close()
                                'readerPedi.Close()
                                If vlNumSer = "S" Then
                                    '--------------------------------------------------------------
                                    'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
                                    '---------------------------------------------------------------
                                    '--------------------------H NUMEROS DE SERIE
                                    If vlMaxNum = True Then
                                        Dim readerNumSerie3 As SqlDataReader
                                        SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
                                        '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
                                        LabelTABLA.Text = "Q19s_HNUMSER"
                                        TextBox1.Text = "P23"
                                        Me.Refresh()
                                        If connFB.State = ConnectionState.Closed Then
                                            connFB.Open()
                                        End If
                                        cmd = New SqlCommand(SqlSelection, connFB, objTrans)
                                        readerNumSerie3 = cmd.ExecuteReader()
                                        While readerNumSerie3.Read()
                                            mREG_SERIE = readerNumSerie3.Item(0).ToString
                                            mREG_SERIE = Val(mREG_SERIE) + 1
                                        End While
                                        'If connFB.State = ConnectionState.Open Then
                                        '    connFB.Close()
                                        'End If
                                        readerNumSerie3.Close()
                                        vlMaxNum = False
                                    End If
                                    '---------------------------------------------------
                                    Dim nNUM_SER As String
                                    Dim nCOSTO As String
                                    Dim nDOCTO_ENT As String
                                    Dim nFECHA_ENT As String
                                    Dim nREG_SERIE As String
                                    Dim readerNumSerie As SqlDataReader
                                    'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
                                    '" FROM Logistik_numeros_series" + _
                                    '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
                                    '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
                                    SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" +
                                    " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" +
                                    " WHERE h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" +
                                    " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART +
                                    "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='M'"
                                    LabelTABLA.Text = "Q20s_Logistik_numeros_series"
                                    TextBox1.Text = "P24"
                                    Me.Refresh()
                                    If conn.State = ConnectionState.Closed Then
                                        conn.Open()
                                    End If
                                    cmd = New SqlCommand(SqlSelection, conn)
                                    readerNumSerie = cmd.ExecuteReader()
                                    If connFB.State = ConnectionState.Closed Then
                                        connFB.Open()
                                    End If
                                    While readerNumSerie.Read()
                                        Dim NumSer_Cve_Doc As String = Trim(pcve_doc_origen.ToString)
                                        'NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
                                        nNUM_SER = readerNumSerie.Item(0).ToString
                                        nCOSTO = readerNumSerie.Item(1).ToString
                                        nDOCTO_ENT = readerNumSerie.Item(2).ToString
                                        nFECHA_ENT = readerNumSerie.Item(3).ToString
                                        nREG_SERIE = readerNumSerie.Item(4).ToString
                                        If nFECHA_ENT <> "" Then
                                            nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
                                        End If

                                        sqllocal = "UPDATE NUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', COSTO = '" + nCOSTO + "', " +
                                        "DOCTO_ENT = '" + NumSer_Cve_Doc + "', FECHA_ENT = '" + nFECHA_ENT + "'" +
                                        " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'"
                                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                        cmd.ExecuteNonQuery()
                                        LabelTABLA.Text = "Q21u_NUMSER"
                                        TextBox1.Text = "P25"
                                        Me.Refresh()
                                        sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V'," +
                                        "TIP_MOV = '51', CVE_DOC ='" + NumSer_Cve_Doc + "', REG_SERIE = '" + mREG_SERIE + "'" +
                                       " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER +
                                       "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" ' AND REG_SERIE = '" + nREG_SERIE + "'"
                                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                        cmd.ExecuteNonQuery()
                                        LabelTABLA.Text = "Q22u_HNUMSER"
                                        TextBox1.Text = "P26"
                                        Me.Refresh()
                                        ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
                                        'sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'V'" + _
                                        '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
                                        '" and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'" + _
                                        '" AND NUM_SER ='" + nNUM_SER + "'"
                                        'cmd = New SqlCommand(sqllocal, conn)
                                        'cmd.ExecuteNonQuery()

                                    End While
                                    If conn.State = ConnectionState.Open Then
                                        conn.Close()
                                    End If
                                    readerNumSerie.Close()
                                    '--------------------------H NUMEROS DE SERIE
                                    'Dim nREG_SERIE As String
                                    'Dim readerNumSerie3 As SqlDataReader
                                    'SqlSelection = "SELECT NUM_SER, REG_SERIE" + _
                                    '" FROM Logistik_Hnumeros_series" + _
                                    '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
                                    'conn.Open()
                                    'cmd = New SqlCommand(SqlSelection, conn)
                                    'readerNumSerie3 = cmd.ExecuteReader()
                                    'While readerNumSerie3.Read()
                                    '    nNUM_SER = readerNumSerie3.Item(0).ToString
                                    '    nREG_SERIE = readerNumSerie3.Item(1).ToString
                                    '    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', TIP_MOV = '51', CVE_DOC ='" + pcve_doc_origen.ToString + "'" + _
                                    '    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
                                    '    "' AND ALMACEN = '" + NUM_ALM + "' AND REG_SERIE = '" + nREG_SERIE + "'"
                                    '    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                    '    cmdFB.ExecuteNonQuery()
                                    'End While
                                    'conn.Close()
                                    'readerNumSerie3.Close()
                                    '--------------------------------------------------------------
                                    'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
                                    '--------------------------------------------------------------
                                End If
                                If vlPedimento = "S" Then


                                    '---------------------------------------------------------------
                                    'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
                                    '---------------------------------------------------------------
                                    '---- extraer el consecutivo REG_LTPD de SAE
                                    Dim pREG_LTPD As String
                                    'Dim readerMAx As FbDataReader
                                    'sqllocal = "Select coalesce(max(REG_LTPD),1) AS num FROM LTPD" + vgNumEmpresa.ToString
                                    'If connFB.State = ConnectionState.Closed Then
                                    '    connFB.Open()
                                    'End If
                                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                    'readerMAx = cmdFB.ExecuteReader()
                                    'While readerMAx.Read()
                                    '    'MsgBox(reader7.Item(0))
                                    '    pREG_LTPD = readerMAx.Item(0).ToString
                                    '    pREG_LTPD = Val(pREG_LTPD) + 1
                                    'End While
                                    'If pREG_LTPD = "" Then pREG_LTPD = "1"
                                    'readerMAx.Close()
                                    '---EXTRAER DATOS DEL SQL
                                    Dim pLOTE As String
                                    Dim pPEDIMENTO As String
                                    Dim pFCHCADUC As String
                                    Dim pFCHADUANA As String
                                    Dim pFCHULTMOV As String
                                    Dim pNOM_ADUAN As String
                                    Dim pCANTIDAD As Double
                                    Dim pCVE_OBS As String
                                    Dim pCIUDAD As String
                                    Dim pFRONTERA As String
                                    Dim pFEC_PROD_LT As String
                                    Dim pGLN As String
                                    Dim pSTATUS As String
                                    'Dim readerPedimento As SqlDataReader
                                    'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
                                    '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
                                    '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                                    '"STATUS, REG_LTPD  FROM Logistik_Lote_Pedimento" + _
                                    '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
                                    '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'"
                                    'If conn.State = ConnectionState.Closed Then
                                    '    conn.Open()
                                    'End If
                                    'cmd = New SqlCommand(SqlSelection, conn)
                                    'readerPedimento = cmd.ExecuteReader()
                                    Dim readerPedimento As SqlDataReader
                                    SQL = "SELECT LOTE ,PEDIMENTO, FCHCADUC," +
                                    "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," +
                                    "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," +
                                    "STATUS, REG_LTPD  FROM LTPD" + vgNumEmpresa.ToString +
                                    " WHERE CVE_ALM = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" +
                                    " and CANTIDAD > '0'"
                                    LabelTABLA.Text = "Q23u_LTPD"
                                    TextBox1.Text = "P27"
                                    Me.Refresh()
                                    'If conn.State = ConnectionState.Closed Then
                                    '    conn.Open()
                                    'End If
                                    'cmd = New SqlCommand(SqlSelection, conn)
                                    'readerPedimento = cmd.ExecuteReader()
                                    cmd = New SqlCommand(SQL, connFB, objTrans)
                                    readerPedimento = cmd.ExecuteReader()
                                    Dim vvCantFaltante As Double = CANT
                                    While readerPedimento.Read()
                                        pLOTE = readerPedimento.Item(0).ToString
                                        pPEDIMENTO = readerPedimento.Item(1).ToString
                                        pFCHCADUC = readerPedimento.Item(2).ToString
                                        pFCHADUANA = readerPedimento.Item(3).ToString
                                        pFCHULTMOV = readerPedimento.Item(4).ToString
                                        pNOM_ADUAN = readerPedimento.Item(5).ToString
                                        pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
                                        pCVE_OBS = readerPedimento.Item(7).ToString
                                        pCIUDAD = readerPedimento.Item(8).ToString
                                        pFRONTERA = readerPedimento.Item(9).ToString
                                        pFEC_PROD_LT = readerPedimento.Item(10).ToString
                                        pGLN = readerPedimento.Item(11).ToString
                                        pSTATUS = readerPedimento.Item(12).ToString
                                        pREG_LTPD = readerPedimento.Item(13).ToString

                                        If pFCHCADUC <> "" Then
                                            pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
                                        End If
                                        If pFCHADUANA <> "" Then
                                            pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
                                        End If
                                        If pFCHULTMOV <> "" Then
                                            pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
                                        End If
                                        If pFEC_PROD_LT <> "" Then
                                            pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
                                        End If

                                        '------------------INSERTAR PEDIMENTOS EN SAE
                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
                                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                        cmd.ExecuteNonQuery()
                                        LabelTABLA.Text = "Q24u_TBLCONTROL"
                                        TextBox1.Text = "P28"
                                        Me.Refresh()
                                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
                                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                        cmd.ExecuteNonQuery()
                                        LabelTABLA.Text = "Q25u_TBLCONTROL"
                                        TextBox1.Text = "P29"
                                        Me.Refresh()
                                        'sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = '" + pCANTIDAD.ToString + "'" + _
                                        '" WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
                                        '" AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                        'cmdFB.ExecuteNonQuery()

                                        If pCANTIDAD >= vvCantFaltante Then
                                            sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + vvCantFaltante.ToString +
                                            " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
                                            " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                            cmd.ExecuteNonQuery()
                                            LabelTABLA.Text = "Q26u_LTPD"
                                            TextBox1.Text = "P30"
                                            Me.Refresh()
                                        Else
                                            sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + pCANTIDAD.ToString +
                                            " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
                                            " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
                                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                            cmd.ExecuteNonQuery()
                                            LabelTABLA.Text = "Q27u_LTPD"
                                            TextBox1.Text = "P31"
                                            Me.Refresh()
                                            '9 >= 10
                                            '10 - 9 = 1
                                            vvCantFaltante = CANT - pCANTIDAD
                                        End If

                                        'sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
                                        '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
                                        '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
                                        '"STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + NUM_ALM + "','" + pFCHCADUC + "','" + _
                                        ' pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD + "','" + pREG_LTPD + "','" + _
                                        ' pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
                                        'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                        'cmdFB.ExecuteNonQuery()

                                        '---- extraer MAXIMO el E_LTPD de SAE
                                        Dim readerLTPD As SqlDataReader
                                        sqllocal = "Select MAX(E_LTPD) AS NUM FROM ENLACE_LTPD" + vgNumEmpresa.ToString
                                        LabelTABLA.Text = "Q28s_ENLACE_LTPD"
                                        TextBox1.Text = "P32"
                                        Me.Refresh()
                                        If connFB.State = ConnectionState.Closed Then
                                            connFB.Open()
                                        End If
                                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                        readerLTPD = cmd.ExecuteReader()
                                        While readerLTPD.Read()
                                            'MsgBox(reader7.Item(0))
                                            E_LTPD = readerLTPD.Item(0).ToString
                                            E_LTPD = Val(E_LTPD) + 1
                                        End While
                                        If E_LTPD = "" Then E_LTPD = "1"
                                        readerLTPD.Close()
                                        sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" +
                                        E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
                                        LabelTABLA.Text = "Q29i_ENLACE_LTPD"
                                        TextBox1.Text = "P33"
                                        Me.Refresh()
                                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                        cmd.ExecuteNonQuery()
                                        If pCANTIDAD >= vvCantFaltante Then
                                            Exit While
                                        End If
                                        ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
                                        'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
                                        '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
                                        '"' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
                                        '" AND REG_LTPD = '" + pREG_LTPD.ToString + "'"
                                        'cmd = New SqlCommand(SqlSelection, conn)
                                        'cmd.ExecuteNonQuery()

                                    End While
                                    If conn.State = ConnectionState.Open Then
                                        conn.Close()
                                    End If
                                    readerPedimento.Close()
                                    '---------------------------------------------------------------
                                    'END INSERTAR PEDIMENTOS
                                    '---------------------------------------------------------------
                                End If
                                vUUID = Guid.NewGuid.ToString()
                                vUUID = UCase(vUUID)
                                If vlNumSer = "S" Then
                                    sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                    ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                    ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                    ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                                    "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
                                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                                    IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                                    DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                                    NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                                    CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                                    TOT_PARTIDA + "','" + POLIT_APLI + "')"
                                    TextBox1.Text = "P35"
                                    Me.Refresh()
                                Else
                                    If vgVersion = "5" Then
                                        sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" +
                                        "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" +
                                        PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" +
                                        IMPU4.ToString + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" +
                                        TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" +
                                        DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" +
                                        NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" +
                                        CVE_OBS + "','0','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" +
                                        TOT_PARTIDA + "','" + POLIT_APLI + "')"
                                        TextBox1.Text = "P36"
                                        Me.Refresh()
                                    End If
                                    Dim VERSION_SINC As String = vfechayhora
                                    VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
                                    If vgVersion = "6" Or vgVersion = "7" Then
                                        E_LTPD = "0"
                                        sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" +
                                        ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" +
                                        ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" +
                                        ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" +
                                        ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ, UUID) values (" +
                                        "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" +
                                        PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" +
                                        IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" +
                                        TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" +
                                        DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" +
                                        Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" +
                                        CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" +
                                        TOT_PARTIDA.ToString + "','S','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1','" + vUUID + "')"
                                        TextBox1.Text = "P37"
                                        Me.Refresh()
                                    End If

                                End If
                                If connFB.State = ConnectionState.Closed Then
                                    connFB.Open()
                                End If
                                LabelTABLA.Text = "Q30i_PAR_FACTR"
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()

                                'INSERTAR EL INDICE
                                sqllocal = "insert into  PAR_FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR.ToString + "')"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()
                                LabelTABLA.Text = "Q31i_PAR_FACTR_CLIB"
                                TextBox1.Text = "P38"
                                Me.Refresh()
                                'actualizar detalle PAR_FACTP01
                                'sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString + _
                                '" WHERE CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()
                                'actualizar ACUMULADOR de remisiones y facturas
                                '-----------camision del vendedor
                                'If pComicion = "" Then pComicion = "0"
                                'If Val(pComicion) >= 1 Then
                                '    Dim VLcomi As String = (pComicion / 100) * TOT_PARTIDA
                                '    sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
                                '    " RIMP = RIMP + " + TOTIMP4 + ", RCOMI = RCOMI + " + VLcomi + _
                                '    " WHERE CVE_AFACT = '11'"
                                'Else
                                'TOT_ARTIDA = PRECIO POR CANTIDAD
                                'prueba satisfecha en sql
                                'sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RCOMI = RCOMI + " + COM_TOT.ToString +
                                '" where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"

                                sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," +
                                " RIMP = RIMP + " + TOTIMP4 + "" +
                                 " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                                LabelTABLA.Text = "Q32u_AFACT"
                                TextBox1.Text = "P39"
                                Me.Refresh()
                                'End If
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()
                                '---------EXTRAER CLAVE DEL FOLIO
                                Dim CVE_FOLIO As String = "0"
                                Dim readerCONTROL As SqlDataReader
                                SQL = "Select ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " WHERE ID_TABLA='6'"
                                LabelTABLA.Text = "Q33s_TBLCONTROL"
                                TextBox1.Text = "P40"
                                Me.Refresh()
                                cmd = New SqlCommand(SQL, connFB, objTrans)
                                readerCONTROL = cmd.ExecuteReader()
                                While readerCONTROL.Read()
                                    'MsgBox(reader3.Item(0))
                                    CVE_FOLIO = readerCONTROL.Item(0).ToString
                                    'vExistencia = Val(vExistencia) + 1
                                End While
                                If CVE_FOLIO = "" Then CVE_FOLIO = "1"
                                readerCONTROL.Close()
                                '-----------------------------------------------
                                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                cmd.ExecuteNonQuery()
                                LabelTABLA.Text = "Q34u_TBLCONTROL"
                                TextBox1.Text = "P41"
                                Me.Refresh()


                                'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()

                                ''insertar documentos siguientes
                                'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
                                '"PARTIDA, PART_E, CANT_E) VALUES (" + _
                                '"'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" + _
                                'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()
                                'sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
                                '"PARTIDA, PART_E, CANT_E) VALUES (" + _
                                '"'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" + _
                                'NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()
                                '-------------------------------------------------------------------------------
                                'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
                                ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                                'cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                'cmd.ExecuteNonQuery()
                                '-----------------------------------------------------------------------------
                                'actualizar las existencias
                                'Call ActualizarExistencias(CVE_ART, CANT)
                                'sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
                                '" PEND_SURT = PEND_SURT - " + CANT.ToString + ", COSTO_PROM = '" + COST + "'," + _
                                '" ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
                                '" WHERE CVE_ART ='" + CVE_ART + "'"
                                time = Today.Now

                                '-----------------------------------------------
                                'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                                Dim vExistencia As String = ""
                                Dim reader3 As SqlDataReader
                                SQL = "Select isnull(max(EXIST),0) AS num FROM INVE" + vgNumEmpresa.ToString +
                                    " WHERE CVE_ART = '" + CVE_ART + "'"
                                cmd = New SqlCommand(SQL, connFB, objTrans)
                                LabelTABLA.Text = "Q35s_INVE"
                                TextBox1.Text = "P42"
                                Me.Refresh()
                                reader3 = cmd.ExecuteReader()
                                While reader3.Read()
                                    'MsgBox(reader3.Item(0))
                                    vExistencia = reader3.Item(0).ToString
                                    vExistencia = Val(vExistencia) - Val(CANT)
                                End While
                                If vExistencia = "" Then vExistencia = "1"
                                reader3.Close()
                                '--------existe almacen
                                Dim vExistAlm As String
                                Dim rederExistAlm As SqlDataReader
                                If Trim(UCase(CampLib34)) = "GDL" Then
                                    'NUM_ALMA = "984"
                                    sqllocal = "SELECT EXIST FROM MULT" + vgNumEmpresa.ToString +
                                " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '984'"
                                Else
                                    'NUM_ALMA = "1"
                                    sqllocal = "SELECT EXIST FROM MULT" + vgNumEmpresa.ToString +
                                " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '1'"
                                End If
                                LabelTABLA.Text = "Q36s_MULT"
                                TextBox1.Text = "P43"
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                rederExistAlm = cmd.ExecuteReader()
                                While rederExistAlm.Read
                                    vExistAlm = rederExistAlm.Item(0).ToString
                                    vExistAlm = Val(vExistAlm) - CANT
                                End While
                                rederExistAlm.Close()
                                If vlNumSer = "S" Then
                                    'CVE_PEDI
                                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                    "'R','" + CVE_PEDI + "','         1','" + VEND + "','" + CANT.ToString + "','" +
                                    "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                                    "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                                    "1','" + FECHAELAB + "','0','" + Trim(vCveDoc.ToString) + "','-1','" +
                                    "S','0','" + COST + "','N','0')"
                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()
                                    LabelTABLA.Text = "Q37i_MINVE"
                                    TextBox1.Text = "P44"
                                    Me.Refresh()
                                Else
                                    If vgVersion = "5" Then
                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                                        "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                        "'R','" + CVE_PEDI + "','         1','" + VEND + "','" + CANT.ToString + "','" +
                                        "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                                        "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" +
                                        "1','" + FECHAELAB + "','0','" + Trim(vCveDoc.ToString) + "','-1','" +
                                        "S','0','" + COST + "','N','0')"
                                        LabelTABLA.Text = "Q38i_MINVE"
                                        TextBox1.Text = "P45"
                                        Me.Refresh()
                                    End If
                                    If vgVersion = "6" Or vgVersion = "7" Then
                                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" +
                                        "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov.ToString + "','51','" + time.ToString("yyyy/MM/dd") + "'," +
                                        "'R','" + pcvedoc + "','" + pCve_Cliente + "','" + VEND.ToString + "','" + CANT.ToString + "','" +
                                        "0','" + PREC.ToString + "','" + COST.ToString + "','','" + CVE_OBS.ToString + "'," +
                                        "'0','" + UNI_VENTA.ToString + "','" + E_LTPD.ToString + "','" + vExistAlm + "','" + TIPO_PROD + "','" +
                                        "1','" + FECHAELAB + "','0','" + Trim(vCveDoc.ToString) + "','-1','" +
                                        "S','" + COST.ToString + "','" + COST.ToString + "','N','0','" + vExistencia.ToString + "','" + COST.ToString + "')"
                                        LabelTABLA.Text = "Q39i_MINVE"
                                        TextBox1.Text = "P46"
                                        Me.Refresh()
                                    End If

                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()
                                    'ERRORremision1()
                                    Dim VERSION_SINC As String
                                    VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
                                    sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" +
                                    " WHERE CVE_ART = '" + CVE_ART + "'" +
                                    " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
                                    LabelTABLA.Text = "Q40u_MULT"
                                    TextBox1.Text = "P47"
                                    Me.Refresh()
                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()

                                    sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                                    " COSTO_PROM = '" + COST + "', VERSION_SINC = '" + time.ToString("yyyy/MM/dd HH:mm:ss") + "'," +
                                    "VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" +
                                    " WHERE CVE_ART ='" + CVE_ART + "'"
                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()
                                    LabelTABLA.Text = "Q41u_INVE"
                                    TextBox1.Text = "P48"
                                    Me.Refresh()
                                    sqllocal = "UPDATE MINVE" + vgNumEmpresa.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " +
                                    " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" +
                                    " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
                                    cmd = New SqlCommand(sqllocal, connFB, objTrans)
                                    cmd.ExecuteNonQuery()
                                    LabelTABLA.Text = "Q42u_MINVE"
                                    TextBox1.Text = "P49"
                                    Me.Refresh()
                                End If
                                'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
                                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
                                'cmdFB.ExecuteNonQuery()
                                mREG_SERIE = Val(mREG_SERIE) + 1
                                vlsubtotal = vlsubtotal + (PREC * CANT)
                                NUM_PAR = NUM_PAR + 1
                            End If
                        End While
                        readerOCDet.Close()

                        sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1, FECH_ULT_DOC = '" + vfechayhora.ToString("yyyy/MM/dd") + "'" +
                        " WHERE TIP_DOC='R' AND FECH_ULT_DOC =(SELECT MAX(FECH_ULT_DOC) FROM FOLIOSF" + vgNumEmpresa.ToString + " WHERE TIP_DOC='R')"
                        'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1" + _
                        '" WHERE TIP_DOC = 'R' and serie ='STAND.'"
                        '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        LabelTABLA.Text = "Q43u_FOLIOSF"
                        TextBox1.Text = "P50"
                        Me.Refresh()
                        sqllocal = "UPDATE FACTR" + vgNumEmpresa.ToString + " SET FECHA_CANCELA=null, VERSION_SINC = '" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "'" +
                        " WHERE CVE_DOC = '" + vCveDoc + "'"
                        LabelTABLA.Text = "Q44u_FACTR"
                        TextBox1.Text = "P51"
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, connFB, objTrans)
                        cmd.ExecuteNonQuery()
                        '------------------------
                        Dim vfSubtot As Decimal
                        objTrans.Commit()
                        vlsubtotal = vlsubtotal + (COST * CANT)
                        vfSubtot = vlsubtotal
                        If vfSubtot >= 1 Then
                            Dim vfIVA As Double = vfSubtot * 0.16
                            Dim vfNeto As Double = vfSubtot + vfIVA
                            sqllocal = "update FACTR" + vgNumEmpresa.ToString + " set CAN_TOT = '" + vfSubtot.ToString + "', IMP_TOT4 = '" + vfIVA.ToString + "'," +
                            " IMPORTE = '" + vfNeto.ToString + "', FECHA_CANCELA = NULL, NUM_PAGOS=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
                            cmd = New SqlCommand(sqllocal, connFB, objTrans)
                            cmd.ExecuteNonQuery()
                            LabelTABLA.Text = "Q45u_FACTR"
                        End If
                        empresa = vgEmpresa.ToString
                        documento = CVE_DOC.ToString
                        mensaje = "Registro de Remision Correcta:" + CVE_DOC.ToString + " del Pedido:" + id_pedido
                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        LabelTABLA.Text = "Q46i_Logistik_log"
                        TextBox1.Text = "P52"
                        Me.Refresh()
                        '------------------------
                        BIEN = 1

                    End If
                    'OrdenVenta = Val(OrdenVenta)
                    'OrdenVenta = espacios(OrdenVenta, 20)
                    Dim sql11 As String = "update Logistik_orders SET EnviadaSAE = 'S', current_state = '61'," +
                    " doc_sig_sae='" + vCveDoc + "', Tipo_Rem_Fact='R'" +
                    " WHERE id_order = '" + OrdenVenta + "' and num_empresa='" + num_empresa + "'"
                    EjecutarQuerySQL_EMPRESA(sql11)
                    LabelTABLA.Text = "Q47u_Logistik_orders"
                    Me.Refresh()
                    If BIEN = 1 Then
                        'falta actualizar encabezado y detalle
                        sqllocal = "SELECT id_order, id_customer, num_empresa" +
                        " FROM Logistik_orders WHERE TRIM(id_order) = '" + OrdenVenta.Trim + "' and num_empresa='" + num_empresa + "'"
                        LabelTABLA.Text = "Q48s_Logistik_orders"
                        TextBox1.Text = "P53"
                        Me.Refresh()
                        Dim daEmpresax As New SqlDataAdapter(sqllocal, conn)
                        Dim dsEmpresax As New DataSet
                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        daEmpresax.Fill(dsEmpresax, "Logistik_order")
                        Dim oTableEmpresax As New DataTable
                        oTableEmpresax = dsEmpresax.Tables("Logistik_order")

                        Dim cmd As SqlCommand
                        For Each oRowEmpresax In oTableEmpresax.Rows
                            OrdenVenta = oRowEmpresax.Item("id_order").ToString
                            num_empresa = oRowEmpresax.Item("num_empresa").ToString
                            If num_empresa = "" Then num_empresa = "01"

                            'If num_empresa = "01" Then
                            '    RefVenta = "E1V" & OrdenVenta
                            'End If
                            'If num_empresa = "04" Then
                            '    RefVenta = "E4V" & OrdenVenta
                            'End If
                            'actualiza encabezado
                            sqllocal = "update Logistik_orders SET current_state='61', Tipo_Rem_Fact='R', EnviadaSAE = 'S'" +
                            " WHERE TRIM(id_order) = '" + Trim(OrdenVenta) + "' and  num_empresa='" + num_empresa + "'"
                            LabelTABLA.Text = "Q49u_Logistik_orders"
                            TextBox1.Text = "P54:" + OrdenVenta + ":" + "LogistikMasterValvulerias" & Trim(num_empresa)
                            Me.Refresh()
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias" & Trim(num_empresa))
                            'actualiza detalle
                            Dim readerDetalle As SqlDataReader
                            sqllocal = "Select id_order_detail, product_upc, quantity_received" +
                            " FROM Logistik_order_detail WHERE TRIM(id_order) = '" + Trim(OrdenVenta) + "' and num_empresa='" + num_empresa + "'"
                            LabelTABLA.Text = "Q50s_Logistik_order_detail"
                            TextBox1.Text = "P55"
                            Me.Refresh()
                            cmd = New SqlCommand(sqllocal, conn)
                            readerDetalle = cmd.ExecuteReader()
                            Dim NPART As String
                            Dim vprod As String
                            Dim vcant As String
                            While readerDetalle.Read()
                                NPART = readerDetalle.Item(0).ToString
                                vprod = readerDetalle.Item(1).ToString
                                vcant = readerDetalle.Item(2).ToString
                                'actualiza encabezado
                                sqllocal = "update Logistik_order_detail set quantity_received = '" + vcant + "'" +
                                " WHERE TRIM(id_order) = '" + Trim(OrdenVenta) + "' and product_upc = '" + vprod + "'" +
                                " AND id_order_detail = '" + NPART.ToString + "' and num_empresa='" + num_empresa + "'"
                                LabelTABLA.Text = "Q51u_Logistik_order_detail"
                                TextBox1.Text = "P56"
                                Me.Refresh()
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias" & Trim(num_empresa))
                            End While
                            readerDetalle.Close()
                            LabelTABLA.Text = "Pasando SAE1 o SAE4"
                            TextBox1.Text = "P544:" + OrdenVenta + ":" + "LogistikMasterValvulerias" & Trim(num_empresa)
                            Me.Refresh()

                            Call RemisionesSAE("LogistikMasterValvulerias" & num_empresa, Trim(num_empresa), CVE_PEDI, OrdenVenta, camplib34)

                            OrdenVenta = Val(OrdenVenta)
                            Dim sql As String = "update Logistik_orders SET current_state='9'" +
                            " WHERE TRIM(id_order) = '" + Trim(OrdenVenta) + "'  and num_empresa='" + num_empresa + "'"
                            LabelTABLA.Text = "Q53u_Logistik_orders"
                            TextBox1.Text = "P57"
                            Me.Refresh()
                            EjecutarQuerySQL_EMPRESA_X(sql, "LogistikMasterValvulerias" & Trim(num_empresa))
                            '--------------------------------------------------------------------------------------
                            BIEN = 0
                        Next
                    End If
                End If

            Next
            '------------------------------------------------------------------------------------------


            'Catch es As FbException
            '    empresa = vgEmpresa.ToString
            '    documento = CVE_DOC.ToString
            '    mensaje = "Sincronizar Remision: InCorrecta Remision:" + CVE_DOC.ToString
            '    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" + _
            '    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            '    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            '    Me.Refresh()
            '    objTrans.Rollback()
            '    If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
            '        Me.Dispose()
            '        'FrmLogin.Dispose()
            '    End If
            '    Throw es
        Catch es As SqlException
            If CVE_DOC <> "" Then
                empresa = vgEmpresa.ToString
                documento = CVE_DOC.ToString
                mensaje = "Sincronizar Remision: InCorrecta Remision:" + CVE_DOC.ToString + " Tabla:" + LabelTABLA.Text
                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                objTrans.Rollback()
                Throw es
            End If

        Catch ex As Exception
            If CVE_DOC <> "" Then
                empresa = vgEmpresa.ToString
                documento = CVE_DOC.ToString
                mensaje = "Sincronizar Remision: InCorrecta Remision:" + CVE_DOC.ToString + " Tabla:" + LabelTABLA.Text
                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                objTrans.Rollback()
            End If

        End Try

    End Sub
    Private Sub LlevarEntradas(ByVal pMiBD As String)
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn As New SqlConnection(Str)
        Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn2 As New SqlConnection(Str2)
        sqllocal = "SELECT id_order, Almacen_origen, Almacen_destino, Documento, EnviadaSAE" +
        " FROM Logistik_Traspasos WHERE EnviadaSAE='E' and current_state = '9'"
        Dim daPC As New SqlDataAdapter(sqllocal, conn)
        Dim dsPC As New DataSet
        daPC.Fill(dsPC, "Logistik_TraspasosEntradas")
        Dim oTablePC As New DataTable
        oTablePC = dsPC.Tables("Logistik_TraspasosEntradas")
        Dim OrdenVenta As String
        Dim vAlm_orig As String
        Dim vAlm_des As String
        Dim vEnviadoSAE As String
        Dim vDocumento As String = "0"
        For Each oRowPC In oTablePC.Rows
            OrdenVenta = oRowPC.Item("id_order").ToString
            ' especificar documento
            vDocumento = Trim(oRowPC.Item("Documento").ToString)
            vEnviadoSAE = Trim(oRowPC.Item("EnviadaSAE").ToString)
            'agregar ceros
            vDocumento = espacios(vDocumento, 20)
            vAlm_des = oRowPC.Item("Almacen_destino").ToString
            '--------------consecutivo traspaso SAE
            Dim vConsecSAE As String = 0
            sqllocal = "SELECT num_doc FROM Logistik_Consecutivo_SAE"
            Dim daPC1 As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC1 As New DataSet
            daPC1.Fill(dsPC1, "Logistik_Consecutivo_SAE")
            Dim oTablePC1 As New DataTable
            oTablePC1 = dsPC1.Tables("Logistik_Consecutivo_SAE")
            If oTablePC1.Rows.Count >= 1 Then
                For Each oRowPC7 In oTablePC1.Rows
                    vConsecSAE = oRowPC7.Item("num_doc").ToString
                    vConsecSAE = vConsecSAE + 1
                Next
            Else
                sqllocal = "insert into Logistik_Consecutivo_SAE(num_doc) values ('1')"
                EjecutarQuerySQL_EMPRESA(sqllocal)
                vConsecSAE = 1
            End If

            '--------------------------------------
            If vConsecSAE > 0 Then
                vConsecSAE = espacios(vConsecSAE, 20)
                sqllocal = "SELECT product_upc, product_quantity, quantity_input, quantity_output" +
                " FROM Logistik_Traspasos_detail WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                Dim da As New SqlDataAdapter(sqllocal, conn)
                Dim ds As New DataSet
                da.Fill(ds, "Logistik_Traspasos_detail")
                Dim oTable As New DataTable
                oTable = ds.Tables("Logistik_Traspasos_detail")
                Dim vCant As Double
                Dim vCantPed As Double
                Dim vArt As String
                '-------------------------------------------
                If conn2.State = ConnectionState.Closed Then
                    conn2.Open()
                End If
                '---------------------------------------
                objTrans = conn2.BeginTransaction()
                '--------------------------------------
                Dim vMovimiento As Integer = 0
                Dim vEntrada As String = "B"
                For Each oRow In oTable.Rows
                    vArt = oRow.Item("product_upc").ToString
                    vCant = oRow.Item("product_quantity").ToString
                    If vCant > 0 Then
                        '---------------------crear el o los movimientos de salida por traspaso
                        Dim vNum_Mov As String
                        Dim vcont7 As String = ""
                        Dim reader7 As SqlDataReader
                        sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num FROM MINVE" + vgNumEmpresa.ToString
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        reader7 = cmd.ExecuteReader()
                        While reader7.Read()
                            vcont7 = reader7.Item(0).ToString
                            vcont7 = Val(vcont7) + 1
                        End While
                        If vcont7 = "" Then vcont7 = "1"
                        vNum_Mov = vcont7
                        reader7.Close()
                        '-------------traer y costo existencia - la cantidad de salida
                        Dim vCosto As String = "0"
                        Dim vExistencia As Double = 0
                        sqllocal = "Select ISNULL(max(m.NUM_MOV),1) AS num," +
                        " (SELECT M1.COSTO FROM MINVE" + vgNumEmpresa.ToString + " M1 WHERE M1.CVE_ART = '" + vArt.ToString + "' AND M1.ALMACEN = '" + vAlm_orig.ToString + "' AND M1.NUM_MOV = MAX(M.NUM_MOV)) AS COSTO, " +
                        " (SELECT EXISTENCIA FROM MINVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt.ToString + "' AND ALMACEN = '" + vAlm_orig.ToString + "' AND NUM_MOV = MAX(M.NUM_MOV)) AS EXIST " +
                        " FROM MINVE" + vgNumEmpresa.ToString + " m WHERE m.CVE_ART = '" + vArt.ToString + "' and m.ALMACEN = '" + vAlm_orig.ToString + "'"
                        Dim reader As SqlDataReader
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        reader = cmd.ExecuteReader()
                        While reader.Read()
                            vCosto = reader.Item(1).ToString
                            If reader.Item(2).ToString = "" Then
                                vExistencia = 0
                            Else
                                vExistencia = reader.Item(2).ToString
                            End If
                        End While
                        If vCosto = "" Then vCosto = "0"
                        vExistencia = vExistencia - vCant
                        reader.Close()
                        '-------------traer tipo de producto y unida de medida
                        Dim vUM As String = ""
                        Dim vTip_Art As String = ""
                        Dim reader3 As SqlDataReader
                        sqllocal = "Select UNI_MED, TIPO_ELE FROM INVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        reader3 = cmd.ExecuteReader()
                        While reader3.Read()
                            vUM = reader3.Item(0).ToString
                            vTip_Art = reader3.Item(1).ToString
                        End While
                        reader3.Close()
                        ' ''insertar movimiento de disminucion
                        ''sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
                        ''",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
                        ''",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
                        ''",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
                        ''"'" + vArt + "','" + vAlm_orig + "','" + vNum_Mov + "','58','" + time.ToString("yyyy/MM/dd") + "'," + _
                        ''"'M','" + vConsecSAE + "','0','0','" + vCant.ToString + "','0','0','" + vCosto + "','0','0'," + _
                        ''"'0','" + vUM + "','0','" + vExistencia.ToString + "','" + vTip_Art + "'," + _
                        ''"'1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" + _
                        ''"S','0','" + vCosto + "','S','0')"
                        ''cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        ''cmd.ExecuteNonQuery()
                        ''sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - '" + vCant.ToString + "'" + _
                        ''           " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_orig + "'"
                        ''cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        ''cmd.ExecuteNonQuery()
                        ' ''---------------------crear el o los movimientos de entrada por traspaso
                        ''sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num FROM MINVE" + vgNumEmpresa.ToString
                        ''cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        ''reader7 = cmd.ExecuteReader()
                        ''While reader7.Read()
                        ''    'MsgBox(reader7.Item(0))
                        ''    vcont7 = reader7.Item(0).ToString
                        ''    vcont7 = Val(vcont7) + 1
                        ''End While
                        ''If vcont7 = "" Then vcont7 = "1"
                        ''vNum_Mov = vcont7
                        ''reader7.Close()
                        ' ''-------------traer y costo existencia + la cantidad de entrada
                        ''sqllocal = "Select ISNULL(max(m.NUM_MOV),1) AS num," + _
                        ''" (SELECT M1.COSTO FROM MINVE" + vgNumEmpresa.ToString + " M1 WHERE M1.CVE_ART = '" + vArt.ToString + "' AND M1.ALMACEN = '" + vAlm_des.ToString + "' AND M1.NUM_MOV = MAX(M.NUM_MOV)) AS COSTO, " + _
                        ''" (SELECT EXISTENCIA FROM MINVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt.ToString + "' AND ALMACEN = '" + vAlm_des.ToString + "' AND NUM_MOV = MAX(M.NUM_MOV)) AS EXIST " + _
                        ''" FROM MINVE" + vgNumEmpresa.ToString + " m WHERE m.CVE_ART = '" + vArt.ToString + "' and m.ALMACEN = '" + vAlm_des.ToString + "'"
                        ''Dim reader5 As SqlDataReader
                        ''cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        ''reader5 = cmd.ExecuteReader()
                        ''While reader5.Read()
                        ''    vCosto = reader5.Item(1).ToString
                        ''    If reader5.Item(2).ToString = "" Then
                        ''        vExistencia = 0
                        ''    Else
                        ''        vExistencia = reader5.Item(2).ToString
                        ''    End If
                        ''End While
                        ''If vCosto = "" Then vCosto = "0"
                        ''vExistencia = vExistencia + vCant
                        ''reader5.Close()
                        'insertar movimiento de aumento
                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                        "'" + vArt + "','" + vAlm_des + "','" + vNum_Mov + "','7','" + time.ToString("yyyy/MM/dd") + "'," +
                        "'M','" + vConsecSAE + "','0','0','" + vCant.ToString + "','0','0','" + vCosto + "','0','0'," +
                        "'0','" + vUM + "','0','" + vExistencia.ToString + "','" + vTip_Art + "'," +
                        "'1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','1','" +
                        "S','0','" + vCosto + "','S','0')"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + '" + vCant.ToString + "'" +
                                   " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_des + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        vMovimiento = 1
                    End If
                Next
                '------------------------
                objTrans.Commit()
                '------------------------
                If conn2.State = ConnectionState.Open Then
                    conn2.Close()
                End If
                'cambiar el status de envio
                If vMovimiento = 1 Then
                    Dim sql As String = "update Logistik_Traspasos SET EnviadaSAE = 'S', Doc_Salida ='" + vConsecSAE + "'" +
                    " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                    EjecutarQuerySQL_EMPRESA(sql)
                    sql = "update Logistik_Consecutivo_SAE SET num_doc = num_doc + 1"
                    EjecutarQuerySQL(sql)
                    '--------------------CREAR MOVIEMNTOS DE LA ORDEN DE COMPRA
                    sql = "Select product_upc, product_name, quantity_output " +
                    " FROM Logistik_Traspasos_detail " +
                    " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                    Dim dsCargarEncabezado As New DataSet()
                    Dim dataadapter As New SqlDataAdapter(sql, conn)
                    dataadapter.Fill(dsCargarEncabezado, "Logistik_Traspasos")
                    Dim oTabla As DataTable
                    oTabla = dsCargarEncabezado.Tables("Logistik_Traspasos")
                    Dim oFila As DataRow
                    Dim vArt7 As String = ""
                    Dim vDesc7 As String = ""
                    Dim vCant7 As String = ""
                    'dim vFecha as String =
                    If oTabla.Rows.Count >= 1 Then
                        For Each oFila In oTabla.Rows
                            vArt7 = oFila.Item("product_upc").ToString
                            vDesc7 = oFila.Item("product_name").ToString
                            vCant7 = Convert.ToDouble(oFila.Item("product_quantity").ToString)
                            If Len(vCant) >= 1 Then
                                sql = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino) VALUES (" +
                                "'" + Trim(OrdenVenta.ToString) + "','Entrada','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_des.ToString + "','" + vAlm_orig.ToString + "')"
                                EjecutarQuerySQL_EMPRESA(sql)
                                '---------------------------------------------------------
                                'sql = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," + _
                                '"Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino ) VALUES (" + _
                                '"'" + Trim(OrdenVenta.ToString) + "','Entrada x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + _
                                'vArt7.ToString + "','" + vDesc7.ToString + "','" + _
                                'vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_orig.ToString + "','" + vAlm_des.ToString + "')"
                                'EjecutarQuerySQL_EMPRESA(sql)
                                '---------------------------------------------------------
                            End If
                        Next
                    End If
                End If

            End If
        Next

    End Sub
    Private Sub LlevarUbicaciones(ByVal pMiBD As String)
        Label5.Text = "Sincronizando Ubicaciones del SQL al SAE..."
        Me.Refresh()
        Dim OrdenVenta As String = ""
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn As New SqlConnection(Str)
        Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
        'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn2 As New SqlConnection(Str2)
        Dim vArt As String
        Dim vAlm_orig As String
        Dim vAlm_des As String
        Try

            sqllocal = "SELECT id_order, Almacen_origen, Almacen_destino, Documento, EnviadaSAE, num_pedido, num_empresa" +
            " FROM Logistik_Traspasos WHERE EnviadaSAE='U' and current_state = '8' and verificacion=1"
            'sqllocal = "SELECT id_order, Almacen_origen, Almacen_destino, Documento, EnviadaSAE, num_pedido" + _
            '" FROM Logistik_Traspasos WHERE EnviadaSAE='U' and current_state = '8'"
            TextBox1.Text = "1"
            LabelTABLA.Text = "S Logistik_Transpasos"
            Me.Refresh()
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_TraspasosUbicaciones")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_TraspasosUbicaciones")
            Dim vEnviadoSAE As String
            Dim vDocumento As String = "0"
            Dim Vpedido As String
            Dim Vnum_empresa As String
            For Each oRowPC In oTablePC.Rows
                OrdenVenta = oRowPC.Item("id_order").ToString
                ' especificar documento
                vDocumento = Trim(oRowPC.Item("Documento").ToString)
                vEnviadoSAE = Trim(oRowPC.Item("EnviadaSAE").ToString)
                'agregar ceros
                vDocumento = espacios(vDocumento, 20)
                vAlm_orig = oRowPC.Item("Almacen_origen").ToString
                vAlm_des = oRowPC.Item("Almacen_destino").ToString
                Vpedido = oRowPC.Item("num_pedido").ToString
                Vnum_empresa = oRowPC.Item("num_empresa").ToString
                '--------------consecutivo traspaso SAE
                Dim vConsecSAE As String = oRowPC.Item("id_order").ToString
                'sqllocal = "SELECT num_doc FROM Logistik_Consecutivo_SAE"
                'Dim daPC1 As New SqlDataAdapter(sqllocal, conn)
                'Dim dsPC1 As New DataSet
                'daPC1.Fill(dsPC1, "Logistik_Consecutivo_SAE")
                'Dim oTablePC1 As New DataTable
                'oTablePC1 = dsPC1.Tables("Logistik_Consecutivo_SAE")
                'If oTablePC1.Rows.Count >= 1 Then
                '    For Each oRowPC7 In oTablePC1.Rows
                '        vConsecSAE = oRowPC7.Item("num_doc").ToString
                '        vConsecSAE = vConsecSAE + 1
                '        sqllocal = "update Logistik_Consecutivo_SAE set num_doc = num_doc + 1"
                '        EjecutarQuerySQL(sqllocal)
                '        Exit For
                '    Next
                'Else - 5536871401 ab tomic 2 x 1 y una faja
                '    sqllocal = "insert into Logistik_Consecutivo_SAE(num_doc) values ('1')"
                '    EjecutarQuerySQL_EMPRESA(sqllocal)
                '    vConsecSAE = 1
                'End If
                '--------------------------------------
                If vConsecSAE > 0 Then
                    vConsecSAE = espacios(vConsecSAE, 20)
                    sqllocal = "SELECT product_upc, product_quantity, quantity_input, quantity_output" +
                    " FROM Logistik_Traspasos_detail WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'" +
                    " and num_empresa='" + Vnum_empresa + "'"
                    LabelTABLA.Text = "S Logistik_Traspasos_detail"
                    TextBox1.Text = "2"
                    Me.Refresh()
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    Dim da As New SqlDataAdapter(sqllocal, conn)
                    Dim ds As New DataSet
                    da.Fill(ds, "Logistik_Traspasos_detail")
                    Dim oTable As New DataTable
                    oTable = ds.Tables("Logistik_Traspasos_detail")
                    Dim vCant As Double
                    Dim vCantPed As Double
                    '-------------------------------------------
                    If conn2.State = ConnectionState.Closed Then
                        conn2.Open()
                    End If
                    '---------------------------------------
                    'objTrans = conn2.BeginTransaction()
                    '--------------------------------------
                    Dim vMovimiento As Integer = 0
                    Dim vEntrada As String = "B"
                    For Each oRow In oTable.Rows
                        vArt = oRow.Item("product_upc").ToString
                        'verificar si existe el producto y existencia almacen en el almacen destino
                        '---------------------------------------------------------------------
                        sqllocal = "SELECT CVE_ART, EXIST FROM MULT" + vgNumEmpresa.ToString +
                        " WHERE CVE_ART = '" + vArt.Trim + "' AND CVE_ALM ='" + vAlm_orig.Trim + "'"
                        LabelTABLA.Text = "S MULT"
                        TextBox1.Text = "3"
                        Me.Refresh()
                        Dim readerEXIST1 As SqlDataReader
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, conn2)
                        readerEXIST1 = cmd.ExecuteReader()
                        Dim vValor_Orig As String = ""
                        Dim ExistAlmDest As String
                        While readerEXIST1.Read()
                            'MsgBox("CORRECTO")
                            vValor_Orig = readerEXIST1.Item(1).ToString
                            ExistAlmDest = readerEXIST1.Item(1).ToString
                            'readerEXIST.Close()
                        End While
                        readerEXIST1.Close()
                        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                        sqllocal = "SELECT mm.CVE_ART, mm.EXIST FROM MULT" + vgNumEmpresa.ToString + " as mm" +
                        " WHERE mm.CVE_ART = '" + vArt.Trim + "' AND mm.CVE_ALM ='" + vAlm_des.Trim + "'"
                        LabelTABLA.Text = "S MULT2"
                        LabelQuery.Text = sqllocal
                        TextBox1.Text = "4"
                        Me.Refresh()
                        Dim readerEXIST As SqlDataReader
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, conn2)
                        readerEXIST = cmd.ExecuteReader()
                        Dim vValor_Dest As String = ""
                        'Dim ExistAlmDest As String
                        While readerEXIST.Read()
                            'MsgBox("CORRECTO")
                            vValor_Dest = readerEXIST.Item(1).ToString
                            'ExistAlmDest = readerEXIST.Item(1).ToString
                            'readerEXIST.Close()
                        End While
                        readerEXIST.Close()
                        vCant = oRow.Item("product_quantity").ToString
                        'traspaso alm 1 al alm 983 no hay verificaciones por son merma
                        If (Val(vValor_Orig) >= vCant And Val(vValor_Dest) >= 0) Then
                            Try

                                '---------------------------------------
                                objTrans = conn2.BeginTransaction()
                                '--------------------------------------
                                '---------------------crear el o los movimientos de salida por traspaso
                                Dim vNum_Mov As String
                                Dim vcont7 As String = ""
                                Dim reader7 As SqlDataReader
                                sqllocal = "SELECT aa.ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " aa WHERE aa.ID_TABLA = 44"
                                LabelTABLA.Text = "S MINVE"
                                LabelQuery.Text = sqllocal
                                TextBox1.Text = "5"
                                Me.Refresh()
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                reader7 = cmd.ExecuteReader()
                                While reader7.Read()
                                    vcont7 = reader7.Item(0).ToString
                                    vcont7 = Val(vcont7) + 1
                                End While
                                If vcont7 = "" Then vcont7 = "1"
                                vNum_Mov = vcont7
                                reader7.Close()
                                '-------------traer y costo existencia - la cantidad de salida
                                Dim vCosto As String = "0"
                                Dim vExistencia As Double = 0
                                vExistencia = vValor_Orig
                                If vCosto = "" Then vCosto = "0"
                                vExistencia = vExistencia - vCant
                                ExistAlmDest = ExistAlmDest - vCant
                                vValor_Orig = vValor_Orig - vCant
                                'reader.Close()
                                '-------------traer tipo de producto y unida de medida
                                Dim vUM As String = ""
                                Dim vTip_Art As String = ""
                                Dim reader3 As SqlDataReader
                                sqllocal = "Select UNI_MED, TIPO_ELE, EXIST, COSTO_PROM FROM INVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt + "'"

                                LabelQuery.Text = sqllocal
                                TextBox1.Text = "6"
                                Me.Refresh()
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                reader3 = cmd.ExecuteReader()
                                Dim EXISTG As String
                                While reader3.Read()
                                    vUM = reader3.Item(0).ToString
                                    vTip_Art = reader3.Item(1).ToString
                                    EXISTG = reader3.Item(2).ToString
                                    vCosto = reader3.Item(3).ToString
                                End While
                                reader3.Close()
                                'insertar movimiento de disminucion
                                Dim VERSION_SINC As String = DateTime.Now
                                VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                                sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, COSTO_PROM_GRAL, DESDE_INVE, MOV_ENLAZADO, EXIST_G) VALUES (" +
                                "'" + vArt + "','" + vAlm_orig + "','" + vNum_Mov + "','58','" + time.ToString("yyyy/MM/dd") + "'," +
                                "'M','" + vConsecSAE + "','0','0','" + vCant.ToString + "','0','0','" + vCosto + "','0','0'," +
                                "'0','" + vUM + "','0','" + vValor_Orig.ToString + "','" + vTip_Art + "'," +
                                "'1','" + VERSION_SINC + "','0','1','-1','" +
                                "S','" + vCosto + "','" + vCosto + "','" + vCosto + "','S','0','" + EXISTG.ToString + "')"
                                LabelQuery.Text = sqllocal
                                TextBox1.Text = "7"
                                Me.Refresh()
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - '" + vCant.ToString + "'" +
                                           " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_orig + "'"
                                LabelQuery.Text = sqllocal
                                TextBox1.Text = "8"
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + "  set ULT_CVE=ULT_CVE+1  WHERE ID_TABLA = 44"
                                TextBox1.Text = "9"
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                '---------------------crear el o los movimientos de entrada por traspaso
                                sqllocal = "SELECT aa.ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " aa WHERE aa.ID_TABLA = 44"
                                TextBox1.Text = "10"
                                Me.Refresh()
                                LabelQuery.Text = sqllocal
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                reader7 = cmd.ExecuteReader()
                                While reader7.Read()
                                    'MsgBox(reader7.Item(0))
                                    vcont7 = reader7.Item(0).ToString
                                    vcont7 = Val(vcont7) + 1
                                End While
                                If vcont7 = "" Then vcont7 = "1"
                                vNum_Mov = vcont7
                                reader7.Close()
                                vExistencia = vAlm_des
                                If vCosto = "" Then vCosto = "0"
                                vExistencia = vExistencia + vCant
                                vValor_Dest = vValor_Dest + vCant
                                'reader5.Close()
                                'insertar movimiento de aumento
                                Dim VERSION_SINC7 As String = DateTime.Now
                                VERSION_SINC7 = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss.mmm")

                                sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G) VALUES (" +
                                "'" + vArt + "','" + vAlm_des + "','" + vNum_Mov + "','7','" + time.ToString("yyyy/MM/dd") + "'," +
                                "'M','" + vConsecSAE + "','0','0','" + vCant.ToString + "','0','0','" + vCosto + "','0','0'," +
                                "'0','" + vUM + "','0','" + vValor_Dest.ToString + "','" + vTip_Art + "'," +
                                "'1','" + VERSION_SINC7 + "','0','1','1','" +
                                "S','0','" + vCosto + "','S','0','" + EXISTG.ToString + "')"
                                LabelQuery.Text = sqllocal
                                TextBox1.Text = "12"
                                Me.Refresh()
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + '" + vCant.ToString + "'" +
                                           " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_des + "'"
                                TextBox1.Text = "13"
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + "  set ULT_CVE=ULT_CVE+1  WHERE ID_TABLA = 44"
                                TextBox1.Text = "14"
                                Me.Refresh()
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                cmd.ExecuteNonQuery()
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                vMovimiento = 1
                                '------------------------
                                objTrans.Commit()
                                '------------------------
                            Catch ex As Exception
                                objTrans.Rollback()
                            End Try
                        ElseIf vValor_Orig = "" Then
                            'NO EXISTE
                            'sqllocal = "INSERT INTO MULT" + vgNumEmpresa.ToString + "() VALUES ('" + _
                            'vArt + "')"
                            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                            documento = OrdenVenta.ToString
                            mensaje = "Error TRASPASO ,el producto no existe:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            TextBox1.Text = "15"
                            Me.Refresh()
                            Exit For
                        Else
                            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                            documento = OrdenVenta.ToString
                            mensaje = "Error TRASPASO ,Existencias insuficientes del producto:" + vArt + " Alm_origen:" + vAlm_orig + " o Alm_dest:" + vAlm_des + " con negativos"
                            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                            TextBox1.Text = "16"
                            Me.Refresh()
                            Exit For

                        End If
                    Next
                    '------------------------------------------
                    If vMovimiento = 1 Then
                        sqllocal = "update Logistik_Traspasos SET EnviadaSAE = 'S', Doc_Salida ='" + vConsecSAE + "'" +
                        " WHERE id_order = '" + OrdenVenta.Trim + "'"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        TextBox1.Text = "17"
                        Me.Refresh()
                        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                        empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                        documento = OrdenVenta.ToString
                        If Vpedido = "" Then
                            mensaje = "TRASPASO producto:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                        Else
                            mensaje = "TRASPASO producto:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des + " Pedido:" + Vpedido
                        End If
                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        TextBox1.Text = "18"
                        Me.Refresh()
                        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                        'sql = "update Logistik_Consecutivo_SAE SET num_doc = num_doc + 1"
                        'EjecutarQuerySQL(sql)
                        '--------------------CREAR MOVIEMNTOS DE LA ORDEN DE COMPRA
                        sqllocal = "Select product_upc, product_name, product_quantity " +
                        " FROM Logistik_Traspasos_detail " +
                        " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                        TextBox1.Text = "19"
                        Me.Refresh()
                        Dim dsCargarEncabezado As New DataSet()
                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        Dim dataadapter As New SqlDataAdapter(sqllocal, conn)
                        dataadapter.Fill(dsCargarEncabezado, "Logistik_Traspasos")
                        Dim oTabla As DataTable
                        oTabla = dsCargarEncabezado.Tables("Logistik_Traspasos")
                        Dim oFila As DataRow
                        Dim vArt7 As String = ""
                        Dim vDesc7 As String = ""
                        Dim vCant7 As String = ""
                        'dim vFecha as String =
                        If oTabla.Rows.Count >= 1 Then
                            For Each oFila In oTabla.Rows
                                vArt7 = oFila.Item("product_upc").ToString
                                vDesc7 = oFila.Item("product_name").ToString
                                vCant7 = Convert.ToDouble(oFila.Item("product_quantity").ToString)
                                If Len(vCant) >= 1 Then
                                    sqllocal = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                    "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino) VALUES (" +
                                    "'" + Trim(OrdenVenta.ToString) + "','Salida x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                    vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                    vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_des.ToString + "','" + vAlm_orig.ToString + "')"
                                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                    '---------------------------------------------------------
                                    sqllocal = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                    "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino ) VALUES (" +
                                    "'" + Trim(OrdenVenta.ToString) + "','Entrada x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                    vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                    vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_orig.ToString + "','" + vAlm_des.ToString + "')"
                                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                    TextBox1.Text = "20"
                                    Me.Refresh()
                                    '---------------------------------------------------------
                                End If
                            Next
                        End If
                    End If
                End If
            Next
            'TextBox1.Text = "211"
            'Me.Refresh()
        Catch es As SqlException
            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
            documento = OrdenVenta.ToString
            mensaje = "Error TRASPASO, el producto no existe:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            TextBox1.Text = "21"
            Me.Refresh()
            If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                Me.Dispose()
                'FrmLogin.Dispose()
            End If
            Throw es
        Catch ex As Exception
            empresa = "LogistikMasterValvulerias" & vgNumEmpresa
            documento = OrdenVenta.ToString
            mensaje = "Error TRASPASO, el producto no existe:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            TextBox1.Text = "22"
            Me.Refresh()
        Finally
            'TextBox1.Text = "24"
            'Me.Refresh()
            If conn2.State <> ConnectionState.Closed Then conn2.Close()
            'TextBox1.Text = "25"
            'Me.Refresh()
            If conn.State <> ConnectionState.Closed Then conn.Close()
            'TextBox1.Text = "26"
            'Me.Refresh()
        End Try
    End Sub

    Private Sub LlevarOrdCompEmp6SAE(ByVal pEMP06BD As String)
        Label5.Text = "Sincronizar Compras del SQL al SAE parte 1"
        Me.Refresh()
        'EMPRESA SQL LOGISTIK
        Dim CVE_DOC As String
        Dim voc2019 As String

        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim conn As New SqlConnection(Str)
        'EMPRESA SAE ALMACEN
        Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pEMP06BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
        'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pEMP06BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        Dim conn2 As New SqlConnection(Str2)
        'Dim vgNumEmpresa2 As String = "06"
        ''EMPRESA SAE ENLAZADO SQL LOGISTIK
        'Dim Str3 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";MultipleActiveResultSets=True;"
        'Dim connEMP As New SqlConnection(Str3)
        Dim BIEN As Integer = 0
        'TextErrorEmp2.Text = TextErrorEmp2.Text + " BDsae1:" + pEMP06BD + " BDlog1:" + MI_BD
        Try
            'EnviadaSAE = S
            'EnviadaSAE = N
            'sqllocal = "SELECT lso.id_supply_order, lso.id_supply_order_state, lso.EnviadaSAE, lsod.quantity_received" + _
            '" FROM Logistik_supply_order as lso, Logistik_supply_order_detail as lsod" + _
            '" WHERE lso.id_supply_order = lsod.id_supply_order" + _
            '" and lso.EnviadaSAE = 'N' and lso.id_supply_order_state = 5"
            'se cambio el estado 5 a 9 por los costos
            sqllocal = "SELECT id_supply_order,id_supplier, id_warehouse, total_te, num_empresa,date_upd" +
            " FROM Logistik_supply_order WHERE EnviadaSAE = 'N' and id_supply_order_state = 9"
            LabelTABLA.Text = "S Logistik_supply_order"

            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "Logistik_supply_order")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("Logistik_supply_order")
            Dim OrdenCompra As String
            Dim id_supplier As String
            Dim id_warehouse As String
            Dim total_te As Double
            Dim num_empresa As String
            Dim date_upd As String
            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            For Each oRowPC In oTablePC.Rows
                OrdenCompra = oRowPC.Item("id_supply_order").ToString
                voc2019 = Trim(oRowPC.Item("id_supply_order").ToString)
                'agregar ceros
                'OrdenCompra = ceros(OrdenCompra, 10)
                'agregar espacios
                OrdenCompra = espacios(OrdenCompra, 20)
                id_supplier = oRowPC.Item("id_supplier").ToString
                id_warehouse = oRowPC.Item("id_warehouse").ToString
                total_te = Convert.ToDouble(oRowPC.Item("total_te").ToString)
                num_empresa = oRowPC.Item("num_empresa").ToString
                'Dim Verdadero As Boolean = VerificarRFCprovedorSAE(pEMP06BD, id_supplier, num_empresa)
                '7777777777777777777777777777777777777777777777777777777777777777777777777777777777777
                sqllocal = "update Logistik_supply_order SET id_supply_order_state='7'" +
                           " WHERE EnviadaSAE = 'N' and id_supply_order = '" + OrdenCompra + "'"
                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias" & num_empresa)
                '7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
                If Trim(id_supplier) = "0" Then
                    empresa = vgEmpresa
                    documento = ""
                    mensaje = "Verificacion Orden de Compra:" + OrdenCompra.ToString + " El RFC del proveedor no existe"
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                Else
                    date_upd = oRowPC.Item("date_upd").ToString
                    Dim TIP_DOC As String = "r"
                    CVE_DOC = OrdenCompra
                    Dim CVE_CLPV As String = id_supplier
                    Dim STATUS As String = "O"
                    Dim SU_REFER As String = OrdenCompra.Trim
                    Dim FECHA_DOC As String = time.ToString("yyyy/MM/dd")
                    Dim FECHA_REC As String = time.ToString("yyyy/MM/dd")
                    Dim FECHA_PAG As String = time.ToString("yyyy/MM/dd")
                    Dim FECHA_CANCELA As String = time.ToString("yyyy/MM/dd")
                    'SUBTOTAL
                    Dim CAN_TOT As Double = total_te / 1.16
                    Dim IMP_TOT1 As String = "0"
                    Dim IMP_TOT2 As String = "0"
                    Dim IMP_TOT3 As String = "0"
                    'IVA
                    Dim IMP_TOT4 As String = CAN_TOT * 0.16
                    Dim DES_TOT As String = "0"
                    Dim DES_FIN As String = "0"
                    Dim TOT_IND As String = "0"
                    Dim OBS_COND As String = ""
                    Dim CVE_OBS As String = "0"
                    Dim NUM_ALMA As String = id_warehouse
                    Dim ACT_CXP As String = "S"
                    Dim ACT_COI As String = "N"
                    Dim NUM_MONED As String = "1"
                    Dim TIPCAMB As String = "1"
                    Dim ENLAZADO As String = "O"
                    Dim TIP_DOC_E As String = "o"
                    Dim NUM_PAGOS As String = ""
                    'FECHA Y HORA
                    Dim FECHAELAB As String = vfechayhora.ToString("yyyy/MM/dd HH:mm:ss")
                    Dim SERIE As String = ""
                    'EXTRAER FOLIO
                    Dim FOLIO As String
                    '------------------traer del sae
                    FOLIO = Nothing
                    sqllocal = "Select MASCARA FROM PARAM_FOLIOSC" + vgNumEmpresa.ToString +
                    " WHERE NUM_EMP = '6' AND TIPODOCTO = 'R'"
                    LabelTABLA.Text = "S PARAM_FOLIOSC" + vgNumEmpresa.ToString
                    Dim da77 As New SqlDataAdapter(sqllocal, conn2)
                    Dim ds77 As New DataSet
                    If conn2.State = ConnectionState.Closed Then
                        conn2.Open()
                    End If
                    da77.Fill(ds77, "PARAM_FOLIOSC" & vgNumEmpresa.ToString)
                    Dim oTable77 As New DataTable
                    oTable77 = ds77.Tables("PARAM_FOLIOSC" & vgNumEmpresa.ToString)
                    'If conn2.State = ConnectionState.Open Then
                    '    conn2.Close()
                    'End If
                    If oTable77.Rows.Count >= 1 Then
                        For Each oRow77 In oTable77.Rows
                            FOLIO = oRow77.Item("MASCARA").ToString
                        Next
                    End If
                    If FOLIO = "" Then
                        MsgBox("Configure la mascara de la clave del documento")
                        Exit Sub
                    End If
                    Dim CTLPOL As String = "0"
                    Dim ESCFD As String = "N"
                    Dim CONTADO As String = "N"
                    Dim BLOQ As String = "N"
                    Dim DES_FIN_PORC As String = "0"
                    Dim DES_TOT_PORC As String = "0"
                    'TOTAL
                    Dim IMPORTE As String = total_te.ToString
                    Dim TIP_DOC_ANT As String = ""
                    Dim DOC_ANT As String = ""
                    Dim TIP_DOC_SIG As String = ""
                    Dim DOC_SIG As String = ""
                    Dim SigCveDoc As String = ""
                    Dim vCveDoc As String = ""
                    If FECHA_DOC <> "" Then
                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy/MM/dd")
                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("yyyy-MM-dd hh:mm:ss.mmm")
                        'FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    End If
                    If FECHA_REC <> "" Then
                        'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("yyyy/MM/dd")
                        'FECHA_REC = Convert.ToDateTime(FECHA_REC).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    End If
                    If FECHA_PAG <> "" Then
                        'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("yyyy/MM/dd")
                        'FECHA_PAG = Convert.ToDateTime(FECHA_PAG).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    End If
                    If FECHA_CANCELA <> "" Then
                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("yyyy/MM/dd")
                        'FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("dd-MM-yyyy HH:mm:ss.mmm")
                    End If
                    If FECHAELAB <> "" Then
                        'FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("MM/dd/yyyy hh:mm:ss tt")
                        FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("yyyy/MM/dd hh:mm:ss")
                        'FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("dd-MM-yyyy hh:mm:ss.mmm")
                    End If
                    '---------------------------------------
                    If conn2.State = ConnectionState.Closed Then
                        conn2.Open()
                    End If
                    objTrans = conn2.BeginTransaction()
                    '--------------------------------------
                    '----------------buscar clave del documento
                    Dim vcont As String = ""
                    Dim vnum As Integer
                    Dim reader As SqlDataReader
                    Dim SqlSelection As String = "Select ISNULL(max(CLAVE_DOC),1) AS num FROM COMPR_CLIB" + vgNumEmpresa.ToString
                    LabelTABLA.Text = "S COMPR_CLIB" + vgNumEmpresa.ToString
                    cmd = New SqlCommand(SqlSelection, conn2, objTrans)
                    reader = cmd.ExecuteReader()
                    While reader.Read()
                        'MsgBox(reader.Item(0))
                        vcont = reader.Item(0).ToString
                        'Convertir a numero y 'aumentar mas uno
                        vcont = Val(vcont) + 1
                        'agregar ceros
                        'vcont = ceros(vnum, 10)
                        'agregar espacios
                        vcont = espacios(vcont, 20)
                        'regresar valor
                        'Me.TextBox1.Text = vcont
                        vCveDoc = vcont
                    End While
                    reader.Close()
                    'cmd.Dispose()
                    If vCveDoc <> "" Then
                        ''---------------------------------------
                        'TRAER CLAVE BITA
                        ''------------------------------------------------
                        'Dim readerBita As SqlDataReader
                        'Dim vBita As String
                        'Dim CVE_BITA As String
                        'sqllocal = "Select isnull(max(CVE_BITA),1) AS num FROM BITA" + vgNumEmpresa.ToString
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'readerBita = cmd.ExecuteReader()
                        'While readerBita.Read()
                        '    vBita = readerBita.Item(0).ToString
                        '    CVE_BITA = Val(vBita) + 1
                        'End While
                        'readerBita.Close()
                        ''--------------------------------------
                        'DOC_ANT = ceros(DOC_ANT, 10)
                        'DOC_ANT = espacios(DOC_ANT, 20)
                        Dim vfolio As String = vCveDoc
                        CVE_CLPV = espacios(CVE_CLPV, 10)
                        sqllocal = "insert into  COMPR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, SU_REFER, FECHA_DOC, FECHA_REC," +
                        "FECHA_PAG, FECHA_CANCELA, CAN_TOT, IMP_TOT1, IMP_TOT2, IMP_TOT3, IMP_TOT4," +
                        "DES_TOT, DES_FIN, TOT_IND, OBS_COND, CVE_OBS, NUM_ALMA, ACT_CXP," +
                        "ACT_COI, NUM_MONED, TIPCAMB, ENLAZADO, TIP_DOC_E, NUM_PAGOS, FECHAELAB," +
                        "SERIE, FOLIO, CTLPOL, ESCFD, CONTADO, BLOQ, DES_FIN_PORC," +
                        "DES_TOT_PORC, IMPORTE, TIP_DOC_ANT, DOC_ANT, TIP_DOC_SIG, DOC_SIG) values (" +
                        "'r','" + vCveDoc.ToString + "','" + CVE_CLPV.ToString + "','" + STATUS.ToString + "','" + SU_REFER.ToString + "','" + FECHA_DOC.ToString + "','" + FECHA_REC.ToString + "','" +
                        FECHA_PAG.ToString + "','" + FECHA_CANCELA.ToString + "','" + CAN_TOT.ToString + "','" + IMP_TOT1.ToString + "','" + IMP_TOT2.ToString + "','" + IMP_TOT3.ToString + "','" + IMP_TOT4.ToString + "','" +
                        DES_TOT.ToString + "','" + DES_FIN.ToString + "','" + TOT_IND.ToString + "','" + OBS_COND.ToString + "','" + CVE_OBS.ToString + "','" + NUM_ALMA.ToString + "','" + ACT_CXP.ToString + "','" +
                        ACT_COI.ToString + "','" + NUM_MONED.ToString + "','" + TIPCAMB.ToString + "','" + ENLAZADO.ToString + "','o','" + NUM_PAGOS.ToString + "','" + FECHAELAB.ToString + "','" +
                        SERIE.ToString + "','" + vfolio.ToString + "','" + CTLPOL.ToString + "','" + ESCFD.ToString + "','" + CONTADO.ToString + "','" + BLOQ.ToString + "','" + DES_FIN_PORC.ToString + "','" +
                        DES_TOT_PORC.ToString + "','" + IMPORTE.ToString + "','" + TIP_DOC_ANT.ToString + "','" + DOC_ANT.ToString + "','','')"
                        LabelTABLA.Text = "I COMPR" + vgNumEmpresa.ToString
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "insert into  COMPR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
                        LabelTABLA.Text = "I COMPR_CLIB" + vgNumEmpresa.ToString
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '''INSERT TABLA BITA
                        'sqllocal = "INSERT INTO BITA" + vgNumEmpresa.ToString + _
                        '"(CVE_BITA, CVE_CLIE, CVE_CAMPANIA, CVE_ACTIVIDAD, FECHAHORA, CVE_USUARIO, OBSERVACIONES, STATUS, NOM_USUARIO)" + _
                        '" VALUES ('" + CVE_BITA + "','" + CVE_CLPV + "','_SAE_','    3','" + FECHAELAB + "','0', 'No. [" + vCveDoc.ToString + " ] $ " + IMPORTE.ToString + "', 'F', 'Administrador')"
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
                        LabelTABLA.Text = "U TBLCONTROL" + vgNumEmpresa.ToString
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '--------------------------------------------------------------------------------------
                        ''Dim vCve_Obs As String = TraerClaveSiguiente()
                        Dim vCve_Obs As String = "0"
                        Dim vcont7 As String = ""
                        'Dim reader7 As SqlDataReader
                        'sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCC" + vgNumEmpresa.ToString
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'reader7 = cmd.ExecuteReader()
                        'While reader7.Read()
                        '    'MsgBox(reader7.Item(0))
                        '    vcont7 = reader7.Item(0).ToString
                        '    vcont7 = Val(vcont7) + 1
                        'End While
                        'If vcont7 = "" Then vcont7 = "1"
                        'vCve_Obs = vcont7
                        'reader7.Close()
                        ''---------------------------------------------------------------------------------------
                        Dim vObser As String '= "Buenas O. C. HH"
                        'sqllocal = "INSERT INTO OBS_DOCC" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
                        'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        'cmd.ExecuteNonQuery()
                        'Call UpdateOC(CVE_DOC, vCveDoc)
                        sqllocal = "update COMPO" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='r', TIP_DOC_SIG='r', DOC_SIG='" + vCveDoc + "'" +
                        " WHERE CVE_DOC ='" + CVE_DOC + "'"
                        LabelTABLA.Text = "U COMPO" + vgNumEmpresa.ToString
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '-------------------------------------------------------------------
                        'Call RecepcionDatalleSAE2(vCveDoc, vObser, CVE_DOC)
                        'Dim CVE_DOC As String
                        Dim NUM_PAR As Integer = 0
                        Dim CVE_ART As String
                        Dim CANT As String
                        Dim PXR As String
                        Dim PREC As String
                        Dim COST As String = "0"
                        Dim IMPU1 As String = "0"
                        Dim IMPU2 As String = "0"
                        Dim IMPU3 As String = "0"
                        Dim IMPU4 As String
                        Dim IMP1APLA As String = "0"
                        Dim IMP2APLA As String = "0"
                        Dim IMP3APLA As String = "0"
                        Dim IMP4APLA As String
                        Dim TOTIMP1 As String = "0"
                        Dim TOTIMP2 As String = "0"
                        Dim TOTIMP3 As String = "0"
                        Dim TOTIMP4 As String
                        Dim DESCU As String = "0"
                        Dim ACT_INV As String = "S"
                        Dim TIP_CAM As String = "1"
                        Dim UNI_VENTA As String = "pz"
                        Dim TIPO_ELEM As String = "N"
                        Dim TIPO_PROD As String = "S"
                        'Dim CVE_OBS As String
                        Dim REG_SERIE As String = "0"
                        Dim E_LTPD As String = "0"
                        Dim FACTCONV As String = "1"
                        Dim COST_DEV As String = "0"
                        Dim NUM_ALM As String = NUM_ALMA
                        Dim MINDIRECTO As String = "0"
                        Dim NUM_MOV As String
                        Dim TOT_PARTIDA As String
                        Dim CampLib1, CampLib2, CampLib3, CampLib4, CampLib5, CampLib6, CampLib7 As String
                        Dim CampLib8, CampLib9, CampLib10, CampLib11, CampLib12 As String
                        Dim CampLib13, CampLib14, CampLib15, CampLib16, CampLib17 As String
                        Dim CampLib18, CampLib19, CampLib20, CampLib21, CampLib22 As String
                        Dim CampLib23, CampLib24, CampLib25, CampLib26, CampLib27 As String
                        Dim CampLib28, CampLib29, CampLib30, CampLib31, CampLib32 As String
                        Dim CampLib33, CampLib34, CampLib35, CampLib36, CampLib37 As String
                        Dim CampLib38, CampLib39, CampLib40, CampLib41, CampLib42 As String
                        Dim CampLib43, CampLib44, CampLib45 As String
                        '-------------------------------------------------------------------------------------------------
                        Dim reader2 As SqlDataReader
                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        SqlSelection = "Select upc, quantity_expected, quantity_received, unit_price_te, price_te" +
                        " FROM Logistik_supply_order_detail WHERE id_supply_order = '" + OrdenCompra + "'"
                        LabelTABLA.Text = "S Logistik_supply_order_detail"
                        cmd = New SqlCommand(SqlSelection, conn)
                        reader2 = cmd.ExecuteReader()
                        While reader2.Read()
                            'MsgBox(reader2.Item(0))
                            'CVE_DOC = reader2.Item(0).ToString
                            NUM_PAR = NUM_PAR + 1
                            CVE_ART = reader2.Item(0).ToString
                            CANT = "0"
                            CANT = reader2.Item(2).ToString
                            PXR = reader2.Item(2).ToString
                            PREC = reader2.Item(3).ToString
                            'COST = reader2.Item(3).ToString
                            PREC = "0"
                            COST = "0"
                            '---------------------------------------------------------------------------------
                            Dim readerCosto1 As SqlDataReader
                            'se cambio de precio_pesos a costo_pesos
                            SqlSelection = "select pedido, oc, precio, costo_pesos" +
                            " FROM vLogistik_Kardex WHERE trim(oc)='" + voc2019.Trim + "'" +
                            " and trim(vLogistik_Kardex.empresa_destino)='" + vgNumEmpresa.Trim + "'" +
                            " And trim(vLogistik_Kardex.estado_inicial)='0' and trim(vLogistik_Kardex.estado_final)='1'"
                            cmd = New SqlCommand(SqlSelection, conn)
                            readerCosto1 = cmd.ExecuteReader()
                            While readerCosto1.Read()
                                COST = readerCosto1.Item(3).ToString
                            End While
                            If COST = "" Then COST = "0"
                            readerCosto1.Close()
                            '-----------------------------------------------------------------------------------
                            'iva 16
                            IMPU4 = "16"
                            '1
                            IMP4APLA = "1"
                            'iva total
                            TOTIMP4 = PREC * (IMPU4 / 100)
                            'sacar cant * costo
                            TOT_PARTIDA = CANT * COST
                            '-------------------Traer la clave siguiente
                            'CVE_OBS = TraerClaveSiguiente()
                            vcont = "0"
                            Dim readerObser As SqlDataReader
                            sqllocal = "Select ISNULL(max(CVE_OBS),1) AS num FROM OBS_DOCC" + vgNumEmpresa.ToString
                            LabelTABLA.Text = "S OBS_DOCC" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerObser = cmd.ExecuteReader()
                            While readerObser.Read()
                                'MsgBox(readerObser.Item(0))
                                vcont = readerObser.Item(0).ToString
                                vcont = Val(vcont) + 1
                            End While
                            If vcont = "" Then vcont = "1"
                            CVE_OBS = vcont
                            readerObser.Close()
                            '---------------------crear el o los movimientos
                            'Dim vNum_Mov As String = ConsecutivoMovimiento()
                            Dim vNum_Mov As String
                            vcont7 = "0"
                            Dim readerMINVE As SqlDataReader
                            sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num FROM MINVE" + vgNumEmpresa.ToString
                            LabelTABLA.Text = "S MINVE" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerMINVE = cmd.ExecuteReader()
                            While readerMINVE.Read()
                                'MsgBox(reader7.Item(0))
                                vcont7 = readerMINVE.Item(0).ToString
                                vcont7 = Val(vcont7) + 1
                            End While
                            If vcont7 = "" Then vcont7 = "1"
                            vNum_Mov = vcont7
                            readerMINVE.Close()
                            '-------------------------------------------
                            sqllocal = "insert into PAR_COMPR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXR, PREC, COST, IMPU1, IMPU2, IMPU3, " +
                            "IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESCU," +
                            "ACT_INV, TIP_CAM, UNI_VENTA, TIPO_ELEM, TIPO_PROD, CVE_OBS, REG_SERIE, E_LTPD, FACTCONV, COST_DEV," +
                            "NUM_ALM, MINDIRECTO, NUM_MOV, TOT_PARTIDA, MAN_IEPS, APL_MAN_IMP,CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" +
                            "'" + vCveDoc.ToString + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "','" +
                            PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" +
                            IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" +
                            TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESCU.ToString + "','" +
                            "S','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_ELEM.ToString + "','" + TIPO_PROD.ToString + "','" +
                            CVE_OBS.ToString + "','" + REG_SERIE.ToString + "','" + E_LTPD.ToString + "','" + FACTCONV.ToString + "','" + COST_DEV.ToString + "','" +
                            NUM_ALM.ToString + "','" + MINDIRECTO.ToString + "','" + vNum_Mov.ToString + "','" + TOT_PARTIDA.ToString +
                            "','N','1','0','C','0','0','1')"
                            LabelTABLA.Text = "I PAR_COMPR" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'INSERTAR EL INDICE
                            sqllocal = "insert into  PAR_COMPR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + vCveDoc.ToString + "','" + NUM_PAR.ToString + "')"
                            LabelTABLA.Text = "I PAR_COMPR_CLIB" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'actualizar detalle
                            sqllocal = "update PAR_COMPO" + vgNumEmpresa.ToString + " set PXR = PXR - " + CANT.ToString +
                            " WHERE CVE_DOC = '" + CVE_DOC.ToString + "' and CVE_ART = '" + CVE_ART.ToString + "'"
                            LabelTABLA.Text = "U PAR_COMPO" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'actualizar ACUMULADOR
                            sqllocal = "update ACOMP" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + '" + TOT_PARTIDA.ToString + "'," +
                            " RIMP = RIMP + '" + TOTIMP4.ToString + "'" +
                             " where  DATEPART(MONTH,PER_ACUM) = DATEPART(MONTH,GETDATE()) AND DATEPART(YEAR,PER_ACUM)=DATEPART(YEAR,GETDATE())"
                            LabelTABLA.Text = "U ACOMP" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                            sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
                            LabelTABLA.Text = "U TBLCONTROL" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 57"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE FOLIOSC" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'r'"
                            LabelTABLA.Text = "U FOLIOSC" + vgNumEmpresa.ToString
                            '" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'actualizar las existencias
                            'Call ActualizarExistencias(CVE_ART, CANT)
                            sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST + '" + CANT.ToString + "', FCH_ULTCOM='" + time.ToString("yyyy/MM/dd") + "'," +
                            " COMP_X_REC = COMP_X_REC - '" + CANT.ToString + "', COSTO_PROM = '" + COST.ToString + "'," +
                            " ULT_COSTO = '" + COST.ToString + "', COMP_ANL_C = COMP_ANL_C + '" + CANT.ToString + "', COMP_ANL_M = COMP_ANL_M + '" + TOT_PARTIDA.ToString + "'" +
                            " WHERE CVE_ART ='" + CVE_ART.ToString + "'"
                            LabelTABLA.Text = "U INVE" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '-----------------------------------------------
                            'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
                            Dim vExistencia As String = ""
                            Dim readerINVE As SqlDataReader
                            sqllocal = "Select ISNULL(max(EXIST),0) AS num FROM INVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + CVE_ART + "'"
                            LabelTABLA.Text = "U2 INVE" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerINVE = cmd.ExecuteReader()
                            While readerINVE.Read()
                                'MsgBox(readerINVE.Item(0))
                                vExistencia = readerINVE.Item(0).ToString
                                'vExistencia = Val(vExistencia) + 1
                            End While
                            If vExistencia = "" Then vExistencia = "1"
                            readerINVE.Close()
                            ''--------existe almacen
                            Dim vExistAlm As String
                            Dim rederExistAlm As SqlDataReader
                            sqllocal = "SELECT EXIST FROM MULT" + vgNumEmpresa.ToString +
                            " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM = '" + NUM_ALM + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            rederExistAlm = cmd.ExecuteReader()
                            While rederExistAlm.Read
                                vExistAlm = rederExistAlm.Item(0).ToString
                                vExistAlm = Val(vExistAlm) + Val(CANT)
                            End While
                            rederExistAlm.Close()
                            '-----------------------------------------------
                            sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                            ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                            ",REG_SERIE, UNI_VENTA, E_LTPD, EXIST_G, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                            ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" +
                            "'" + CVE_ART + "','1','" + vNum_Mov + "','1','" + time.ToString("yyyy/MM/dd") + "'," +
                            "'r','" + vCveDoc.ToString + "','         1','1','" + CANT + "','0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," +
                            "'" + REG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + vExistAlm + "','" + TIPO_PROD + "','" + FACTCONV + "','" + time.ToString("yyyy/MM/dd") + "','','1','1','" +
                            "S','0','" + COST + "','N','0')"
                            LabelTABLA.Text = "U MINVE" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + vObser + "')"
                            'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            'cmd.ExecuteNonQuery()
                            'COMP_X_REC = COMP_X_REC - CANT
                            sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST  + " + CANT.ToString +
                            "  WHERE CVE_ART = '" + CVE_ART + "' and CVE_ALM = '" + NUM_ALM + "'"
                            LabelTABLA.Text = "U MULT" + vgNumEmpresa.ToString
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                        End While
                        reader2.Close()
                        sqllocal = "update COMPR" + vgNumEmpresa.ToString + " set CAN_TOT = '0', IMP_TOT4 = '0'," +
                                " IMPORTE = '0',FECHA_CANCELA = NULL, NUM_PAGOS=NULL where CVE_DOC = '" + vCveDoc.ToString + "'"
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        '------------------------
                        objTrans.Commit()

                        empresa = pEMP06BD.ToString
                        documento = vCveDoc.ToString
                        mensaje = "Registar Recepcion Correcta: " + vCveDoc.ToString + "  Orden de compra:" + OrdenCompra.ToString
                        sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                        empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                        EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                        Me.Refresh()
                        '----------------------------------------------------------------------------------------
                        'falta actualizar encabezado y detalle

                        sqllocal = "SELECT id_supply_order,id_supplier, id_warehouse, total_te, num_empresa,date_upd" +
                        " FROM Logistik_supply_order WHERE TRIM(id_supply_order) = '" + Trim(OrdenCompra) + "'"
                        Dim daEmpresax As New SqlDataAdapter(sqllocal, conn)
                        Dim dsEmpresax As New DataSet
                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        daEmpresax.Fill(dsEmpresax, "Logistik_supply_order" & num_empresa)
                        Dim oTableEmpresax As New DataTable
                        oTableEmpresax = dsEmpresax.Tables("Logistik_supply_order" & num_empresa)

                        For Each oRowEmpresax In oTableEmpresax.Rows
                            OrdenCompra = oRowEmpresax.Item("id_supply_order").ToString
                            num_empresa = oRowEmpresax.Item("num_empresa").ToString
                            'actualiza encabezado
                            'sqllocal = "update Logistik_supply_order SET id_supply_order_state='5'" + _
                            '" WHERE EnviadaSAE = 'N' and id_supply_order = '" + OrdenCompra + "'"
                            'EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias" & num_empresa)
                            'actualiza detalle
                            Dim readerDetalle As SqlDataReader
                            sqllocal = "Select id_supply_order_detail, upc, quantity_received" +
                            " FROM Logistik_supply_order_detail WHERE TRIM(id_supply_order) = '" + Trim(OrdenCompra) + "'"
                            cmd = New SqlCommand(sqllocal, conn)
                            readerDetalle = cmd.ExecuteReader()
                            Dim NPART As String
                            Dim vprod As String
                            Dim vcant As String
                            While readerDetalle.Read()
                                NPART = readerDetalle.Item(0).ToString
                                vprod = readerDetalle.Item(1).ToString
                                vcant = readerDetalle.Item(2).ToString
                                'actualiza encabezado
                                sqllocal = "update Logistik_supply_order_detail set quantity_received = '" + vcant + "'" +
                                " WHERE TRIM(id_supply_order) = '" + Trim(OrdenCompra) + "' and upc = '" + vprod + "'" +
                                " AND id_supply_order_detail = '" + NPART.ToString + "'"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias" & num_empresa)
                            End While
                            readerDetalle.Close()
                            '---------------------------------------------------------------------------------------
                            'Call LlevarOrdenesCompraSAE("LogistikMasterValvulerias" & num_empresa, num_empresa)
                            Call Compras("LogistikMasterValvulerias" & num_empresa, num_empresa, OrdenCompra)
                            OrdenCompra = Val(OrdenCompra)
                            sqllocal = "update Logistik_supply_order SET id_supply_order_state='7'" +
                            " WHERE TRIM(id_supply_order) = '" + Trim(OrdenCompra) + "'"
                            EjecutarQuerySQL_EMPRESA_X(sqllocal, MI_BD)
                            '--------------------------------------------------------------------------------------
                        Next
                        '------------------------
                    End If
                    OrdenCompra = Val(OrdenCompra)
                    Dim sql As String = "update Logistik_supply_order SET id_supply_order_state='6'" +
                    " WHERE id_supply_order = '" + OrdenCompra + "'"
                    EjecutarQuerySQL_EMPRESA(sql)
                End If
            Next
            '------------------------------------------------------------------------------------------
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "sioncronizar Orden de compra InCorrecta: " + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTrans.Rollback()
            If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                Me.Dispose()
                'FrmLogin.Dispose()
            End If
            Throw es
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = CVE_DOC.ToString
            mensaje = "sioncronizar Orden de compra InCorrecta: " + CVE_DOC.ToString
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            objTrans.Rollback()
            Throw ex
        Finally
            If conn2.State <> ConnectionState.Closed Then conn2.Close()
        End Try
    End Sub
    Function VerificarRFCclienteSAE(ByVal id_supplier As String, ByVal num_empresa As String) As Boolean
        Try
            '--------------------------------------------------------------------------------------
            Dim Str4 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn4 As New SqlConnection(Str4)
            Dim sql4 As String = "SELECT * FROM EmpresaSAE WHERE BASEDATOS = 'LogistikMasterValvulerias" + num_empresa + "'"
            If conn4.State = ConnectionState.Closed Then
                conn4.Open()
            End If
            Dim daBD As New SqlDataAdapter(sql4, conn4)
            Dim dsbd As New DataSet()
            daBD.Fill(dsbd, "EmpresaSAE")
            Dim oTabla4 As DataTable
            oTabla4 = dsbd.Tables("EmpresaSAE")
            Dim SERVIDOR2 As String = ""
            Dim USUARIO2 As String = ""
            Dim NOMBRE_BD2 As String = ""
            Dim PASSWROD2 As String = ""
            Dim BASEDATOS2 As String = ""
            'Dim VTIPO As String = ""
            If oTabla4.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla4.Rows
                    SERVIDOR2 = oFila.Item("SERVIDOR").ToString
                    BASEDATOS2 = oFila.Item("BASEDATOS").ToString
                    USUARIO2 = oFila.Item("USUARIO").ToString
                    PASSWROD2 = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD2 = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness2 As String = Mid(NOMBRE_BD2, LongitudBD)
            '--------------------------------------------------------------------------------------------
            Dim Str1 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD2 + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            'Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD2 + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn1 As New SqlConnection(Str1)
            Dim vRF2 As String = ""
            Dim reader2 As SqlDataReader
            sqllocal = "SELECT RFC FROM CLIE" + num_empresa + " WHERE CLAVE = '" + id_supplier + "'"
            If conn1.State = ConnectionState.Closed Then
                conn1.Open()
            End If
            cmd = New SqlCommand(sqllocal, conn1)
            reader2 = cmd.ExecuteReader()
            While reader2.Read()
                vRF2 = reader2.Item(0).ToString
            End While
            reader2.Close()
            '-------------------------------------------------------------------------------------
            '------------------------------------------------------------------------------------
            Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn7 As New SqlConnection(Str7)
            Dim sql As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Almacen'"
            If conn7.State = ConnectionState.Closed Then
                conn7.Open()
            End If
            Dim dataadapterBD As New SqlDataAdapter(sql, conn7)
            Dim dsCargarbd As New DataSet()
            dataadapterBD.Fill(dsCargarbd, "EmpresaSAE")
            Dim oTabla7 As DataTable
            oTabla7 = dsCargarbd.Tables("EmpresaSAE")
            Dim SERVIDOR As String = ""
            Dim USUARIO As String = ""
            Dim NOMBRE_BD As String = ""
            Dim PASSWROD As String = ""
            Dim BASEDATOS As String = ""
            'Dim VTIPO As String = ""
            If oTabla7.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla7.Rows
                    SERVIDOR = oFila.Item("SERVIDOR").ToString
                    BASEDATOS = oFila.Item("BASEDATOS").ToString
                    USUARIO = oFila.Item("USUARIO").ToString
                    PASSWROD = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim NUMEMP066 As String = Mid(NOMBRE_BD, LongitudBD)
            'vgEmpresa = NOMBRE_BD
            '------------------------------------------------------------------------------------
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn2 As New SqlConnection(Str2)

            Dim Vrfc1 As String = ""
            Dim reader3 As SqlDataReader
            id_supplier = espacios(id_supplier, 10)
            sqllocal = "SELECT RFC FROM CLIE" + NUMEMP066.Trim + " WHERE RFC = '" + vRF2 + "'"
            cmd = New SqlCommand(sqllocal, conn2)
            If conn2.State = ConnectionState.Closed Then
                conn2.Open()
            End If
            reader3 = cmd.ExecuteReader()
            While reader3.Read()
                Vrfc1 = reader3.Item(0).ToString
            End While
            reader3.Close()
            If conn2.State = ConnectionState.Open Then
                conn2.Close()
            End If
            If conn7.State = ConnectionState.Open Then
                conn7.Close()
            End If
            If conn1.State = ConnectionState.Open Then
                conn1.Close()
            End If
            If conn4.State = ConnectionState.Open Then
                conn4.Close()
            End If
            If Vrfc1 = vRF2 And vRF2 <> "" And Vrfc1 <> "" Then
                vlRFC = Trim(Vrfc1)
                Return True
            Else
                Return False
            End If
        Catch ex As Exception
            MsgBox(ex.Message.ToString)
            Return False
        End Try
    End Function
    Function VerificarRFCprovedorSAE(ByVal id_supplier As String, ByVal num_empresa As String) As Boolean
        Try
            '--------------------------------------------------------------------------------------
            Dim Str4 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn4 As New SqlConnection(Str4)
            Dim sql4 As String = "SELECT * FROM EmpresaSAE WHERE BASEDATOS = 'LogistikMasterValvulerias" + num_empresa + "'"
            Dim daBD As New SqlDataAdapter(sql4, conn4)
            Dim dsbd As New DataSet()
            daBD.Fill(dsbd, "EmpresaSAE")
            Dim oTabla4 As DataTable
            oTabla4 = dsbd.Tables("EmpresaSAE")
            Dim SERVIDOR2 As String = ""
            Dim USUARIO2 As String = ""
            Dim NOMBRE_BD2 As String = ""
            Dim PASSWROD2 As String = ""
            Dim BASEDATOS2 As String = ""
            'Dim VTIPO As String = ""
            If oTabla4.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla4.Rows
                    SERVIDOR2 = oFila.Item("SERVIDOR").ToString
                    BASEDATOS2 = oFila.Item("BASEDATOS").ToString
                    USUARIO2 = oFila.Item("USUARIO").ToString
                    PASSWROD2 = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD2 = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness2 = Mid(NOMBRE_BD2, LongitudBD)
            '--------------------------------------------------------------------------------------------
            Dim Str1 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD2 + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"

            'Dim Str1 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD2 + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn1 As New SqlConnection(Str1)
            Dim vRF2 As String = ""
            Dim reader2 As SqlDataReader
            sqllocal = "SELECT RFC FROM PROV" + nnBisness2.ToString + " WHERE CLAVE = '" + id_supplier + "'"
            cmd = New SqlCommand(sqllocal, conn1)
            conn1.Open()
            reader2 = cmd.ExecuteReader()
            While reader2.Read()
                vRF2 = reader2.Item(0).ToString
            End While
            reader2.Close()
            conn1.Close()
            '-------------------------------------------------------------------------------------
            '------------------------------------------------------------------------------------
            Dim Str7 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn7 As New SqlConnection(Str7)
            Dim sql As String = "SELECT * FROM EmpresaSAE WHERE TIPO = 'Almacen'"
            Dim dataadapterBD As New SqlDataAdapter(sql, conn7)
            Dim dsCargarbd As New DataSet()
            dataadapterBD.Fill(dsCargarbd, "EmpresaSAE")
            Dim oTabla7 As DataTable
            oTabla7 = dsCargarbd.Tables("EmpresaSAE")
            Dim SERVIDOR As String = ""
            Dim USUARIO As String = ""
            Dim NOMBRE_BD As String = ""
            Dim PASSWROD As String = ""
            Dim BASEDATOS As String = ""
            'Dim VTIPO As String = ""
            If oTabla7.Rows.Count >= 1 Then
                Dim oFila As DataRow
                For Each oFila In oTabla7.Rows
                    SERVIDOR = oFila.Item("SERVIDOR").ToString
                    BASEDATOS = oFila.Item("BASEDATOS").ToString
                    USUARIO = oFila.Item("USUARIO").ToString
                    PASSWROD = oFila.Item("PASSWROD").ToString
                    NOMBRE_BD = oFila.Item("NOMBRE_BD").ToString
                Next
            End If
            Dim nnBisness = Mid(NOMBRE_BD, LongitudBD)
            'vgEmpresa = NOMBRE_BD
            '------------------------------------------------------------------------------------
            Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"

            'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + NOMBRE_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            Dim conn2 As New SqlConnection(Str2)

            Dim Vrfc1 As String = ""
            Dim reader3 As SqlDataReader
            id_supplier = espacios(id_supplier, 10)
            sqllocal = "SELECT RFC FROM PROV" + nnBisness.ToString + " WHERE RFC = '" + vRF2 + "'"
            cmd = New SqlCommand(sqllocal, conn2)
            conn2.Open()
            reader3 = cmd.ExecuteReader()
            While reader3.Read()
                Vrfc1 = reader3.Item(0).ToString
            End While
            reader3.Close()
            conn2.Close()

            If Vrfc1 = vRF2 And vRF2 <> "" And Vrfc1 <> "" Then
                Return True
            Else
                Return False
            End If
        Catch ex As Exception
            MsgBox(ex.Message.ToString)
            Return False
        End Try

    End Function

#Region "ConfiguracionTerminal"
    Private Sub ConfigTerminal(ByVal pMiBD As String, ByVal pnumemp As String)
        Dim vlMascaraOrdenCompra As String = "0"
        Dim vlMascaraRecepcion As String = "0"
        Dim vlMascaraPedido As String = "0"
        Dim vlMascaraRemision As String = "0"
        Dim vlMultiAlmacen As String = "F"
        Dim vlInvNumDecimales As String = "0"
        Dim sql1 As String

        Try
            Dim Str As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
            Dim conn As New SqlConnection(Str)
            sqllocal = "SELECT TIPODOCTO, MASCARA FROM PARAM_FOLIOSC" & vgNumEmpresa.ToString
            Dim da As New SqlDataAdapter(sqllocal, conn)
            Dim ds As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da.Fill(ds, "PARAM_FOLIOSC" & vgNumEmpresa.ToString)
            Dim oTable As New DataTable
            oTable = ds.Tables("PARAM_FOLIOSC" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            Dim TIPODOCTO As String
            For Each oRow In oTable.Rows
                TIPODOCTO = oRow.Item("TIPODOCTO").ToString
                If TIPODOCTO = "O" Then
                    vlMascaraOrdenCompra = oRow.Item("MASCARA").ToString
                End If
                If TIPODOCTO = "R" Then
                    vlMascaraRecepcion = oRow.Item("MASCARA").ToString
                End If
            Next
            '---------------------------------------------------------------------------
            sqllocal = "SELECT TIPODOCTO, MASCARA FROM PARAM_FOLIOSF" & vgNumEmpresa.ToString
            Dim da1 As New SqlDataAdapter(sqllocal, conn)
            Dim ds1 As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            da1.Fill(ds1, "PARAM_FOLIOSF" & vgNumEmpresa.ToString)
            Dim oTable1 As New DataTable
            oTable1 = ds1.Tables("PARAM_FOLIOSF" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            For Each oRow In oTable1.Rows
                TIPODOCTO = oRow.Item("TIPODOCTO").ToString
                If TIPODOCTO = "P" Then
                    vlMascaraPedido = oRow.Item("MASCARA").ToString
                End If
                If TIPODOCTO = "R" Then
                    vlMascaraRemision = oRow.Item("MASCARA").ToString
                End If
            Next
            '----------------------------------------------------------------------------
            sqllocal = "SELECT MULTIALMACEN,NUMDECIMALES FROM PARAM_INVENTARIO" & vgNumEmpresa.ToString
            Dim dainv As New SqlDataAdapter(sqllocal, conn)
            Dim dsinv As New DataSet
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            dainv.Fill(dsinv, "PARAM_INVENTARIO" & vgNumEmpresa.ToString)
            Dim oTableinv As New DataTable
            oTableinv = dsinv.Tables("PARAM_INVENTARIO" & vgNumEmpresa.ToString)
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
            For Each oRow In oTableinv.Rows
                vlMultiAlmacen = oRow.Item("MULTIALMACEN").ToString
                vlInvNumDecimales = oRow.Item("NUMDECIMALES").ToString
            Next
            '++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            sql1 = "Update Logistik_Config_SAE SET MascaraOrdenCompra = '" + vlMascaraOrdenCompra + "'," +
            "MascaraRecepcion = '" + vlMascaraRecepcion + "', MascaraPedido = '" + vlMascaraPedido + "'," +
            "MascaraRemision = '" + vlMascaraRemision + "'," +
            "MultiAlmacen = '" + vlMultiAlmacen + "', InvNumDecimales = '" + vlInvNumDecimales + "'"
            EjecutarQuerySQL_EMPRESA(sql1)

            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Area de configuración: Correcta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
        Catch es As SqlException
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Area de configuración: InCorrecta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
            If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                Me.Dispose()
                'FrmLogin.Dispose()
            End If
        Catch ex As Exception
            empresa = vgEmpresa.ToString
            documento = ""
            mensaje = "Area de configuración: InCorrecta"
            sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
            empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','0')"
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            Me.Refresh()
        End Try
    End Sub
#End Region
    Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click
        'Dim msgconn As String = "Conexion1:"
        Try
            'Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
            'Dim conn As New SqlConnection(Str)
            'conn.Open()
            'conn.Close()
            'msgconn = msgconn + "Correcta, "
            'Dim conn2 As New SqlConnection("Data Source=" + My.Settings.vgCrearBD_IP2 + ";Initial Catalog=" + My.Settings.Ruta_SAE_FB + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";")
            'msgconn = msgconn + "Conexion2:"
            'If conn2.State = ConnectionState.Closed Then
            '    conn2.Open()
            'End If
            'msgconn = msgconn + "Correcta. "
            vlSyncCompleta = 1
            sqllocal = "UPDATE Logistik_Servidor_Status SET sincronizacion_completa=1"
            TextBox1.Text = "update Logistik_Servidor_Status"
            Me.Refresh()
            EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
            DesactivarOCPed = False
            Label5.Text = "Actualizando, esto puede tardar varios minutos..."
            Me.Refresh()
            'infocus 3d sin cable
            Sincronizar(sender, e)
        Catch ex As Exception
            Timer1.Enabled = False
            'Timer2.Enabled = False
            'Timer3.Enabled = False
            Timer4.Enabled = False
            MsgBox("Verificar el error en pantalla, porque se cerra la aplicación")
            Application.Exit()
        End Try
    End Sub

    Private Sub KardexDelProductoToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles KardexDelProductoToolStripMenuItem.Click
        'KardexProducto.ShowDialog()
    End Sub

    Private Sub DiferenciasDeAlmacenToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DiferenciasDeAlmacenToolStripMenuItem.Click
        'ReportExistAlm.ShowDialog()
    End Sub

    'Function SincronizarPedidosweb()

    '    'Remisiones web
    '    Try
    '        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass.ToString + ";"
    '        Dim conn As New SqlConnection(Str)
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        Dim sql As String = "SELECT id_pedido,id_cliente,direccion_entrega,comentarios,id_estado" + _
    '        ",total_pedido,no_guia,paqueteria,dto_manual_yazbek,dto_aplicado_yazbek" + _
    '        ",dto_manual_mayork,dto_aplicado_mayork,dto_manual_otros,dto_aplicado_otros,total_prod_yazbek" + _
    '        ",total_prod_otros,zona_acomodo,clasificacion,factura,id_lista_yazbek_usada" + _
    '        ",id_lista_otros_usada,id_u_levanto_pedido,fecha_u_levanto_pedido,id_usuario_a_atorizacion,fecha_a_atorizacion" + _
    '        ",id_usuario_a_surtido,fecha_a_surtido,tiempo_para_surtido,id_usuario_t_para_surtido,fecha_t_para_surtido" + _
    '        ",id_usuario_inicio_surtido,fecha_inicio_surtido,id_usuario_a_facturacion,fecha_a_facturacion,id_usuario_a_entrega" + _
    '        ",fecha_a_entrega,id_usuario_entregado,fecha_entregado,id_usuario_cancelacion,fecha_cancelacion" + _
    '        ",id_usuario_autoriza_dto,fecha_autoriza_dto,id_apartado,forma_de_pago,metodo_de_pago" + _
    '        ",uso_de_cfdi,remision FROM wLogistik_Pedidos WHERE id_estado='5' AND EnviadaSAE='N'"
    '        Dim dataadapter As New SqlDataAdapter(sql, conn)
    '        Dim dsCargarEncabezado As New DataSet()
    '        dataadapter.Fill(dsCargarEncabezado, "wLogistik_Pedidos")
    '        oTabla = dsCargarEncabezado.Tables("wLogistik_Pedidos")
    '        Dim id_pedido As String = ""
    '        Dim OrdenVenta As String = ""
    '        Dim TIP_DOC As String
    '        Dim CVE_DOC As String
    '        Dim CVE_CLPV As String
    '        Dim STATUS As String
    '        Dim DAT_MOSTR As String
    '        Dim CVE_VEND As String
    '        Dim CVE_PEDI As String
    '        Dim FECHA_DOC As String
    '        Dim FECHA_ENT As String
    '        Dim FECHA_VEN As String
    '        Dim FECHA_CANCELA As String
    '        Dim CAN_TOT As String
    '        Dim IMP_TOT1 As String
    '        Dim IMP_TOT2 As String
    '        Dim IMP_TOT3 As String
    '        Dim IMP_TOT4 As String
    '        Dim DES_TOT As String
    '        Dim DES_FIN As String
    '        Dim COM_TOT As String
    '        Dim CONDICION As String
    '        Dim CVE_OBS As String
    '        Dim NUM_ALMA As String
    '        Dim ACT_CXC As String
    '        Dim ACT_COI As String
    '        Dim ENLAZADO As String
    '        Dim TIP_DOC_E As String
    '        Dim NUM_MONED As String
    '        Dim TIPCAMB As String
    '        Dim NUM_PAGOS As String
    '        Dim FECHAELAB As String
    '        Dim PRIMERPAGO As String
    '        Dim RFC As String
    '        Dim CTLPOL As String
    '        Dim ESCFD As String
    '        Dim AUTORIZA As String
    '        Dim SERIE As String
    '        Dim FOLIO As String
    '        Dim AUTOANIO As String
    '        Dim DAT_ENVIO As String
    '        Dim CONTADO As String
    '        Dim CVE_BITA As String
    '        Dim BLOQ As String
    '        Dim FORMAENVIO As String
    '        Dim DES_FIN_PORC As String
    '        Dim DES_TOT_PORC As String
    '        Dim IMPORTE As String
    '        Dim COM_TOT_PORC As String
    '        Dim METODODEPAGO As String
    '        Dim NUMCTAPAGO As String
    '        Dim TIP_DOC_ANT As String
    '        Dim DOC_ANT As String
    '        Dim TIP_DOC_SIG As String
    '        Dim DOC_SIG As String
    '        Dim oRow As DataRow
    '        For Each oRow In oTabla.Rows
    '            id_pedido = oRow.Item("id_pedido").ToString
    '            OrdenVenta = oRow.Item("id_pedido").ToString
    '            'agregar ceros
    '            OrdenVenta = ceros(OrdenVenta, 10)
    '            'agregar espacios
    '            OrdenVenta = espacios(OrdenVenta, 20)
    '            Dim vCveDoc As String = ""
    '            TIP_DOC = "R"
    '            'SigCveDoc = TraerCveDocSigRecep()
    '            'CVE_DOC = SigCveDoc
    '            CVE_DOC = OrdenVenta
    '            'clave cte 10 espacios
    '            CVE_CLPV = oRow.Item("id_cliente").ToString
    '            'O=orginal
    '            STATUS = "O"
    '            '0
    '            DAT_MOSTR = "0"
    '            'null
    '            CVE_VEND = ""
    '            'null
    '            CVE_PEDI = ""
    '            FECHA_DOC = vfechayhora.ToString("yyyy/MM/dd HH:mm:ss")
    '            'If FECHA_DOC <> "" Then
    '            '    FECHA_DOC = Convert.ToDateTime(FECHA_DOC).ToString("dd/MM/yyyy")
    '            'End If
    '            FECHA_ENT = vfechayhora.ToString("yyyy/MM/dd HH:mm:ss")
    '            'If FECHA_ENT <> "" Then
    '            '    FECHA_ENT = Convert.ToDateTime(FECHA_ENT).ToString("dd/MM/yyyy")
    '            'End If
    '            FECHA_VEN = vfechayhora.ToString("yyyy/MM/dd HH:mm:ss")
    '            'If FECHA_VEN <> "" Then
    '            '    FECHA_VEN = Convert.ToDateTime(FECHA_VEN).ToString("dd/MM/yyyy")
    '            'End If
    '            FECHA_CANCELA = vfechayhora.ToString("yyyy/MM/dd HH:mm:ss")
    '            'If FECHA_CANCELA <> "" Then
    '            '    FECHA_CANCELA = Convert.ToDateTime(FECHA_CANCELA).ToString("dd/MM/yyyy")
    '            'End If
    '            'importe
    '            CAN_TOT = oRow.Item("total_pedido").ToString
    '            IMP_TOT1 = "0"
    '            IMP_TOT2 = "0"
    '            IMP_TOT3 = "0"
    '            Dim iva As Double = Convert.ToDouble(CAN_TOT) * 0.16
    '            'iva
    '            IMP_TOT4 = iva.ToString
    '            'DESCUENTO
    '            DES_TOT = "0"
    '            DES_FIN = "0"

    '            COM_TOT = "0"
    '            CONDICION = ""
    '            CVE_OBS = "0"
    '            NUM_ALMA = "1"
    '            ACT_CXC = "S"
    '            ACT_COI = "N"
    '            ENLAZADO = "O"
    '            TIP_DOC_E = "O"

    '            NUM_MONED = "1"
    '            TIPCAMB = "1"
    '            NUM_PAGOS = "1"

    '            FECHAELAB = vfechayhora.ToString("yyyy/MM/dd HH:mm:ss")
    '            'If FECHAELAB <> "" Then
    '            '    FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("dd/MM/yyyy hh:mm:ss tt")
    '            '    'FECHAELAB = Convert.ToDateTime(FECHAELAB).ToString("dd-MM-yyyy hh:mm:ss.mmm")
    '            'End If
    '            PRIMERPAGO = "0"
    '            'traerlo de sae
    '            'RFC = oRow.Item("RFC").ToString
    '            Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '            Dim SqlA As String = "SELECT RFC FROM CLIE" + vgNumEmpresa.ToString + _
    '            " WHERE  TRIM(CLAVE) = '" + CVE_CLPV + "'"
    '            Dim da7 As New FbDataAdapter(SqlA, connFB)
    '            Dim ds7 As New DataSet
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            da7.Fill(ds7, "CLIENTES" & vgNumEmpresa.ToString)
    '            Dim oTable As New DataTable
    '            oTable = ds7.Tables("CLIENTES" & vgNumEmpresa.ToString)
    '            If connFB.State = ConnectionState.Open Then
    '                connFB.Close()
    '            End If

    '            If oTable.Rows.Count >= 1 Then
    '                For Each oRow55 In oTable.Rows
    '                    RFC = oRow55.Item("RFC").ToString
    '                Next
    '            End If
    '            '----------------------------
    '            CVE_CLPV = espacios(CVE_CLPV, 10)
    '            CTLPOL = "0"
    '            ESCFD = "N"
    '            AUTORIZA = "1"
    '            '---------------------traer del sae
    '            SERIE = ""
    '            FOLIO = Nothing
    '            SqlA = "Select MASCARA FROM PARAM_FOLIOSF" + vgNumEmpresa.ToString + _
    '            " WHERE NUM_EMP = '1' AND TIPODOCTO = 'R'"
    '            Dim da77 As New FbDataAdapter(SqlA, connFB)
    '            Dim ds77 As New DataSet
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            da77.Fill(ds77, "PARAM_FOLIOSF" & vgNumEmpresa.ToString)
    '            Dim oTable77 As New DataTable
    '            oTable77 = ds77.Tables("PARAM_FOLIOSF" & vgNumEmpresa.ToString)
    '            If connFB.State = ConnectionState.Open Then
    '                connFB.Close()
    '            End If

    '            If oTable77.Rows.Count >= 1 Then
    '                For Each oRow77 In oTable77.Rows
    '                    FOLIO = oRow77.Item("MASCARA").ToString
    '                Next
    '            End If
    '            If FOLIO = "" Then
    '                MsgBox("Configure la mascara de la clave del documento")
    '                Exit Function
    '            End If
    '            '---------------------------------------------------
    '            AUTOANIO = ""
    '            DAT_ENVIO = "1"
    '            CONTADO = "N"
    '            CVE_BITA = "2"
    '            BLOQ = "N"
    '            FORMAENVIO = ""
    '            'descuentos
    '            DES_FIN_PORC = "0"
    '            DES_TOT_PORC = "0"
    '            'subtotal + iva
    '            Dim importetot As Double = Convert.ToDouble(CAN_TOT) + iva
    '            IMPORTE = importetot.ToString.ToString
    '            COM_TOT_PORC = "0"
    '            METODODEPAGO = ""
    '            NUMCTAPAGO = ""
    '            TIP_DOC_ANT = ""
    '            DOC_ANT = ""
    '            TIP_DOC_SIG = Nothing
    '            DOC_SIG = Nothing
    '            'vCveDoc = BuscarClaveDoc()
    '            '----------------buscar clave del documento
    '            Dim vcont As String = ""
    '            Dim vnum As Integer
    '            SqlA = "Select COALESCE(max(CLAVE_DOC),1) AS num FROM FACTR_CLIB" + vgNumEmpresa.ToString
    '            Dim da55 As New FbDataAdapter(SqlA, connFB)
    '            Dim ds55 As New DataSet
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            da55.Fill(ds55, "FACTR_CLIB" & vgNumEmpresa.ToString)
    '            Dim oTable55 As New DataTable
    '            oTable55 = ds55.Tables("FACTR_CLIB" & vgNumEmpresa.ToString)
    '            'If connFB.State = ConnectionState.Open Then
    '            '    connFB.Close()
    '            'End If

    '            If oTable55.Rows.Count >= 1 Then
    '                For Each oRow55 In oTable55.Rows
    '                    vcont = oRow55.Item("num").ToString
    '                    'Convertir a numero y 'aumentar mas uno
    '                    vnum = Val(vcont) + 1
    '                    'agregar ceros
    '                    vcont = ceros(vnum, 10)
    '                    'agregar espacios
    '                    vcont = espacios(vcont, 20)
    '                    'regresar valor
    '                    'Me.TextBox1.Text = vcont
    '                    vCveDoc = vcont
    '                Next
    '            End If
    '            'Dim reader As FbDataReader
    '            'SqlA = "Select ISNULL(max(CLAVE_DOC),1) AS num FROM FACTR_CLIB" + vgNumEmpresa.ToString
    '            'cmdFB = New FbCommand(SqlA, connFB)
    '            'If connFB.State = ConnectionState.Closed Then
    '            '    connFB.Open()
    '            'End If
    '            ''objTransFB = connFB.BeginTransaction()
    '            'reader = cmdFB.ExecuteReader()
    '            'While reader.Read()
    '            '    'MsgBox(reader.Item(0))
    '            '    vcont = reader.Item(0).ToString
    '            '    'Convertir a numero y 'aumentar mas uno
    '            '    vnum = Val(vcont) + 1
    '            '    'agregar ceros
    '            '    vcont = ceros(vnum, 10)
    '            '    'agregar espacios
    '            '    vcont = espacios(vcont, 20)
    '            '    'regresar valor
    '            '    'Me.TextBox1.Text = vcont
    '            '    vCveDoc = vcont
    '            'End While
    '            'reader.Close()
    '            ''cmd.Dispose()
    '            '---------------------------------------------------
    '            objTransFB = connFB.BeginTransaction()
    '            If vCveDoc <> "" Then
    '                If DOC_ANT <> "" Then
    '                    DOC_ANT = ceros(DOC_ANT, 10)
    '                    DOC_ANT = espacios(DOC_ANT, 20)
    '                End If
    '                sqllocal = "insert into FACTR" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, CVE_CLPV, STATUS, DAT_MOSTR" + _
    '                ",CVE_VEND,CVE_PEDI,FECHA_DOC,FECHA_ENT,FECHA_VEN" + _
    '                ",FECHA_CANCELA,CAN_TOT,IMP_TOT1,IMP_TOT2,IMP_TOT3" + _
    '                ",IMP_TOT4,DES_TOT,DES_FIN,COM_TOT,CONDICION" + _
    '                ",CVE_OBS,NUM_ALMA,ACT_CXC,ACT_COI,ENLAZADO" + _
    '                ",TIP_DOC_E,NUM_MONED,TIPCAMB,NUM_PAGOS,FECHAELAB" + _
    '                ",PRIMERPAGO,RFC,CTLPOL,ESCFD,AUTORIZA" + _
    '                ",SERIE,FOLIO,AUTOANIO,DAT_ENVIO,CONTADO" + _
    '                ",CVE_BITA,BLOQ,FORMAENVIO,DES_FIN_PORC,DES_TOT_PORC" + _
    '                ",IMPORTE,COM_TOT_PORC,METODODEPAGO,NUMCTAPAGO,TIP_DOC_ANT" + _
    '                ",DOC_ANT,TIP_DOC_SIG,DOC_SIG) values (" + _
    '                "'R','" + vCveDoc + "','" + CVE_CLPV + "','" + STATUS + "','" + DAT_MOSTR + "','" + _
    '                CVE_VEND + "','" + CVE_PEDI + "','" + FECHA_DOC + "','" + FECHA_ENT + "','" + FECHA_VEN + "','" + _
    '                FECHA_CANCELA + "','" + CAN_TOT + "','" + IMP_TOT1 + "','" + IMP_TOT2 + "','" + IMP_TOT3 + "','" + _
    '                IMP_TOT4 + "','" + DES_TOT + "','" + DES_FIN + "','" + COM_TOT + "','" + CONDICION + "','" + _
    '                CVE_OBS + "','" + NUM_ALMA + "','" + ACT_CXC + "','" + ACT_COI + "','" + ENLAZADO + "','" + _
    '                "O','" + NUM_MONED + "','" + TIPCAMB + "','" + NUM_PAGOS + "','" + FECHAELAB + "','" + _
    '                PRIMERPAGO + "','" + RFC + "','" + CTLPOL + "','" + ESCFD + "','" + AUTORIZA + "','" + _
    '                SERIE + "','" + vCveDoc + "','" + AUTOANIO + "','" + DAT_ENVIO + "','" + CONTADO + "','" + _
    '                CVE_BITA + "','" + BLOQ + "','" + FORMAENVIO + "','" + DES_FIN_PORC + "','" + DES_TOT_PORC + "','" + _
    '                IMPORTE + "','" + COM_TOT_PORC + "','" + METODODEPAGO + "','" + NUMCTAPAGO + "','" + TIP_DOC_ANT + "','" + _
    '                DOC_ANT + "','" + TIP_DOC_SIG + "','" + DOC_SIG + "')"

    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()

    '                sqllocal = "insert into FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC) values ('" + vCveDoc + "')"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()

    '                sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 32"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '                '---------------------
    '                'Dim vCve_Obs As String = TraerClaveSiguiente()
    '                Dim vCve_Obs As String
    '                Dim vcont7 As String = ""
    '                Dim reader7 As FbDataReader
    '                sqllocal = "Select COALESCE(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                reader7 = cmdFB.ExecuteReader()
    '                While reader7.Read()
    '                    'MsgBox(reader7.Item(0))
    '                    vcont7 = reader7.Item(0).ToString
    '                    vcont7 = Val(vcont7) + 1
    '                End While
    '                If vcont7 = "" Then vcont7 = "1"
    '                vCve_Obs = vcont7
    '                reader7.Close()
    '                '-----------------------------------
    '                Dim vObser As String = "Buenas Remisión HH"
    '                sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + vCve_Obs + "','" + vObser + "')"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '                'Call UpdateOC(CVE_DOC, vCveDoc)
    '                'sqllocal = "update FACTP" + vgNumEmpresa.ToString + " SET ENLAZADO='T', TIP_DOC_E='R', TIP_DOC_SIG='R', DOC_SIG='" + vCveDoc + "'" + _
    '                '" WHERE CVE_DOC ='" + CVE_DOC + "'"
    '                'cmd = New SqlCommand(sqllocal, connSAE, objTrans)
    '                'cmd.ExecuteNonQuery()
    '                '-------------------------------------------------------------------------------------------------------------
    '                'FALTANTES DEFINIR EL ALMACEN detalle del pedido, update fecha_cancelacion=null, agregar datos a los campos UUID Y VERSION_SINC
    '                Call RemisionesDatalleSAEFBweb(id_pedido, vCveDoc, vObser, CVE_DOC, CVE_VEND, NUM_ALMA, CVE_CLPV)
    '                '-------------------------------------------------------------------------------------------------------------
    '                objTransFB.Commit()
    '                '------------------------
    '            End If
    '            OrdenVenta = Val(OrdenVenta)
    '            Dim sql1 As String = "update wLogistik_Pedidos SET EnviadaSAE = 'S'" + _
    '            " WHERE id_pedido = '" + OrdenVenta + "'"
    '            EjecutarQuerySQL(sql1)
    '        Next
    '        'MsgBox("Almacenado correctamente")
    '    Catch es As SqlException
    '        objTrans.Rollback()
    '        Throw es
    '    Catch ex As Exception
    '        '***** rollback the transaction ************************************************'
    '        objTrans.Rollback()
    '        MsgBox(ex.Message.ToString)
    '    End Try
    'End Function
    'Function RemisionesDatalleSAEFBweb(ByVal pIdPedido As String, ByVal pcvedoc As String, ByVal pObser As String, ByVal pcve_doc_origen As String, ByVal VEND As String, ByVal pAlmacen As String, ByVal pCve_Cliente As String)
    '    'envia datos al sae
    '    Dim SqlSelection As String
    '    Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + MI_BD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
    '    Dim conn As New SqlConnection(Str)
    '    Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '    Try

    '        Dim CVE_DOC As String
    '        Dim NUM_PAR As Integer = 1
    '        Dim CVE_ART As String
    '        Dim vlsubtotal As Double
    '        Dim CANT As Double
    '        Dim CANTp As Double
    '        Dim PXS As String
    '        Dim PREC As String
    '        Dim COST As String
    '        Dim IMPU1 As String
    '        Dim IMPU2 As String
    '        Dim IMPU3 As String
    '        Dim IMPU4 As String
    '        Dim IMP1APLA As String
    '        Dim IMP2APLA As String
    '        Dim IMP3APLA As String
    '        Dim IMP4APLA As String
    '        Dim TOTIMP1 As String
    '        Dim TOTIMP2 As String
    '        Dim TOTIMP3 As String
    '        Dim TOTIMP4 As String
    '        Dim DESC1 As String
    '        Dim DESC2 As String
    '        Dim DESC3 As String
    '        Dim COMI As String
    '        Dim APAR As String
    '        Dim ACT_INV As String
    '        Dim NUM_ALM As String = pAlmacen
    '        Dim POLIT_APLI As String
    '        Dim TIP_CAM As String
    '        Dim UNI_VENTA As String
    '        Dim TIPO_PROD As String
    '        Dim CVE_OBS As String
    '        Dim REG_SERIE As String
    '        Dim E_LTPD As String
    '        Dim TIPO_ELEM As String
    '        Dim NUM_MOV As String
    '        Dim TOT_PARTIDA As String
    '        Dim IMPRIMIR As String
    '        If conn.State = ConnectionState.Closed Then
    '            conn.Open()
    '        End If
    '        Dim reader2 As SqlDataReader
    '        SqlSelection = "SELECT id_pedido_detalle,id_pedido,codigo_producto,precio_unitario,cantidad" + _
    '        ",total_partida,back_order FROM wLogistik_Pedidos_Detalle WHERE id_pedido ='" + pIdPedido + "'"
    '        cmd = New SqlCommand(SqlSelection, conn)
    '        reader2 = cmd.ExecuteReader()
    '        'If conn.State = ConnectionState.Open Then
    '        '    conn.Close()
    '        'End If
    '        ' esta variable controla el consecutivo de las series
    '        Dim mREG_SERIE As String
    '        ' esta variable controla una sola entrada al ciclo de las series
    '        Dim vlMaxNum As Boolean = True
    '        '--------------------------------------
    '        '---------------------------------------
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        objTransFB = connFB.BeginTransaction()
    '        '--------------------------------------
    '        '-------------------------------------------
    '        While reader2.Read()

    '            CVE_DOC = pcvedoc
    '            CVE_ART = reader2.Item(2).ToString
    '            PREC = reader2.Item(3).ToString
    '            CANTp = reader2.Item(4).ToString
    '            CANT = reader2.Item(4).ToString
    '            PXS = reader2.Item(4).ToString

    '            COST = "0"
    '            IMPU1 = "0"
    '            IMPU2 = "0"
    '            IMPU3 = "0"

    '            IMPU4 = "16"
    '            IMP1APLA = "0"
    '            IMP2APLA = "0"
    '            IMP3APLA = "0"
    '            IMP4APLA = "0"
    '            TOTIMP1 = "0"
    '            TOTIMP2 = "0"
    '            TOTIMP3 = "0"
    '            'iva
    '            TOTIMP4 = "16"
    '            DESC1 = "0"
    '            DESC2 = "0"
    '            DESC3 = "0"
    '            COMI = "0"
    '            APAR = "0"
    '            ACT_INV = "S"
    '            POLIT_APLI = ""
    '            TIP_CAM = "1"
    '            UNI_VENTA = "pz"
    '            TIPO_PROD = "P"

    '            CVE_OBS = "0"
    '            REG_SERIE = "0"
    '            'tiene lotes
    '            E_LTPD = "0"
    '            TIPO_ELEM = "N"
    '            'consecutivo

    '            'NUM_MOV = reader2.Item(34).ToString
    '            'cantidad por pecio
    '            TOT_PARTIDA = Convert.ToDouble(PREC) * Convert.ToDouble(CANTp)
    '            IMPRIMIR = ""
    '            Dim Sql As String
    '            '-------------------Traer la clave siguiente
    '            ''CVE_OBS = TraerClaveSiguiente()
    '            'Dim vcont As String = ""
    '            ''Dim vnum As Integer
    '            'Dim reader As FbDataReader
    '            'Dim Sql As String = "Select coalesce(max(CVE_OBS),1) AS num FROM OBS_DOCF" + vgNumEmpresa.ToString
    '            'cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            'reader = cmdFB.ExecuteReader()
    '            'While reader.Read()
    '            '    'MsgBox(reader.Item(0))
    '            '    vcont = reader.Item(0).ToString
    '            '    vcont = Val(vcont) + 1
    '            'End While
    '            'If vcont = "" Then vcont = "1"
    '            'CVE_OBS = vcont
    '            'reader.Close()

    '            'sqllocal = "INSERT INTO OBS_DOCF" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            '---------------------crear el o los movimientos
    '            'Dim vNum_Mov As String = ConsecutivoMovimiento()
    '            Dim vNum_Mov As String
    '            Dim vcont7 As String = ""
    '            Dim reader7 As FbDataReader
    '            Sql = "Select coalesce(max(NUM_MOV),1) AS num FROM MINVE" + vgNumEmpresa.ToString
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            reader7 = cmdFB.ExecuteReader()
    '            While reader7.Read()
    '                'MsgBox(reader7.Item(0))
    '                vcont7 = reader7.Item(0).ToString
    '                vcont7 = Val(vcont7) + 1
    '            End While
    '            If vcont7 = "" Then vcont7 = "1"
    '            vNum_Mov = vcont7
    '            reader7.Close()
    '            '----------tiene pedimento y numero de serie
    '            Dim vlPedimento As String = "N"
    '            Dim vlNumSer As String = "N"
    '            'Dim readerPedi As SqlDataReader
    '            'SqlSelection = "SELECT Pedimento, NumSerie FROM Logistik_product" + _
    '            '" WHERE upc = '" + CVE_ART + "'"
    '            'conn.Open()
    '            'cmd = New SqlCommand(SqlSelection, conn)
    '            'readerPedi = cmd.ExecuteReader()
    '            'While readerPedi.Read()
    '            '    vlPedimento = readerPedi.Item(0)
    '            '    vlNumSer = readerPedi.Item(1)
    '            'End While
    '            'conn.Close()
    '            'readerPedi.Close()
    '            If vlNumSer = "S" Then
    '                '--------------------------------------------------------------
    '                'BEGIN UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE, una o varias series
    '                '---------------------------------------------------------------
    '                '--------------------------H NUMEROS DE SERIE
    '                If vlMaxNum = True Then
    '                    Dim readerNumSerie3 As FbDataReader
    '                    SqlSelection = "SELECT MAX(REG_SERIE) AS NUM  FROM HNUMSER" + vgNumEmpresa.ToString '+ _
    '                    '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                    If connFB.State = ConnectionState.Closed Then
    '                        connFB.Open()
    '                    End If
    '                    cmdFB = New FbCommand(SqlSelection, connFB, objTransFB)
    '                    readerNumSerie3 = cmdFB.ExecuteReader()
    '                    While readerNumSerie3.Read()
    '                        mREG_SERIE = readerNumSerie3.Item(0).ToString
    '                        mREG_SERIE = Val(mREG_SERIE) + 1
    '                    End While
    '                    'If connFB.State = ConnectionState.Open Then
    '                    '    connFB.Close()
    '                    'End If
    '                    readerNumSerie3.Close()
    '                    vlMaxNum = False
    '                End If
    '                '---------------------------------------------------
    '                Dim nNUM_SER As String
    '                Dim nCOSTO As String
    '                Dim nDOCTO_ENT As String
    '                Dim nFECHA_ENT As String
    '                Dim nREG_SERIE As String
    '                Dim readerNumSerie As SqlDataReader
    '                'SqlSelection = "SELECT NUM_SER, COSTO, DOCTO_ENT, FECHA_ENT" + _
    '                '" FROM Logistik_numeros_series" + _
    '                '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                '" and CVE_DOC_SQL ='" + (Val(pcve_doc_origen)).ToString + "' and STATUS ='M'"
    '                SqlSelection = "SELECT ns.NUM_SER, ns.COSTO, ns.DOCTO_ENT, ns.FECHA_ENT, h.REG_SERIE" + _
    '                " FROM Logistik_numeros_series ns, Logistik_Hnumeros_series h" + _
    '                " WHERE h.ALMACEN = ns.ALMACEN And h.CVE_ART = ns.CVE_ART And h.NUM_SER = ns.NUM_SER" + _
    '                " and ns.ALMACEN = '" + Trim(NUM_ALM) + "' and ns.CVE_ART = '" + CVE_ART + _
    '                "' and ns.CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and ns.STATUS ='M'"
    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If

    '                cmd = New SqlCommand(SqlSelection, conn)
    '                readerNumSerie = cmd.ExecuteReader()
    '                If connFB.State = ConnectionState.Closed Then
    '                    connFB.Open()
    '                End If
    '                While readerNumSerie.Read()
    '                    Dim NumSer_Cve_Doc As String = Trim(pcve_doc_origen.ToString)
    '                    'NumSer_Cve_Doc = espacios(NumSer_Cve_Doc, 20)
    '                    nNUM_SER = readerNumSerie.Item(0).ToString
    '                    nCOSTO = readerNumSerie.Item(1).ToString
    '                    nDOCTO_ENT = readerNumSerie.Item(2).ToString
    '                    nFECHA_ENT = readerNumSerie.Item(3).ToString
    '                    nREG_SERIE = readerNumSerie.Item(4).ToString
    '                    If nFECHA_ENT <> "" Then
    '                        nFECHA_ENT = Convert.ToDateTime(nFECHA_ENT).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If

    '                    sqllocal = "UPDATE NUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', COSTO = '" + nCOSTO + "', " + _
    '                    "DOCTO_ENT = '" + NumSer_Cve_Doc + "', FECHA_ENT = '" + nFECHA_ENT + "'" + _
    '                    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()

    '                    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V'," + _
    '                    "TIP_MOV = '51', CVE_DOC ='" + NumSer_Cve_Doc + "', REG_SERIE = '" + mREG_SERIE + "'" + _
    '                   " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
    '                   "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" ' AND REG_SERIE = '" + nREG_SERIE + "'"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()

    '                    ''--------------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                    'sqllocal = "UPDATE Logistik_numeros_series SET STATUS = 'V'" + _
    '                    '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                    '" and CVE_DOC_SQL ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'" + _
    '                    '" AND NUM_SER ='" + nNUM_SER + "'"
    '                    'cmd = New SqlCommand(sqllocal, conn)
    '                    'cmd.ExecuteNonQuery()

    '                End While
    '                If conn.State = ConnectionState.Open Then
    '                    conn.Close()
    '                End If
    '                readerNumSerie.Close()
    '                '--------------------------H NUMEROS DE SERIE
    '                'Dim nREG_SERIE As String
    '                'Dim readerNumSerie3 As SqlDataReader
    '                'SqlSelection = "SELECT NUM_SER, REG_SERIE" + _
    '                '" FROM Logistik_Hnumeros_series" + _
    '                '" WHERE ALMACEN = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'"
    '                'conn.Open()
    '                'cmd = New SqlCommand(SqlSelection, conn)
    '                'readerNumSerie3 = cmd.ExecuteReader()
    '                'While readerNumSerie3.Read()
    '                '    nNUM_SER = readerNumSerie3.Item(0).ToString
    '                '    nREG_SERIE = readerNumSerie3.Item(1).ToString
    '                '    sqllocal = "UPDATE HNUMSER" + vgNumEmpresa.ToString + " SET STATUS = 'V', TIP_MOV = '51', CVE_DOC ='" + pcve_doc_origen.ToString + "'" + _
    '                '    " WHERE CVE_ART = '" + CVE_ART + "' AND NUM_SER = '" + nNUM_SER + _
    '                '    "' AND ALMACEN = '" + NUM_ALM + "' AND REG_SERIE = '" + nREG_SERIE + "'"
    '                '    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                '    cmdFB.ExecuteNonQuery()
    '                'End While
    '                'conn.Close()
    '                'readerNumSerie3.Close()
    '                '--------------------------------------------------------------
    '                'END UN CLICO PARA MODIFICAR LOS NUMEROS DE SERIE
    '                '--------------------------------------------------------------
    '            End If
    '            If vlPedimento = "S" Then


    '                '---------------------------------------------------------------
    '                'BEGIN INSERTAR PEDIMENTOS 1 pedimento por partida
    '                '---------------------------------------------------------------
    '                '---- extraer el consecutivo REG_LTPD de SAE
    '                Dim pREG_LTPD As String
    '                'Dim readerMAx As FbDataReader
    '                'sqllocal = "Select coalesce(max(REG_LTPD),1) AS num FROM LTPD" + vgNumEmpresa.ToString
    '                'If connFB.State = ConnectionState.Closed Then
    '                '    connFB.Open()
    '                'End If
    '                'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                'readerMAx = cmdFB.ExecuteReader()
    '                'While readerMAx.Read()
    '                '    'MsgBox(reader7.Item(0))
    '                '    pREG_LTPD = readerMAx.Item(0).ToString
    '                '    pREG_LTPD = Val(pREG_LTPD) + 1
    '                'End While
    '                'If pREG_LTPD = "" Then pREG_LTPD = "1"
    '                'readerMAx.Close()
    '                '---EXTRAER DATOS DEL SQL
    '                Dim pLOTE As String
    '                Dim pPEDIMENTO As String
    '                Dim pFCHCADUC As String
    '                Dim pFCHADUANA As String
    '                Dim pFCHULTMOV As String
    '                Dim pNOM_ADUAN As String
    '                Dim pCANTIDAD As Double
    '                Dim pCVE_OBS As String
    '                Dim pCIUDAD As String
    '                Dim pFRONTERA As String
    '                Dim pFEC_PROD_LT As String
    '                Dim pGLN As String
    '                Dim pSTATUS As String
    '                'Dim readerPedimento As SqlDataReader
    '                'SqlSelection = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                '"STATUS, REG_LTPD  FROM Logistik_Lote_Pedimento" + _
    '                '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                '"' and CVE_DOC ='" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='M'"
    '                'If conn.State = ConnectionState.Closed Then
    '                '    conn.Open()
    '                'End If
    '                'cmd = New SqlCommand(SqlSelection, conn)
    '                'readerPedimento = cmd.ExecuteReader()
    '                Dim readerPedimento As FbDataReader
    '                Sql = "SELECT LOTE ,PEDIMENTO, FCHCADUC," + _
    '                "FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD," + _
    '                "CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                "STATUS, REG_LTPD  FROM LTPD" + vgNumEmpresa.ToString + _
    '                " WHERE CVE_ALM = '" + Trim(NUM_ALM) + "' and CVE_ART = '" + CVE_ART + "'" + _
    '                " and CANTIDAD > '0'"
    '                'If conn.State = ConnectionState.Closed Then
    '                '    conn.Open()
    '                'End If
    '                'cmd = New SqlCommand(SqlSelection, conn)
    '                'readerPedimento = cmd.ExecuteReader()
    '                cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '                readerPedimento = cmdFB.ExecuteReader()
    '                Dim vvCantFaltante As Double = CANT
    '                While readerPedimento.Read()
    '                    pLOTE = readerPedimento.Item(0).ToString
    '                    pPEDIMENTO = readerPedimento.Item(1).ToString
    '                    pFCHCADUC = readerPedimento.Item(2).ToString
    '                    pFCHADUANA = readerPedimento.Item(3).ToString
    '                    pFCHULTMOV = readerPedimento.Item(4).ToString
    '                    pNOM_ADUAN = readerPedimento.Item(5).ToString
    '                    pCANTIDAD = Convert.ToDouble(readerPedimento.Item(6).ToString)
    '                    pCVE_OBS = readerPedimento.Item(7).ToString
    '                    pCIUDAD = readerPedimento.Item(8).ToString
    '                    pFRONTERA = readerPedimento.Item(9).ToString
    '                    pFEC_PROD_LT = readerPedimento.Item(10).ToString
    '                    pGLN = readerPedimento.Item(11).ToString
    '                    pSTATUS = readerPedimento.Item(12).ToString
    '                    pREG_LTPD = readerPedimento.Item(13).ToString

    '                    If pFCHCADUC <> "" Then
    '                        pFCHCADUC = Convert.ToDateTime(pFCHCADUC).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFCHADUANA <> "" Then
    '                        pFCHADUANA = Convert.ToDateTime(pFCHADUANA).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFCHULTMOV <> "" Then
    '                        pFCHULTMOV = Convert.ToDateTime(pFCHULTMOV).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If
    '                    If pFEC_PROD_LT <> "" Then
    '                        pFEC_PROD_LT = Convert.ToDateTime(pFEC_PROD_LT).ToString("yyyy/MM/dd hh:mm:ss")
    '                    End If

    '                    '------------------INSERTAR PEDIMENTOS EN SAE
    '                    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 70"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 67"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()

    '                    'sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = '" + pCANTIDAD.ToString + "'" + _
    '                    '" WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                    '" AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()

    '                    If pCANTIDAD >= vvCantFaltante Then
    '                        sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + vvCantFaltante.ToString + _
    '                        " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                    Else
    '                        sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + pCANTIDAD.ToString + _
    '                        " WHERE PEDIMENTO = '" + pPEDIMENTO + "' AND REG_LTPD = '" + pREG_LTPD + "'" + _
    '                        " AND CVE_ALM = '" + Trim(NUM_ALM.ToString) + "'"
    '                        cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                        cmdFB.ExecuteNonQuery()
    '                        '9 >= 10
    '                        '10 - 9 = 1
    '                        vvCantFaltante = CANT - pCANTIDAD
    '                    End If

    '                    'sqllocal = "INSERT INTO LTPD" + vgNumEmpresa.ToString + "(CVE_ART, LOTE, PEDIMENTO, CVE_ALM, FCHCADUC," + _
    '                    '"FCHADUANA, FCHULTMOV, NOM_ADUAN, CANTIDAD, REG_LTPD," + _
    '                    '"CVE_OBS, CIUDAD, FRONTERA, FEC_PROD_LT, GLN," + _
    '                    '"STATUS) VALUES ('" + CVE_ART + "','" + pLOTE + "','" + pPEDIMENTO + "','" + NUM_ALM + "','" + pFCHCADUC + "','" + _
    '                    ' pFCHADUANA + "','" + pFCHULTMOV + "','" + pNOM_ADUAN + "','" + pCANTIDAD + "','" + pREG_LTPD + "','" + _
    '                    ' pCVE_OBS + "','" + pCIUDAD + "','" + pFRONTERA + "','" + pFEC_PROD_LT + "','" + pGLN + "','A')"
    '                    'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    'cmdFB.ExecuteNonQuery()

    '                    '---- extraer MAXIMO el E_LTPD de SAE
    '                    Dim readerLTPD As FbDataReader
    '                    sqllocal = "Select MAX(E_LTPD) AS NUM FROM ENLACE_LTPD" + vgNumEmpresa.ToString
    '                    If connFB.State = ConnectionState.Closed Then
    '                        connFB.Open()
    '                    End If
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    readerLTPD = cmdFB.ExecuteReader()
    '                    While readerLTPD.Read()
    '                        'MsgBox(reader7.Item(0))
    '                        E_LTPD = readerLTPD.Item(0).ToString
    '                        E_LTPD = Val(E_LTPD) + 1
    '                    End While
    '                    If E_LTPD = "" Then E_LTPD = "1"
    '                    readerLTPD.Close()
    '                    sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" + _
    '                    E_LTPD + "','" + pREG_LTPD.ToString + "','" + CANT.ToString + "','" + CANT.ToString + "')"
    '                    cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                    cmdFB.ExecuteNonQuery()
    '                    If pCANTIDAD >= vvCantFaltante Then
    '                        Exit While
    '                    End If
    '                    ''-----------PARA QUE FUNCIONE LAS PACIALIDADES DE OC
    '                    'SqlSelection = "UPDATE  Logistik_Lote_Pedimento SET STATUS='A' " + _
    '                    '" WHERE CVE_ALM = '" + Trim(NUM_ALM.ToString) + "' and CVE_ART = '" + CVE_ART + _
    '                    '"' and CVE_DOC = '" + Trim(pcve_doc_origen.ToString) + "' and STATUS ='N'" + _
    '                    '" AND REG_LTPD = '" + pREG_LTPD.ToString + "'"
    '                    'cmd = New SqlCommand(SqlSelection, conn)
    '                    'cmd.ExecuteNonQuery()

    '                End While
    '                If conn.State = ConnectionState.Open Then
    '                    conn.Close()
    '                End If
    '                readerPedimento.Close()
    '                '---------------------------------------------------------------
    '                'END INSERTAR PEDIMENTOS
    '                '---------------------------------------------------------------
    '            End If
    '            If vlNumSer = "S" Then
    '                sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" + _
    '                "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" + _
    '                PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" + _
    '                DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" + _
    '                NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" + _
    '                CVE_OBS + "','" + mREG_SERIE + "','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" + _
    '                TOT_PARTIDA + "','" + POLIT_APLI + "')"
    '            Else
    '                If vgVersion = "5" Then
    '                    sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                    ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                    ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                    ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR) values (" + _
    '                    "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART + "','" + CANT.ToString + "','" + PXS + "','" + _
    '                    PREC + "','" + COST + "','" + IMPU1 + "','" + IMPU2 + "','" + IMPU3 + "','" + _
    '                    IMPU4 + "','" + IMP1APLA + "','" + IMP2APLA + "','" + IMP3APLA + "','" + IMP4APLA + "','" + _
    '                    TOTIMP1 + "','" + TOTIMP2 + "','" + TOTIMP3 + "','" + TOTIMP4 + "','" + DESC1 + "','" + _
    '                    DESC2 + "','" + DESC3 + "','" + COMI + "','" + APAR + "','S','" + _
    '                    NUM_ALM + "','" + POLIT_APLI + "','" + TIP_CAM + "','" + UNI_VENTA + "','" + TIPO_PROD + "','" + _
    '                    CVE_OBS + "','0','" + E_LTPD + "','" + TIPO_ELEM + "','" + vNum_Mov + "','" + _
    '                    TOT_PARTIDA + "','" + POLIT_APLI + "')"
    '                End If
    '                Dim VERSION_SINC As String = vfechayhora
    '                VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss")
    '                If vgVersion = "6" Or vgVersion = "7" Then
    '                    sqllocal = "insert into  PAR_FACTR" + vgNumEmpresa.ToString + "(CVE_DOC, NUM_PAR, CVE_ART, CANT, PXS, PREC, COST, IMPU1, IMPU2, IMPU3" + _
    '                    ",IMPU4, IMP1APLA, IMP2APLA, IMP3APLA, IMP4APLA, TOTIMP1, TOTIMP2, TOTIMP3, TOTIMP4, DESC1" + _
    '                    ",DESC2, DESC3, COMI, APAR, ACT_INV, NUM_ALM, POLIT_APLI, TIP_CAM, UNI_VENTA, TIPO_PROD" + _
    '                    ",CVE_OBS, REG_SERIE, E_LTPD, TIPO_ELEM, NUM_MOV, TOT_PARTIDA, IMPRIMIR" + _
    '                    ",VERSION_SINC, MAN_IEPS, APL_MAN_IMP, CUOTA_IEPS, APL_MAN_IEPS, MTO_PORC, MTO_CUOTA, CVE_ESQ) values (" + _
    '                    "'" + pcvedoc + "','" + NUM_PAR.ToString + "','" + CVE_ART.ToString + "','" + CANT.ToString + "','" + PXS.ToString + "','" + _
    '                    PREC.ToString + "','" + COST.ToString + "','" + IMPU1.ToString + "','" + IMPU2.ToString + "','" + IMPU3.ToString + "','" + _
    '                    IMPU4.ToString + "','" + IMP1APLA.ToString + "','" + IMP2APLA.ToString + "','" + IMP3APLA.ToString + "','" + IMP4APLA.ToString + "','" + _
    '                    TOTIMP1.ToString + "','" + TOTIMP2.ToString + "','" + TOTIMP3.ToString + "','" + TOTIMP4.ToString + "','" + DESC1.ToString + "','" + _
    '                    DESC2.ToString + "','" + DESC3.ToString + "','" + COMI.ToString + "','" + APAR.ToString + "','S','" + _
    '                    Trim(NUM_ALM.ToString) + "','" + POLIT_APLI.ToString + "','" + TIP_CAM.ToString + "','" + UNI_VENTA.ToString + "','" + TIPO_PROD.ToString + "','" + _
    '                    CVE_OBS.ToString + "','0','" + E_LTPD.ToString + "','" + TIPO_ELEM.ToString + "','" + vNum_Mov.ToString + "','" + _
    '                    TOT_PARTIDA.ToString + "','" + POLIT_APLI.ToString + "','" + VERSION_SINC.ToString + "','N','1','0','C','0','0','1')"
    '                End If

    '            End If
    '            If connFB.State = ConnectionState.Closed Then
    '                connFB.Open()
    '            End If
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()

    '            'INSERTAR EL INDICE
    '            sqllocal = "insert into  PAR_FACTR_CLIB" + vgNumEmpresa.ToString + "(CLAVE_DOC, NUM_PART) VALUES ('" + pcvedoc + "','" + NUM_PAR.ToString + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'actualizar detalle PAR_FACTP01
    '            'sqllocal = "update PAR_FACTP" + vgNumEmpresa.ToString + " set PXS = PXS - " + CANT.ToString + _
    '            '" WHERE CVE_DOC = '" + CVE_DOC + "' and CVE_ART = '" + CVE_ART + "'"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            'actualizar ACUMULADOR de remisiones y facturas
    '            '-----------camision del vendedor
    '            'If pComicion = "" Then pComicion = "0"
    '            'If Val(pComicion) >= 1 Then
    '            '    Dim VLcomi As String = (pComicion / 100) * TOT_PARTIDA
    '            '    sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '            '    " RIMP = RIMP + " + TOTIMP4 + ", RCOMI = RCOMI + " + VLcomi + _
    '            '    " WHERE CVE_AFACT = '11'"
    '            'Else
    '            sqllocal = "update AFACT" + vgNumEmpresa.ToString + " set RVTA_COM = RVTA_COM + " + TOT_PARTIDA + "," + _
    '            " RIMP = RIMP + " + TOTIMP4 + "" + _
    '            " WHERE CVE_AFACT = '11'"
    '            'End If
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            '---------EXTRAER CLAVE DEL FOLIO
    '            Dim CVE_FOLIO As String = "0"
    '            'Dim readerCONTROL As FbDataReader
    '            'Sql = "Select ULT_CVE AS num FROM TBLCONTROL" + vgNumEmpresa.ToString + " WHERE ID_TABLA='32'"
    '            'cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            'readerCONTROL = cmdFB.ExecuteReader()
    '            'While readerCONTROL.Read()
    '            '    'MsgBox(reader3.Item(0))
    '            '    CVE_FOLIO = readerCONTROL.Item(0).ToString
    '            '    'vExistencia = Val(vExistencia) + 1
    '            'End While
    '            'If CVE_FOLIO = "" Then CVE_FOLIO = "1"
    '            'readerCONTROL.Close()
    '            '-----------------------------------------------
    '            sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 44"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 55"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            'sqllocal = "UPDATE  TBLCONTROL" + vgNumEmpresa.ToString + " SET ULT_CVE = ULT_CVE + 1  WHERE ID_TABLA = 56"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()

    '            'insertar documentos siguientes
    '            sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '            "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '            "'R','" + pcvedoc + "','A','P','" + CVE_DOC + "','" + _
    '            NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            sqllocal = "INSERT INTO DOCTOSIGF" + vgNumEmpresa.ToString + "(TIP_DOC, CVE_DOC, ANT_SIG, TIP_DOC_E, CVE_DOC_E," + _
    '            "PARTIDA, PART_E, CANT_E) VALUES (" + _
    '            "'P','" + CVE_DOC + "','S','R','" + pcvedoc + "','" + _
    '            NUM_PAR.ToString + "','" + NUM_PAR.ToString + "','" + CANT.ToString + "')"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()

    '            'sqllocal = "UPDATE FOLIOSF" + vgNumEmpresa.ToString + " SET ULT_DOC = ULT_DOC + 1 WHERE TIP_DOC = 'R'"
    '            ''" FOLIODESDE = '', FOLIOHASTA = '',SERIE = '', ,FECH_ULT_DOC = '', STATUS = ''" + _
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            'actualizar las existencias
    '            'Call ActualizarExistencias(CVE_ART, CANT)
    '            sqllocal = "update INVE" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", FCH_ULTVTA='" + time.ToString("yyyy/MM/dd") + "'," + _
    '            " PEND_SURT = PEND_SURT - " + CANT.ToString + ", COSTO_PROM = '" + COST + "'," + _
    '            " ULT_COSTO = '" + COST + "', VTAS_ANL_C = VTAS_ANL_C + " + CANT.ToString + ", VTAS_ANL_M = VTAS_ANL_M + " + TOT_PARTIDA + "" + _
    '            " WHERE CVE_ART ='" + CVE_ART + "'"
    '            cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            cmdFB.ExecuteNonQuery()
    '            '-----------------------------------------------
    '            'Dim vExistencia As String = ExistenciaArticulo(CVE_ART)
    '            Dim vExistencia As String = ""
    '            Dim reader3 As FbDataReader
    '            Sql = "Select coalesce(max(EXIST),0) AS num FROM INVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + CVE_ART + "'"
    '            cmdFB = New FbCommand(Sql, connFB, objTransFB)
    '            reader3 = cmdFB.ExecuteReader()
    '            While reader3.Read()
    '                'MsgBox(reader3.Item(0))
    '                vExistencia = reader3.Item(0).ToString
    '                'vExistencia = Val(vExistencia) - Val(CANT)
    '            End While
    '            If vExistencia = "" Then vExistencia = "1"
    '            reader3.Close()

    '            If vlNumSer = "S" Then
    '                sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" + _
    '                "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                "'" + mREG_SERIE + "','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" + _
    '                "S','0','" + COST + "','N','0')"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '            Else
    '                If vgVersion = "5" Then
    '                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO) VALUES (" + _
    '                    "'" + CVE_ART + "','" + NUM_ALM + "','" + vNum_Mov + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    "'R','" + (Val(pcve_doc_origen)).ToString + "','         1','" + VEND + "','" + CANT.ToString + "','" + _
    '                    "0','" + PREC + "','" + COST + "','','" + CVE_OBS + "'," + _
    '                    "'0','" + UNI_VENTA + "','" + E_LTPD + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                    "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" + _
    '                    "S','0','" + COST + "','N','0')"
    '                End If
    '                If vgVersion = "6" Or vgVersion = "7" Then
    '                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" + _
    '                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" + _
    '                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" + _
    '                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G, COSTO_PROM_GRAL ) VALUES (" + _
    '                    "'" + CVE_ART + "','" + Trim(NUM_ALM) + "','" + vNum_Mov.ToString + "','51','" + time.ToString("yyyy/MM/dd") + "'," + _
    '                    "'R','" + pcve_doc_origen.ToString + "','" + pCve_Cliente + "','" + VEND.ToString + "','" + CANT.ToString + "','" + _
    '                    "0','" + PREC.ToString + "','" + COST.ToString + "','','" + CVE_OBS.ToString + "'," + _
    '                    "'0','" + UNI_VENTA.ToString + "','" + E_LTPD.ToString + "','" + vExistencia + "','" + TIPO_PROD + "','" + _
    '                    "1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','" + CVE_FOLIO.ToString + "','-1','" + _
    '                    "S','" + COST.ToString + "','" + COST.ToString + "','N','0','" + vExistencia.ToString + "','" + COST.ToString + "')"
    '                End If
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '                sqllocal = "UPDATE MINVE" + vgNumEmpresa.ToString + " SET CTLPOL = NULL, TIPO_PROD = NULL, AFEC_COI = NULL, CVE_OBS=NULL " + _
    '                " WHERE CVE_ART = '" + CVE_ART + "' AND ALMACEN = '" + Trim(NUM_ALM) + "'" + _
    '                " AND NUM_MOV ='" + vNum_Mov + "' AND REFER = '" + pcve_doc_origen.ToString + "'"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '                Dim VERSION_SINC As String
    '                VERSION_SINC = Convert.ToDateTime(vfechayhora).ToString("yyyy/MM/dd HH:mm:ss")
    '                sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - " + CANT.ToString + ", VERSION_SINC = '" + VERSION_SINC + "'" + _
    '                " WHERE CVE_ART = '" + CVE_ART + "'" + _
    '                " AND  CVE_ALM = '" + Trim(NUM_ALM) + "'"
    '                cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '                cmdFB.ExecuteNonQuery()
    '            End If
    '            'sqllocal = "INSERT INTO OMINVE" + vgNumEmpresa.ToString + "(CVE_OBS, STR_OBS) VALUES ('" + CVE_OBS + "','" + pObser + "')"
    '            'cmdFB = New FbCommand(sqllocal, connFB, objTransFB)
    '            'cmdFB.ExecuteNonQuery()
    '            mREG_SERIE = Val(mREG_SERIE) + 1
    '            vlsubtotal = vlsubtotal + (PREC * CANT)
    '            NUM_PAR = NUM_PAR + 1
    '        End While
    '        reader2.Close()
    '        '------------------------
    '        'objTransFB.Commit()
    '        '------------------------

    '        Return vlsubtotal
    '    Catch es As SqlException
    '        vfVerificarErrorVta = False
    '        objTransFB.Rollback()
    '        Throw es
    '        Return 0
    '    Catch ex As Exception
    '        vfVerificarErrorVta = False
    '        objTransFB.Rollback()
    '        MsgBox(ex.Message.ToString)
    '        Return 0
    '    End Try
    'End Function

    'Function fVerificarOC(ByVal pDoc As String) As Boolean
    '    Try
    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        Dim Sql As String = "SELECT CVE_DOC, CVE_ART FROM PAR_COMPO" + vgNumEmpresa.ToString + _
    '        " WHERE  CVE_DOC = '" + pDoc.ToString + "'"
    '        Dim da7 As New FbDataAdapter(Sql, connFB)
    '        Dim ds7 As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da7.Fill(ds7, "PAR_COMPO" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds7.Tables("PAR_COMPO" & vgNumEmpresa.ToString)
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        Dim CVE_DOC As String
    '        Dim CVE_ART As String
    '        If oTable.Rows.Count >= 1 Then
    '            For Each oRow In oTable.Rows
    '                CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                CVE_ART = oRow.Item("CVE_ART").ToString
    '                Dim vIDArticulo As Integer = TraerIDArtticulo(CVE_ART)
    '                If vIDArticulo <= 0 Then
    '                    Return False
    '                End If
    '            Next
    '            Return True
    '        Else
    '            Return False
    '        End If
    '    Catch ex As Exception
    '        Return False
    '        MsgBox(ex.Message.ToString)
    '    End Try

    'End Function
    'Function fVerificarPedido(ByVal pDoc As String) As Boolean
    '    Try

    '        Dim connFB As New FbConnection(My.Settings.ConexionFB1 & My.Settings.Ruta_SAE_FB & My.Settings.ConexionFB2)
    '        Dim Sql As String = "Select CVE_DOC, CVE_ART FROM PAR_FACTP" + vgNumEmpresa.ToString + _
    '        " WHERE CVE_DOC = '" + pDoc.ToString + "'"
    '        Dim da7 As New FbDataAdapter(Sql, connFB)
    '        Dim ds7 As New DataSet
    '        If connFB.State = ConnectionState.Closed Then
    '            connFB.Open()
    '        End If
    '        da7.Fill(ds7, "PAR_FACTP" & vgNumEmpresa.ToString)
    '        Dim oTable As New DataTable
    '        oTable = ds7.Tables("PAR_FACTP" & vgNumEmpresa.ToString)
    '        If connFB.State = ConnectionState.Open Then
    '            connFB.Close()
    '        End If
    '        Dim CVE_DOC As String
    '        Dim CVE_ART As String
    '        If oTable.Rows.Count >= 1 Then
    '            For Each oRow In oTable.Rows
    '                CVE_DOC = oRow.Item("CVE_DOC").ToString
    '                CVE_ART = oRow.Item("CVE_ART").ToString
    '                Dim vIDArticulo As Integer = TraerIDArtticulo(CVE_ART)
    '                If vIDArticulo <= 0 Then
    '                    Return False
    '                End If
    '            Next
    '            Return True
    '        Else
    '            Return False
    '        End If
    '    Catch ex As Exception
    '        Return False
    '        MsgBox(ex.Message.ToString)
    '    End Try

    'End Function

    Private Sub InventarioFisicoToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles InventarioFisicoToolStripMenuItem.Click
        'FrmInventarioFisico.ShowDialog()
    End Sub

    Private Sub ButtonCalicacionEmbarque_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'FormCalicacionEmbarque.ShowDialog()
    End Sub

    Private Sub ButtonMovimientosAlmacen_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'FormMovimientosAlmacen.ShowDialog()
    End Sub

    Private Sub ButtonControlEmbarquesInventarios_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'FormControlEmbarquesInventarios.ShowDialog()
    End Sub

    Private Sub ButtonPedidosSurtidos_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'FormPedidosSurtidos.ShowDialog()

    End Sub

    Private Sub CheckBoxMostrar_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBoxMostrar.CheckedChanged
        If CheckBoxMostrar.Checked = True Then CheckBoxEnviado.Checked = False
        Call LlenarProveedores()
    End Sub

    Private Sub CheckBoxEnviado_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBoxEnviado.CheckedChanged
        If CheckBoxEnviado.Checked = True Then CheckBoxMostrar.Checked = False
        Call LlenarProveedores()
    End Sub

    Private Sub ButtonNegativos_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ButtonNegativos.Click
        If vgControlSync = 0 Then
            Dim StatusDate As String
            Timer1.Enabled = False
            'Timer2.Stop()
            'Timer3.Enabled = False
            'Timer4.Enabled = False
            StatusDate = InputBox("Escribe el password:", "Enter Autorizacion", " ")
            If StatusDate = "godinez" Then
                vgNumEmpresa = "06"
                Label5.Text = "Sincronizando Ubicaciones Mantenimiento del SQL al SAE..."
                Me.Refresh()
                Dim OrdenVenta As String = ""
                Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=LogistikMasterValvulerias06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
                Dim conn As New SqlConnection(Str)
                Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=SAE80_EMP06;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.vgBDOtroLado_Pass + ";"
                Dim conn2 As New SqlConnection(Str2)
                Dim vArt As String
                Dim vAlm_orig As String
                Dim vAlm_des As String
                Try

                    sqllocal = "SELECT id_order, Almacen_origen, Almacen_destino, Documento, EnviadaSAE, num_pedido" +
                    " FROM Logistik_Traspasos WHERE EnviadaSAE='U' and current_state = '8'"
                    LabelTABLA.Text = "M Logistik_Transpasos"
                    LabelQuery.Text = sqllocal
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    Dim daPC As New SqlDataAdapter(sqllocal, conn)
                    Dim dsPC As New DataSet
                    daPC.Fill(dsPC, "Logistik_TraspasosUbicaciones")
                    Dim oTablePC As New DataTable
                    oTablePC = dsPC.Tables("Logistik_TraspasosUbicaciones")
                    Dim vEnviadoSAE As String
                    Dim vDocumento As String = "0"
                    Dim Vpedido As String
                    For Each oRowPC In oTablePC.Rows
                        OrdenVenta = oRowPC.Item("id_order").ToString
                        ' especificar documento
                        vDocumento = Trim(oRowPC.Item("Documento").ToString)
                        vEnviadoSAE = Trim(oRowPC.Item("EnviadaSAE").ToString)
                        'agregar ceros
                        vDocumento = espacios(vDocumento, 20)
                        vAlm_orig = oRowPC.Item("Almacen_origen").ToString
                        vAlm_des = oRowPC.Item("Almacen_destino").ToString
                        Vpedido = oRowPC.Item("num_pedido").ToString
                        '--------------consecutivo traspaso SAE
                        Dim vConsecSAE As String = oRowPC.Item("id_order").ToString
                        'sqllocal = "SELECT num_doc FROM Logistik_Consecutivo_SAE"
                        'Dim daPC1 As New SqlDataAdapter(sqllocal, conn)
                        'Dim dsPC1 As New DataSet
                        'daPC1.Fill(dsPC1, "Logistik_Consecutivo_SAE")
                        'Dim oTablePC1 As New DataTable
                        'oTablePC1 = dsPC1.Tables("Logistik_Consecutivo_SAE")
                        'If oTablePC1.Rows.Count >= 1 Then
                        '    For Each oRowPC7 In oTablePC1.Rows
                        '        vConsecSAE = oRowPC7.Item("num_doc").ToString
                        '        vConsecSAE = vConsecSAE + 1
                        '        sqllocal = "update Logistik_Consecutivo_SAE set num_doc = num_doc + 1"
                        '        EjecutarQuerySQL(sqllocal)
                        '        Exit For
                        '    Next
                        'Else - 5536871401 ab tomic 2 x 1 y una faja
                        '    sqllocal = "insert into Logistik_Consecutivo_SAE(num_doc) values ('1')"
                        '    EjecutarQuerySQL_EMPRESA(sqllocal)
                        '    vConsecSAE = 1
                        'End If
                        '--------------------------------------
                        If vConsecSAE > 0 Then
                            vConsecSAE = espacios(vConsecSAE, 20)
                            sqllocal = "SELECT product_upc, product_quantity, quantity_input, quantity_output" +
                            " FROM Logistik_Traspasos_detail WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                            LabelTABLA.Text = "M Logistik_Traspasos_detail"
                            LabelQuery.Text = sqllocal
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            Dim da As New SqlDataAdapter(sqllocal, conn)
                            Dim ds As New DataSet
                            da.Fill(ds, "Logistik_Traspasos_detail")
                            Dim oTable As New DataTable
                            oTable = ds.Tables("Logistik_Traspasos_detail")
                            Dim vCant As Double
                            Dim vCantPed As Double

                            '-------------------------------------------
                            If conn2.State = ConnectionState.Closed Then
                                conn2.Open()
                            End If
                            '---------------------------------------
                            'objTrans = conn2.BeginTransaction()
                            '--------------------------------------
                            Dim vMovimiento As Integer = 0
                            Dim vEntrada As String = "B"
                            For Each oRow In oTable.Rows
                                vArt = oRow.Item("product_upc").ToString
                                vCant = oRow.Item("product_quantity").ToString
                                'verificar si existe el producto y existencia almacen en el almacen destino
                                '---------------------------------------------------------------------
                                sqllocal = "SELECT CVE_ART, EXIST FROM MULT" + vgNumEmpresa.ToString +
                                " WHERE CVE_ART = '" + vArt.Trim + "' AND CVE_ALM ='" + vAlm_orig.Trim + "'"
                                LabelTABLA.Text = "M MULT"
                                LabelQuery.Text = sqllocal
                                Dim readerEXIST1 As SqlDataReader
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn2)
                                readerEXIST1 = cmd.ExecuteReader()
                                Dim vValor_Orig As String = ""
                                'Dim ExistAlmDest As String
                                While readerEXIST1.Read()
                                    'MsgBox("CORRECTO")
                                    vValor_Orig = (readerEXIST1.Item(1).ToString)
                                    'ExistAlmDest = readerEXIST1.Item(1).ToString
                                    'readerEXIST.Close()
                                End While
                                readerEXIST1.Close()
                                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                                sqllocal = "SELECT mm.CVE_ART, mm.EXIST FROM MULT" + vgNumEmpresa.ToString + " as mm" +
                                " WHERE mm.CVE_ART = '" + vArt.Trim + "' AND mm.CVE_ALM ='" + vAlm_des.Trim + "'"
                                LabelTABLA.Text = "S MULT2"
                                LabelQuery.Text = sqllocal
                                Dim readerEXIST As SqlDataReader
                                If conn2.State = ConnectionState.Closed Then
                                    conn2.Open()
                                End If
                                cmd = New SqlCommand(sqllocal, conn2)
                                readerEXIST = cmd.ExecuteReader()
                                Dim vValor_Dest As String = ""
                                'Dim ExistAlmDest As String
                                While readerEXIST.Read()
                                    'MsgBox("CORRECTO")
                                    vValor_Dest = readerEXIST.Item(1).ToString
                                    'ExistAlmDest = readerEXIST.Item(1).ToString
                                    'readerEXIST.Close()
                                End While
                                readerEXIST.Close()

                                Try
                                    '---------------------------------------
                                    objTrans = conn2.BeginTransaction()
                                    '--------------------------------------
                                    '---------------------crear el o los movimientos de salida por traspaso
                                    Dim vNum_Mov As String
                                    Dim vcont7 As String = ""
                                    Dim reader7 As SqlDataReader
                                    sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num FROM MINVE" + vgNumEmpresa.ToString
                                    LabelTABLA.Text = "M MINVE"
                                    LabelQuery.Text = sqllocal
                                    If conn2.State = ConnectionState.Closed Then
                                        conn2.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    reader7 = cmd.ExecuteReader()
                                    While reader7.Read()
                                        vcont7 = reader7.Item(0).ToString
                                        vcont7 = Val(vcont7) + 1
                                    End While
                                    If vcont7 = "" Then vcont7 = "1"
                                    vNum_Mov = vcont7
                                    reader7.Close()
                                    '-------------traer y costo existencia - la cantidad de salida
                                    Dim vCosto As String = "0"
                                    'Dim vExistenia As Double = vValor_Orig
                                    'sqllocal = "Select ISNULL(max(M.NUM_MOV),1) AS num," + _
                                    '" (SELECT M1.COSTO FROM MINVE" + vgNumEmpresa.ToString + " M1 WHERE M1.CVE_ART = '" + vArt.ToString + "' AND M1.ALMACEN = '" + vAlm_orig.ToString + "' AND M1.NUM_MOV = MAX(M.NUM_MOV)) AS COSTO, " + _
                                    '" (SELECT EXISTENCIA FROM MINVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt.ToString + "' AND ALMACEN = '" + vAlm_orig.ToString + "' AND NUM_MOV = MAX(M.NUM_MOV)) AS EXIST " + _
                                    '" FROM MINVE" + vgNumEmpresa.ToString + " M WHERE M.CVE_ART = '" + vArt.ToString + "' and M.ALMACEN = '" + vAlm_orig.ToString + "'"
                                    'LabelTABLA.Text = "M MINVE2"
                                    'LabelQuery.Text = sqllocal
                                    'Dim reader As SqlDataReader
                                    'If conn2.State = ConnectionState.Closed Then
                                    '    conn2.Open()
                                    'End If
                                    'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    'reader = cmd.ExecuteReader()
                                    'While reader.Read()
                                    '    vCosto = reader.Item(1).ToString
                                    '    If reader.Item(2).ToString = "" Then
                                    '        vExistencia = 0
                                    '    Else
                                    '        vExistencia = reader.Item(2).ToString
                                    '    End If
                                    'End While
                                    If vCosto = "" Then vCosto = "0"
                                    vValor_Orig = vValor_Orig - vCant
                                    'vExistencia = vExistencia - vCant
                                    'ExistAlmDest = ExistAlmDest - vCant
                                    'reader.Close()
                                    '-------------traer tipo de producto y unida de medida
                                    Dim vUM As String = ""
                                    Dim vTip_Art As String = ""
                                    Dim reader3 As SqlDataReader
                                    sqllocal = "Select UNI_MED, TIPO_ELE, EXIST FROM INVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt + "'"
                                    LabelTABLA.Text = "M INVE"
                                    LabelQuery.Text = sqllocal
                                    If conn2.State = ConnectionState.Closed Then
                                        conn2.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    reader3 = cmd.ExecuteReader()
                                    Dim EXISTG As String
                                    While reader3.Read()
                                        vUM = reader3.Item(0).ToString
                                        vTip_Art = reader3.Item(1).ToString
                                        EXISTG = reader3.Item(2).ToString
                                    End While
                                    reader3.Close()
                                    'insertar movimiento de disminucion
                                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G) VALUES (" +
                                    "'" + vArt + "','" + vAlm_orig + "','" + vNum_Mov + "','58','" + time.ToString("yyyy/MM/dd") + "'," +
                                    "'M','" + vConsecSAE + "','0','0','" + vCant.ToString + "','0','0','" + vCosto + "','0','0'," +
                                    "'0','" + vUM + "','0','" + vValor_Orig.ToString + "','" + vTip_Art + "'," +
                                    "'1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','-1','" +
                                    "S','0','" + vCosto + "','S','0','" + EXISTG.ToString + "')"
                                    LabelTABLA.Text = "M INVE2"
                                    LabelQuery.Text = sqllocal
                                    If conn2.State = ConnectionState.Closed Then
                                        conn2.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - '" + vCant.ToString + "'" +
                                               " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_orig + "'"
                                    LabelTABLA.Text = "M MULT"
                                    LabelQuery.Text = sqllocal
                                    If conn2.State = ConnectionState.Closed Then
                                        conn2.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    '---------------------crear el o los movimientos de entrada por traspaso
                                    Dim readerMinve As SqlDataReader
                                    sqllocal = "Select ISNULL(max(NUM_MOV),1) AS num FROM MINVE" + vgNumEmpresa.ToString
                                    LabelTABLA.Text = "M MINVE"
                                    LabelQuery.Text = sqllocal
                                    If conn2.State = ConnectionState.Closed Then
                                        conn2.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    readerMinve = cmd.ExecuteReader()
                                    While readerMinve.Read()
                                        vcont7 = readerMinve.Item(0).ToString
                                        vcont7 = Val(vcont7) + 1
                                    End While
                                    If vcont7 = "" Then vcont7 = "1"
                                    vNum_Mov = vcont7
                                    readerMinve.Close()
                                    '-------------traer y costo existencia + la cantidad de entrada
                                    'sqllocal = "Select ISNULL(max(M.NUM_MOV),1) AS num," + _
                                    '" (SELECT M1.COSTO FROM MINVE" + vgNumEmpresa.ToString + " M1 WHERE M1.CVE_ART = '" + vArt.ToString + "' AND M1.ALMACEN = '" + vAlm_des.ToString + "' AND M1.NUM_MOV = MAX(M.NUM_MOV)) AS COSTO, " + _
                                    '" (SELECT EXISTENCIA FROM MINVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + vArt.ToString + "' AND ALMACEN = '" + vAlm_des.ToString + "' AND NUM_MOV = MAX(M.NUM_MOV)) AS EXIST " + _
                                    '" FROM MINVE" + vgNumEmpresa.ToString + " M WHERE M.CVE_ART = '" + vArt.ToString + "' and M.ALMACEN = '" + vAlm_des.ToString + "'"
                                    'LabelTABLA.Text = "M MINVE"
                                    'LabelQuery.Text = sqllocal
                                    'Dim reader5 As SqlDataReader
                                    'If conn2.State = ConnectionState.Closed Then
                                    '    conn2.Open()
                                    'End If
                                    'cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    'reader5 = cmd.ExecuteReader()
                                    'While reader5.Read()
                                    '    vCosto = reader5.Item(1).ToString
                                    '    If reader5.Item(2).ToString = "" Then
                                    '        vExistencia = 0
                                    '    Else
                                    '        vExistencia = reader5.Item(2).ToString
                                    '    End If
                                    'End While
                                    'vExistencia = vAlm_des
                                    If vCosto = "" Then vCosto = "0"
                                    vValor_Dest = vValor_Dest + vCant
                                    'vExistencia = vExistencia + vCant
                                    'reader5.Close()
                                    'insertar movimiento de aumento
                                    sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                                    ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                                    ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                                    ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G) VALUES (" +
                                    "'" + vArt + "','" + vAlm_des + "','" + vNum_Mov + "','7','" + time.ToString("yyyy/MM/dd") + "'," +
                                    "'M','" + vConsecSAE + "','0','0','" + vCant.ToString + "','0','0','" + vCosto + "','0','0'," +
                                    "'0','" + vUM + "','0','" + vValor_Dest.ToString + "','" + vTip_Art + "'," +
                                    "'1','" + vfechayhora.ToString("yyyy/MM/dd HH:mm:ss") + "','0','1','1','" +
                                    "S','0','" + vCosto + "','S','0','" + EXISTG.ToString + "')"
                                    LabelTABLA.Text = "M MINVE"
                                    LabelQuery.Text = sqllocal
                                    If conn2.State = ConnectionState.Closed Then
                                        conn2.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + '" + vCant.ToString + "'" +
                                               " WHERE CVE_ART = '" + vArt + "' AND CVE_ALM ='" + vAlm_des + "'"
                                    LabelTABLA.Text = "M MULT"
                                    LabelQuery.Text = sqllocal
                                    If conn2.State = ConnectionState.Closed Then
                                        conn2.Open()
                                    End If
                                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                    cmd.ExecuteNonQuery()
                                    vMovimiento = 1
                                    '------------------------
                                    objTrans.Commit()
                                    '------------------------
                                Catch ex As Exception
                                    objTrans.Rollback()
                                End Try
                            Next
                            '------------------------------------------
                            'cambiar el status de envio
                            If vMovimiento = 1 Then

                                Dim sql As String = "update Logistik_Traspasos SET EnviadaSAE = 'S', Doc_Salida ='" + vConsecSAE + "'" +
                                " WHERE id_order = '" + OrdenVenta.Trim + "'"
                                EjecutarQuerySQL_EMPRESA(sql)
                                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                                empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                                documento = OrdenVenta.ToString
                                If Vpedido = "" Then
                                    mensaje = "TRASPASO producto:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                                Else
                                    mensaje = "TRASPASO producto:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des + " Pedido:" + Vpedido
                                End If
                                sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                                empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','1')"
                                EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                                'sql = "update Logistik_Consecutivo_SAE SET num_doc = num_doc + 1"
                                'EjecutarQuerySQL(sql)
                                '--------------------CREAR MOVIEMNTOS DE LA ORDEN DE COMPRA
                                sql = "Select product_upc, product_name, product_quantity " +
                                " FROM Logistik_Traspasos_detail " +
                                " WHERE id_order = '" + Trim(OrdenVenta.ToString) + "'"
                                Dim dsCargarEncabezado As New DataSet()
                                If conn.State = ConnectionState.Closed Then
                                    conn.Open()
                                End If
                                Dim dataadapter As New SqlDataAdapter(sql, conn)
                                dataadapter.Fill(dsCargarEncabezado, "Logistik_Traspasos")
                                Dim oTabla As DataTable
                                oTabla = dsCargarEncabezado.Tables("Logistik_Traspasos")
                                Dim oFila As DataRow
                                Dim vArt7 As String = ""
                                Dim vDesc7 As String = ""
                                Dim vCant7 As String = ""
                                'dim vFecha as String =
                                If oTabla.Rows.Count >= 1 Then
                                    For Each oFila In oTabla.Rows
                                        vArt7 = oFila.Item("product_upc").ToString
                                        vDesc7 = oFila.Item("product_name").ToString
                                        vCant7 = Convert.ToDouble(oFila.Item("product_quantity").ToString)
                                        If Len(vCant) >= 1 Then
                                            sql = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                            "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino) VALUES (" +
                                            "'" + Trim(OrdenVenta.ToString) + "','Salida x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                            vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                            vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_des.ToString + "','" + vAlm_orig.ToString + "')"
                                            EjecutarQuerySQL_EMPRESA(sql)
                                            '---------------------------------------------------------
                                            sql = "INSERT INTO Logistik_Movimientos(IdComVtaTras,Tipo_Mov,Fecha,Codigo_Producto,Descripcion," +
                                            "Cantidad,Largo,Ancho,Ubicacion,Etiqueta,Estado,IdPedido,Lote,Pedimento,vchgReferencia,Alm_Origen,Alm_Destino ) VALUES (" +
                                            "'" + Trim(OrdenVenta.ToString) + "','Entrada x Traspaso','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" +
                                            vArt7.ToString + "','" + vDesc7.ToString + "','" +
                                            vCant7.ToString + "','0','0','0','0','7','0','0','0','0','" + vAlm_orig.ToString + "','" + vAlm_des.ToString + "')"
                                            EjecutarQuerySQL_EMPRESA(sql)
                                            '---------------------------------------------------------
                                        End If
                                    Next
                                End If
                            End If
                        End If
                    Next

                Catch es As SqlException
                    empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                    documento = OrdenVenta.ToString
                    mensaje = "Error TRASPASO, el producto no existe:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    If es.ErrorCode = 40 Or es.ErrorCode = 0 Then
                        Me.Dispose()
                        'FrmLogin.Dispose()
                    End If
                    Throw es
                Catch ex As Exception
                    empresa = "LogistikMasterValvulerias" & vgNumEmpresa
                    documento = OrdenVenta.ToString
                    mensaje = "Error TRASPASO, el producto no existe:" + vArt + " Alm_origen:" + vAlm_orig + " Alm_dest:" + vAlm_des
                    sqllocal = "INSERT INTO Logistik_log(empresa,documento,fechahora,mensaje,positivo) values ('" +
                    empresa.ToString + "','" + documento.ToString + "','" + Format(Date.Now, "yyyyMMdd HH:mm:ss") + "','" + mensaje.ToString + "','2')"
                    EjecutarQuerySQL_EMPRESA_X(sqllocal, "LogistikMasterValvulerias06")
                    Me.Refresh()
                    Throw ex
                Finally
                    If conn2.State <> ConnectionState.Closed Then conn2.Close()
                    If conn.State <> ConnectionState.Closed Then conn.Close()
                    Timer1.Enabled = True
                    'Timer2.Stop()
                    'Timer3.Enabled = True
                    'Timer4.Enabled = True
                    TextHora.Text = "1"
                    vconttimer = 1
                    Minuto = 0
                End Try
            End If
            Timer1.Enabled = True
            'Timer2.Stop()
            'Timer3.Enabled = True
            'Timer4.Enabled = True
            TextHora.Text = "1"
            vconttimer = 1
            Minuto = 0
            Call LlenarProveedores()
            Me.Refresh()
        Else
            MsgBox("No se puede usar hasta que termine de sincronizar", "Mantenimiento")
        End If
    End Sub

    Private Sub PictureBox2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PictureBox2.Click
        'FrmAccesoBD.ShowDialog()
    End Sub

    Private Sub SalirToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SalirToolStripMenuItem.Click
        'Me.Dispose()
        Application.ExitThread()

    End Sub

    Private Sub BttmAjustarInventario_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles BttmAjustarInventario.Click
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=Logistik_codeba;Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn As New SqlConnection(Str)
        Try

            sqllocal = "SELECT IRC.id_invResutladoCod, IRC.edo, IRC.id_inventario, IRC.id_almacen, IRC.cod " +
            ", IRC.cant_teo, IRC.cant_t1, IRC.cant_v1, IRC.cant_conciliada, IRC.dif_teo_t1 " +
            ", IRC.dif_teo_v1, IRC.fUpd, IP.id_cod, IP.edo, IP.cod, " +
            " IP.descripcion, IP.actv_lote, IP.actv_caducidad, IP.actv_pedimento  " +
            " FROM  Logistik_Codeba.dbo.inv_resultados_cod  IRC, Logistik_Codeba.dbo.inv_productos IP " +
            " where trim(IRC.cod)= trim(IP.id_cod)"
            LabelTABLA.Text = "Ajuste Inventario inv_resultados_cod"
            LabelQuery.Text = sqllocal
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            'TextErrorEmp2.Text = "prueba 14 recepcion emp1o4"
            daPC.Fill(dsPC, "vLogistik_Embarques_RECEPCION")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("vLogistik_Embarques_RECEPCION")
            Dim OrdenCompra As String
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim id_invResutladoCod As String
            Dim edo As String
            Dim id_inventario As String
            Dim id_almacen As String
            Dim cod As String
            Dim cant_teo As Double = 0
            Dim cant_v1 As String
            Dim cant_t1 As String
            Dim cant_conciliada As Double = 0
            Dim total_te As String
            Dim dif_teo_t1 As String
            Dim dif_teo_v1 As String
            Dim fUpd As String

            Dim id_cod As String
            Dim descripcion As String
            Dim actv_lote As String
            Dim actv_caducidad As String
            Dim actv_pedimento As String
            For Each oRowPC In oTablePC.Rows
                id_invResutladoCod = oRowPC.Item("id_invResutladoCod").ToString
                edo = oRowPC.Item("edo").ToString
                id_inventario = oRowPC.Item("id_inventario").ToString
                id_invResutladoCod = oRowPC.Item("id_invResutladoCod").ToString
                id_almacen = oRowPC.Item("id_almacen").ToString
                cod = oRowPC.Item("cod").ToString
                cant_teo = Convert.ToDouble(oRowPC.Item("cant_teo").ToString)
                cant_t1 = oRowPC.Item("cant_t1").ToString
                cant_v1 = oRowPC.Item("cant_v1").ToString
                cant_conciliada = oRowPC.Item("cant_conciliada").ToString
                dif_teo_t1 = oRowPC.Item("dif_teo_t1").ToString
                dif_teo_v1 = oRowPC.Item("dif_teo_v1").ToString
                fUpd = oRowPC.Item("fUpd").ToString

                id_cod = oRowPC.Item("id_cod").ToString
                descripcion = oRowPC.Item("descripcion").ToString
                actv_lote = oRowPC.Item("actv_lote").ToString
                actv_caducidad = oRowPC.Item("actv_caducidad").ToString
                actv_pedimento = oRowPC.Item("actv_pedimento").ToString
                'id_invResutladoCod = oRowPC.Item("id_invResutladoCod").ToString
                'id_invResutladoCod = oRowPC.Item("id_invResutladoCod").ToString
                'id_invResutladoCod = oRowPC.Item("id_invResutladoCod").ToString
                'cant_teo SAE
                ' sae  >  loistik     salida
                ' 100    90           10
                ' sae  < logistik    entrada
                ' 90     100          10
                If (cant_teo > cant_conciliada) Then

                ElseIf (cant_teo < cant_conciliada) Then

                Else

                End If

            Next
        Catch ex As Exception

        End Try
    End Sub

    Private Sub Button3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button3.Click
        Label5.Text = "Ajuste de Inventario..."
        Me.Refresh()
        Dim OrdenVenta As String = ""
        Dim Str As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=Logistik_Codeba;Integrated Security=False;Uid=sa; Password=Mexpym*01;"
        Dim conn As New SqlConnection(Str)
        Dim Str2 As String = "Data Source=" + My.Settings.vgBDOtroLado_IP2 + ";Initial Catalog=SAE80EMPRE01;Integrated Security=False;Uid=sa; Password=Mexpym*01;"
        'Dim Str2 As String = "Data Source=" + My.Settings.vgCrearBD_IP + ";Initial Catalog=" + pMiBD + ";Integrated Security=False;Uid=" + My.Settings.vgBDOtroLado_User + "; Password=" + My.Settings.pass + ";"
        Dim conn2 As New SqlConnection(Str2)

        Try

            sqllocal = "SELECT id_invMovimientoAjuste,CVE_ART,LOTE,PEDIMENTO,CVE_ALM" +
                       ",FCHCADUC,FCHADUANA,NOM_ADUAN,CIUDAD,FRONTERA" +
                       ",GLN,CON_LOTE,CON_PEDIMENTO,cant_ajuste,tipo_ajuste,fUpd" +
                       " FROM inv_movimientos_ajuste"
            If conn.State = ConnectionState.Closed Then
                conn.Open()
            End If
            Dim daPC As New SqlDataAdapter(sqllocal, conn)
            Dim dsPC As New DataSet
            daPC.Fill(dsPC, "inv_movimientos_ajuste")
            Dim oTablePC As New DataTable
            oTablePC = dsPC.Tables("inv_movimientos_ajuste")
            Dim id_invMovimientoAjuste As Integer
            Dim CVE_ART As String
            Dim LOTE As String
            Dim PEDIMENTO As String
            Dim CVE_ALM As String
            Dim FCHCADUC As String
            Dim FCHADUANA As String
            Dim NOM_ADUAN As String
            Dim CIUDAD As String
            Dim FRONTERA As String
            Dim GLN As String
            Dim CON_LOTE As String
            Dim CON_PEDIMENTO As String
            Dim cant_ajuste As Double
            Dim tipo_ajuste As String
            Dim fUpd As String
            Dim vgNumEmpresa As String = "01"
            For Each oRowPC In oTablePC.Rows
                id_invMovimientoAjuste = Convert.ToInt32(oRowPC.Item("id_invMovimientoAjuste").ToString)
                CVE_ART = Trim(oRowPC.Item("CVE_ART").ToString)
                LOTE = Trim(oRowPC.Item("LOTE").ToString)
                PEDIMENTO = oRowPC.Item("PEDIMENTO").ToString
                CVE_ALM = oRowPC.Item("CVE_ALM").ToString
                FCHCADUC = oRowPC.Item("FCHCADUC").ToString
                FCHADUANA = oRowPC.Item("FCHADUANA").ToString
                NOM_ADUAN = oRowPC.Item("NOM_ADUAN").ToString

                CIUDAD = oRowPC.Item("CIUDAD").ToString
                FRONTERA = oRowPC.Item("FRONTERA").ToString
                GLN = oRowPC.Item("GLN").ToString
                CON_LOTE = oRowPC.Item("CON_LOTE").ToString
                CON_PEDIMENTO = oRowPC.Item("CON_PEDIMENTO").ToString
                cant_ajuste = oRowPC.Item("cant_ajuste").ToString
                tipo_ajuste = oRowPC.Item("tipo_ajuste").ToString
                fUpd = oRowPC.Item("fUpd").ToString
                '--------------------------------------   
                Try
                    '---------------------------------------
                    If conn2.State = ConnectionState.Closed Then
                        conn2.Open()
                    End If
                    objTrans = conn2.BeginTransaction()
                    '--------------------------------------

                    '---------------------crear el o los movimientos de salida por traspaso
                    Dim vNum_Mov As String
                    Dim vcont7 As String = ""
                    Dim reader7 As SqlDataReader
                    sqllocal = "SELECT aa.ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " aa WHERE aa.ID_TABLA = 44"
                    LabelTABLA.Text = "S MINVE"
                    LabelQuery.Text = sqllocal
                    TextBox1.Text = "5"
                    Me.Refresh()
                    If conn2.State = ConnectionState.Closed Then
                        conn2.Open()
                    End If
                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                    reader7 = cmd.ExecuteReader()
                    While reader7.Read()
                        vcont7 = reader7.Item(0).ToString
                        vcont7 = Val(vcont7) + 1
                    End While
                    If vcont7 = "" Then vcont7 = "1"
                    vNum_Mov = vcont7
                    reader7.Close()
                    '-------------traer y costo existencia - la cantidad de salida
                    Dim vCosto As String = "0"
                    Dim vUltiCosto As String = "0"
                    Dim vExistencia As Double = 0
                    If vCosto = "" Then vCosto = "0"
                    vExistencia = vExistencia - cant_ajuste
                    'reader.Close()
                    '-------------traer tipo de producto y unida de medida
                    Dim vUM As String = ""
                    Dim vTip_Art As String = ""
                    Dim reader3 As SqlDataReader
                    sqllocal = "Select UNI_MED, TIPO_ELE, EXIST, COSTO_PROM, ULT_COSTO FROM INVE" + vgNumEmpresa.ToString + " WHERE CVE_ART = '" + CVE_ART + "'"

                    LabelQuery.Text = sqllocal
                    TextBox1.Text = "6"
                    Me.Refresh()
                    If conn2.State = ConnectionState.Closed Then
                        conn2.Open()
                    End If
                    cmd = New SqlCommand(sqllocal, conn2, objTrans)
                    reader3 = cmd.ExecuteReader()
                    Dim EXISTG As String
                    While reader3.Read()
                        vUM = reader3.Item(0).ToString
                        vTip_Art = reader3.Item(1).ToString
                        EXISTG = reader3.Item(2).ToString
                        vCosto = reader3.Item(3).ToString
                        vUltiCosto = reader3.Item(4).ToString
                    End While
                    reader3.Close()
                    'tipo_ajuste = -1    realizar una salida
                    'tipo_ajuste = 1     realizar una entrada
                    If tipo_ajuste = -1 Then
                        If CON_PEDIMENTO = "S" Or CON_LOTE = "S" Then
                            sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + "  set ULT_CVE=ULT_CVE+1  WHERE ID_TABLA = 32"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + "  set ULT_CVE=ULT_CVE+1  WHERE ID_TABLA = 67"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'SALIDA
                            sqllocal = "UPDATE INVE" + vgNumEmpresa.ToString + "  set EXIST=" + EXISTG.ToString + "  , COSTO_PROM= " + vCosto.ToString +
                            " WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '/////////////////////////////////////////////////////////
                            '---- extraer el consecutivo REG_LTPD de SAE
                            Dim vConsecutivoReg_LTPD As Boolean
                            Dim readerMAx As SqlDataReader
                            Dim pREG_LTPD As String = "0"
                            sqllocal = "Select REG_LTPD AS num from LTPD" + vgNumEmpresa.ToString +
                            " WHERE PEDIMENTOSAT='" + PEDIMENTO.ToString + "' AND CVE_ART='" + CVE_ART.ToString + "'"
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            If vConsecutivoReg_LTPD = False Then
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                readerMAx = cmd.ExecuteReader()
                                While readerMAx.Read()
                                    pREG_LTPD = readerMAx.Item(0).ToString
                                    'pREG_LTPD = Val(pREG_LTPD) + 1
                                End While
                                If pREG_LTPD = "" Then pREG_LTPD = "1"
                                readerMAx.Close()
                                vConsecutivoReg_LTPD = True
                            Else
                                pREG_LTPD = Val(pREG_LTPD) + 1
                            End If
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            '------------------UPDATE PEDIMENTOS EN SAE
                            sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  - " + cant_ajuste.ToString +
                                " where PEDIMENTOSAT = '" + PEDIMENTO + "' AND CVE_ART='" + CVE_ART.ToString + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
                                " AND CVE_ALM = '" + Trim(CVE_ALM.ToString) + "'" +
                                " AND LOTE = '" + Trim(LOTE.ToString) + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '---- extraer MAXIMO el E_LTPD de SAE
                            Dim readerLTPD As SqlDataReader
                            sqllocal = "Select coalesce(max(E_LTPD),1) AS NUM from ENLACE_LTPD" + vgNumEmpresa.ToString
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerLTPD = cmd.ExecuteReader()
                            Dim E_LTPD As String = "0"
                            While readerLTPD.Read()
                                'MsgBox(reader7.Item(0))
                                E_LTPD = readerLTPD.Item(0).ToString
                                E_LTPD = Val(E_LTPD) + 1
                            End While
                            If E_LTPD = "" Then E_LTPD = "1"
                            readerLTPD.Close()
                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" +
                            E_LTPD + "','" + pREG_LTPD.ToString + "','" + cant_ajuste.ToString + "','" + cant_ajuste.ToString + "')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '/////////////////////////////////////////////////////////
                            sqllocal = "UPDATE INVE" + vgNumEmpresa.ToString + "  set EDO_PUBL_ML='A'" +
                            " WHERE EDO_PUBL_ML='P' AND CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE INVEN_CLARO" + vgNumEmpresa.ToString + "  set EDO_PUBL_CS='A'" +
                            " WHERE EDO_PUBL_CS='P' AND CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE INVE_AMAZON" + vgNumEmpresa.ToString + "  set STATUS_INV='', SUBMIT_INV_ID='', EDO_PUBL_AM='A'" +
                           " WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '/////////////////////////////////////////////////////////)

                        End If
                        'insertar movimiento de disminucion
                        Dim VERSION_SINC As String = DateTime.Now
                        VERSION_SINC = Convert.ToDateTime(VERSION_SINC).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, COSTO_PROM_GRAL, DESDE_INVE, MOV_ENLAZADO, EXIST_G) VALUES (" +
                        "'" + CVE_ART + "','" + CVE_ALM + "','" + vNum_Mov + "','59','" + time.ToString("yyyy/MM/dd") + "'," +
                        "'M','','0','0','" + cant_ajuste.ToString + "','0','0','" + vCosto + "','0','0'," +
                        "'0','" + vUM + "','0','" + vExistencia.ToString + "','" + vTip_Art + "'," +
                        "'1','" + VERSION_SINC + "','0','1','-1','" +
                        "S','" + vCosto + "','" + vCosto + "','" + vCosto + "','S','0','" + EXISTG.ToString + "')"
                        LabelQuery.Text = sqllocal
                        TextBox1.Text = "7"
                        Me.Refresh()
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST - '" + cant_ajuste.ToString + "'" +
                                   " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM ='" + CVE_ALM + "'"
                        LabelQuery.Text = sqllocal
                        TextBox1.Text = "8"
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + "  set ULT_CVE=ULT_CVE+1  WHERE ID_TABLA = 44"
                        TextBox1.Text = "9"
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If


                    End If

                    If tipo_ajuste = 1 Then
                        '---------------------crear el o los movimientos de entrada por traspaso
                        sqllocal = "SELECT aa.ULT_CVE FROM TBLCONTROL" + vgNumEmpresa.ToString + " aa WHERE aa.ID_TABLA = 44"
                        TextBox1.Text = "10"
                        Me.Refresh()
                        LabelQuery.Text = sqllocal
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        reader7 = cmd.ExecuteReader()
                        While reader7.Read()
                            'MsgBox(reader7.Item(0))
                            vcont7 = reader7.Item(0).ToString
                            vcont7 = Val(vcont7) + 1
                        End While
                        If vcont7 = "" Then vcont7 = "1"
                        vNum_Mov = vcont7
                        reader7.Close()
                        If vCosto = "" Then vCosto = "0"
                        vExistencia = vExistencia + cant_ajuste
                        If CON_PEDIMENTO = "S" Or CON_LOTE = "S" Then
                            sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + "  set ULT_CVE=ULT_CVE+1  WHERE ID_TABLA = 32"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + "  set ULT_CVE=ULT_CVE+1  WHERE ID_TABLA = 67"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            'SALIDA
                            sqllocal = "UPDATE INVE" + vgNumEmpresa.ToString + "  set EXIST=" + EXISTG.ToString + "  , COSTO_PROM= " + vCosto.ToString +
                            " WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '/////////////////////////////////////////////////////////
                            '---- extraer el consecutivo REG_LTPD de SAE
                            Dim vConsecutivoReg_LTPD As Boolean
                            Dim readerMAx As SqlDataReader
                            Dim pREG_LTPD As String = "0"
                            sqllocal = "Select REG_LTPD AS num from LTPD" + vgNumEmpresa.ToString +
                            " WHERE PEDIMENTOSAT='" + PEDIMENTO.ToString + "' AND CVE_ART='" + CVE_ART.ToString + "'"
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            If vConsecutivoReg_LTPD = False Then
                                cmd = New SqlCommand(sqllocal, conn2, objTrans)
                                readerMAx = cmd.ExecuteReader()
                                While readerMAx.Read()
                                    pREG_LTPD = readerMAx.Item(0).ToString
                                    'pREG_LTPD = Val(pREG_LTPD) + 1
                                End While
                                If pREG_LTPD = "" Then pREG_LTPD = "1"
                                readerMAx.Close()
                                vConsecutivoReg_LTPD = True
                            Else
                                pREG_LTPD = Val(pREG_LTPD) + 1
                            End If
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            '------------------UPDATE PEDIMENTOS EN SAE
                            sqllocal = "update LTPD" + vgNumEmpresa.ToString + " set CANTIDAD = CANTIDAD  + " + cant_ajuste.ToString +
                                " where PEDIMENTOSAT = '" + PEDIMENTO + "' AND CVE_ART='" + CVE_ART.ToString + "' AND REG_LTPD = '" + pREG_LTPD + "'" +
                                " AND CVE_ALM = '" + Trim(CVE_ALM.ToString) + "'" +
                                " AND LOTE = '" + Trim(LOTE.ToString) + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '---- extraer MAXIMO el E_LTPD de SAE
                            Dim readerLTPD As SqlDataReader
                            sqllocal = "Select coalesce(max(E_LTPD),1) AS NUM from ENLACE_LTPD" + vgNumEmpresa.ToString
                            If conn.State = ConnectionState.Closed Then
                                conn.Open()
                            End If
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            readerLTPD = cmd.ExecuteReader()
                            Dim E_LTPD As String = "0"
                            While readerLTPD.Read()
                                'MsgBox(reader7.Item(0))
                                E_LTPD = readerLTPD.Item(0).ToString
                                E_LTPD = Val(E_LTPD) + 1
                            End While
                            If E_LTPD = "" Then E_LTPD = "1"
                            readerLTPD.Close()
                            sqllocal = "INSERT INTO ENLACE_LTPD" + vgNumEmpresa.ToString + "(E_LTPD, REG_LTPD, CANTIDAD, PXRS) VALUES ('" +
                            E_LTPD + "','" + pREG_LTPD.ToString + "','" + cant_ajuste.ToString + "','" + cant_ajuste.ToString + "')"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '/////////////////////////////////////////////////////////
                            sqllocal = "UPDATE INVE" + vgNumEmpresa.ToString + "  set EDO_PUBL_ML='A'" +
                            " WHERE EDO_PUBL_ML='P' AND CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE INVEN_CLARO" + vgNumEmpresa.ToString + "  set EDO_PUBL_CS='A'" +
                            " WHERE EDO_PUBL_CS='P' AND CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE INVE_AMAZON" + vgNumEmpresa.ToString + "  set STATUS_INV='', SUBMIT_INV_ID='', EDO_PUBL_AM='A'" +
                           " WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            '/////////////////////////////////////////////////////////
                            sqllocal = "UPDATE INVE" + vgNumEmpresa.ToString + "  set EDO_PUBL_ML='A'" +
                            " WHERE EDO_PUBL_ML='P' AND CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE INVEN_CLARO" + vgNumEmpresa.ToString + "  set EDO_PUBL_CS='A'" +
                            " WHERE EDO_PUBL_CS='P' AND CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()
                            sqllocal = "UPDATE INVE_AMAZON" + vgNumEmpresa.ToString + "  set STATUS_INV='', SUBMIT_INV_ID='', EDO_PUBL_AM='A'" +
                           " WHERE CVE_ART = '" + CVE_ART.ToString + "'"
                            cmd = New SqlCommand(sqllocal, conn2, objTrans)
                            cmd.ExecuteNonQuery()

                        End If
                        'insertar movimiento de aumento
                        Dim VERSION_SINC7 As String = DateTime.Now
                        VERSION_SINC7 = Convert.ToDateTime(VERSION_SINC7).ToString("yyyy/MM/dd HH:mm:ss.mmm")
                        sqllocal = "INSERT INTO MINVE" + vgNumEmpresa.ToString + "(CVE_ART, ALMACEN, NUM_MOV, CVE_CPTO, FECHA_DOCU" +
                        ",TIPO_DOC, REFER, CLAVE_CLPV, VEND, CANT, CANT_COST, PRECIO, COSTO, AFEC_COI, CVE_OBS" +
                        ",REG_SERIE, UNI_VENTA, E_LTPD, EXISTENCIA, TIPO_PROD, FACTOR_CON, FECHAELAB, CTLPOL, CVE_FOLIO, SIGNO" +
                        ",COSTEADO, COSTO_PROM_INI, COSTO_PROM_FIN, DESDE_INVE, MOV_ENLAZADO, EXIST_G) VALUES (" +
                        "'" + CVE_ART + "','" + CVE_ALM + "','" + vNum_Mov + "','6','" + time.ToString("yyyy/MM/dd") + "'," +
                        "'M','','0','0','" + cant_ajuste.ToString + "','0','0','" + vCosto + "','0','0'," +
                        "'0','" + vUM + "','0','" + vExistencia.ToString + "','" + vTip_Art + "'," +
                        "'1','" + VERSION_SINC7 + "','0','1','1','" +
                        "S','0','" + vCosto + "','S','0','" + EXISTG.ToString + "')"
                        LabelQuery.Text = sqllocal
                        TextBox1.Text = "12"
                        Me.Refresh()
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE MULT" + vgNumEmpresa.ToString + " SET EXIST = EXIST + '" + cant_ajuste.ToString + "'" +
                                   " WHERE CVE_ART = '" + CVE_ART + "' AND CVE_ALM ='" + CVE_ALM + "'"
                        TextBox1.Text = "13"
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        sqllocal = "UPDATE TBLCONTROL" + vgNumEmpresa.ToString + "  set ULT_CVE=ULT_CVE+1  WHERE ID_TABLA = 44"
                        TextBox1.Text = "14"
                        Me.Refresh()
                        cmd = New SqlCommand(sqllocal, conn2, objTrans)
                        cmd.ExecuteNonQuery()
                        If conn2.State = ConnectionState.Closed Then
                            conn2.Open()
                        End If
                    End If
                    '------------------------
                    objTrans.Commit()
                    '------------------------

                Catch ex As Exception
                    objTrans.Rollback()
                End Try
            Next
            MsgBox("A finalizado con exito el ajuste inventario", MsgBoxStyle.Information + MsgBoxStyle.OkOnly)
        Catch ex As Exception
            MsgBox(ex.Message.ToString)
        End Try

    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        CamposLibres.ShowDialog()
    End Sub

    'Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
    '    CamposLibres.ShowDialog()
    'End Sub
    'Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
    '    'TextBox3.Text = TextBox2.Text
    '    'If Len(TextBox3.Text) >= 1 Then
    '    '    Dim Resul As Decimal = Convert.ToDecimal(TextBox3.Text)
    '    '    'TextBox3.Text = FormatNumber(Resul, 2)
    '    '    TextBox3.Text = Resul.ToString("##########.##")
    '    'End If

    'End Sub
End Class
